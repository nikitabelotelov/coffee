define("Vdom/Vdom",["Core/helpers/Function/runDelayed","Core/core-extend","View/Executor/Markup","Core/helpers/isNewEnvironment","Core/helpers/Array/findIndex","Core/helpers/Array/uniq","Core/core-instance","Core/helpers/Array/flatten","View/Logger","Core/Serializer","Core/helpers/Function/shallowClone","View/Executor/Expressions","Core/helpers/Object/isEmpty","View/Executor/TClosure","View/Executor/Utils","require","exports","Env/Env"],function(r,o,i,a,s,u,l,d,c,f,p,h,v,m,y,g,e,N){Object.defineProperty(e,"__esModule",{value:true}),e["Vdom/_private/Synchronizer/resources/SyntheticEvent"]=true;var b=function(){"use strict";var e={},t=function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r={animationend:true,blur:false,error:false,focus:false,load:false,mouseenter:false,mouseleave:false,resize:false,scroll:false,unload:false,click:true,change:true,compositionend:true,compositionstart:true,compositionupdate:true,copy:true,cut:true,paste:true,dblclick:true,focusin:true,focusout:true,input:true,keydown:true,keypress:true,keyup:true,mousedown:true,mousemove:true,mouseout:true,mouseover:true,mouseup:true,select:true,wheel:true,touchstart:true,touchend:true,touchmove:true,contextmenu:true,swipe:true};function n(e,t){var n=e?e:t;this.nativeEvent=e?e:null,this.type=n.type,this.target=n.target,this._bubbling=e?r[n.type]:t&&t._bubbling,this.stopped=false}var o=(t.default=n).prototype;o.stopPropagation=function(){if(this.stopped=true,this.nativeEvent)this.nativeEvent.stopPropagation()},o.isStopped=function(){return this.stopped},o.isBubbling=function(){return this._bubbling},o.preventDefault=function(){if(this.nativeEvent)this.nativeEvent.preventDefault()},o.propagating=function(){return true===this._bubbling&&false===this.stopped},o.stopImmediatePropagation=function(){this.stopPropagation()}}(g,e);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),t=b;e["Vdom/_private/Synchronizer/resources/DirtyCheckingCompatible"]=true;var _=function(){"use strict";var e={},t=function(e,t,s,u){function n(e,t,n,r,o,i,a){return s.Compatible.createCompoundControlNode(e,t,[],n,r,o,i,a,u.getMarkupGenerator(false))}function r(e,t){if(e)delete e.editingTemplate,delete e.columns,delete e.itemContentTpl,delete e.dictionaries;for(var n in e)if(e.hasOwnProperty(n)&&!t.hasOwnProperty(n))delete e[n];return e}Object.defineProperty(t,"__esModule",{value:true}),t.createCompoundControlNode=n,t.clearNotChangedOptions=r}(g,e,y,m);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),n=_;e["Vdom/_private/Synchronizer/resources/Hooks"]=true;var C=function(){"use strict";var e={},t=function(e,t,l,a){function n(o){function e(e){var t,n=(e.nativeEvent&&e.nativeEvent.args||[]).concat(o.args);o.fn.apply(o.controlNode.control,[e].concat(n));var r=e.nativeEvent.result;if(r&&r.then)r.then(function(){o.controlNode.requestDirtyCheck(o.controlNode)});else o.controlNode.requestDirtyCheck(o.controlNode);return[o.controlNode.control,e]}if("event"===o.name)return e;else throw new Error("getEventHandlerBase: wrong event type")}Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e){this.type="ControlNodeHook",this.controlNode=e}return e}();t.ControlNodeHook=r;var o=function(){function e(e,t){this.nameForNode=e,this.control=t}return e.hookName="named-hook",e.attributeName="name",e.restrictedTags={component:true,option:true},e}();t.NamedNodeHook=o;var i=function(){function e(e,t){this.propName=e,this.value=t}return e}();function s(e,t,n){var r=e&&e["controlNodes"]||[],o;if(n(r,r.indexOf(t)),e)e["controlNodes"]=r;for(var i=0;i<r.length;i++)if(r[i]["element"]=e,a.constants.compat)r[i].control.saveOptions(r[i].control._options,r[i]);else r[i].control._container=e}function u(e){var t=e.slice(0);t.sort(function(e,t){var n=parseInt((e.id+"").replace("inst_",""),10),r=parseInt((t.id+"").replace("inst_",""),10);if(n>r)return-1;if(n<r)return 1;return 0}),t.unshift(t.length),t.unshift(0),e.splice.apply(e,t)}function d(e){return function(e,t,n,r,o,i){var a=function e(t){if(t){if(this.environment._destroyed)return;if(i)i(t);if(this.controlNode.markup&&"invisible-node"===this.controlNode.markup.type)v(this.controlNode,this.controlNode.events,this.controlNode.environment,t);s(t,this.controlNode,function(e,t){var n;if(!(-1!==t))e.push(this.controlNode),u(e)}.bind(this))}else s(this.controlNode.control._container[0],this.controlNode,function(e,t){var n;if(-1!==t)e.splice(t,1)}.bind(this))}.bind({controlNode:o,environment:o.environment});return[e,t,n,r,a?a:i]}}function c(e){var t=(e=e.arguments||e).length,n=new Array(t),r=t-1,o;if("number"!==typeof t)throw new Error("reverseArray - wrong arg");for(o=0;o!==t;o++)n[r]=e[o],r--;return n}function f(e,t){this.eventName=e,this.eventDescrArr=t,this.handlerFn=null}function p(e,t,n,r){this.eventName=e,this.environment=n,this.eventDescrArr=t.map(function(e){return e.controlNode=r,e})}function h(e,t){return e.filter(function(e){return t[0]&&t[0].value===e.value})}function v(t,e,n,r){var o;for(var i in e)if(e.hasOwnProperty(i)){var a=e[i],s=l.Event.getEventName(i),u=a.map(function(e){return e.controlNode=t,e});if(!(a instanceof p)&&!(a instanceof f)){if(!r.eventProperties)r.eventProperties={},r.eventPropertiesCnt=0;if(r.eventProperties[i])if(o=h(r.eventProperties[i],u),r.eventProperties[i]&&0===o.length)u=u.concat(r.eventProperties[i]);r.eventProperties[i]=u,r.eventPropertiesCnt++,n.addCaptureEventHandler(s,r)}}}function m(a){return function(e,t,n,r,s,u){var o,i;if(Object.keys(t.events).length>0)i=function(e){var t;if(e){if(this.environment._destroyed)return;u(e),v(this.controlNode,this.events,this.environment,e)}else for(var n in u(),this.events)if(this.events.hasOwnProperty(n)){var r=this.events[n],o=l.Event.getEventName(n),i=r.map(function(e){return e.controlNode=s,e}),a;if(!(r instanceof p)&&!(r instanceof f))if(t=this.controlNode.control._container[0],this.environment.removeCaptureEventHandler(o,t),t&&t.eventProperties)if(delete t.eventProperties[this.eventName],t.eventPropertiesCnt--,0===t.eventPropertiesCnt)delete t.eventPropertiesCnt,delete t.eventProperties}}.bind({environment:a,controlNode:s,events:t.events});return[e,t,n,r,i?i:u]}}t.FocusPropsNodeHook=i,t.setControlNodeHook=d,f.prototype.type="BubblingPhaseEventHook",p.prototype.type="CapturePhaseEventHook",t.setEventHooks=m}(g,e,h,N);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),w=C;e["Vdom/_private/Synchronizer/resources/SwipeController"]=true;var T=function(){"use strict";var e={},t=function(e,t){var o;function r(){o={minSwipeDistance:50,deviationThreshold:25,maxSwipeDuration:600}}function n(e){var t=s(e);if(a()||r()||!i(t))return;o.time=Date.now(),o.location=t,o.target=e.target}function i(e){return e.x-o.deviationThreshold>=0&&e.x+o.deviationThreshold<=window.innerWidth}function a(){return o&&o.target}function s(e){var t=e.touches?e.touches[0]:e;return{x:t.clientX,y:t.clientY}}function u(e){var t=Date.now(),n=s(e),r;if(e.target===o.target&&o.time-t<o.maxSwipeDuration)if(Math.abs(o.location.x-n.x)>o.minSwipeDistance&&Math.abs(o.location.y-n.y)<o.deviationThreshold)r=o.location.x>n.x?"left":"right";else if(Math.abs(o.location.y-n.y)>o.minSwipeDistance&&Math.abs(o.location.x-n.x)<o.deviationThreshold)r=o.location.y>n.y?"top":"bottom";return r}function l(e){if(o.target){var t=u(e);if(t){var n=new Event("swipe");n.direction=t,e.target.dispatchEvent(n),r()}}}Object.defineProperty(t,"__esModule",{value:true}),t.resetSwipeState=r,t.initSwipeState=n,t.detectSwipe=l}(g,e);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),k=T;e["Vdom/_private/Synchronizer/resources/runDelayedRebuild"]=true;var O=function(){"use strict";var e={},t=function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:true});var o,i=false,a=function e(){var t=null;if("undefined"!==typeof document)if("undefined"!==typeof document.hidden)t="hidden";else if("undefined"!==typeof document.msHidden)t="msHidden";else if("undefined"!==typeof document.webkitHidden)t="webkitHidden";return t}();function s(){i=false}function u(e){if(true===(i=e))setTimeout(s,1e3)}function l(e){if(a&&document[a])setTimeout(e,0);else if(i&&r.detection.chrome){if(window&&window.requestIdleCallback)window.requestIdleCallback(e)}else n(e)}t.animationWaiter=u,t.default=l}(g,e,r,N);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),E=O;e["Vdom/_private/Synchronizer/resources/Environment"]=true;var V=function(){"use strict";var e={},t=function(e,t,n){Object.defineProperty(t,"__esModule",{value:true});var r=n.extend({constructor:function(e,t){this._controlStateChangedCallback=e,this._rebuildIgnoreId=null},destroy:function(){this._controlStateChangedCallback=null,this._destroyed=true}}),o=r.prototype;o.forceRebuild=function(e){if(this._rebuildIgnoreId!==e&&this._controlStateChangedCallback)this._controlStateChangedCallback(e)},o.setRebuildIgnoreId=function(e){this._rebuildIgnoreId=e},o.needWaitAsyncInit=function(){return false},o.setupControlNode=function(e){e.environment=this,e.control._saveEnvironment(this,e)},o.decorateRootNode=function(e){return this._rootMapper?this._rootMapper(e):e},t.default=r}(g,e,o);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),D=V;e["Vdom/_private/Utils/Functional"]=true;var M=function(){"use strict";var e={},t=function(e,t){function o(e){var t=e.length,n=new Array(t),r;if("number"!==typeof t)throw new Error("argumentsToArray - wrong arg");for(r=0;r!==t;r++)n[r]=e[r];return n}function r(e){var n=Array.isArray(e)?e:o(arguments),r=n.length;return function(){var e=n[r-1].apply(this,arguments),t;for(t=r-2;t>=0;t--)e=e instanceof Array?n[t].apply(this,e):n[t].call(this,e);return e}}function i(e,t,n,r){var o=e.prototype,i=r,a=[],s,u;while(o&&o.constructor){if(o.hasOwnProperty(t)&&"function"===typeof o[t])if(u=o[t])a.push(u);o=o.constructor.superclass}for(s=a.length-1;-1!==s;s--)i=n(i,a[s]);return i}function n(e,t){var n;return r(a(e,t))}function a(e,t){var n;return i(e,t,function(e,t){return e.unshift(t),e},[])}function s(e,t){var n;if(!e)throw n="function"==typeof t?t():t,new Error(n||"assert")}Object.defineProperty(t,"__esModule",{value:true}),t.argumentsToArray=o,t.composeWithResultApply=r,t.reduceHierarchyFunctions=i,t.composeHierarchyFunctions=n,t.getHierarchyFunctions=a,t.assert=s}(g,e);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),P=M;e["Vdom/_private/Utils/Monad"]=true;var I=function(){"use strict";var e={},t=function(e,t,n){function a(e,t,n,r){var o=n;if(null===e||void 0===e)e=[];for(var i in e)if(e.hasOwnProperty(i))o=t.call(r,o,e[i],i,e);return o}function r(e){return n.Common.asyncRenderErrorLog(e),e}function o(e,n,r){return r.join(e,function(t){return r.join(n,function(e){return r.pure(e.concat(t))})})}function i(t,e,n){if(e.then)return e.then(function(e){return o(t,e,n)},r);return o(t,e,n)}function s(e,t,n){if(e.then)return e.then(function(e){return i(e,t,n)},r);return i(e,t,n)}function u(e,r,o,i){var t;return a(e,function(e,t,n){return s(r.call(i,t,n),e,o)},o.pure([]))}function l(r){return{join:function(e,t){var n=t(e.value);return{value:n.value,memo:r.plus(n.memo,e.memo)}},pure:function(e){return{value:e,memo:r.zero}}}}Object.defineProperty(t,"__esModule",{value:true}),t.mapM=u,t.createWriterMonad=l,t.ArrayWriterMonad=l({plus:function(e,t){return e.concat(t)},zero:[]}),t.ListMonad={join:function(e,n){return a(e,function(e,t){return e.concat(n(t))},[])},pure:function(e){return[e]}}}(g,e,y);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),x=I;e["Vdom/_private/Synchronizer/resources/TabIndex"]=true;var S=function(){"use strict";var e={},t=function(e,t,C){Object.defineProperty(t,"__esModule",{value:true});var u=1,w={a:true,link:true,button:true,input:true,select:true,textarea:true},d=1,c=2,f=4,p=8,h=16,v={hidden:d,disabled:c,"delegates-tabfocus":f,"creates-context":p,"tab-cycling":h};function m(e,t){return window.getComputedStyle(e)[t]}function n(e){var t=/\bws-(hidden|disabled)\b/g,n=e.getAttribute("class"),r,o,i,a,s,u,l;s=0;while(r=n&&t.exec(n))s|=v[r[1]];if("true"===e["ws-creates-context"]||"true"===e.getAttribute("ws-creates-context"))s|=v["creates-context"];if("true"===e["ws-delegates-tabfocus"]||"true"===e.getAttribute("ws-delegates-tabfocus"))s|=v["delegates-tabfocus"];if("true"===e["ws-tab-cycling"]||"true"===e.getAttribute("ws-tab-cycling"))s|=v["tab-cycling"];if(u=0===(s&(d|c)))u="none"!==m(e,"display")&&"invisible"!==m(e,"visibility");if(u)i=e.getAttribute("tabindex"),o=parseInt(i,10),l={enabled:true,tabStop:(a=!isNaN(o))&&o>=0||null===i&&w.hasOwnProperty(e.tagName.toLowerCase())||-1!==o&&e.hasAttribute("contenteditable"),createsContext:0!==(s&p),tabIndex:o||0,delegateFocusToChildren:0!==(s&f),tabCycling:0!==(s&h)};else l={enabled:false,tabStop:false,createsContext:false,tabIndex:0,delegateFocusToChildren:false,tabCycling:false};return l}function T(e){return e.firstElementChild?e.firstElementChild:null}function k(e){return e.lastElementChild?e.lastElementChild:null}function O(e){return e.previousElementSibling?e.previousElementSibling:null}function E(e){return e.nextElementSibling?e.nextElementSibling:null}function V(a,e,t,n,r){function o(e,t,n){var r;if(C.assert("number"===typeof e&&"number"===typeof t),e=0===e?1/0:e>0?e:-1,-1===(t=0===t?1/0:t>0?t:-1)&&-1!==e)return 1;if(-1===e&&-1!==t)return-1;if(e>t)r=n?-1:1;else if(e<t)r=n?1:-1;else r=0;return r}function i(e,t,n){var r,o,i;if(t.enabled&&!t.createsContext)o=n?k(e):T(e);if(!o)if(!(o=n?O(e):E(e))){i=e.parentNode;while(i!==a&&!o)if(!(o=n?O(i):E(i)))i=i.parentNode}return o||a}function s(e){return V(e,void 0,n?0:1,n,r)}function u(e){return n?k(e):T(e)}function l(e,t){if(t.delegateFocusToChildren&&e.childElementCount)if(e.wsControl&&e.wsControl.canAcceptFocus&&e.wsControl.canAcceptFocus())N=e;else N=s(e);return!!(!t.delegateFocusToChildren||w.hasOwnProperty(e.tagName.toLowerCase())||N)}C.assert(a&&(e||void 0!==t)&&r&&a!==e);var d,c,f,p,h,v,m=null,y,g=null,N,b;if(e)t=(v=r(e)).tabIndex,d=i(e,v,n);else d=(d=n?k(a):T(a))||a;var _=false;for(f=0;2!==f&&!p;f++){while(d!==a&&d!==e&&!p){if((c=r(d)).enabled&&c.tabStop)if(0===(h=o(c.tabIndex,t,n))&&0===f){if(l(d,c))p=d,b=N}else if(h>0)if(!p)if(0===f){if(null===m||o(c.tabIndex,m.tabIndex,n)<0)if(l(d,c))m=d,g=c.tabIndex,y=f,b=N}else if(null===m||o(c.tabIndex,m.tabIndex,n)<0||_&&o(c.tabIndex,m.tabIndex,n)<=0)if(l(d,c))m=d,g=c.tabIndex,y=f,b=N,_=false;if(-1===t&&m)p=m;if(!p)d=i(d,c,n)}if(d===a&&0===f)if(e&&(false===n&&t>0||true===n&&1!==t&&-1!==t))d=u(a);if(0===f)_=true}if(C.assert(!!p||d===e||d===a),!p&&m)if(g>=0)p=m;if(p&&b)p=b,C.assert(!!p);return p}function l(e,t,n){return V(e,void 0,t?0:1,t,n)}function r(i,e,t,a){function n(e){var t,n=null,r,o=e;while(o&&o!==i){if(!a(o).enabled)n=o;o=o.parentElement}if(!o)throw new Error("Узел fromElement должен лежать внутри узла rootElement");if((r=n||e)!==i){o=r.parentElement;while(o!==i&&!a(o).createsContext)o=o.parentElement;t=o}return{element:e,context:t}}function r(e,t){var n=e===document.documentElement||!!e.parentElement;if(!e||!e.ownerDocument||!n||e.nodeType!==u)throw new Error("Плохой параметр "+t)}r(e,"fromElement"),r(i,"rootElement");var o=n(e),s=o.element;if(s!==i)do{if(!(s=V(o.context,o.element,void 0,t,a)))if(a(o.context).tabCycling)break;else o=n(o.context)}while(!s&&o.element!==i);if(s===i)s=l(i,t,a);if(!s&&a(o.context||i).tabCycling)if(void 0===(s=l(o.context||i,t,a)))s=e;return s}function o(){var e=document.createElement("div");return e.innerHTML='<svg><foreignObject width="30" height="30">'+'<input type="text"/>'+"</foreignObject></svg>",e.firstChild.firstChild}function i(e){var t;if(!(e.ownerSVGElement||"svg"===e.nodeName.toLowerCase()))return false;var n=o();e.appendChild(n);var r=n.querySelector("input");return r.focus(),r.disabled=true,e.removeChild(n),true}function a(t){if(t.focus)t.focus();else try{HTMLElement.prototype.focus.call(t)}catch(e){i(t)}}t.getElementProps=n,t.findFirstInContext=l,t.findWithContexts=r,t.focus=a}(g,e,M);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),R=S;e["Vdom/_private/Synchronizer/resources/VdomMarkup"]=true;var A=function(){"use strict";var e={},t=function(e,t,v,m,y,s,g){function N(e,t){if(t)return e.children||[];else return m.Vdom.isVNodeType(e)?null===e.children?[]:e.children:[]}function b(e,t,n,r,o,i){if(n.stopped)return n;if(r&&m.Vdom.isTemplateVNodeType(n)&&n.children&&n.children[0])return n.children[0]=b(e,t,n.children[0],r),n;if(m.Vdom.isVNodeType(n)){if(t.control&&"Controls/Decorator/Markup"===t.control._moduleName)if(n.children&&n.children[0])n.children[0].stopped=true;var a=e(n.type,n.hprops,n.children,n.key,t,n.ref,n),s=n.type===a[0]&&n.props===a[1]&&n.children===a[2]&&n.key===a[3];if(i){if(n.type=a[0],n.props=a[1],n.children=a[2],n.key=a[3],!n.hookedInvControlIds||-1===n.hookedInvControlIds.indexOf(t.id))if(n.ref=a[4],n.hookedInvControlIds)n.hookedInvControlIds.push(t.id)}else return s?n:m.Vdom.htmlNode.apply(m.Vdom,a)}else return n}function n(e){return Array.isArray(e)?e[0]:e}function r(n,e,r,o,i){function a(e){var t=o(e)?[r(e)]:[];return n?t.concat(s.ListMonad.join(N(e,i),a)):t}return s.ListMonad.join(N(e,i),a)}function o(e){return e}function _(e,t){return r(true,e,o,m.Vdom.isControlVNodeType,t)}function C(e){return r(true,e,o,m.Vdom.isTemplateVNodeType)}function w(e,t,n){var r={create:[],createTemplates:[],destroy:[],destroyTemplates:[],update:[],updateTemplates:[],vnodeChanged:false},o,i,a,s,u,l,y;function d(e,t){function n(e){if(e)for(var t=0,n=e.length;t!==n;t++)if(void 0!==e[t].key)return true;return false}function r(e){for(var t={},n=[],r=e.length,o=0;o<r;o++){var i,a=e[o].key;if(void 0!==a)t[a]=o;else n.push(o)}return{keys:t,free:n}}var o,i,a,s,u,l,d,c,f,p,h,v,m;if(n(e)&&n(t)){for(l=r(e),d=r(t),i=l.keys,h=e.length,a=d.keys,v=t.length,u=(s=d.free).length,f=0,o=new Array(length),c=0;c!==h;c++)if(void 0!==(m=e[c]).key)if(a.hasOwnProperty(m.key))o[c]=t[a[m.key]];else o[c]=null;else if(f!==u)o[c]=t[s[f]],f++;else o[c]=null;for(p=f!==u?s[f]:v,c=0;c!==v;c++)if(void 0!==(y=t[c]).key){if(!i.hasOwnProperty(y.key))o.push(y)}else if(c>=p)o.push(t[c])}else o=t;return o}function c(e,t){var n=e&&m.Vdom.isControlVNodeType(e),r=t&&m.Vdom.isControlVNodeType(t),o=e&&m.Vdom.isTemplateVNodeType(e),i,a=o===(t&&m.Vdom.isTemplateVNodeType(t)),s=n===r;if(s){if(n)s=e.controlClass===t.controlClass&&e.key===t.key;else if((s=e.type===t.type)&&m.Vdom.isVNodeType(e))s=e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key}else if(a)if(o)s=e.template===t.template&&e.key===t.key;else if((s=e.type===t.type&&e.compound===t.compound)&&m.Vdom.isVNodeType(e))s=e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key;return s}function f(e,t,n){e[t]=e[t].concat(n)}if(e!==t||n)if(v.coreDebug.checkAssertion(!!t,"newNode !== null"),c(e,t))if(m.Vdom.isControlVNodeType(t))if(-1===e.controlNodeIdx)r.create.push(t);else r.update.push({oldNode:e,newNode:t});else if(m.Vdom.isTemplateVNodeType(t))if(!t.children&&t===e)r.createTemplates.push(t);else r.updateTemplates.push({oldNode:e,newNode:t});else{a=d(i=N(e),N(t)),s=Math.max(i.length,a.length);var p=0,h=a!==t.children;if(i.length!==a.length)r.vnodeChanged=true;for(u=0;u!==s;u++){if((l=i[u])&&"vdom-focus-in"===l.key&&!h){p++;continue}if(y=a[u-p],l&&y)o=w(l,y,n),r.vnodeChanged=r.vnodeChanged||o,f(r,"create",o.create),f(r,"destroy",o.destroy),f(r,"update",o.update),f(r,"createTemplates",o.createTemplates),f(r,"destroyTemplates",o.destroyTemplates),f(r,"updateTemplates",o.updateTemplates);else if(l)if(m.Vdom.isControlVNodeType(l))f(r,"destroy",[l]);else if(m.Vdom.isTemplateVNodeType(t))f(r,"destroy",_(l,true));else f(r,"destroy",_(l,true));else if(m.Vdom.isControlVNodeType(y))f(r,"create",[y]);else if(m.Vdom.isTemplateVNodeType(y))f(r,"createTemplates",[y]);else f(r,"create",_(y)),f(r,"createTemplates",C(y))}}else{if(r.vnodeChanged=true,m.Vdom.isControlVNodeType(t))r.create.push(t);else if(m.Vdom.isTemplateVNodeType(t))r.createTemplates.push(t);else f(r,"create",_(t)),f(r,"createTemplates",C(t));if(e)if(m.Vdom.isControlVNodeType(e))r.destroy.push(e);else if(m.Vdom.isTemplateVNodeType(e))f(r,"destroy",_(e,true));else f(r,"destroy",_(e,true))}return r}function i(e,t){var n;for(n in t)if(t.hasOwnProperty(n))if(!e.hasOwnProperty(n)||e[n]!==t[n])return true;for(n in e)if(e.hasOwnProperty(n)&&!t.hasOwnProperty(n))return true;return false}function T(e,t){return i(e.attributes,t.attributes)||i(e.events,t.events)||i(e.hooks,t.hooks)}function k(n,r,o,e,t){var i,a,s,u,l,d,c,f=false;if(m.Vdom.isControlVNodeType(r)){if(o)return r;if((i=n[r.controlNodeIdx].fullMarkup)&&i.type&&"invisible-node"===i.type){if(t&&t.type){if(!t.hookedInvControlIds)t.hookedInvControlIds=[];b(g.setControlNodeHook(n[r.controlNodeIdx]),n[r.controlNodeIdx],t,true,false,true)}i=m.Vdom.textNode("",n[r.controlNodeIdx].key)}}else if(m.Vdom.isTemplateVNodeType(r)&&!r.children)i=r;else if(!m.Vdom.isTemplateVNodeType(r)&&!m.Vdom.isVNodeType(r)||!r.children||0===r.children.length)i=r;else{a=0,u=(s=m.Vdom.isTemplateVNodeType(r)?r.children:N(r)).length;while(a!==u){if((l=k(n,s[a],o,void 0,r)).changed)f=true;if(l!==s[a])break;a++}if(a===u){if(i=r,!f&&e)if(i.children&&e.children)if(i.children.length!==e.children.length)f=true;else for(var p=0;p<i.children.length;p++)if(i.children[p]!==e.children[p]||e.children[p]&&e.children[p].changed){f=true;break}}else{if(c=s.slice(a+1).map(function(e){var t=k(n,e,o,void 0,r);if(t.changed)f=true;return t}),c=y(c,true),d=s.slice(0,a).concat(Array.isArray(l)?l:[l]).concat(c),m.Vdom.isTemplateVNodeType(r)){var h;return{compound:false,children:d,childrenForDiff:r.children,template:r.template,controlProperties:r.controlProperties,parentControl:r.parentControl,attributes:r.attributes,context:r.context,changed:true,type:"TemplateNode",optionsVersions:r.optionsVersions}.children}if(e){if(!f)if(!e.children&&d||e.children.length!==d.length)f=true;else for(var p=0;p<e.children.length;p++)if(e.children[p]!==d[p]||d[p].changed){f=true;break}if(!f)f=T(r.hprops,e.hprops);if(f)(i=m.Vdom.htmlNode(r.type,r.hprops,d,r.key,r.ref)).changed=true;else i=e}else(i=m.Vdom.htmlNode(r.type,r.hprops,d,r.key,r.ref)).changed=true}}if(m.Vdom.isTemplateVNodeType(i))if(i.children)i=i.children;else m.Vdom.textNode("",i.attributes.key);if(f)i.changed=true;return i}function a(e,t){return m.Vdom.htmlNode("span",{},[m.Vdom.textNode(e,(t||"err_"+Math.trunc(1e3*Math.random()))+"_inner_text")],t||"err_"+Math.trunc(1e3*Math.random()))}function u(e,t){var n=e.control._getMarkup(e.key,t,{key:e.key,attributes:e.attributes,events:e.events,inheritOptions:e.inheritOptions,templateContext:e.templateContext,internal:e.internal,domNodeProps:e.domNodeProps}),r;if(m.Vdom.isVNodeType(n))r=b(e.markupDecorator,e,n);else if(m.Vdom.isControlVNodeType(n))r=b(e.markupDecorator,e,n);else r=n;if(!m.Vdom.isControlVNodeType(r)&&!m.Vdom.isVNodeType(r)&&!m.Vdom.isTemplateVNodeType(r))r=a("control._getMarkup должен отдавать dom-узел",e.key);return r}Object.defineProperty(t,"__esModule",{value:true}),t.getVNodeChidlren=N,t.mapVNode=b,t.getMarkupDiff=w,t.getFullMarkup=k,t.getDecoratedMarkup=u}(g,e,N,y,d,I,C);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),L=A;e["Vdom/_private/Utils/Focus"]=true;var F,q=function(){"use strict";var e={},t=function(e,t,n,r){function o(t){if(t)if(n.detection.isIE&&t.setActive)try{t.setActive()}catch(e){r.focus(t)}else r.focus(t)}Object.defineProperty(t,"__esModule",{value:true}),t.focus=o}(g,e,N,S);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Vdom/_private/Synchronizer/resources/DOMEnvironment"]=true;var H=function(){"use strict";var e={},t=function(r,e,y,f,i,d,p,o,s,l,u,h,v,a,n,c){Object.defineProperty(e,"__esModule",{value:true});var m=y.coreDebug.checkAssertion,g=9,N=function e(t){return"SPAN"===t.tagName&&"warning-container"===t.getAttribute("id")&&t.nextElementSibling&&"BODY"===t.nextElementSibling.tagName},b=function e(t,n,r){if(N(t))t.setAttribute("data-vdomignore","true"),n=true;if(8===r)n=true;return n},_=function e(t){var n=t.nodeType,r=1===n&&t.getAttribute("data-vdomignore");return r||b(t,r,n)};function C(c){return function r(e,t,n,o,i,a){var s,u,l=c(e,t,n,o,i,a),d=l[2];if(-1!==(s=f(d,function e(t){var n;return t!==p.mapVNode(r,i,t)}))&&void 0!==s)u=d.slice(s).map(p.mapVNode.bind(self,r,i)),d=d.slice(0,s).concat(u),l=[l[0],l[1],d,l[3],l[4]];return l}}function w(e){function d(e){var t,n,r,o,i;if(e)if(i=(r=e.split(";")).length)for(o=0;o!==i;o++)if(2===(n=r[o].split(":")).length){if(!t)t={};t[n[0].trim()]=n[1].trim()}return t}function l(e){var t=e.attributes,n,r=t.length,o,i,a,s,u,l=null;for(n=0;n!==r;n++)if("key"===(a=t[n]).name)l=a.value;else if("style"===a.name)i=d(a.value);else{if(!o)o={};o[a.name]=a.value}if(s={properties:u={}},o)u.attributes=o;if(i)u.style=i;if(s.key=l,"input"===e.tagName.toLowerCase()){if(!u.attributes)u.attributes={};if(!u.attributes.hasOwnProperty("value"))u.attributes.value=void 0}return s}function c(e){var t=e.nodeType,n;if(!_(e))if(e.__WS={},1===t)return r(e);else if(3===t){if("\n"===e.data||""===e.data)return e.parentNode.removeChild(e),-1;return h.Vdom.textNode(e.nodeValue)}return null}function r(e){var t=e.tagName,n="http://www.w3.org/1999/xhtml"==e.namespaceURI?null:e.namespaceURI,r=l(e),o=[],i,a=e.childNodes.length;for(i=0;i!==a;i++){var s=c(e.childNodes[i]);if(-1===s)i--,a--;else if(s)o.push(s)}var u=r&&r.properties&&r.properties.attributes||{};return n=n||h.Common.getNamespace(u),v.GeneratorVdom.createTag(t.toLowerCase(),r.properties,o,{attributes:{"ws-creates-context":"true"}})}return c(e)}function t(e,t){return!(e&&t)}function T(e,t){return t.control}function k(e){return!e.reduce(t,true)}function O(e){return e.reduce(T,true)}function E(e){return(e=e.hasOwnProperty("length")?e[0]:e)===document.documentElement||e===document.body||null===e.offsetParent?false:document.body.contains(e)}function V(e){var t=e._container.length?e._container[0].controlNodes:e._container.controlNodes;for(var n in t)if(t[n].control===e)return t[n]}function D(e){var t;if(e)if(e&&!e._options)t="Control "+e._moduleName+" with name "+(e.getName&&e.getName())+" must have _options";if(t)y.IoC.resolve("ILogger").error("DOMEnvironment","Incorrect opener or parent is found! It seems that anybody set wrong opener option! "+t)}function M(e){return e.getOpener&&e.getOpener()||e._options&&e._options.opener||e.getParent&&e.getParent()||e._options&&e._options.parent}function P(e,t){var n=e.control;if(t[t.length-1]!==n)t.push(n);var r=n._options.opener||e.parent;if(r&&!r.control)if(r._container)D(r),r=V(r);else r=null;if(r)P(r,t);else if(D(r=M(n)),r)I(r,t)}function I(e,t){if(t[t.length-1]!==e)t.push(e);var n=M(e);if(D(n),n)if(n._template){var r;P((n._container.length?n._container[0]:n._container).controlNodes[0],t)}else I(n,t)}function x(e,t){if(t=t||[],e&&e.jquery)e=e[0];if(e)if(e.controlNodes&&e.controlNodes.length)P(e.controlNodes[0],t);else if(y.constants.compat&&e.wsControl)I(e.wsControl,t);else x(e.parentNode,t);return t}function S(e,t){if(e&&e.length>0)for(var n=0;n<e.length;n++)if(t.id===e[n].id)return true;return false}var R=a.default.extend({constructor:function(e,t,n){if(m(e!==document,"Корневой контрол нельзя монтировать на document"),this._rootDOMNode=e,this._rootVNode=w(e),this._captureEventHandlers={},this._markupNodeDecorator=C(o.setEventHooks(this)),this.addCaptureProcessingHandler("focus",this._handleFocusEvent),this.addCaptureProcessingHandler("blur",this._handleBlurEvent),this.addCaptureProcessingHandler("mousedown",this._handleMouseDown),this.addCaptureProcessingHandler("click",this._handleClick),this.addCaptureProcessingHandler("touchstart",this._handleTouchstart),this.addCaptureProcessingHandler("touchmove",this._handleTouchmove),this.addCaptureProcessingHandler("touchend",this._handleTouchend),this._handleTabKey=this._handleTabKey.bind(this),this._clickState={detected:false,stage:"",timer:void 0,timeout:500,target:null,touchCount:0,timeStart:void 0},!i()&&"undefined"!==typeof window)document.body.tabIndex=0;a.default.call(this,t,n)},destroy:function(){this.runQueue(),this.removeTabListener(),this.removeCaptureEventHandler("focus"),this.removeCaptureEventHandler("blur"),this.removeCaptureEventHandler("mousedown"),this.removeCaptureEventHandler("click"),this.removeCaptureEventHandler("touchstart"),this.removeCaptureEventHandler("touchmove"),this.removeCaptureEventHandler("touchend"),this._rootDOMNode=void 0,this._rootVNode=void 0,this._captureEventHandlers={},this._handleTabKey=void 0,this.rootNodes=null,this._savedFocusedElement=void 0,R.superclass.destroy.call(this)}}),A=R.prototype;function L(e){try{if(e.control._afterMount&&e.control._afterMount(e.options,e.context),e.control._mounted=true,e.control._$needForceUpdate)delete e.control._$needForceUpdate,e.control._forceUpdate()}catch(e){c.catchLifeCircleErrors("_afterMount",e)}}function F(e,t){e.forEach(function(e){if(e.childrenNodes&&e.childrenNodes.length>0)F(e.childrenNodes,t);if(~t.indexOf(e.id))if(!e.control._mounted&&!e.control._unmounted)if(e.hasCompound)d.default(function(){L(e)});else L(e);else try{e.control._afterUpdate&&e.control._afterUpdate(e.oldOptions||e.options,e.oldContext)}catch(e){c.catchLifeCircleErrors("_afterUpdate",e)}})}function q(e){var t=e.target._cachedValue,n=e.target.value;if(void 0!==t&&t!==n){if(y.detection.isIE12)var r=new Event("change");else{var r;(r=document.createEvent("Event")).initEvent("change",true,true)}r._dispatchedForIE=true,e.target.dispatchEvent(r)}e.target._cachedValue=void 0}function H(e){if(y.detection.isIE)e._cachedValue=e.value}function U(e){if(!e)return false;if(e.classList.contains("vdom-focus-in")||e.classList.contains("vdom-focus-out"))return false;return e.parentElement===document.body&&!e.firstChild||y.detection.isIE&&e===document.body}function j(n,e,r){var t=x(n),o=x(e),i=t.find(function(e){return-1!==o.indexOf(e)});o.find(function(e){if(e!==i){var t=e._container;if(t&&t[0])t=t[0];if(t&&t.contains&&t.contains(n))return false;if(!z(t,document.body))return false;return e._notify("deactivated",[{isTabPressed:!!r,isShiftKey:r&&r.isShiftKey}]),e._active=false}else return true}),t.find(function(e){if(e!==i)return e._notify("activated",[{_$to:t[0],isTabPressed:!!r,isShiftKey:r&&r.isShiftKey}]),e._active=true,false;else return true})}A._handleTabKey=function(e){if(!this._rootDOMNode)return;var t,n;if(e.keyCode===g)if(t=l.findWithContexts(this._rootDOMNode,e.target,!!e.shiftKey,l.getElementProps),this._isTabPressed={isShiftKey:!!e.shiftKey},setTimeout(function(){this._isTabPressed=null}.bind(this),0),t){if(t.wsControl&&t.wsControl.setActive)t.wsControl.setActive(true);else l.focus(t);e.preventDefault(),e.stopImmediatePropagation()}else{if(this._rootDOMNode.wsControl)n=this._rootDOMNode.wsControl._oldKeyboardHover(e);if(false!==n);else e.preventDefault(),e.stopImmediatePropagation()}},A.addTabListener=function(){if(this._rootDOMNode)this._rootDOMNode.addEventListener("keydown",this._handleTabKey,false)},A.removeTabListener=function(){if(this._rootDOMNode)this._rootDOMNode.removeEventListener("keydown",this._handleTabKey)},A.autofocusChanges=function e(t){function o(e,t){var n;if(S(e.controlNodes,t))return e;if(e.children&&e.children.length>0){n=e.children;for(var r=0;r<n.length;r++)if(n[r].controlNodes){if(S(n[r].controlNodes,t))return i=n[r];o(n[r],t)}}return i}function n(e){var t=l.getElementProps(e);return t.tabStop="true"===e.getAttribute("ws-autofocus"),t}var i,r,a=t.control,s=t.environment,u;if(a.__$focusing&&s._rootDOMNode){if(i=o(s._rootDOMNode,t))if(r=l.findFirstInContext(i,void 0,n))l.focus(r);else l.focus(i);a.__$focusing=false}},A._handleFocusEvent=function e(t){if(H(t.target),this._rootDOMNode&&z(t.target,this._rootDOMNode)&&!U(t.target)){var n=!U(t.relatedTarget)&&t.relatedTarget||this._savedFocusedElement;if(this._savedFocusedElement=t.target,j(t.target,n,this._isTabPressed),y.constants.compat&&this._rootDOMNode&&this._rootDOMNode.controlNodes)if(this._rootDOMNode.controlNodes[0]&&this._rootDOMNode.controlNodes[0].control.isActive)if(this._rootDOMNode.controlNodes[0].control.isActive())this._rootDOMNode.controlNodes[0].control._callOnFocusInside();else r("Lib/Control/AreaAbstract/AreaAbstract.compatible")._storeActiveChildInner.apply(this._rootDOMNode.controlNodes[0].control);this._focused=true}oe.call(this,t)},A._handleBlurEvent=function e(t){var n,r;if(y.detection.isIE)if(q(t),null===t.relatedTarget)r=document.activeElement;if(n=t.target,r=r||t.relatedTarget,!i()&&r){var o;if(!W(r))j(r,n,this._isTabPressed)}oe.call(this,t)},A._handleMouseDown=function e(t){var n=t.target,r=document.documentElement;while(n!==r)if(n["ws-no-focus"]||n.getAttribute("ws-no-focus")){t.preventDefault();break}else n=n.parentNode;oe.call(this,t)};var K=[];function z(e,t){while(e.parentNode)if((e=e.parentNode)===t)return true;return false}function W(e){while(e.parentNode)if((e=e.parentNode).controlNodes)return true;return false}function Q(e){if(!this._rootDOMNode)return;var t=e.relatedTarget||document.body,n=e.target,r=document.createEvent("Events");r.initEvent("keydown",true,true);var o=false;if("vdom-focus-in"===n.className)if(z(t,this._rootDOMNode))if(!(t.classList.contains("vdom-focus-out")&&"true"===this._rootDOMNode["ws-tab-cycling"]))o=true;if("vdom-focus-out"===n.className)if(!z(t,this._rootDOMNode))o=true;r.view=window,r.altKey=false,r.ctrlKey=false,r.shiftKey=o,r.metaKey=false,r.keyCode=9,n.dispatchEvent(r)}function B(e){if(!Array.isArray(e))return null;return e.find(function(e){return!!e})}function Y(t,e){var n=B(e.children),r=function(e){Q.call(t,e)},o=function e(t){if(t)t.addEventListener("focus",r)};if(n&&"vdom-focus-in"!==n.key){var i=h.Vdom.htmlNode("a",{attributes:{class:"vdom-focus-in",tabindex:"1"}},[],"vdom-focus-in",o),a=h.Vdom.htmlNode("a",{attributes:{class:"vdom-focus-out",tabindex:"0"}},[],"vdom-focus-out",o);return e.children=[].concat(i,e.children,a),true}return false}function G(e,t){return Array.prototype.filter.call(e.children,function(e){return e.matches(t)})}function X(e){var t=e.firstChild;if(t&&t.classList&&!t.classList.contains("vdom-focus-in")){var n=G(e,".vdom-focus-in"),r=G(e,".vdom-focus-out"),o=n.length?n[0]:document.createElement("a");o.classList.add("vdom-focus-in"),o.tabIndex=1;var i=r.length?r[0]:document.createElement("a");return i.classList.add("vdom-focus-out"),i.tabIndex=0,e.insertBefore(o,t),e.appendChild(i),true}return false}function J(e,t){return e&&e.args&&e.args.length===t.length}function Z(e,t,n){return e&&e.events&&e.events[t]&&e.events[t][n]}function ee(n,e,t,r,o){var i,a=false,s="on:"+n.type.toLowerCase(),u,l,d,c,f,p;if(o)u=n.target===window||n.target===document?document.body:n.target;else u=e.element;u=o?u:e.element;while(!a){if((i=u.eventProperties)&&i[s])for(var h=t;h<i[s].length&&!a;h++){l=i[s][h].fn,d=i[s][h].args,f=J(Z(e,s,h),d)?e.events[s][h].args:d;try{if(!r.concat)throw new Error("Аргументы обработчика события "+s.slice(3)+" должны быть массивом.");if(p=f.concat(r),p=[n].concat(p),n.currentTarget=u,!l.control._destroyed&&(!e||l.control!==e.control))l.apply(l.control,p);if(p=[],n.currentTarget=void 0,!n.propagating()){var v;if(!(!n.isStopped()&&i[s][h+1]&&(i[s][h+1].toPartial||i[s][h+1].fn.controlDestination===i[s][h].fn.controlDestination)))a=true}}catch(e){var m;if(!l.control){if("undefined"!==typeof window)window["console"].error("Error calculating the logical parent for the function ",l);m=new Error(n.type+" event handle error")}else m=new Error(n.type+" event handle error in "+l.control._moduleName);y.IoC.resolve("ILogger").error(u,m,e)}if(c=n.result,!e||!e.control._destroyed)if(c&&c.then)c.then(function(t){return function(e){if(!n.blockUpdate)t.control._forceUpdate();return e}}(l),function(e){return e});else if(!n.blockUpdate)l.control._forceUpdate();c=void 0}if(null===(u=u.parentNode)||void 0===u||!n.propagating())a=true;if(0!==t)t=0}}function te(e,t){var n=e.element.eventProperties,r=e.element.controlNodes,o=0,i=0,a="on:"+t,s=true,u;if(n&&n[a]){u=n[a][0].fn.control;while(s&&i<r.length){if(r[i].control===u)if(++o<n[a].length)u=n[a][o].fn.control;if(r[i].control===e.control)s=false;i++}}return o}function ne(e,t){function n(e){return"text"===e.type||"password"===e.type}if(!e._rootDOMNode)return false;else if(!(t.currentTarget===window&&"scroll"===t.type||t.currentTarget===window&&"resize"===t.type)&&1!==t.eventPhase)return false;else if(y.detection.isIE&&"change"===t.type&&!t._dispatchedForIE&&n(t.target))return false;else if(!re(e,t))return false;return true}function re(e,t){var n=t.target;if(n===window||n===document)return true;while(n){if(n===e._rootDOMNode)return true;if(n.controlNodes&&n.controlNodes[0]&&n.controlNodes[0].environment===e)return true;else if(n.controlNodes&&n.controlNodes[0]&&n.controlNodes[0].environment!==e)return false;if(n===document.body)n=document.documentElement;else if(n===document.documentElement)n=document;else n=n.parentNode}return false}function oe(e){if(ne(this,e)){var t;ee(new s.default(e),null,0,[],true)}}A._handleClick=function e(t){if(this._shouldUseClickByTap())if(K.indexOf(t.target)>-1)K.splice(K.indexOf(t.target),1);if(2===t.button)return void t.stopPropagation();var n=window.getSelection?window.getSelection():null,r=n&&n.toString().length&&t.target.contains(n.focusNode),o=window.getComputedStyle?"none"===window.getComputedStyle(t.target)["user-select"]:true;if(r&&!o)return void t.stopPropagation();oe.call(this,t)},A._handleTouchstart=function e(t){if(this._shouldUseClickByTap())K.push(t.target);n.initSwipeState(t),oe.call(this,t)},A._handleTouchmove=function e(t){if(this._shouldUseClickByTap())if(this._clickState.touchCount++,this._clickState.touchCount>3)K.splice(K.indexOf(t.target),1);n.detectSwipe(t),oe.call(this,t)},A._handleTouchend=function e(t){if(this._shouldUseClickByTap())this._clickState.touchCount=0,setTimeout(function(){if(K.indexOf(t.target)>-1)t.target.click()},this._clickState.timeout);n.resetSwipeState(),oe.call(this,t)},A._shouldUseClickByTap=function e(){return y.constants.browser.retailOffline||y.constants.compatibility.touch&&y.constants.browser.chrome&&navigator&&navigator.userAgent.indexOf("Windows")>-1},A.applyNewVNode=function(e,t,n){if(!this._rootDOMNode)return;var r=this.decorateRootNode(e),o,i,a,s;if("HTML"!==this._rootDOMNode.tagName){if(r&&Y(this,r))if(this._rootVNode&&Y(this,this._rootVNode))X(this._rootDOMNode)}else if(r&&r.children[1]){var u=r.children[1];if(this._rootVNode&&Y(this,u)){var l=this._rootDOMNode.getElementsByTagName("body");if(l.length)X(l=l[0])}}if(this._rootDOMNode.isRoot=true,this._rootDOMNode.hasOwnProperty("$V")||!this._rootDOMNode.firstChild)a=this._rootVNode?h.Vdom.render(r,this._rootDOMNode,void 0,void 0,true):null;else a=this._rootVNode?h.Vdom.hydrate(r,this._rootDOMNode,true,true):null;if(this._rootVNode=r,o=k([n])){if(i=O([n]),s)i._container=window.$?$(s):s;d.default(function(){n.environment._haveRebuildRequest=false,i.reviveSuperOldControls&&i.reviveSuperOldControls(),F([n],t),n.environment._rebuildRequestStarted=false,n.environment.runQueue()})}else n.environment._haveRebuildRequest=false,F([n],t),n.environment._rebuildRequestStarted=false,n.environment.runQueue();return a},A.decorateFullMarkup=function(e,t){if(Array.isArray(e))e=e[0];return p.mapVNode(o.setControlNodeHook(t),t,e,true)},A.getMarkupNodeDecorator=function(){return this._markupNodeDecorator},A.getDOMNode=function(){return this._rootDOMNode},A.runQueue=function(){if(this.queue){this.activateSubQueue=true;for(var e=0;e<this.queue.length;e++)this.forceRebuild(this.queue[e]);this.activateSubQueue=false}if(this.queue=null,this.queueIds={},this.subQueue)this.queue=this.subQueue,this.subQueueIds=this.queueIds,this.subQueue=null,this.subQueueIds={}},A.startEvent=function(e,t){var n=t[0].toLowerCase(),r=t[1]||[],o=t[2],i={},a;if(i._bubbling=o&&void 0!==o.bubbling?o.bubbling:false,i.type=n,i.target=e.element,!i.target){if(!(e.fullMarkup instanceof u.RawMarkupNode)&&!(e.fullMarkup&&"invisible-node"===e.fullMarkup.type))y.IoC.resolve("ILogger").error("Event "+n+" has emited before mounting to DOM");return}return ee(a=new s.default(null,i),e,te(e,n),r,false),a.result},A.addCaptureEventHandler=function(e,t){var n=this._captureEventHandlers;if(this._rootDOMNode.parentNode)if(t.tagName&&"body"===t.tagName.toLowerCase()&&("scroll"===e||"resize"===e))if(void 0===n[e+"body"])n[e+"body"]={handler:oe.bind(this),count:1},window.addEventListener(e,n[e+"body"].handler);else n[e+"body"].count++;else if(void 0===n[e]){n[e]={handler:oe.bind(this),count:1};var r=u.Event.fixUppercaseDOMEventName(e);this._rootDOMNode.parentNode.addEventListener(r,n[e].handler,true)}else n[e].count++},A.addCaptureProcessingHandler=function e(t,n){var r=this._captureEventHandlers;if(void 0===r[t]){if(this._rootDOMNode.parentNode)r[t]={handler:function(e){if(!re(this,e))return;n.apply(this,arguments)}.bind(this),count:1},this._rootDOMNode.parentNode.addEventListener(t,r[t].handler,true)}else r[t].count++},A.removeCaptureEventHandler=function(e,t){var n=this._captureEventHandlers;if(t&&t.tagName&&"body"===t.tagName.toLowerCase()&&("scroll"===e||"resize"===e)){if(n[e+"body"].count--,0===n[e+"body"])window.removeEventListener(e,n[e+"body"].handler)}else{var r=n[e];if(r)if(r.count--,0===r.count){if(this._rootDOMNode.parentNode)this._rootDOMNode.parentNode.removeEventListener(e,r.handler,true);delete n[e]}}},A._canDestroy=function(t){return!this._rootDOMNode||!this._rootDOMNode.controlNodes||!this._rootDOMNode.controlNodes.find(function(e){return!e.parent&&e.control!==t})},R._goUpByControlTree=x,e.default=R}(g,e,N,s,a,O,A,C,b,S,h,y,i,V,T,c);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),U=H;e["Vdom/_private/Synchronizer/resources/DirtyChecking"]=true;var j=function(){"use strict";var e={},t=function(e,A,L,F,o,n,q,H,U,t,j,r,K,C){Object.defineProperty(A,"__esModule",{value:true});var z=new r,W;if(L.constants.compat)W=C;function Q(e){if(e.control&&e.control._getInternalOption&&e.control._getInternalOption("parent")){var t=n.Subscriber.getEventsListFromOptions(e.options);n.Subscriber.applyEvents(e.control,e.control._getInternalOption("parent"),t)}}function w(e,t,n){e.parent=e.parent||n&&n.control||t.parent||null,e.logicParent=e.logicParent||n&&n.control&&n.control.logicParent||t.logicParent||null}function T(e){return"function"===typeof e?e:e["constructor"]}function _(e){return"[object Date]"===Object.prototype.toString.call(e)}A.DirtyKind={NONE:0,DIRTY:1,CHILD_DIRTY:2};var B=[],Y={plus:function(e,t){return{createdNodes:e.createdNodes.concat(t.createdNodes),destroyedNodes:e.destroyedNodes.concat(t.destroyedNodes),updatedNodes:e.updatedNodes.concat(t.updatedNodes),createdTemplateNodes:e.createdTemplateNodes.concat(t.createdTemplateNodes),updatedTemplateNodes:e.updatedTemplateNodes.concat(t.updatedTemplateNodes),updatedChangedNodes:e.updatedChangedNodes.concat(t.updatedChangedNodes),updatedChangedTemplateNodes:e.updatedChangedTemplateNodes.concat(t.updatedChangedTemplateNodes),updatedUnchangedNodes:e.updatedUnchangedNodes.concat(t.updatedUnchangedNodes),selfDirtyNodes:e.selfDirtyNodes.concat(t.selfDirtyNodes)}},zero:{createdNodes:[],destroyedNodes:[],updatedNodes:[],createdTemplateNodes:[],updatedTemplateNodes:[],updatedUnchangedNodes:[],updatedChangedNodes:[],updatedChangedTemplateNodes:[],selfDirtyNodes:[]}};function G(e,t){var n;for(n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}function X(e){var t={};for(var n in e)if(e.hasOwnProperty(n))if(e[n]&&e[n].getVersion)t[n]=e[n].getVersion();else if(e[n]&&e[n].isDataArray)for(var r=0;r<e[n].length;r++){var o=X(e[n][r].internal||{});for(var i in o)if(o.hasOwnProperty(i))t[n+";"+r+";"+i]=o[i]}return t}function k(e){return e&&e.internal?e.internal:{}}function O(e,t){return"object"===typeof e&&e&&t&&e.getVersion}function J(e,t,n,r,o,i){var a,s,u=false,l={},d,c;for(a in t){if(n&&a&&a.indexOf("__dirtyCheckingVars_")>-1)continue;if(d=t.hasOwnProperty(a)||o&&void 0!==t[a])if(c=e.hasOwnProperty(a)||void 0!==e[a]){if("number"===typeof e[a]&&"number"===typeof t[a]&&isNaN(e[a])&&isNaN(t[a]))continue;if(e[a]===t[a]){if(O(e[a],r)){var f=e[a].getVersion(),p=i||"";if(r[p+a]!==f)u=true,l[a]=e[a],r[p+a]=f;else if(Array.isArray(e[a])&&e[a])if(!e[a].isDataArray)u=true,l[a]=e[a]}}else if(Array.isArray(e[a])&&e[a])if(!e[a].isDataArray)u=true,l[a]=e[a];else{if(!t[a]){u=true,l[a]=e[a];continue}for(var h=0;h<e[a].length;h++){var v=a+";"+h+";",m;if(i)v=i+v;if(J(k(e[a][h]),k(t[a][h]),false,r,o,v)){u=true,l[a]=e[a];break}}}else if(a.indexOf("__dirtyCheckingVars_")>-1&&"object"===typeof t[a]&&"object"===typeof e[a]&&e[a]&&t[a]&&!_(e[a]))if(e[a]!==t[a]){u=true,l[a]=e[a];break}else{var y;if(J(e[a],t[a],true,{},true)){u=true,l[a]=e[a];break}}else if(e[a]&&e[a]._preferVersionAPI){var g=e[a].getVersion(),N=i||"";if(r[N+a]!==g){u=true,l[a]=e[a],r[N+a]=g;break}}else if(e[a]&&e[a]._isDeepChecking&&t[a]&&t[a]._isDeepChecking){var b;if(J(e[a],t[a],true,{},true)){u=true,l[a]=e[a];break}}else{if(e[a]&&e[a]._ignoreChanging)continue;if(u=true,l[a]=e[a],O(e[a],r))r[(i||"")+a]=e[a].getVersion()}}}return u?l:null}function i(e){return(e=e||[]).reduce(function(e,t){return e.concat(Array.isArray(t)?i(t):t)},[])}function E(e,t,n){var r;return{markupDecorator:o.composeWithResultApply.call(void 0,[n.getMarkupNodeDecorator()]).bind(e),defaultOptions:{}}}function Z(e,t,n){var r=e.parentControl?e.template.call(e.parentControl,e.controlProperties,e.attributes,e.context,true):e.template(e.controlProperties,e.attributes,e.context,true),o=[],i;if(!Array.isArray(r))r=[r];for(i=0;i<r.length;i++){var a=q.getFullMarkup(t,r[i],true);o=o.concat(Array.isArray(a)?a:[a])}for(i=0;i<o.length;i++)o[i]=q.mapVNode(n.getMarkupNodeDecorator(),t,o[i]);return r=o}function ee(e,t,n,r,o,i,a){var s=T(e),u=a&&a.compound,l=i&&i.state||{vdomCORE:true},d=t.user,c=t.internal||{},f;if(w(c,d,o),!n)n="_";if(u){if(!W)W=C;f=W.createCompoundControlNode(e,s,d,c,n,o,a)}else{var p=a&&a.invisible,h=l?G(d,l):d,v,m,y,g,N,b,_;if("function"===typeof e)y=(b=H.Compatible.createInstanceCompatible(s,h,c)).instance,h=b.resolvedOptions,_=b.defaultOptions;else if(y=e,_=H.OptionsResolver.getDefaultOptions(e),L.constants.compat)if(h=H.Compatible.combineOptionsIfCompatible(s.prototype,h,c),y._setInternalOptions)y._options.doNotSetParent=true,y._setInternalOptions(c||{});v=X(h),m=X(N=a&&a.context||{}),g=E(y,s,r),f={attributes:t.attributes,events:t.events,control:y,errors:i&&i.errors,controlClass:s,options:h,internalOptions:c,optionsVersions:v,id:y._instId||0,parent:o,key:n,defaultOptions:_,markup:p?H.Vdom.textNode(""):void 0,fullMarkup:void 0,childrenNodes:B,markupDecorator:g&&g.markupDecorator,serializedChildren:i&&i.childrenNodes,hasCompound:false,receivedState:void 0,invisible:p,contextVersions:m,context:a&&a.context||{},inheritOptions:a&&a.inheritOptions||{}},r.setupControlNode(f)}return f}function a(e){return t(e)}function te(n,r,o,i,a){if(o.receivedState&&o.receivedState.then)return o.receivedState.then(function e(t){return o.receivedState=t,s(n,r,o,i,a)},function(e){return H.Common.asyncRenderErrorLog(e),o.receivedState=null,s(n,r,o,i,a)});else return s(n,r,o,i,a)}function ne(e,t){if(!e)return;try{if(t.setRebuildIgnoreId(e.id),e.compound){var n=e.options,r=n.__vdomOptions&&n.__vdomOptions.controlNode.instance;if(r)j.default(function(){r.destroy()})}else{for(var o=0;o<e.childrenNodes.length;o++)ne(e.childrenNodes[o],t);if(e.control.__$destroyFromDirtyChecking=true,e.control.destroy(),delete e.controlProperties,delete e.oldOptions,delete e.element,delete e.fullMarkup,delete e.markup,e.control._logicParent&&e.control._logicParent._template&&e.control._options.name)delete e.control._logicParent._children[e.control._options.name]}}finally{t.setRebuildIgnoreId(e.id)}}function re(e){if(e.fullMarkup)e.fullMarkup.changed=true;if(e.parent&&e.parent.fullMarkup&&!e.parent.fullMarkup.changed)re(e.parent)}function oe(e,t){if(e.children)for(var n=0;n<e.children.length;n++)if(H.Vdom.isControlVNodeType(e.children[n]))t.push(e.children[n]);else if(H.Vdom.isTemplateVNodeType(e.children[n])||H.Vdom.isVNodeType(e.children[n]))oe(e.children[n],t)}function s(O,E,e,t,n){var r=e.id,o,i=E[r]||A.DirtyKind.NONE,a=i!==A.DirtyKind.NONE||t,s=!!(i&A.DirtyKind.DIRTY)||t,u=e.markup,l,d=false,y,V,c,f,p,h,v,m,g,N=[],b,_,C,w,T,k,D,M,P,I,x;if(a){if(I=(y=e).context,x=U.ContextResolver.resolveContext(y.controlClass,I,y.control),!y.compound){if(s&&y.control._mounted&&!t){try{y.control.__beforeUpdate(y.options,x)}catch(e){K.catchLifeCircleErrors("_beforeUpdate",e)}try{l=y.control._shouldUpdate(y.options,x)}catch(e){K.catchLifeCircleErrors("_shouldUpdate",e)}s=s&&l}if(s){if(K.log("DirtyChecking",["requestRebuild "+r,y.control,y]),(V=y).control.saveFullContext(U.ContextResolver.wrapContext(y.control,y.context||{})),!y.inheritOptions)y.inheritOptions={};if(H.OptionsResolver.resolveInheritOptions(y.controlClass,y,y.options),y.control.saveInheritOptions(y.inheritOptions),y.markup=q.getDecoratedMarkup(y,n),c=q.getMarkupDiff(u,y.markup),K.log("DirtyChecking (diff)",["","",c]),c.destroy.length||c.vnodeChanged)re(y),d=true;while(c.createTemplates.length>0||c.updateTemplates.length>0){var S={create:[],createTemplates:[],destroy:[],destroyTemplates:[],update:[],updateTemplates:[]};p=c.createTemplates.map(function e(t){K.log("DirtyChecking (create template)",["","",t]),t.optionsVersions=X(t.controlProperties),t.contextVersions=X(t.context),t.children=Z(t,y,O);for(var n=0;n<t.children.length;n++){var r=q.getMarkupDiff(null,t.children[n]);S.create=S.create.concat(r.create),S.createTemplates=S.createTemplates.concat(r.createTemplates),S.update=S.update.concat(r.update),S.updateTemplates=S.updateTemplates.concat(r.updateTemplates)}return t}),c.createTemplates=S.createTemplates,c.updateTemplates=c.updateTemplates.concat(S.updateTemplates),S.createTemplates=[],S.updateTemplates=[],v=c.updateTemplates.map(function e(t){K.log("DirtyChecking (update template)",["","",t]);var n=t.newNode,r=t.oldNode,o=r.controlProperties,i,a=J(n.controlProperties,o,false,r.optionsVersions),s=r.attributes.attributes,u,l=J(n.attributes.attributes,s,false,{}),d=r.template!==n.template,c,f;if(a||l||d){K.log("DirtyChecking (update template with changed options)",["","",a]);var p=r.children;n.children=Z(n,y,O);var h=n.children.length>p.length?n.children.length:p.length;for(f=0;f<h;f++){var v=p[f],m=n.children[f];if(m)c=q.getMarkupDiff(v,m,true),S.create=S.create.concat(c.create),S.createTemplates=S.createTemplates.concat(c.createTemplates),S.update=S.update.concat(c.update),S.updateTemplates=S.updateTemplates.concat(c.updateTemplates),S.destroy=S.destroy.concat(c.destroy);else if(v)if(H.Vdom.isControlVNodeType(v))S.destroy.push(v);else if(H.Vdom.isTemplateVNodeType(v)||H.Vdom.isVNodeType(v))oe(v,S.destroy)}}else for(n.children=r.children,f=0;f<n.children.length;f++)c=q.getMarkupDiff(r.children[f],n.children[f],true),S.create=S.create.concat(c.create),S.createTemplates=S.createTemplates.concat(c.createTemplates),S.update=S.update.concat(c.update),S.updateTemplates=S.updateTemplates.concat(c.updateTemplates),S.destroy=S.destroy.concat(c.destroy);return n.optionsVersions=r.optionsVersions,n}),c.updateTemplates=S.updateTemplates,c.create=c.create.concat(S.create),c.destroy=c.destroy.concat(S.destroy),c.update=c.update.concat(S.update),c.createTemplates=c.createTemplates.concat(S.createTemplates)}if(_=c.destroy.map(function e(t){var n=t.controlNodeIdx,r=V.childrenNodes[n];return ne(r,O),r}),M=new Array(c.create.length+c.update.length),P=new Array(c.createTemplates.length+c.updateTemplates.length),D=c.update.length,p=[],v=[],f=c.create.map(function e(t,n){var r=D+n,o=V.serializedChildren,i=o&&o[r],a,s,u;if(K.log("DirtyChecking (create node)",["","",n,t]),d=true,!t.compound){if(a=t.controlProperties,!(u=ee(t.controlClass,{user:a,internal:t.controlInternalProperties,attributes:t.controlAttributes,events:t.controlEvents},t.key,O,V,i,t)).control._mounted&&!u.control._unmounted){if(s=H.Vdom.getReceivedState(u,t,z))u.receivedState=s;if(u.control.saveOptions)u.control.saveOptions(u.options,u);else if(u.control._options=u.options,u.control._container=u.element,u.control._setInternalOptions(t.controlInternalProperties||{}),L.constants.compat)u.control._container=$(u.element)}if(L.constants.compat&&(!u.control.hasCompatible||u.control.hasCompatible()))Q(u)}else u=ee(t.controlClass,{user:G(t.controlProperties,t.controlInternalProperties),attributes:t.controlAttributes,events:t.controlEvents},t.key,O,V,i,t);return t.controlNodeIdx=r,M[t.controlNodeIdx]=true,u}),k=(h=c.update.map(function e(t,n){K.log("DirtyChecking (update node)",["","",t]);var r=t.newNode,o=t.oldNode.controlNodeIdx,i=V.childrenNodes[o],a=i.control,s=true,u=r.compound?H.Compatible.createCombinedOptions(r.controlProperties,r.controlInternalProperties):r.controlProperties,l=i.options,d=i.optionsVersions,c=r.context||{},f=i.context,p=i.contextVersions,h=J(u,l,r.compound,d),v=J(c,f,false,p),m=v?v:J(c,f,false,p,true),y=i.controlAttributes||i.attributes,g=J(r.controlAttributes,y,r.compound),N;if(r.compound){if(u.__vdomOptions=l.__vdomOptions,h){var b=l.__vdomOptions&&l.__vdomOptions.controlNode.instance;if(b&&!b.__$$blockSetProperties){var _=J(u,b._options||{},r.compound);if(_)b.__$$blockSetProperties=true,h=W.clearNotChangedOptions(h,_),b.setProperties(h),j.default(function(){b.__$$blockSetProperties=false})}}i.options=u}else if(N=J(r.controlInternalProperties,i.internalOptions),h||N||g||v)try{var C;K.log("DirtyChecking (update node with changed)",["","",h||N||g||v]),O.setRebuildIgnoreId(i.id),H.OptionsResolver.resolveInheritOptions(i.controlClass,i,u),a.saveInheritOptions(i.inheritOptions),C=U.ContextResolver.resolveContext(i.controlClass,c,i.control),H.OptionsResolver.resolveOptions(i.controlClass,i.defaultOptions,u,i.parent.control._moduleName),a._beforeUpdate&&a.__beforeUpdate(u,C),a._options=u,s=(a._shouldUpdate?a._shouldUpdate(u,C):true)||N,a._setInternalOptions(N||{}),i.oldOptions=l,i.oldContext=f,i.attributes=r.controlAttributes,i.events=r.controlEvents,a._saveContextObject(C),a.saveFullContext(U.ContextResolver.wrapContext(a,a._context))}finally{var w=a._shouldUpdate?a._shouldUpdate(u,c)||N:true;if(a._setInternalOptions(N||{}),w)O.setRebuildIgnoreId(null);if(i.options=u,i.context=c,!r.compound)i.internalOptions=r.controlInternalProperties}else if(m)for(var T=i.childrenNodes,k=0;k<T.length;k++)E[T[k].id]|=A.DirtyKind.CHILD_DIRTY;return M[n]=(!!h||!!N||!!v||!!g)&&s,r.controlNodeIdx=n,i.events=r.controlEvents,i})).concat(f),b=g=m=B,h.forEach(function(e,t){if(M[t]){if(g===B)g=[];g.push(e)}else{if(m===B)m=[];m.push(e)}}),g.length||f.length)re(y),d=true;if(-1===k.indexOf(y)){if(b===B)b=[];b.push(y)}}else k=e.childrenNodes,b=_=N=g=m=h=p=f=B}else if(k=e.childrenNodes,b=_=N=g=m=h=p=f=B,y.compound)y.parent.hasCompound=true;if((T=F.mapM(k,function(e,t){if(M&&M[t])re(e);return te(O,E,e,M&&M[t])},A.RebuildResultWriter)).then)return T.then(function(e){if(y.childrenNodes=e.value,d||!y.fullMarkup||y.fullMarkup.changed||s){var t=y.fullMarkup&&y.fullMarkup.changed;if(y.fullMarkup=O.decorateFullMarkup(q.getFullMarkup(y.childrenNodes,y.markup,void 0,d||s?void 0:y.fullMarkup),y),y.fullMarkup.changed=t||y.fullMarkup.changed||d||s,y.fullMarkup.changed)re(y)}return{value:y,memo:Y.plus(e.memo,{createdNodes:f,updatedNodes:h,destroyedNodes:_,updatedChangedNodes:g,updatedChangedTemplateNodes:N,updatedUnchangedNodes:m,selfDirtyNodes:b,createdTemplateNodes:p,updatedTemplateNodes:v,destroyedTemplateNodes:C})}},function(e){return H.Common.asyncRenderErrorLog(e),e});else{if(y.childrenNodes=T.value,d||!y.fullMarkup||y.fullMarkup.changed||s){var R=y.fullMarkup&&y.fullMarkup.changed;if(y.fullMarkup=O.decorateFullMarkup(q.getFullMarkup(y.childrenNodes,y.markup,void 0,d||s?void 0:y.fullMarkup),y),y.fullMarkup.changed=R||y.fullMarkup.changed||d||s,y.fullMarkup.changed)re(y)}w={value:y,memo:Y.plus(T.memo,{createdNodes:f,updatedNodes:h,destroyedNodes:_,updatedChangedNodes:g,updatedChangedTemplateNodes:N,updatedUnchangedNodes:m,selfDirtyNodes:b,createdTemplateNodes:p,updatedTemplateNodes:v,destroyedTemplateNodes:C})}}}else w={value:e,memo:Y.zero};return w}A.RebuildResultWriter=F.createWriterMonad(Y),A.createNode=ee,A.destroyReqursive=ne,A.rebuildNode=s}(g,e,N,I,M,h,A,y,h,p,O,f,c,_);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),K=j;e["Vdom/_private/Synchronizer/resources/Debug"]=true;var z=function(){"use strict";var e={},t=function(e,t,i,p,l,h,a){Object.defineProperty(t,"__esModule",{value:true});var s=20,v={0:"NONE",1:"VTEXT",2:"VNODE",3:"WIDGET",4:"PROPS",5:"ORDER",6:"INSERT",7:"REMOVE",8:"THUNK",VirtualNode:"VirtualNode"};function m(e,r){var s=/["'&<>]/,n={area:true,base:true,br:true,col:true,embed:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true};function t(e){var t=""+e,n=s.exec(t);if(!n)return t;var r,o="",i,a=0;for(i=n.index;i<t.length;i++){switch(t.charCodeAt(i)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#39;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}if(a!==i)o+=t.substring(a,i);a=i+1,o+=r}return a!==i?o+t.substring(a,i):o}var o=a(function(e){return t(e)+'="'});function i(e){return(e=void 0!==e&&null!==e?e.toString():"").replace('"',"&quot;")}function u(e,t,n){if(n){if(null==t)return"";return o(e)+i(t)+'"'}return null}function a(t){var n={};return function(e){if(n.hasOwnProperty(e))return n[e];else return n[e]=t.call(this,e)}}function l(e){if(!e)return"";if(p.Vdom.isControlVNodeType(e))return h.getMarkupGenerator(false).createWsControl(e.controlClass,e.controlProperties,{internal:e.controlInternalProperties,attributes:e.controlAttributes,events:e.controlEvents,key:e.key,context:e.context,inheritOptions:e.inheritOptions},r);if(p.Vdom.isTemplateVNodeType(e))return h.getMarkupGenerator(false).createTemplate(e.template,e.attributes&&e.controlProperties,e.attributes,r);else if(p.Vdom.isVNodeType(e))return d(e)+c(e)+f(e);else if(p.Vdom.isTextNodeType(e))return String(e.children);else if(Array.isArray(e)){for(var t="",n=0;n<e.length;n++)t+=l(e[n]);return t}else if("string"===typeof e)return e;return""}function d(e){var t=e.hprops,n="<"+e.type.toLowerCase(),r,o,i,a;for(i in r=t["attributes"])if(r.hasOwnProperty(i)&&null!==r[i]&&void 0!==r[i]&&""!==r[i])n+=" "+u(i,r[i],true);for(a in o="",r=t["style"])if(r.hasOwnProperty(a)&&null!==r[a])o+=a+": "+r[a]+";";if(""!==o)n+=" "+u("style",o,true);return n+">"}function c(e){var t=e.properties&&e.properties.innerHTML;if(t)return t;else{var n="",r=e.children,o=r&&r.length||0,i,a;for(i=0;i!==o;i++)n+=l(a=r[i]);return n}}function f(e){var t=e.type.toLowerCase();return n[t]?"":"</"+t+">"}return l(e)}function y(n){return function(){var e=Date.now(),t;return{value:n.apply(this,arguments),time:Date.now()-e}}}function g(n,e){function t(e,t){if(t.length){console.group(e);try{t.forEach(function(e){N(n,e)})}finally{console.groupEnd()}}}var r=e.createdNodes.slice(0,s),o=e.updatedChangedNodes.slice(0,s),i=e.updatedUnchangedNodes.slice(0,s),a=e.destroyedNodes.slice(0,s);console.log("------------------"),t("Созданы",r),t("Обновлены - изменены по опциям",o),t("Обновлены - не изменены",i),t("Удалены",a)}function u(e,t,n){var r,o=[];if(p.Vdom.isControlVNodeType(n))N(e,n.controlNode);else{if(r=[p.Vdom.isVNodeType(n)?n.tagName:p.Vdom.isTextNodeType(n)?n.text:"???"],void 0!==n.key)r.push[n.key];if(o=[r.join("/")],p.Vdom.isVNodeType(n))o.push(a(n.properties)?"":n.properties);if(t){console.group.apply(console,o);try{i.getVNodeChidlren(n).forEach(u.bind(void 0,e,t))}finally{console.groupEnd()}}else console.log.apply(console,o)}}function N(e,t){var n=t.control,r=n.get("name"),o=t.markup,i,a=e[t.id]||l.DirtyKind.NONE,s=a===l.DirtyKind.NONE?[]:a===l.DirtyKind.DIRTY?["D"]:["C"],u;if(u=(r?[r]:[]).concat([n.describe()]),void 0!==t.key)u.push(t.key);u=u.concat(s),console.log(u.join("/"),t.id,n.getRawData())}function d(r,e,o,t,n,i){for(var a in n=n||{})if(n.hasOwnProperty(a)){var s=n[a],u,l=y(m.bind(void 0,s.value.a))(),d={};for(var c in s.value)if(s.value.hasOwnProperty(c)){var f=s.value[c],p="type"in f?v[f.type]:"????";if(p)d[p]=d.hasOwnProperty(p)?d[p]+1:1}console.group("PATCH: time = "+s.time,true),console.log(d,s.value),console.log("toHTML: time = ",l.time,l.value.length),console.groupEnd()}if(!i.silent&&e)e.forEach(function(e,t){var n=o[t];console.groupCollapsed("Старое",t);try{N(r,e)}finally{console.groupEnd()}console.groupCollapsed("Новое",t);try{N({},n)}finally{console.groupEnd()}}),g(r,t)}function n(r,o){return function(){var e=Date.now(),t,n;try{n=r.call(this,y)}finally{if(t=Date.now()-e,n)d(n.dirties,n.oldRoots,n.newRoots,n.rebuildChanges,n.applyResults,o);console.log("Время перестроения - ",t)}return n}}t.vdomToHTML=m,t.logRebuildChanges=g,t.logVNode=u,t.logControlNode=N,t.logRebuild=d,t.withLogRebuild=n}(g,e,A,y,j,m,v);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),W=z;e["Vdom/_private/Utils/DefaultOpenerFinder"]=true;var Q,B=function(){"use strict";var e={},t=function(e,t,r,o,n){Object.defineProperty(t,"__esModule",{value:true});var i=n.default._goUpByControlTree;function a(e){var t,n;if(r.instanceOfModule(e,"Core/Control"))t=e._container;else if(e instanceof Element)t=e;else o.IoC.resolve("ILogger").error("DOMEnvironment",rk("The arguments should be control or node element"));return i(t).find(function(e){return e._options.isDefaultOpener})}t.find=a}(g,e,l,N,H);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Vdom/_private/Synchronizer/Synchronizer"]=true;var Y,G=function(){"use strict";var e={},t=function(f,e,t,c,p,h,s,o,v,m,y,i){var a;Object.defineProperty(e,"__esModule",{value:true});var u=50,l=2,d=false;if(d)a=t;function g(e,t){var n=e.parent;while(n)t(n),n=n.parent}function N(e,n){return e.map(function(t){var e=n.filter(function(e){return t.id===e.id});if(e.length)return e[0];return t})}function b(e){return e.control&&e.control._parent&&e.control._parent.isDestroyed&&e.control._parent.isDestroyed()}function _(e){if("[object String]"===Object.prototype.toString.call(e))return f(e);return e}function C(e){return e.map(function e(t){return t.id})}var w,T=[],k=[],O={},n={_controlNodes:{},_rebuild:function(){function e(u){var l=O;if(0===Object.keys(l).length)return{dirties:l,oldRoots:T,newRoots:T,rebuildChanges:null,applyResults:null};O={},T.splice(k.length);var d=T,e=c.mapM(d,function e(t,n){return t.requestDirtyCheck=E,p.rebuildNode(k[n],l,t,void 0,true)},p.RebuildResultWriter,this);if(e.then)e.then(function(e){var n=e.value.filter(function(e){if(b(e))return false;return true}),t=e.memo,r=C(n),o={createdNodes:true,updatedChangedNodes:true,selfDirtyNodes:true,createdTemplateNodes:true,updatedChangedTemplateNodes:true},i;for(var a in o)if(t[a].length>0)r=r.concat(C(t[a]));r=v(r);var s=function(e,t){return n[t]&&n[t].environment&&n[t].environment._haveRebuildRequest&&n[t].fullMarkup?e.applyNewVNode(n[t].fullMarkup,r,n[t]):null};if(u)s=u(s);if(t.createdNodes.forEach(function(e){e.requestDirtyCheck=E,this._controlNodes[e.id]=e},this),t.destroyedNodes.forEach(function(e){delete this._controlNodes[e.id]},this),i=k.map(s),T.length>n.length)T=N(T,n);else T=n;return{dirties:l,oldRoots:d,newRoots:n,rebuildChanges:t,applyResults:i}}.bind(this),function(e){return y.Common.asyncRenderErrorLog(e),e});else{var n=e.value.filter(function(e){return-1!==k.indexOf(e.environment)}),t=e.memo,r=C(n).map(function(e){return l[e]&p.DirtyKind.DIRTY?e:void 0}),o={createdNodes:true,updatedChangedNodes:true,selfDirtyNodes:true,createdTemplateNodes:true,updatedChangedTemplateNodes:true},i;for(var a in o)if(t[a].length>0)r=r.concat(C(t[a]));r=v(r);var s=function(e,t){return n[t]&&n[t].environment&&n[t].environment._haveRebuildRequest&&n[t].fullMarkup?e.applyNewVNode(n[t].fullMarkup,r,n[t]):null};if(u)s=u(s);return t.createdNodes.forEach(function(e){e.requestDirtyCheck=E,this._controlNodes[e.id]=e},this),t.destroyedNodes.forEach(function(e){delete this._controlNodes[e.id]},this),i=k.map(s),{dirties:l,oldRoots:d,newRoots:T=n,rebuildChanges:t,applyResults:i}}}var t=d?a.withLogRebuild(e,{silent:true}):e,n;for(n=0;n!==u;n++)if(t.call(this),o(O))break;if(n===u){var r;for(i.setLoggerStatus(true,true),r=1;r<=l;r++)i.log("MAX_REBUILD error",["Logged iteration "+r]),t.call(this);throw i.setLoggerStatus(false,true),new Error("SBIS3.CORE.VDOM.Synchronizer: i === MAX_REBUILD")}},controlStateChangedCallback:function(e){n.requestRebuild(e,false)},mountControlToDOM:function(a,s,u,l,e){l=l[0]?l[0]:l;var t,d=e||{},c=l.getAttribute("data-component-root-id"),n=c&&window.vdomJsModules[c];if(!e)d["data-component"]=l.getAttribute("data-component");s=_(s);var r=function e(){var n,t,r,o=new m,i;if(t=new h.default(l,this.controlStateChangedCallback,d,c),(n=p.createNode(a,{user:u},void 0,t,null,r)).requestDirtyCheck=E,d)n.attributes=d;if(this._controlNodes[n.id]=n,k.push(t),T.push(n),n.control._saveEnvironment(t,n),!a._mounted&&!a._unmounted&&!a._beforeMountCalled)i=y.Vdom.getReceivedState(n,{controlProperties:u,controlClass:s},o);if(n["element"]=l,n.control.saveOptions)n.control.saveOptions(n.options,n);else n.control._options=n.options,n.control._container=$(n.element);if(i)i.then(function e(t){return n.receivedState=t,this.requestRebuild(n.id,true),t}.bind(this),function e(t){return y.Common.asyncRenderErrorLog(t),t});else this.requestRebuild(n.id,true)}.bind(this);if(t=k.some(function(e){return e instanceof h.default&&e.getDOMNode()===l}))throw new Error("На этом DOM-элементе уже есть смонтированный корневой компонент");var o=function(e,t){var n=e._afterMount;e._afterMount=function(){n.apply(this,arguments),setTimeout(function(){t()})}},i=function(){var t=w;w=new Promise(function(e){if(t)t.then(function(){o(a,e),r()});else o(a,e),r()})};if(n&&n.length>0)f(n,i);else i()},cleanControlDomLink:function(e){if(!e)return;var t=e[0]?e[0]:e;if(t.controlNodes)for(var n=0;n<t.controlNodes.length;n++)if(!t.controlNodes[n].control||t.controlNodes[n].control._destroyed)if(delete this._controlNodes[t.controlNodes[n].id],t.controlNodes.length>0)if(t.controlNodes.length>1||!t.controlNodes[0].parent)t.controlNodes.splice(n,1),n--},unMountControlFromDOM:function e(t,n){for(var r=n[0]?n[0]:n,o,i,a=T.length-1;a>=0;a--){var s=T[a].environment._rootDOMNode;if(r===s&&T[a].environment._canDestroy(t)||!s){var u=T[a].id,l=k.splice(a,1)[0];if(this._controlNodes[u])i=this._controlNodes[u],delete this._controlNodes[u];if(T.splice(a,1),r===s)o=l;else l.destroy()}}if(o){if(!t._destroyed)t.destroy();if(i)p.destroyReqursive(i,o);t._mounted=false,t._unmounted=true,o.destroy()}},queue:null,requestRebuild:function(t,e){var r=this._controlNodes[t],n=O,o=false,i=this,a=r&&!r.environment._rebuildRequestStarted;if(!e)a=a&&!T.some(function(e){if(e.environment!==r.environment&&!r.environment._haveRebuildRequest)if(e.environment&&(e.environment._rebuildRequestStarted||e.environment._haveRebuildRequest)){if(!e.environment.queue)e.environment.queue=[];if(!e.environment.queueIds)e.environment.queueIds={};if(o=true,!e.environment.queueIds[t])e.environment.queue.push(t);if(e.environment.queueIds[t]=1,e.environment.activateSubQueue){if(!e.environment.subQueue)e.environment.subQueue=[];if(!e.environment.subQueueIds)e.environment.subQueueIds={};if(!e.environment.subQueueIds[t])e.environment.subQueue.push(t);e.environment.subQueueIds[t]=1}return true}});if(a){if(n[t]|=p.DirtyKind.DIRTY,g(r,function(e){n[e.id]|=p.DirtyKind.CHILD_DIRTY}),!r.environment._haveRebuildRequest)r.environment._haveRebuildRequest=true,s.default(function e(){if(!r.environment._haveRebuildRequest)return;if(r.environment._rebuildRequestStarted=true,this._savedActiveElement!==document.activeElement){var t=document.activeElement;while(t&&t.parentElement){if(t.controlNodes&&t.controlNodes[0]){this._savedControlNode=t.controlNodes[0];break}t=t.parentElement}}var n;if(this._savedActiveElement=document.activeElement,i._rebuild(),r.environment.addTabListener(),r.control.__$focusing)n=r;if(n)r.environment.autofocusChanges.call(this,n)}.bind(this))}else if(r&&r.environment&&!o){if(!r.environment.queue)r.environment.queue=[];if(!r.environment.queueIds)r.environment.queueIds={};if(!r.environment.queueIds[t])r.environment.queue.push(t);r.environment.queueIds[t]=1}},setDebugMode:function(e){d=e}};function E(e){n.requestRebuild(e.id,false)}e.default=n}(g,e,z,I,j,H,O,v,u,f,y,c);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();function X(e,t){N.IoC.resolve("ILogger").warn("Vdom/Vdom",'"'+e+'" wrapper is deprecated and will be removed. Require '+'"Vdom/Vdom" and use '+t+" from it instead.")}return e.Debug=W,e.DirtyChecking=K,e.DirtyCheckingCompatible=n,e.Hooks=w,e.SwipeController=k,e.TabIndex=R,e.VdomMarkup=L,e.DefaultOpenerFinder=B,e.Focus=q,e.Functional=P,e.Monad=x,e.Synchronizer=G.default,e.DOMEnvironment=U.default,e.Environment=D.default,e.runDelayedRebuild=E.default,e.animationWaiter=E.animationWaiter,e.SyntheticEvent=t.default,e.logDeprecatedWrapper=X,e});