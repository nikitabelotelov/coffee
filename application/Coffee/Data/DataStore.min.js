define("Coffee/Data/DataStore",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s={G1:{val1:"val1",val2:"val2"},G2:{val3:"val3",val4:"val4"},G3:{val5:"val5"}};t.SettingsStruct=s;var a={socket:null,messageHandlers:new Array,_parseDataStructure:function(e,t){var a={};for(var s in t)for(var o in a[s]={},t[s])a[s][o]=e[o];return a},initDataStore:function(){var a=this;return new Promise(function(e,t){a.socket=new WebSocket("ws://localhost:8080"),a.socket.onopen=function(){console.log("Соединение установлено."),e()},a.socket.onclose=function(e){if(e.wasClean)console.log("Соединение закрыто чисто");else console.log("Обрыв соединения");console.log("Код: "+e.code+" причина: "+e.reason)},a.socket.onmessage=function(e){a._handleMessage(e.data),console.log("Получены данные "+e.data)},a.socket.onerror=function(e){console.log("Ошибка "+e.message),t()}})},onSettingsUpdated:function(e){this.messageHandlers["settingsUpdated"]=e},_handleMessage:function(e){var t=JSON.parse(e),a=t.data;if(t.type)switch(t.type){case"settingsUpdated":a=this._parseDataStructure(a,s);default:if(this.messageHandlers[t.type])this.messageHandlers[t.type].call(this,a)}},closeConnection:function(){this.socket.close()}};return t.DataStore=a,t});