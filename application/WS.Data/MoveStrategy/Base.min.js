define("WS.Data/MoveStrategy/Base",["WS.Data/MoveStrategy/IMoveStrategy","WS.Data/Collection/RecordSet","WS.Data/Di","WS.Data/Utils","Core/ParallelDeferred","Core/Abstract","Core/helpers/Function/throttle"],function(e,d,t,i,r,o,n){"use strict";var s=n(i.logger.error,100),a=o.extend([e],{"[WS.Data/MoveStrategy/Base]":true,$protected:{_options:{hierField:void 0,dataSource:null,listView:null,items:null,invertOrder:false},_orderProvider:void 0},$constructor:function(){s(this._moduleName,"Move strategy has been deprecated, please use events onBeginMove, onEndMove on a listview instead")},move:function(e,t,i){return this._callReoderMove(e,t,i).addCallback(function(){this._moveInItems(e,t,i)}.bind(this))},_callReoderMove:function(e,t,i){var o=new r;return e.forEach(function(e){o.push(this._getDataSource().move(e.getId(),t.getId(),{before:this._options.invertOrder?i:!i,hierField:this._options.hierField}))}.bind(this)),o.done().getResult()},hierarhyMove:function(t,e){if(!this._options.hierField)throw new Error("Hierrarhy Field is not defined.");var i=e?e.getId():null,o=this._options.hierField,r=[],n=[];if(t.forEach(function(e){var t=e.clone();n.push(t.get(o)),t.set(o,i),r.push(t)}),t.length>1){var s=new d({adapter:t[0].getAdapter()});s.append(r),r=s}else r=r[0];var a=this._getItems();return this._callHierarchyMove(r).addCallback(function(e){return t.forEach(function(e){if(e.set(o,i),a&&-1==a.getIndex(e))a.add(e)}),e})},hierarchyMove:function(e,t){return this.hierarhyMove(e,t)},_callHierarchyMove:function(e){return this._getDataSource().update(e)},_getDataSource:function(){var e;if(this._options.dataSource)e=this._options.dataSource;else if(this._options.listView)e=this._options.listView.getDataSource();if(e)if(!e._$binding.moveBefore)if(e._$binding.moveBefore="ВставитьДо",e._$binding.moveAfter="ВставитьПосле","IndexNumber"==e._$endpoint.moveContract)e._$endpoint.moveContract="ПорядковыйНомер";return e},_getItems:function(){if(this._options.listView)return this._options.listView.getItems();return this._options.items},_moveInItems:function(e,o,r){var n=this._getItems();if(n)e.forEach(function(e){n.setEventRaising(false,true);var t=n.getIndex(e);if(-1==t)n.add(e),t=n.getCount()-1;if(this._options.hierField)e.set(this._options.hierField,o.get(this._options.hierField));var i=n.getIndex(o);if(r&&i<t)i=i+1<n.getCount()?++i:n.getCount();else if(!r&&i>t)i=0!==i?--i:0;n.move(t,i),n.setEventRaising(true,true)}.bind(this))}});return t.register("movestrategy.base",a),a});