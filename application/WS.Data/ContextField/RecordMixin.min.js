define("WS.Data/ContextField/RecordMixin",["WS.Data/Shim/Map","Types/collection","Core/Context"],function(e,a,o){"use strict";var u=new e,c=0,g=function(){var i=[];u.forEach(function(e,t){i.push([t,e])}),u.clear(),i.forEach(function(e){var t=e[0],i=e[1];if(t["[Types/_entity/IObject]"])t.set(i);else Object.keys(i).forEach(function(e){t.set(e,i[e])})})},h={"[WS.Data/ContextField/RecordMixin]":true,get:function(e,t){var i,n,r,l,f;if(0===t.length)return e;if(i=t[0],n=false,c>0&&u.has(e))if(i in(f=u.get(e)))r=f[i],n=true;if(!n)r=e.get(i);if(void 0===r)return o.NonExistentValue;return(l=o.getValueType(r)).get(r,t.slice(1))},setWillChange:function(e,t,i){var n,r,l,f;if(0===t.length)return e!==i;if(l=t[0],r=e.get(l),e.getOwner&&e.getOwner()&&e.getOwner()instanceof a.RecordSet)n=void 0!==r;else n=r!==i;if(n)n=(f=o.getValueType(r)).setWillChange(r,t.slice(1),i);return n},set:function(e,t,i){var n,r,l,f,a;if(0===t.length)return i;if(f=t[0],void 0!==(r=e.get(f)))if(1===t.length){var s;if(u.has(e))s=u.get(e);else s={};s[f]=i,u.set(e,s),n=e}else if(r===(l=(a=o.getValueType(r)).set(r,t.slice(1),i)))n=e;else n=h.set(e,[f],l);else if(void 0===r&&1===t.length){if(e.has(f))e.set(f,i);else this._module.addFieldTo(e,f,i);n=e}if(0===c)g();return n},transaction:function(){if(0===c)u.clear();c++},commit:function(){if(0===--c)g()},remove:function(e,t){var i,n,r,l,f;if(f=0!==t.length)if(i=t[0],f=e.has(i))if(n=e.get(i),f=1===t.length){if(f=null!==n)e.set(i,null)}else if(f=(l=(r=o.getValueType(n)).remove(n,t.slice(1))).changed)e.set(i,l.value);return{value:e,changed:f}}};return h});