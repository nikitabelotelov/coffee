define("View/Builder/Tmpl/checkDomHandler",function(){"use strict";var l=["area","base","br","col","command","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],s=["span","div","td","tr","p"];function e(t){if("function"!==typeof t)t=null;this._callback=t,this.dom=[],this._done=false,this._tagStack=[],this._parser=this._parser||null}return e.prototype.getTextAround=function t(e){var n,a=this._parser._tokenizer,r=e||200,i=a._index,o=i-r>=0?i-r:0,l=i+r;return a._buffer.slice(o,l)},e.prototype.onparserinit=function t(e){this._parser=e},e.prototype._addDomElement=function t(e){var n=this._tagStack[this._tagStack.length-1],a=n?n.children:this.dom,r=a[a.length-1];if(e.next=null,r)(e.prev=r).next=e;else e.prev=null;a.push(e),e.parent=n||null},e.prototype.onopentag=function t(e,n,a,r,i){var o={name:e,attribs:n,children:[]};if(i){if(-1!==s.indexOf(e))this._handleCallback(new Error('Тег "'+e+'" не может быть самозакрывающимся.'))}else if(-1!==l.indexOf(e))this._handleCallback(new Error('Тег "'+e+'" обязан быть самозакрывающимся.'));this._addDomElement(o),this._tagStack.push(o)},e.prototype.onclosetag=function t(e){if(!this._tagStack.length)this._handleCallback(new Error('Встречен внезапный закрывающий тег "'+e+'", у него нет открывающего тега.'));var n=this._tagStack.pop();if(n.name!==e)this._handleCallback(new Error('Тег "'+e+'" пытается закрыть последний открытый тег "'+n.name+'", названия этих тегов не совпадают.'))},e.prototype._handleCallback=e.prototype.onerror=function t(e){if(e)e.message="Проблема в разметке.\n"+e.message+"\n"+"Поправьте разметку!\n"+"Промежуток текста, в котором была найдена ошибка:\n"+this.getTextAround();if("function"===typeof this._callback)this._callback(e);else if(e)throw e},e.prototype.onreset=function t(){e.call(this,this._callback)},e.prototype.onend=function t(){if(this._done)return;this._done=true,this._parser=null,this._handleCallback(null)},e});