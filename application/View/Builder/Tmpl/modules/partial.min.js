define("View/Builder/Tmpl/modules/partial",["View/Builder/Tmpl/modules/data","View/Builder/Tmpl/expressions/process","View/Builder/Tmpl/modules/utils/parse","View/Builder/Tmpl/modules/data/utils/functionStringCreator","View/Builder/Tmpl/modules/utils/tag","View/Builder/Tmpl/handlers/error","View/Builder/Tmpl/modules/utils/common","View/Builder/Tmpl/modules/utils/template"],function t(l,w,C,v,T,S,j,_){"use strict";var e;return{parse:function t(a){var l=a.children;if("ws:partial"===a.name&&a.attribs.template)a.attribs._wstemplatename=a.attribs.template;function e(){var t,e;if(void 0===a.attribs._wstemplatename)S("No template tag for partial "+a.name,this.filename);if(this._currentPartialName=this._currentPartialName||[],"ws:partial"===a.name)e=a.attribs["template"].replace("optional!","");else e=a.name.replace("ws:","");this._currentPartialName.push(e);try{var r=this._traverseTagAttributes(a.attribs);if((a.attribs=r)._wstemplatename.data.length>0)return _.resolveInjectedTemplate.call(this,a,l);t=_.checkRequirableTemplate.call(this,a,l)}finally{this._currentPartialName.pop()}return t}return function t(){return e.call(this)}},module:function t(m,d,e){function h(t,e){for(var r=e+t,a=r.length,l=new Array(a),i=0;i<a;++i)l[i]=0;for(var i=1,n=0,s=0;i<a;++i){if(i<=s)l[i]=Math.min(s-i+1,l[i-n]);while(i+l[i]<a&&r[l[i]]===r[i+l[i]])++l[i];if(i+l[i]-1>s)s=(n=i)+l[i]-1}for(i=a-t.length;i<a;++i)if(l[i]===e.length)return i-e.length;return-1}function f(t,e,r){var a={partial:"ws:partial"===t.name};return l.call(this,{children:t.injectedData,attribs:t.attribs,isControl:!!T.isWsControl(t),internal:t.internal},e,a)}function g(t){if("ws:partial"===t.name)if(t.attribs._wstemplatename.data)return"ws:"+t.attribs._wstemplatename.data.value.replace(/^js!/,"");else return"ws:"+t.attribs._wstemplatename.replace(/^js!/,"");else return t.name}function b(t){return{library:t.children[0].library,module:t.children[0].module}}function r(t){var e,r,a=m.decorAttribs||C.parseAttributesForDecoration.call(this,m.attribs,d,{},!!T.isWsControl(m),m),l=f.call(this,m,d),i=m.internal&&Object.keys(m.internal).length>0?v.getStr(m.internal):null,n,s;if(m.decorAttribs=a,m.injectedTemplate){if(!(r=w(m.injectedTemplate,d,this.calculators,this.filename,void 0,l)))S('Your template variable by the name of "'+m.injectedTemplate.name.string+'" is empty',this.filename);if(e=r.html||r,r.data)l.__rootScope=r.data;if(e){if(j.isFunction(e))return e(l,a);if(j.isString(e))return _.syncRequireTemplateOrControl.call(this,e,v.getStr(l),t&&t.isMainAttrs?"thelpers.plainMergeAttr(attr,"+v.getStr(a)+")":v.getStr(a),m)}S('Your template variable by the name of "'+m.injectedTemplate.name.string+'" is empty',this.filename)}if(n=T.isModule(m),s=T.isWsControl(m),n||s){var o=v.getStr(l),u,c;if(n)c=v.getStr(b(m)),u="resolver";else c='"'+g(m)+'"',u="wsControl";return'markupGenerator.createControl("'+u+'", '+c+", "+o+", "+(t?v.injectFunctionCall("thelpers.plainMergeAttr",["attr",v.getStr(a),"true"]):v.injectFunctionCall("thelpers.plainMergeContext",["attr",v.getStr(a)]))+", "+_.getTemplateCfg(i&&-1!==h(o,i)?"{}":i)+", context, depsLocal, includedTemplates, thelpers.config), \n"}if(T.isTemplate(m))return o=v.getStr(l),'markupGenerator.createControl("template", "'+m.attribs._wstemplatename.data.value+'", '+o+", "+(t?v.injectFunctionCall("thelpers.plainMergeAttr",["attr",v.getStr(a),"true"]):v.injectFunctionCall("thelpers.plainMergeContext",["attr",v.getStr(a)]))+", "+_.getTemplateCfg(i&&-1!==h(o,i)?"{}":i)+", context, depsLocal, includedTemplates, thelpers.config), \n";var p=".call(this, "+v.injectFunctionCall("thelpers.plainMerge",["Object.create(data || {})",v.injectFunctionCall("thelpers.calculateScope",[v.getStr(l),"thelpers.plainMerge"]),"false"])+", "+(t?v.injectFunctionCall("thelpers.plainMergeAttr",["attr",v.getStr(a),"true"]):v.injectFunctionCall("thelpers.plainMergeContext",["attr",v.getStr(a)]))+", "+"context, isVdom), ";if(this.includedFn)return m.attribs._wstemplatename.data.value+p;return"("+"function f2(data,attr) {"+'var key = attr&&attr.key||"_";'+"thelpers.prepareAttrsForFocus(attr&&attr.attributes, data);"+"var defCollection = {id: [], def: undefined};"+this.getString(m.children,{},this.handlers,{},true)+"}"+")"+p}return m.children=_.reflector(m.children),function t(e){return r.call(this,e)}}}});