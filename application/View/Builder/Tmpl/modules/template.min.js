define("View/Builder/Tmpl/modules/template",["View/Builder/Tmpl/handlers/error","Core/Deferred","View/config"],function e(a,l,r){"use strict";var t;return{parse:function e(n){function r(){var r=new l,i=new l;return this.traversingAST(n.children).addCallbacks(function e(t){r.callback(t),n.children=t,i.callback(n)},function e(t){i.errback(t),a(t,this.filename)}.bind(this)),{fake:r,real:i}}function t(){var e,t;try{t=n.attribs.name.trim()}catch(e){a("Something wrong with name attribute in ws:template tag",this.filename,e)}if(void 0===n.children||0===n.children.length)a("There is got to be a children in ws:template tag",this.filename);return e=r.call(this),this.includeStack[t]=e.fake,e.real}return function e(){return t.call(this)}},module:function e(i,t){var n=i.attribs.name;if(r.reservedWords.includes(n))a("Unexpected reserved word '"+n+"' in template attribute name",this.filename);if(!n.match(/^[a-zA-Z_]\w*$/g)&&this.filename.includes(".wml"))a("Incorrect template name '"+n+"'",this.filename);return function e(){var t;if(!this.includeStack[n])this.includeStack[n]=i.children;var r=this.getString(this.includeStack[n],{},this.handlers,{},true);if(delete this.includeStack[n],this.includedFn)return r='{ var key = attr&&attr.key||"_";'+"var forCounter = 0;"+"var templateCount = 0;"+"if (!attr.attributes){attr.attributes = {};}"+"thelpers.prepareAttrsForFocus(attr&&attr.attributes, data);"+"var defCollection = {id: [], def: undefined};"+'var viewController = thelpers.configResolver.calcParent(this, typeof currentPropertyName === "undefined" ? undefined : currentPropertyName, data);'+r+"}",this.includedFn[n]=r,"";return t='(function() { includedTemplates["'+n+'"] = (function (data,attr,context,isVdom) {'+r+"}.bind({ includedTemplates: includedTemplates })"+"); })(), \n"}}}});