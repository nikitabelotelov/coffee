define("View/Builder/Tmpl/modules/for",["View/Builder/Tmpl/modules/utils/common","View/Builder/Tmpl/expressions/process","View/Builder/Tmpl/expressions/third-party/parser","View/Builder/Tmpl/handlers/error","Core/Deferred","text!View/Builder/Tmpl/modules/templates/forModuleTemplate.jstpl","text!View/Builder/Tmpl/modules/templates/forCustomTemplate.jstpl","text!View/Builder/Tmpl/modules/templates/forProcessedBlock.jstpl"],function(T,o,f,d,O,i,u,e){"use strict";function m(e){var t=e.message.split("Expecting")[0];return t=t.split("line")[0]+"line:"+t.slice(t.indexOf(":")+1)}var t;return i=i.replace("/*#PROCESSED_BLOCK#*/",e).replace(/\r|\n/g,""),u=u.replace("/*#PROCESSED_BLOCK#*/",e).replace(/\r|\n/g,""),{parse:function e(u){function p(e,t,r){return{key:e,value:t,main:r}}function t(){var r=new O,e=" in ",l=" as ",n=",",t,i="",a=function e(t,r){var i=t.split(l),a=i[0],s;if(i.length>1)a=i[1],s=i[0];else if((i=T.removeAllSpaces(t).split(n)).length>1)a=i[1],s=i[0];return p(s,a,r)},s=u.attribs.hasOwnProperty("for");try{if(s)i=T.clone(u.attribs["for"]);else i=u.attribs.data;if(i.indexOf(";")>-1){var c=i.split(";");u.attribs.START_FROM_NAME='{{"'+c[0]+'"}}',u.attribs.START_FROM="{{"+c[0]+"}}",u.attribs.CUSTOM_CONDITION="{{"+c[1]+"}}",u.attribs.CUSTOM_ITERATOR="{{"+c[2]+"}}",delete u.attribs.data}else t=i.split(e),u.forSource=a(t[0],f.parse(t[1]));u.attribs=this._traverseTagAttributes(u.attribs)}catch(e){var o=m(e);d("Wrong arguments in for statement "+u.name+"\n"+o,this.filename,e)}return this.traversingAST(u.children).addCallbacks(function e(t){u.children=t,r.callback(u)}.bind(this),function e(t){r.errback(t)}),r}return function e(){return t.call(this)}},module:function e(s,l){var n,c=s.attribs.hasOwnProperty("for");function r(){var e=s.attribs.START_FROM.data[0]?o(s.attribs.START_FROM.data[0],l,this.calculators,this.filename):"",t=s.attribs.START_FROM_NAME.data[0]?o(s.attribs.START_FROM_NAME.data[0],l,this.calculators,this.filename):"",r=s.attribs.CUSTOM_CONDITION.data[0]?o(s.attribs.CUSTOM_CONDITION.data[0],l,this.calculators,this.filename):"",i=s.attribs.CUSTOM_ITERATOR.data[0]?o(s.attribs.CUSTOM_ITERATOR.data[0],l,this.calculators,this.filename):"",a=this._process(c?[n]:n.children,l);return u.replace("/*#START_FROM_NAME#*/",t).replace(/\/\*#START_FROM#\*\//g,e).replace("/*#CUSTOM_CONDITION#*/",r).replace("/*#CUSTOM_ITERATOR#*/",i).replace("/*#PROCESSED#*/",a)}function t(){if(!s.forSource)return r.call(this);var e=o({type:"var",name:s.forSource.main,value:void 0},l,this.calculators,this.filename);if(c)s.attribs["for"]=void 0;var t=this._process(c?[n]:n.children,l);return i.replace(/\/\*#SCOPE_ARRAY#\*\//g,e).replace("/*#TAG_OBJECT_STRING#*/",JSON.stringify({key:s.forSource.key,value:s.forSource.value})).replace("/*#PROCESSED#*/",t)}return n={attribs:s.attribs,children:s.children,name:s.name,type:s.type},s.key=s.prefix?s.prefix+"-"+s.key:s.key,function e(){if(void 0!==s.children)return t.call(this)}}}});