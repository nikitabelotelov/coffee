define("View/Builder/Tmpl/expressions/dirtyCheckingPatch",["View/Builder/Tmpl/expressions/event","View/Builder/Tmpl/expressions/statement","Core/helpers/Function/shallowClone"],function(m,v,f){function l(e){return e&&e.name&&e.name.string&&e.name.string.indexOf&&(e.name.string.indexOf("|mutable")>-1||e.name.string.indexOf("|bind")>-1)}function o(e,t){return t.data&&t.data[0]===e}function y(e,t,n){for(var r=0,i=0;i<n.length;i++){var a=true;for(var s in e)if(o(n[i],e[s])||l(n[i])){a=false;break}if(a)t["__dirtyCheckingVars_"+r++]={data:[f(n[i])],type:"text"}}}function i(e){var t=(e="string"===typeof e?e:"").length,n,r;if(")"!==e[t-1]&&"]"!==e[t-1])return e.substring(0,e.lastIndexOf("."));if(")"===e[t-1])n="(",r=")";else n="[",r="]";var i=t-1,a=1;while(i>0&&a>0)if(e[--i]===r)a++;else if(e[i]===n)a--;if(")"===r)return e.substring(0,e.substring(0,i).lastIndexOf("."));else return e.substring(0,i)}function O(e){for(var t,n=["START_FROM","CUSTOM_CONDITION","CUSTOM_ITERATOR"],r=0;r<n.length;++r)if(e.attribs.hasOwnProperty(n[r])&&e.attribs[n[r]].data.length)if(""!==(t=i(e.attribs[n[r]].data[0].name.string)))this.ignoredNames[t]=1}function b(e){var t=[],n;if(e&&e.data){if(n=b(e.data))t=t.concat(n)}else if(e&&e.length&&"string"!==typeof e){for(var r=0;r<e.length;r++)if(n=b(e[r]))t=t.concat(n)}else if(e&&"tag"===e.type)return w.call(this,e);if(0===t.length){if(!e||"var"!==e.type)return;if(!e.name||"string"!==typeof e.name.string)return[e];for(var i in this.ignoredNames)if(this.ignoredNames.hasOwnProperty(i)&&e.name.string.indexOf(i)>-1)return;return[e]}return t}function w(e,t){if(!e)return[];var n=e.children,r=[],i=e.hasOwnProperty("forSource"),a=false,s=false;if(!e.children)return[];if(e.name&&e.children[0])s="control"===e.children[0].type,a="template"===e.children[0].type;var f={};if("undefined"===typeof this.ignoredNames)this.ignoredNames={};else for(var l in this.ignoredNames)if(this.ignoredNames.hasOwnProperty(l))f[l]=1;if(e.name&&"ws:for"===e.name&&!i)O.call(this,e);for(var o=0;o<n.length;o++)if("tag"===n[o].type)r=r.concat(w.call(this,n[o]));else{var c=b(n[o]);if(c)r=r.concat(c)}if(s||a||t||"ws:partial"===e.name){if(e.injectedData)for(var d=0;d<e.injectedData.length;d++){var g=b.call(this,e.injectedData[d]);if(!g)throw new Error('Invalid option in tag "'+e.name+'"');if(e.injectedData[d].internal={},y({},e.injectedData[d].internal,g),g)r=r.concat(g)}if(!e.attribs&&(s||a))e.attribs={};if(!e.internal)e.internal={};y(e.attribs,e.internal,r)}if(e.attribs)for(var h in e.attribs){if(h&&m.isEvent(h))continue;var u=b(e.attribs[h]);if(u)r=r.concat(u)}if(i){var p=b(v.createDataVar(e.forSource.main));if(p)r=r.concat(p)}return this.ignoredNames=f,r}function c(e){var t=e.lastIndexOf("thelpers.getter"),n=e.indexOf(")",t);if(-1===t||-1===n)return"";return e.substring(t,n+1)}function e(e){var t={};for(var n in e)if(n.indexOf("__dirtyCheckingVars_")>-1)if(!e[n])delete e[n];else if(-1===e[n].indexOf("getter"))delete e[n];else if(t.hasOwnProperty(e[n]))delete e[n];else{t[e[n]]=true;var r=e[n].split(".apply"),i="",a;if(r.length>1)for(var s=0;s<r.length;s++)if(a=c(r[s]))i=a+" && "+i;if(i)e[n]=e[n].replace("¥","¥"+i)}}return{detectControlTags:w,doDirtyCheckingSafety:e}});