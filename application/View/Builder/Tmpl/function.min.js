define("View/Builder/Tmpl/function",["View/Builder/Tmpl/expressions/process","View/Builder/Tmpl/expressions/event","View/Builder/Tmpl/modules/utils/common","View/Builder/Tmpl/modules/control","View/Builder/Tmpl/modules/if","View/Builder/Tmpl/modules/for","View/Builder/Tmpl/modules/else","View/Builder/Tmpl/modules/partial","View/Builder/Tmpl/modules/template","View/Builder/Tmpl/modules/utils/tag","View/Builder/Tmpl/modules/data/utils/dataTypesCreator","View/Builder/Tmpl/modules/data/utils/functionStringCreator","View/Builder/Tmpl/handlers/log","View/Builder/Tmpl/modules/utils/parse","Core/helpers/Hcontrol/configStorage","Core/helpers/Function/shallowClone","text!View/Builder/Tmpl/modules/templates/objectFunctionTemplate.jstpl","text!View/Builder/Tmpl/modules/templates/objectFunctionHeaderTemplate.jstpl"],function e(f,l,p,n,t,r,i,s,a,o,u,c,d,h,m,g,v,_){"use strict";function b(e){return{type:"text",value:e}}function T(e){if(e&&e.replace){var r={"'":"\\'",'"':'\\"',"\\":"\\\\"};return e.replace(/['"\\]/g,function e(t){return r[t]||t})}return e}_=_.replace(/\r/g,""),v=v.replace(/\r/g,"");var w=[{toFind:/¥/g,toReplace:"\\u00A5"},{toFind:/۩/g,toReplace:"\\u06E9"},{toFind:/₪/g,toReplace:"\\u20AA"}],y;return{name:"string",_modules:{if:t,for:r,else:i,partial:s,template:a},_attributeModules:{if:t,for:r},_controlsData:{},handlers:{},includeStack:{},includedFunctions:{},clearControlsData:function(){this._controlsData={}},decorate:function e(n){return function e(t){if(!t)t={};var r=g(t);if(n)for(var i in n)if(r[i])if(r[i].data.length>0)r[i].data.push(b(" "+n[i]));else if(r[i].data&&!r[i].data.length)r[i].data=[r[i].data,b(" "+n[i])];else r[i]={},r[i].data=b(n[i]);else r[i]={},r[i].data=b(n[i]);return r}},getString:function e(t,r,i,n,s){var a=this.decorate(n),o="",l=this._controlsData;if(a.isMainAttrs=true,i)this.handlers=i,this.calculators=i.config.calculators,this.iterators=i.config.iterators,this.filename=i.filename,this.config=i.config;m.merge(l);var u=""+this._process(t,null,a);if(u)u=""+u.replace(/\n/g," ");if(!s)o+=_;return o+=v.replace("/*#TEMPLATE_STRING#*/",u).replace("/*#FILENAME#*/",i.filename)},getFunction:function e(t,r,i,n,s){var a=function(){},o="no function";try{o=this.getString(t,r,i,n,s),(a=new Function("data, attr, context, isVdom, sets",o)).includedFunctions=this.includedFunctions,a.privateFn=this.privateFn,a.includedFn=this.includedFn}catch(e){d.IoC.resolve("ILogger").error(d.generateErrorMessage(i.filename),e,e),d.IoC.resolve("ILogger").log("generating function: ",o)}return a},_processOptionModule:function e(t,r,i){return o.loadModuleFunction.call(this,n.module,t,r,i)},_processModule:function e(t,r,i){var n=o.moduleMatcher.call(this,t);return o.loadModuleFunction.call(this,n,t,r,i)},_processTag:function e(t){var r=o.splitWs(t);if(this._modules[r]&&"partial"!==r)return this._processModule;else return this._checkForManageableAttributes},_processEntity:function(e,t,r,i){if(this._modules[o.splitWs(e.name)])return this._processModule(e,t,r);if(o.isTagRequirable.call(this,e.name,u.injectedDataTypes))return this._processOptionModule(e,t,r);return this._handlingTag(e,t,r,i)},_whatMethodShouldYouUse:function e(t){return o.findFunctionCase.call(this,t,"_process")},_stopArrs:function e(t){var r="",i;if(p.isArray(t)){for(i=0;i<t.length;i++)r+=t[i];return r}return t},_seek:function e(t,r,i,n,s,a){var o=this._whatMethodShouldYouUse(t);if(o)return t.prev=i,t.next=n,this._stopArrs(o.call(this,t,r,s,a))},_processData:function e(t,r,i,n,s,a,o){var l="",u,c,d="";if(t.length){for(u=0;u<t.length;u++){if(i)c=f(t[u],r,this.calculators,this.filename,i.isControl,i.rootConfig,i.propertyName,a);else c=f(t[u],r,this.calculators,this.filename,void 0,void 0,o,a);if(p.notUndefOrNull(c))if("var"===t[u].type)if(true===t[u].localized)l+="' + ("+c+") + '";else{if(n)c="thelpers.wrapUndef("+c+")";l+="' + ("+c+") + '"}else l+=T(c);else l+=""}d=l}else if(false!==s&&"text"===t.type)d=T(t.value);else if(i)d=f(t,r,this.calculators,this.filename,i.isControl,i.rootConfig,i.propertyName,a);else d=f(t,r,this.calculators,this.filename,void 0,void 0,void 0,a);if("string"===typeof d)w.forEach(function(e){d=d.replace(e.toFind,e.toReplace)});return d},_processAttributesObj:function e(t,r,i){var n={attributes:{},events:{},key:c.wrapAroundExec('key+"'+i.key+'"')},s,a;if(t)for(a in t)if(t.hasOwnProperty(a)&&t[a])if(l.isEvent(a))n.events[a.toLowerCase()]=l.processEventAttribute.call(this,t[a],a,r);else{var o=true;if("data-bind"===a)o=false;if(s=this._processData(t[a].data,r,void 0,true,false,o,a),""!==p.removeAllSpaces(s))n.attributes[a]=s}return n.events=c.wrapAroundExec('typeof window === "undefined"?{}:'+c.getStr(n.events)),n},_processText:function e(t,r){var i=this._processData(t.data,r,void 0,true);return"markupGenerator.createText('"+(i=i||"")+"', key + '"+t.key+"'), \n"},_processDirective:function e(t,r){return"markupGenerator.createDirective('"+t.data+"'), \n"},_processComment:function e(t,r){var i;return"markupGenerator.createComment('"+this._processData(t.data,r,void 0,true)+"'), \n"},_generateTag:function e(t,r,i,n){if(t.attribs&&t.attribs.xmlns)n=t.attribs.xmlns;else if(!t.attribs)t.attribs={xmlns:n};else t.attribs.xmlns=n;var s=i&&p.isFunction(i)?i(t.attribs):t.attribs,a=this._processAttributesObj(s,r,t),o=c.getStr(a).replace(/\\("|')/g,"$1").replace(/\\\\/g,"\\").replace(/\' \+ /g,'" + ').replace(/ \+ \'/g,' + "'),l=this._process(t.children,r,void 0,n),u=i?"attr":'attr?{context: attr.context, key: key+"'+t.key+'"}:{}';return"markupGenerator.createTag('"+t.name+"', "+o+", ["+l+"], "+u+", defCollection, viewController), \n"},_processManageableAttributes:function e(t){var r=[],i;for(i in t)if(this._attributeModules.hasOwnProperty(i)&&t[i])if("if"===i)r.unshift({module:i,value:t[i]});else r.push({module:i,value:p.clone(t[i])});return r},_useManageableAttributes:function e(t,r,i,n){var s=this._processManageableAttributes(t.attribs);if(!!s.length){var a=s.shift().module;if("for"===a&&"label"===t.name)return this._processEntity(t,r,i,n);return o.loadModuleFunction.call(this,h.attributeParserMatcherByName.call(this,a),t,r,i)}return this._processEntity(t,r,i,n)},_checkForManageableAttributes:function e(t,r,i,n){if(t.attribs)return this._useManageableAttributes(t,r,i,n);return this._processEntity(t,r,i,n)},_handlingTag:function e(t,r,i,n){return this._generateTag(t,r,i,n)},_process:function e(t,r,i,n){for(var s="",a,o=0;o<t.length;o++)if(a=this._seek(t[o],r,t[o-1],t[o+1],i,n))s+=a;return s}}});