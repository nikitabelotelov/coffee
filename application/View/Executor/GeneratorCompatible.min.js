define("View/Executor/GeneratorCompatible",["require","exports","Core/helpers/Number/randomId","Core/Context","Core/helpers/Hcontrol/configStorage","Core/markup/ParserUtilities","Core/core-extend-initializer","Core/ContextBinder","Env/Env","Core/helpers/Function/shallowClone","Core/Serializer","View/Logger","View/Request","View/Executor/Markup","View/Executor/Expressions","View/Executor/Utils"],function(p,e,m,u,C,g,d,l,v,b,a,x,_,y,h,w){var O=Object.create(y.Generator),f=["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","path","circle","ellipse","line","rect","use","stop","polyline","polygon"];function P(e){return e&&e.then}function s(e){var t;switch(e.prototype._moduleName){case"OnlinePage/Context/UserInfo":return new e(window&&window.userInfo||{});case"Controls/Container/Scroll/Context":return new e({pagingVisible:false});default:return new e({})}}function t(e,t,n){if("undefined"===typeof t)return{};var r=e.contextTypes?e.contextTypes():{},o={};if(!r)v.IoC.resolve("ILogger").error(null,"Context types are not defined");else for(var i in r)if(!(t[i]instanceof r[i]))o[i]=s(r[i]);else if(o[i]=t[i],n)o[i].registerConsumer(n);return o}var n=h.ContextResolver.resolveContext,e;function k(e,t){var n=t||{};if(e&&e.name)n.name=e.name;else if(t&&t.name)e.name=t.name;return n}function c(e,t){if(false===t)e+=" ws-hidden";return e}function N(e,t){if(t)e+=" ws-enabled";else e+=" ws-disabled";return e}function E(e,t){if(!e||!t)return;for(var n in t){if(!t.hasOwnProperty(n))continue;if(e.hasOwnProperty(n)){if("class"===n||"attr:class"===n)e[n]=(t[n]||"")+" "+(e[n]||"")}else e[n]=t[n]}}function S(e,t){if(t)if(e&&(e.bindings&&e.bindings.length||"false"===e["hasMarkup"]))return"false";return"true"}function I(e,t,n){var r=(e["attr:class"]?e["attr:class"]+" ":"")+(e["class"]?e["class"]+" ":"")+(t["className"]?t["className"]+" ":"")+(t["cssClassName"]?t["cssClassName"]+" ":"")+(n&&n["class"]?n["class"]:""),o={visible:c,enabled:N};for(var i in r=w.Class.removeClassDuplicates(r),e.class=r.trim(),o)if(o.hasOwnProperty(i))e.class=o[i](e.class,t[i]);if(e.class=e.class.trim(),!e.class)delete e.class;return e}function T(e,t,n){var r=e.user.__$config,o=C.getData()[r];if(!o){var i={};i[r]=e.user,C.merge(i)}else e.user=o;return e}function R(e){return new g.Node({nodeType:1,nodeName:"component",startTag:"<component>",closeTag:"</component>",attributes:e,sequence:void 0,childNodes:[],parentNode:void 0})}function F(e,t,n,r){var o,i=r&&r._options||{},a=w.Common.isNewControl(n)||"buildMarkupWithContext"in t?t.buildMarkupWithContext:i.buildMarkupWithContext;if(e&&e instanceof u&&false!==a)t=(o=l.initBinderForControlConfig(t)).getConstructorOptions(e,n,t);else if(t.context&&t.context instanceof u&&false!==a)t=(o=l.initBinderForControlConfig(t)).getConstructorOptions(t.context,n,t);return t}function V(o,i,a){var l=o.user,e,t;if(l["class"]=a["class"],o.internal&&o.internal.hasOldParent&&!l["tabindex"])l["tabindex"]=a["attr:tabindex"]||a["tabindex"];if(!window||!l.element||0===l.element.length)if(!o.internal||!o.internal.logicParent)l.element=R(a);else l.__$fixDecOptions=a;var n=h.Subscriber.getEventsListFromOptions(l);for(var r in n)if(n.hasOwnProperty(r))delete l[r];var s=l.doNotSetParent;l.doNotSetParent=true,l=F(l.linkedContext,l,i),o.internal=o.internal||{},l.iWantBeWS3=true;var f=w.Compatible.createInstanceCompatible(i,l,o.internal),c=f.instance,u=f.resolvedOptions;if(u.doNotSetParent=s,"undefined"!==typeof window)h.Subscriber.subscribeEvents(c,o.internal.logicParent,n),O.saveContext(l,c);if(c._template){if(c.saveOptions)c.saveOptions(u);else c._options=u;if("undefined"!==typeof window)O.saveContext(l,c);try{e=c._beforeMountLimited&&c._beforeMountLimited(u,o.templateContext||{})}catch(e){x.catchLifeCircleErrors("_beforeMount",e)}c._beforeMountCalled=true,c.saveInheritOptions(o.inheritOptions||{});var p={};if(!h.Attr.checkAttr(a)&&!a.__wasOldControl){for(var d in a){if(("data-component"===d||"config"===d||"hasMarkup"===d)&&o.internal&&o.internal.logicParent&&o.internal.logicParent._template)continue;p["attr:"+d]=a[d]}a=p,Object.defineProperty(a,"__itsFixedAttrs",{value:true,enumerable:false,configurable:false})}else for(var d in a)if(("data-component"===d||"config"===d||"hasMarkup"===d)&&(!o.internal||!o.internal.logicParent||!o.internal.logicParent._template||o.internal.hasOldParent))a["attr:"+d]=a[d];if(e&&P(e))return new Promise(function(r){e.then(function(t){var e;if(c._saveContextObject(h.ContextResolver.resolveContext(i,o.templateContext||{})),c.saveFullContext(h.ContextResolver.wrapContext(c,o.templateContext||{})),c=w.Common.plainMerge(c,t),l.__$receivedState=t,a&&a["attr:component"]&&a["attr:component"].indexOf("Controls/Application")>-1)delete a["config"],delete a["attr:config"];var n=_.getCurrent();if(n)n.stateReceiver.register(o.key,{getState:function(){return t},setState:function(){}});if((e=c._template?c.render(null,{attributes:a,key:o.key}):"").then)e.then(function(e){r({result:O.makeInlineConfigs(e,o.key,t),receivedState:t})},function(e){w.Common.asyncRenderErrorLog(e),r({result:U(c),receivedState:void 0})});else{if(!o.internal||!o.internal.logicParent)O.saveConfig(l.__$config,c);e=O.makeInlineConfigs(e,o.key,t),r({result:e,receivedState:t})}},function(e){w.Common.asyncRenderErrorLog(e),r({result:U(c),receivedState:void 0})})});else c._saveContextObject(h.ContextResolver.resolveContext(i,o.templateContext||{})),c.saveFullContext(h.ContextResolver.wrapContext(c,o.templateContext||{}))}if(t=c._template?y.Generator.invisibleNodeCompat(c.render(void 0,{attributes:a})):"",E(c._decOptions,a),v.constants.compat||!o.internal||!o.internal.logicParent||C.hasKey(l.__$config))O.saveConfig(l.__$config,c),c.__destory_origin=c.destroy,c.destroy=function(e){var t={};t[this._options.__$config]=void 0,C.merge(t),this.__destory_origin.apply(this,arguments)};return t}function M(e,t,n,r,o){var i=t.prototype._modifyOptions,a;if(W(r,e.user),void 0!==r["attr:class"])r["class"]=r["attr:class"];if(void 0!==e.user.__enabledOnlyToTpl&&false!==e.user.allowChangeEnable)e.user.enabled=e.user.__enabledOnlyToTpl;if(e.internal.isOldControl=true,a=i.call(t.prototype,e.user,o,r),window&&e.internal.parent&&e.internal.parent._template&&a.element.length>0){var l=w.Compatible.createInstanceCompatible(t,a,e.internal).instance;return""}else{var s;if(r=I(r,a,o),a.context&&a.context instanceof u)s=a.context;else if(a.linkedContext&&a.linkedContext instanceof u)s=a.linkedContext;for(var f in Object.defineProperty(a,"__wasOldControl",{value:true,enumerable:false,configurable:false}),r)if(0!==f.indexOf("attr:"))r["attr:"+f]=r[f],delete r[f];var c=n.call(e.internal.parent,a,{attributes:r,internal:e.internal},s);if(void 0!==e.user.__enabledOnlyToTpl&&false!==e.user.allowChangeEnable)delete e.user.enabled;return c}}function j(e,t,n,r,o){if(e.internal&&e.internal.parent&&e.internal.parent._template&&window&&e.user.element.length>0){var i,a;return a=F(n,e.user,t),w.Compatible.createInstanceCompatible(t,a,e.internal),""}else{var l={enabled:e.internal.parentEnabled,visible:e.internal.parentVisible};return o["hasMarkup"]="true",g.buildMarkupForClass(t,e.user,n,r,l,void 0,o)}}function D(e,t){if(t)e.linkedContext=t;else if(e.parent&&e.parent.getLinkedContext)e.linkedContext=e.parent.getLinkedContext()}function A(e,t,n){if(false===e.allowChangeEnable||"false"===e.allowChangeEnable)return false;if(n&&n._options)if(false===n._options.allowChangeEnable||"false"===n._options.allowChangeEnable)return false;if(t&&void 0===e.enabled&&!t.parent)return e.enabled=t.parentEnabled,true}function L(e,t,n,r,o){var i=q(e),a,l,s;if(w.Common.isNewControl(e)||i.stable)t=T(t,e,w.Common.isNewControl(e));if(!t.internal||!t.internal.logicParent||!t.internal.logicParent._template||!w.Common.isNewControl(e))s=d.call(e),(l=F(n,t.user,e,s)).element=window?$('[config="'+o["config"]+'"]'):[],D(l,n);else(l=t.user).element=[];if(w.Common.isNewControl(e)||i.stable){var f=A(l,t.internal,s),c=s?d.getInstanceOptionsByDefaults(e,l,s):l;if(o=k(c,o),w.Common.isNewControl(e))a=V({user:c,internal:t.internal,templateContext:t.templateContext,inheritOptions:t.inheritOptions,key:t.key},e,o);else{var u=W(o,c);if(a=M({user:c,internal:t.internal},e,i,o,l),!u)delete c.tabindex}if(f)delete l.enabled;if(e.prototype._modifyOptionsAfter)e.prototype._modifyOptionsAfter(t.user);return a}else W(o=k(l,o),l),a=j({user:l,internal:t.internal},e,n,r,o);return a}function W(e,t){var n=true;if(void 0!==t.tabindex)n=false;if(void 0!==e["attr:tabindex"])t.tabindex=e["attr:tabindex"];if(void 0!==e["tabindex"])t.tabindex=e["tabindex"];if(t.__$config)if(C.hasKey(t.__$config)){if(void 0!==e["attr:tabindex"])C.getValue(t.__$config).tabindex=e["attr:tabindex"];if(void 0!==e["tabindex"])C.getValue(t.__$config).tabindex=e["tabindex"]}return n}function B(r){var e=r.bindings;e&&e.forEach(function(t){var n=r;if(t.bindNonExistent){var e=t.propName.split("/");if(e.length)e.forEach(function(e){if(n.hasOwnProperty(e))n=n[e];else v.IoC.resolve("ILogger").error("fillNonExistentValues","nonexistent value "+t.propName+" can't fill")}),t.nonExistentValue=n;else v.IoC.resolve("ILogger").error("fillNonExistentValues","nonexistent value "+t.propName+" can't fill")}})}function r(e){if(e&&e._options&&e._options.__$config)return e._options.__$config;else if(e&&e._parent)return r(e._parent);else return""}function q(e){return e.prototype._dotTplFn||e.prototype._template}function G(){return m("cfg-")}function z(e,t,n,r){var o=r&&r.resolvers?w.Common.findResolverInConfig(e,r.resolvers):void 0;if(o)return o(e);else return w.Common.depsTemplateResolver(e,t,n,r)}function U(e){var t={},n;if(e&&e._options)n=e._options,t=h.Decorate.createRootDecoratorObject(n["__$config"],true,n["data-component"],{});return O.createTag("div",{attributes:t},[])}function H(e,t){function r(e){if(void 0===e||null===e)return"";else return e}var n;return function(e){var t="";for(var n in e)if(e.hasOwnProperty(n))t+=""!==r(e[n])?" "+n+'="'+e[n]+'"':"";return t}(O.joinAttrs(e,t))}function K(e){return!(w.Common.isString(e)&&w.Common.isOptionalString(w.Common.splitWs(e)))}function o(e){var t={},n;for(n in e)if(e.hasOwnProperty(n))t[n]=e[n];for(n in O)if(O.hasOwnProperty(n))e[n]=function(e){return function(){if(v.constants.compat)return O[e].apply(this,arguments);else return t[e].apply(this,arguments)}}(n)}if(h.ContextResolver.resolveContext=function(){var e;return(w.Common.isCompat()?t:n).apply(h.ContextResolver,arguments)},O.createEmptyText=function(){return""},O.createWsControl=function e(t,n,r,o,i){var a=this.prepareDataForCreate(t,n,r,i);x.log("createWsControl",[a.dataComponent,a.controlProperties]),x.log("Context for control",["",r.context]),x.log("Inherit options for control",["",r.inheritOptions]);var l=a.dataComponent,s,f=null,c=a.controlClass,u=c&&c.prototype&&q(c),p;if(!c&&!u){if(K(t)){var d=new Error("Попытка создания контрола, у которого отсутствует конструктор и шаблон");v.IoC.resolve("ILogger").error(d.message,d.stack)}return""}if(c&&!u&&!w.Common.isNewControl(c))return W(r.attributes,n),O.createController(c,n,r,o,i);var m=a.controlProperties;if(!m["data-component"])m["data-component"]=l;if(!a.logicParent||!a.logicParent._template||!w.Common.isNewControl(c))m=b(m);for(var C=0;m.hasOwnProperty("__dirtyCheckingVars_"+C);C++)delete m["__dirtyCheckingVars_"+C];if(m&&m.bindings)for(var g=0;g<m.bindings.length;g++)if(m.bindings[g].propName&&m.bindings[g].propName.indexOf("__dirtyCheckingVars_")>-1)m.bindings.splice(g,1),g--;if(B(m),n.internal=n.internal||{},v.constants.compat||!w.Common.isNewControl(c)||!a.logicParent||!a.logicParent._template)s=G();else s="cfg-123";if(w.Common.isNewControl(c)&&a.logicParent&&a.logicParent._template||h.Rights.applyRights(a.attrs,m)){if(u)p=h.Decorate.createRootDecoratorObject(s,S(m,!u.stable),a.attrs&&a.attrs["data-component"]||l,a.attrs);else delete(p=a.attrs)["data-component"],delete m["data-component"];if(m["__$config"]=s,a.attrs&&a.attrs.__wasOldControl)Object.defineProperty(p,"__wasOldControl",{value:true,enumerable:false,configurable:false});return h.Focus.resetDefaultValues(p),L(c,{user:m,internal:a.internal,templateContext:r.context,inheritOptions:r.inheritOptions,key:r.key},o,f,p)}else return""},O.createController=function e(t,n,r,o,i){var a=this.prepareDataForCreate(t,n,r,i);x.log("createController",[a.dataComponent,a.controlProperties]);var l=m("cfg-"),s=a.controlClass,f=null,c,u=a.controlProperties;if(!u["data-component"])u["data-component"]=a.dataComponent,a.attrs["data-component"]=a.dataComponent;h.Focus.resetDefaultValues(a.attrs),h.Focus.prepareTabindex(a.attrs);for(var p=0;u.hasOwnProperty("__dirtyCheckingVars_"+p);p++)delete u["__dirtyCheckingVars_"+p];if(u&&u.bindings)for(var d=0;d<u.bindings.length;d++)if(u.bindings[d].propName&&u.bindings[d].propName.indexOf("__dirtyCheckingVars_")>-1)u.bindings.splice(d,1),d--;if(B(u),r=k(u,a.attrs),h.Rights.applyRights(r,u))return c=h.Decorate.createRootDecoratorObject(l,"false",a.dataComponent,r),g.buildMarkupForClass(s,u,o,f,void 0,void 0,c);else return""},O.createTemplate=function e(t,n,r,o,i,a){var l,s=w.Common.hasResolver(t,a&&a.resolvers);if(w.Common.isString(t)){if(s)l=a.resolvers[s](t);else if((l=i&&i[t]||p(t))&&w.Common.isOptionalString(t)&&!w.Common.isTemplateString(t))return this.createWsControl(t.split("js!")[1],n,r,o,i)}else l=t;if(-1===n.tabindex&&!n.hasOwnProperty("_moduleName"))delete n.tabindex;var f=this.prepareDataForCreate(t,n,r,i),c=f.parent,u=f.controlProperties;return x.log("createTemplate",[w.Common.isString(t)?t:"InlineFunction",f.controlProperties,l]),x.log("Context for template",["",r.context]),x.log("Inherit options for template",["",r.inheritOptions]),null===l?"":c?l.call(c,u,r,o):l(u,r,o)},O.resolver=function e(t,n,r,o,i,a,l,s){var f="string"===typeof t,c=w.Common.isLibraryModule(t),u=!(f&&w.Common.isStringModules(t)),p=this.prepareDataForCreate(t,n,r,i,a),d=p.controlProperties,m;if(f)m=z(t,a,i,l);else if(c)m=p.controlClass;else m=t;if(w.Common.isControlClass(m)){if(f&&-1!==t.indexOf("js!")&&!w.RequireHelper.defined(m.prototype._moduleName))m.prototype._moduleName=t.split("js!")[1];if(m.prototype._dotTplFn||m.prototype._template)return O.createWsControl(m,d,r,o,i);else return O.createController(m,d,r,o,i)}else{var C;if(x.log("Resolver",[f?t:"InlineFunction",p.controlProperties,m]),x.log("Context for template",["",r.context]),x.log("Inherit options for template",["",r.inheritOptions]),"function"===typeof m)C=n&&p.parent?m.call(p.parent,d,r,o,false):m(d,r,o,false);else if(m&&"function"===typeof m.func)C=n&&p.parent?m.func.call(p.parent,d,r,o,false):m.func(d,r,o,false);else if(w.Common.isArray(m))C=n&&p.parent?m.map(function(e){if("function"===typeof e)return e.call(p.parent,d,r,o,false);else if("function"===typeof e.func)return e.func.call(p.parent,d,r,o,false);return e}):m.map(function(e){if("function"===typeof e)return e(d,r,o,false);else if("function"===typeof e.func)return e.func(d,r,o,false);return e}),C=O.joinElements(C,void 0,s);else if("undefined"===typeof t)return v.IoC.resolve("ILogger").error(typeof t+" component error","Попытка использовать компонент/шаблон, "+"но вместо компонента в шаблоне был передан "+typeof t+"! "+"Если верстка строится неправильно, нужно поставить точку останова и исследовать стек вызовов. "+"По стеку будет понятно, в каком шаблоне и в какую опцию передается "+typeof t),"";else if(u){if(!d.hasOwnProperty("enabled"))d.enabled=r.internal.parentEnabled;if("undefined"===typeof doT)return g.buildInnerComponents(""+t,d,o);else{try{t=t&&t.indexOf&&t.indexOf("{{")>-1?doT.template(t,void 0,void 0,true)(d):t.toString()}catch(e){t=t.toString()}return g.buildInnerComponents(t,d,o)}}else return t.toString();return C}},O.joinElements=function e(t,n,r){if(Array.isArray(t)){var o="";return t.forEach(function e(t){var n;if(Array.isArray(t))t=O.joinElements(t,void 0,r);if(t&&P(t)){if(n=m("def-"),!r.def)r.def=[];r.def.push(t),t="["+n+"]",r.id.push(t)}o+=t||""}),o}else throw new Error("joinElements: elements is not array")},O.createTag=function e(t,n,r,o,i,a){if(!o)o={};if(!n)n={};var l=h.Attr.processMergeAttributes(o.attributes,n.attributes,true);h.Focus.prepareTabindex(l);var s=l?H(l,{}):"";if(~f.indexOf(t))return"<"+t+s+" />";return"<"+t+s+">"+O.joinElements(r,void 0,i)+"</"+t+">"},O.createText=function e(t){return t},O.createDirective=function e(t){return"<"+t+">"},O.createComment=function e(t){return"\x3c!--"+t+"--\x3e"},O.makeInlineConfigs=function e(t,n,r){var o=new a,i=JSON.stringify(r,o.serialize);return w.Common.componentOptsReArray.forEach(function(e){i=i.replace(e.toFind,e.toReplace)}),t+'<script type="text/javascript" data-vdomignore="true">window.inline'+n.replace("cfg-","")+"='"+i+"';<\/script>"},O.saveConfig=function e(t,n){if("undefined"!==typeof window){var r={};r[t]=n,C.merge(r)}},O.saveContext=function e(t,n){var r=t.context||t.linkedContext;if(r&&r instanceof u){var o;l.initBinderForControlConfig(t).bindControl(n,r,"syncControl")}},O.calculateScope=function e(t){return h.Scope.calculateScope(t,h.Scope.controlPropMerge)},O.buildMarkupForClass=L,O.escape=w.Common.escape,v.constants.isBrowserPlatform)o(y.GeneratorText);return O});