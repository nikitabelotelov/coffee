define("View/Executor/_Markup/Generator",["require","exports","Core/core-debug","Core/constants","Core/IoC","View/Logger","View/Executor/Utils","View/Executor/Expressions"],function(e,t,d,y,b,v,E,x){"use strict";Object.defineProperty(t,"__esModule",{value:true});var T={},n=/(\[def-[\w\d]+\])/g,i=["ws-creates-context","ws-delegates-tabfocus","ws-tab-cycling","ws-no-focus","attr:ws-creates-context","attr:ws-delegates-tabfocus","attr:ws-tab-cycling","attr:ws-no-focus"],r={createWsControl:function(e,t,r,o,n){throw new Error("Generator.createWsControl is not implemented")},createTemplate:function(e,t,r,o,n,i){throw new Error("Generator.createTemplate is not implemented")},createController:function(e,t,r,o,n){throw new Error("Generator.createController is not implemented")},resolver:function(e,t,r,o,n,i){throw new Error("Generator.resolver is not implemented")},joinElements:function(e,t){throw new Error("Generator.joinElements is not implemented")},createTag:function(e,t,r,o,n){throw new Error("Generator.createTag is not implemented")},createText:function(e){throw new Error("Generator.createText is not implemented")},createEmptyText:function(){throw new Error("Generator.createEmptyText is not implemented")},createDirective:function(e){throw new Error("Generator.createDirective is not implemented")},escape:function(e){throw new Error("Generator.escape is not implemented")},getScope:function(e){return e},chain:function(t,o){return Promise.all(o.def).then(function e(r){return t.replace(n,function(e){var t=o.id.indexOf(e);if(o.id[t])return r[t].result?r[t].result:r[t];return""})},function(e){E.Common.asyncRenderErrorLog(e)})},createControl:function(e,t,r,o,n,i,a,l,s,c,u){var f;if((r=E.ConfigResolver.resolveControlCfg(r,n,o)).internal.logicParent=r.internal.logicParent||n.viewController,r.internal.parent=r.internal.parent||n.viewController,o.internal=r.internal,r=r.user,null===t)return this.createText("",o.key);else{if("wsControl"===e)if(v.getLoggerStatus()||E.Common.isCompat())f=d.methodExecutionTime(this.createWsControl,this,[t,r,o,i,a]);else f=this.createWsControl(t,r,o,i,a);if("template"===e)if(v.getLoggerStatus()||E.Common.isCompat())f=d.methodExecutionTime(this.createTemplate,this,[t,r,o,i,a,s]);else f=this.createTemplate(t,r,o,i,a,s);if("controller"===e)if(v.getLoggerStatus()||E.Common.isCompat())f=d.methodExecutionTime(this.createController,this,[t,r,o,i,a]);else f=this.createController(t,r,o,i,a);if("resolver"===e){var p,m;if(o.events)for(m in o.events)if(o.events.hasOwnProperty(m))for(p=0;p<o.events[m].length;p++)if(!o.events[m][p].fn.isControlEvent)o.events[m][p].toPartial=true;if(v.getLoggerStatus()||E.Common.isCompat())f=d.methodExecutionTime(this.resolver,this,[t,r,o,i,a,l,s,u]);else f=this.resolver(t,r,o,i,a,l,s,u)}if(void 0!==f)return f;else{if(t&&e)return this.createText("",o.key);if("undefined"===typeof t)return b.resolve("ILogger").error("Undefined component error","Попытка использовать компонент/шаблон, "+"но вместо компонента в шаблоне в опцию template был передан undefined! "+"Если верстка строится неправильно, нужно поставить точку останова и исследовать стек вызовов. "+"По стеку будет понятно, в каком шаблоне и в какую опцию передается undefined"),this.createText("",o.key);throw new Error("MarkupGenerator: createControl type not resolved")}}},prepareDataForCreate:function(e,t,r,o,n){var i,a,l,s,c,u;if("function"===typeof e)l=(i=e).prototype?e.prototype._moduleName:"";if("string"===typeof e)if(E.Common.isLibraryModuleString(e))e=E.Common.splitModule(e);else{var f=E.Common.splitWs(e);if(f)e=f;if(e.indexOf("/")>-1)if(s=true,e.indexOf("optional!")>-1)c=true;if(e=e.replace("optional!",""),n&&n[e])i=n[e];if(!i)i=o&&(o[e]||o["optional!"+e]);if(!i)if(!s||c||y.compat){if(E.RequireHelper.defined(e))i=E.RequireHelper.require(e)}else try{if(!(i=T[e]))i=E.RequireHelper.require(e),T[e]=i}catch(e){b.resolve("ILogger").warn("Create component",e,e.stack)}l=e}if("object"===typeof e&&e&&e.library&&e.module){var p=e.library+":"+e.module;if(o&&o[e.library])i=o[e.library][e.module];else if(E.RequireHelper.defined(e.library))i=E.RequireHelper.require(e.library)[e.module];else{var m;if(T[e.library])i=T[e.library][e.module];else p=void 0}if(i&&i.prototype&&!i.prototype.hasOwnProperty("_moduleName"))i.prototype._moduleName=p;l=p}var d=i&&i.prototype&&E.Common.isCompound(i),v=x.Scope.calculateScope(t,E.Common.plainMerge)||{};if(d)for(var w in r.events)v[w]=r.events[w];if(!r.attributes)r.attributes={};if(x.Focus.prepareAttrsForFocus(r.attributes,v),a=r.internal&&r.internal.logicParent?r.internal.logicParent:null,u=r.internal&&r.internal.parent?r.internal.parent:null,E.OptionsResolver.resolveInheritOptions(i,r,v),y.compat){if(v&&void 0===v.enabled){var h=r.internal;if(h&&h.parent&&d)if(void 0!==h.parentEnabled&&false!==v.allowChangeEnable)v.enabled=h.parentEnabled;else v.enabled=true;else if(d&&false===h.parentEnabled)v.__enabledOnlyToTpl=h.parentEnabled}if(d){var C=r.attributes;for(var g in C)if(C.hasOwnProperty(g)&&x.Event.isEvent(g))v[g]=C[g]}}return{logicParent:a,parent:u,attrs:r.attributes,controlProperties:v,dataComponent:l,internal:r.internal,controlClass:i,compound:!(i&&i.isWasaby)}},cutFocusAttributes:function(t,r,o){i.forEach(function(e){if(t.hasOwnProperty(e))if(r&&r(e,t[e]),delete t[e],o)o.removeAttribute(e)})},joinAttrs:x.Attr.joinAttrs};return t.default=r,t});