define("View/Executor/_Markup/Generator",["require","exports","Env/Env","View/Logger","View/Executor/Utils","View/Executor/Expressions"],function(e,t,h,d,y,E){Object.defineProperty(t,"__esModule",{value:true});var x={},o=/(\[def-[\w\d]+\])/g,i=["ws-creates-context","ws-delegates-tabfocus","ws-tab-cycling","ws-no-focus","attr:ws-creates-context","attr:ws-delegates-tabfocus","attr:ws-tab-cycling","attr:ws-no-focus"],r={createWsControl:function(e,t,r,n,o){throw new Error("Generator.createWsControl is not implemented")},createTemplate:function(e,t,r,n,o,i){throw new Error("Generator.createTemplate is not implemented")},createController:function(e,t,r,n,o){throw new Error("Generator.createController is not implemented")},resolver:function(e,t,r,n,o,i){throw new Error("Generator.resolver is not implemented")},joinElements:function(e,t){throw new Error("Generator.joinElements is not implemented")},createTag:function(e,t,r,n,o){throw new Error("Generator.createTag is not implemented")},createText:function(e){throw new Error("Generator.createText is not implemented")},createEmptyText:function(){throw new Error("Generator.createEmptyText is not implemented")},createDirective:function(e){throw new Error("Generator.createDirective is not implemented")},escape:function(e){throw new Error("Generator.escape is not implemented")},getScope:function(e){return e},chain:function(t,n){return Promise.all(n.def).then(function e(r){return t.replace(o,function(e){var t=n.id.indexOf(e);if(n.id[t])return r[t].result?r[t].result:r[t];return""})},function(e){y.Common.asyncRenderErrorLog(e)})},createControl:function(e,t,r,n,o,i,a,l,s,c,u){var f;if((r=y.ConfigResolver.resolveControlCfg(r,o,n)).internal.logicParent=r.internal.logicParent||o.viewController,r.internal.parent=r.internal.parent||o.viewController,n.internal=r.internal,r=r.user,null===t)return this.createText("",n.key);else{if("wsControl"===e)if(d.getLoggerStatus()||y.Common.isCompat())f=h.coreDebug.methodExecutionTime(this.createWsControl,this,[t,r,n,i,a]);else f=this.createWsControl(t,r,n,i,a);if("template"===e)if(d.getLoggerStatus()||y.Common.isCompat())f=h.coreDebug.methodExecutionTime(this.createTemplate,this,[t,r,n,i,a,s]);else f=this.createTemplate(t,r,n,i,a,s);if("controller"===e)if(d.getLoggerStatus()||y.Common.isCompat())f=h.coreDebug.methodExecutionTime(this.createController,this,[t,r,n,i,a]);else f=this.createController(t,r,n,i,a);if("resolver"===e){var p,m;if(n.events)for(m in n.events)if(n.events.hasOwnProperty(m))for(p=0;p<n.events[m].length;p++)if(!n.events[m][p].fn.isControlEvent)n.events[m][p].toPartial=true;if(d.getLoggerStatus()||y.Common.isCompat())f=h.coreDebug.methodExecutionTime(this.resolver,this,[t,r,n,i,a,l,s,u]);else f=this.resolver(t,r,n,i,a,l,s,u)}if(void 0!==f)return f;else{if(t&&e)return this.createText("",n.key);if("undefined"===typeof t)return h.IoC.resolve("ILogger").error("Undefined component error","Попытка использовать компонент/шаблон, "+"но вместо компонента в шаблоне в опцию template был передан undefined! "+"Если верстка строится неправильно, нужно поставить точку останова и исследовать стек вызовов. "+"По стеку будет понятно, в каком шаблоне и в какую опцию передается undefined"),this.createText("",n.key);throw new Error("MarkupGenerator: createControl type not resolved")}}},prepareDataForCreate:function(e,t,r,n,o){var i,a,l,s,c,u;if("function"===typeof e)l=(i=e).prototype?e.prototype._moduleName:"";if("string"===typeof e)if(y.Common.isLibraryModuleString(e))e=y.Common.splitModule(e);else{var f=y.Common.splitWs(e);if(f)e=f;if(e.indexOf("/")>-1)if(s=true,e.indexOf("optional!")>-1)c=true;if(e=e.replace("optional!",""),o&&o[e])i=o[e];if(!i)i=n&&(n[e]||n["optional!"+e]);if(!i)if(!s||c||h.constants.compat){if(y.RequireHelper.defined(e))i=y.RequireHelper.require(e)}else try{if(!(i=x[e]))i=y.RequireHelper.require(e),x[e]=i}catch(e){h.IoC.resolve("ILogger").warn("Create component",e,e.stack)}if(l=e,i&&i.default&&i.default.isWasaby)i=i.default}if("object"===typeof e&&e&&e.library&&e.module){var p=e.library+":"+e.module.join(".");if(n&&n[e.library])i=y.Common.extractLibraryModule(n[e.library],e.module);else if(y.RequireHelper.defined(e.library))i=y.Common.extractLibraryModule(y.RequireHelper.require(e.library),e.module);else{var m;if(x[e.library])i=y.Common.extractLibraryModule(x[e.library],e.module);else p=void 0}if(i&&i.prototype&&!i.prototype.hasOwnProperty("_moduleName"))i.prototype._moduleName=p;l=p}var d=i&&i.prototype&&y.Common.isCompound(i),v=E.Scope.calculateScope(t,y.Common.plainMerge)||{};if(d)for(var g in r.events)v[g]=r.events[g];if(!r.attributes)r.attributes={};if(E.Focus.prepareAttrsForFocus(r.attributes,v),a=r.internal&&r.internal.logicParent?r.internal.logicParent:null,u=r.internal&&r.internal.parent?r.internal.parent:null,y.OptionsResolver.resolveInheritOptions(i,r,v),h.constants.compat){if(v&&void 0===v.enabled){var w=r.internal;if(w&&w.parent&&d)if(void 0!==w.parentEnabled&&false!==v.allowChangeEnable)v.enabled=w.parentEnabled;else v.enabled=true;else if(d&&false===w.parentEnabled)v.__enabledOnlyToTpl=w.parentEnabled}if(d){var b=r.attributes;for(var C in b)if(b.hasOwnProperty(C)&&E.Event.isEvent(C))v[C]=b[C]}}return{logicParent:a,parent:u,attrs:r.attributes,controlProperties:v,dataComponent:l,internal:r.internal,controlClass:i,compound:!(i&&i.isWasaby)}},invisibleNodeCompat:function e(t){return t&&t.indexOf&&0===t.indexOf("<invisible-node")?t.replace(/invisible-node/g,"div"):t},cutFocusAttributes:function(t,r,n){i.forEach(function(e){if(t.hasOwnProperty(e))if(r&&r(e,t[e]),delete t[e],n)n.removeAttribute(e)})},joinAttrs:E.Attr.joinAttrs};return t.default=r,t});