define("View/Executor/_Markup/Vdom/Generator",["require","exports","Core/helpers/Array/flatten","Core/IoC","View/Logger","View/Executor/_Markup/Generator","View/Executor/Expressions","View/Executor/Utils"],function(l,e,p,y,d,t,m,v){"use strict";Object.defineProperty(e,"__esModule",{value:true});var C=Object.create(t.default),o=[],n="";return C.createEmptyText=function(e){return C.createText("",e)},C.createWsControl=function e(t,r,o,n,i){var s=this.prepareDataForCreate(t,r,o,i),a=s.controlClass;if(d.log("createWsControl",[s.dataComponent,s.controlProperties]),d.log("Context for control",["",o.context]),d.log("Inherit options for control",["",o.inheritOptions]),!a)return C.createText("",s.controlProperties&&s.controlProperties.__key||o.key);var c=s.compound,l=s.controlProperties;if(v.OptionsResolver.resolveOptions(a,l,s.logicParent?s.logicParent._moduleName:""))return{compound:c,invisible:false,controlClass:a,controlProperties:l,controlInternalProperties:s.internal,controlAttributes:s.attrs,controlEvents:o.events,key:l.__key||o.key,controlNodeIdx:-1,context:o.context,inheritOptions:o.inheritOptions};else return C.createText("",l.__key||o.key)},C.createTemplate=function e(t,r,o,n,i){var s;if(v.Common.isString(t)){if((s=i&&i[t]||l(t))&&v.Common.isOptionalString(t)&&!v.Common.isTemplateString(t))return this.createWsControl(t.split("js!")[1],r,o,n,i)}else s=t;var a=this.prepareDataForCreate(t,r,o,i);if(d.log("createTemplate",[v.Common.isString(t)?t:"InlineFunction",a.controlProperties,s]),d.log("Context for template",["",o.context]),d.log("Inherit options for template",["",o.inheritOptions]),null==s)return"";if(a.controlProperties.__noDirtyChecking)return this.resolver(s,a.controlProperties,o,n,i);var c={compound:false,template:s,controlProperties:a.controlProperties,parentControl:a.parent,attributes:o,context:o.key,type:"TemplateNode"};return Object.defineProperty(c,"count",{configurable:true,get:function(){var e=0;if(this.children){for(var t=0;t<this.children.length;t++){var r;e+=this.children[t].count||0}return this.children.length+e}else return 0}}),c},C.createController=function e(t,r,o,n,i){return C.createWsControl.apply(this,arguments)},C.resolver=function e(t,r,o,n,i,s,a){var c=this.prepareDataForCreate(t,r,o,i,s),l=c.controlProperties,u="string"===typeof t,f=v.Common.isLibraryModule(t),p;if(u)p=v.Common.depsTemplateResolver(t,s,i,a);else p=c.controlClass;if(!p)if("function"===typeof t)p=t;else if(t&&"function"===typeof t.func)p=t;else if(v.Common.isArray(t))p=t;if(v.Common.isControlClass(p))return C.createWsControl(p,l,o,n,i);else{d.log("Resolver",[u?t:"InlineFunction",c.controlProperties,p]),d.log("Context for template",["",o.context]),d.log("Inherit options for template",["",o.inheritOptions]);var m=c.parent;if("function"===typeof p)return m?p.call(m,l,o,n,true,void 0):p(l,o,n,true);else if(p&&"function"===typeof p.func)return m?p.func.call(m,l,o,n,true,void 0):p.func(l,o,n,true);else if(v.Common.isArray(p)){var h;return m?p.reduce(function(e,t){if("function"===typeof t)return e.concat(t.call(m,l,o,n,true));else if("function"===typeof t.func)return e.concat(t.func.call(m,l,o,n,true));return e.concat(t)},[]):p.reduce(function(e,t){if("function"===typeof t)return e.concat(t(l,o,n,true));else if("function"===typeof t.func)return e.concat(t.func(l,o,n,true));return e.concat(t)},[])}else if("undefined"===typeof t)return y.resolve("ILogger").error(typeof t+" component error","Попытка использовать компонент/шаблон, "+"но вместо компонента в шаблоне был передан "+typeof t+"! "+"Если верстка строится неправильно, нужно поставить точку останова и исследовать стек вызовов. "+"По стеку будет понятно, в каком шаблоне и в какую опцию передается "+typeof t),C.createText("",o.key);else return C.createText(t,o.key)}},C.joinElements=function e(t,r){if(Array.isArray(t))return o=[],n=r||"",t=p(t,true);else throw new Error("joinElements: elements is not array")},C.createTag=function e(t,r,o,n,i,s){if(!n)n={};if(!r)r={};var a=m.Attr.mergeAttrs(n.attributes,r.attributes),c=m.Attr.mergeEvents(n.events,r.events);m.Focus.prepareTabindex(a);var l={attributes:a,hooks:{},events:c||{}},u,f=l.attributes&&l.attributes.key?l.attributes.key:r.key;return o=p(o,true),v.Vdom.htmlNode(t,l,o,f,function(r){if(r){if(this.control&&this.attrs&&this.attrs.name){if(this.control._options.name===this.attrs.name&&"DIV"===r.tagName&&this.control.hasCompatible&&this.control.hasCompatible())this.attrs.name+="_fix";this.control._children[this.attrs.name]=r}if(this.attrs)C.cutFocusAttributes(this.attrs,function(e,t){r[e]=t},r)}}.bind({control:s,attrs:l.attributes}))},C.createText=function e(t,r){if(!t)return;return v.Vdom.textNode(t,r)},C.createDirective=function e(t){throw new Error("vdomMarkupGenerator createDirective not realized")},C.getScope=function(e){try{throw new Error('vdomMarkupGenerator: using scope="{{...}}"')}catch(e){y.resolve("ILogger").info("SCOPE ... in VDom",e.stack)}return e},C.canBeCompatible=false,C.escape=function(e){return e},e.default=C,e});