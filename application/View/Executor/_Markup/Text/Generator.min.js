define("View/Executor/_Markup/Text/Generator",["require","exports","Core/helpers/Number/randomId","Core/helpers/Hcontrol/configStorage","Core/IoC","Core/constants","Core/Serializer","Core/library","View/Logger","View/Request","View/Executor/_Markup/Generator","View/Executor/Expressions","View/Executor/Utils"],function(p,e,i,o,v,t,a,s,C,d,r,m,y){"use strict";Object.defineProperty(e,"__esModule",{value:true}),e["View/Executor/_Markup/Text/FunctionHeaderTemplate"]=true;var n=function(){var e={},t=(r=p,n=e,Object.defineProperty(n,"__esModule",{value:true}),void(n.default="/*#DELETE IT START#*/\nfunction debug() { debugger; }\nvar thelpers = typeof tclosure === 'undefined' || !tclosure ? arguments[arguments.length - 1] : tclosure;\nif (typeof thelpers === \"undefined\" || !thelpers._isTClosure) {\neval(\"var thelpers = null;\");\nthelpers = (function(){return this || (0, eval)('this')})().requirejs(\"View/Executor/TClosure\");\n}\nvar depsLocal = typeof _deps === 'undefined' ? undefined : _deps;\nif (typeof includedTemplates === \"undefined\") {\neval(\"var includedTemplates = undefined;\");\nincludedTemplates = (this && this.includedTemplates) ? this.includedTemplates : {};\n}\n/*#DELETE IT END#*/\nvar templateCount = 0;\nvar key = attr && attr.key || '_';\nvar defCollection = {id: [], def: undefined};\nvar viewController = thelpers.configResolver.calcParent(this, typeof currentPropertyName === 'undefined' ? undefined : currentPropertyName, data);")),r,n;if(t instanceof Function)return t;else for(var o in t)if(t.hasOwnProperty(o))e[o]=t[o];return e}(),g=Object.create(r.default),l=["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","path","circle","ellipse","line","rect","use","stop","polyline","polygon"];function h(e){return e&&e.then}function u(e,t){var r=t||{};if(e&&e.name)r.name=e.name;else if(t&&t.name)e.name=t.name;return r}function c(e){var t,r=[],n=e._linksStorage,o;for(var i in n)if(n.hasOwnProperty(i))if((t=n[i]).module)o=s.parse(t.module),r.push(o.name);return r}function f(n,o,i){var e=n.user,t,a;e["class"]=i["class"];var r=m.Subscriber.getEventsListFromOptions(e);for(var s in r)if(r.hasOwnProperty(s))delete e[s];var l=e.doNotSetParent;e.doNotSetParent=true;var u=e._logicParent&&e._logicParent._moduleName||"";y.OptionsResolver.resolveOptions(o,e,u);var c=new o(e),f=e;if(f.doNotSetParent=l,"undefined"!==typeof window)m.Subscriber.subscribeEvents(c,n.internal.logicParent,r);if(c._template){if(c.saveOptions)c.saveOptions(f);else c._options=f;try{t=c._beforeMountLimited&&c._beforeMountLimited(f,n.templateContext||{})}catch(e){C.catchLifeCircleErrors("_beforeMount",e)}if(c.saveInheritOptions(n.inheritOptions||{}),t&&h(t))return new Promise(function(r){t.then(function(t){c._saveContextObject(m.ContextResolver.resolveContext(o,n.templateContext||{})),c.saveFullContext(m.ContextResolver.wrapContext(c,n.templateContext||{}));var e=d.getCurrent();if(e)e.stateReceiver.register(n.key,{getState:function(){return t},setState:function(){}});if((a=c._template?c.render(null,i):"").then)a.then(function(e){r({result:e,receivedState:t})},function(e){y.Common.asyncRenderErrorLog(e),r({result:b(c),receivedState:void 0})});else r({result:a,receivedState:t})},function(e){y.Common.asyncRenderErrorLog(e),r({result:b(c),receivedState:void 0})})});else c._saveContextObject(m.ContextResolver.resolveContext(o,n.templateContext||{})),c.saveFullContext(m.ContextResolver.wrapContext(c,n.templateContext||{}))}return a=c._template?c.render(void 0,i):""}function x(e,t,r,n,o){var i=t.user,a;return o=u(i,o),a=f({user:i,internal:t.internal,templateContext:t.templateContext,inheritOptions:t.inheritOptions,key:t.key},e,o)}function _(e,t,r,n){var o=n&&n.resolvers?y.Common.findResolverInConfig(e,n.resolvers):void 0;if(o)return o(e);else return y.Common.depsTemplateResolver(e,t,r,n)}function b(e){var t={},r;if(e&&e._options)r=e._options,t=m.Decorate.createRootDecoratorObject(r["__$config"],true,r["data-component"],{});return g.createTag("div",{attributes:t},[])}function w(e,t){function n(e){if(void 0===e||null===e)return"";else return e}var r;return function(e){var t="";for(var r in e)if(e.hasOwnProperty(r))t+=""!==n(e[r])?" "+r+'="'+e[r]+'"':"";return t}(g.joinAttrs(e,t))}if(g.createController=function(){return""},g.createEmptyText=function(){return""},g.createWsControl=function e(t,r,n,o,i){var a=this.prepareDataForCreate(t,r,n,i),s=a.dataComponent;C.log("createWsControl",[s,a.controlProperties]),C.log("Context for control",["",n.context]),C.log("Inherit options for control",["",n.inheritOptions]);var l=null,u=a.controlClass,c=u&&u.prototype._template;if(!u&&!c)return"";if(u&&!c)return g.createController(u,r,n,o,i);var f=a.controlProperties;if(!f["data-component"])f["data-component"]=s;for(var p=0;f.hasOwnProperty("__dirtyCheckingVars_"+p);p++)delete f["__dirtyCheckingVars_"+p];return x(u,{user:f,internal:a.internal,templateContext:n.context,inheritOptions:n.inheritOptions,key:n.key},o,l,n)},g.createTemplate=function e(t,r,n,o,i,a){var s,l=y.Common.hasResolver(t,a&&a.resolvers);if(y.Common.isString(t)){if(l)s=a.resolvers[l](t);else if((s=i&&i[t]||p(t))&&y.Common.isOptionalString(t)&&!y.Common.isTemplateString(t))return this.createWsControl(t.split("js!")[1],r,n,o,i)}else s=t;var u=this.prepareDataForCreate(t,r,n,i),c=u.parent,f=u.controlProperties;return C.log("createTemplate",[y.Common.isString(t)?t:"InlineFunction",u.controlProperties,s]),C.log("Context for template",["",n.context]),C.log("Inherit options for template",["",n.inheritOptions]),null===s?"":c?s.call(c,f,n,o):s(f,n,o)},g.resolver=function e(t,r,n,o,i,a,s,l){var u="string"===typeof t,c=y.Common.isLibraryModule(t),f=this.prepareDataForCreate(t,r,n,i,a),p=f.controlProperties,d;if(u)d=_(t,a,i,s);else if(c)d=f.controlClass;else d=t;if(y.Common.isControlClass(d)){if(u&&-1!==t.indexOf("js!")&&!y.RequireHelper.defined(d.prototype._moduleName))d.prototype._moduleName=t.split("js!")[1];if(d.prototype._template)return g.createWsControl(d,r,n,o,i)}else{var m;if(C.log("Resolver",[u?t:"InlineFunction",f.controlProperties,d]),C.log("Context for template",["",n.context]),C.log("Inherit options for template",["",n.inheritOptions]),"function"===typeof d)m=r&&f.parent?d.call(f.parent,p,n,o,false):d(p,n,o,false);else if(d&&"function"===typeof d.func)m=r&&f.parent?d.func.call(f.parent,p,n,o,false):d.func(p,n,o,false);else if(y.Common.isArray(d))m=r&&f.parent?d.map(function(e){if("function"===typeof e)return e.call(f.parent,p,n,o,false);else if("function"===typeof e.func)return e.func.call(f.parent,p,n,o,false);return e}):d.map(function(e){if("function"===typeof e)return e(p,n,o,false);else if("function"===typeof e.func)return e.func(p,n,o,false);return e}),m=g.joinElements(m,void 0,l);else if("undefined"===typeof t)return v.resolve("ILogger").error(typeof t+" component error","Попытка использовать компонент/шаблон, "+"но вместо компонента в шаблоне был передан "+typeof t+"! "+"Если верстка строится неправильно, нужно поставить точку останова и исследовать стек вызовов. "+"По стеку будет понятно, в каком шаблоне и в какую опцию передается "+typeof t),"";else m=t;return m}},g.joinElements=function e(t,r,n){if(Array.isArray(t)){var o="";return t.forEach(function e(t){var r;if(Array.isArray(t))t=g.joinElements(t,void 0,n);if(t&&h(t)){if(r=i("def-"),!n.def)n.def=[];n.def.push(t),t="["+r+"]",n.id.push(t)}o+=t||""}),o}else throw new Error("joinElements: elements is not array")},g.createTag=function e(t,r,n,o,i){if(!o)o={};if(!r)r={};var a=m.Attr.processMergeAttributes(o.attributes,r.attributes,true);m.Focus.prepareTabindex(a),g.cutFocusAttributes(a);var s=a?w(a,{}):"";if(~l.indexOf(t))return"<"+t+s+" />";return"<"+t+s+">"+g.joinElements(n,void 0,i)+"</"+t+">"},g.createText=function e(t){return t},g.createDirective=function e(t){return"<"+t+">"},g.createComment=function e(t){return"\x3c!--"+t+"--\x3e"},g.makeInlineConfigs=function e(t,r,n){var o=g.serializeReceivedState(n);return t+'<script type="text/javascript" data-vdomignore="true">window.inline'+r.replace("cfg-","")+"='"+o+"';<\/script>"},g.serializeReceivedState=function e(t){var r=new a,n=JSON.stringify(t,r.serialize);return y.Common.componentOptsReArray.forEach(function(e){n=n.replace(e.toFind,e.toReplace)}),n},g.saveConfig=function e(t,r){if("undefined"!==typeof window){var n={};n[t]=r,o.merge(n)}},g.calculateScope=function e(t){return m.Scope.calculateScope(t,m.Scope.controlPropMerge)},g.buildMarkupForClass=x,g.escape=y.Common.escape,t.isBrowserPlatform&&t.compat)p(["View/Executor/GeneratorCompatible"]);return e.default=g,e});