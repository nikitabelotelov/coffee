define("Browser/_TransportOld/loadTemplateFile",["Core/Deferred","Env/Env","Core/Storage","Browser/_TransportOld/nodeType"],function(a,i,c,l){return function e(r,o){function n(n){if(!o&&n instanceof Array)for(var e=0,t=n.length;e<t;e++)if(c.isStored("resfile://"+n[e])||e==t-1){n=n[e];break}var r="undefined"!==typeof document&&(i.cookie.get("s3rh")||i.cookie.get("rightshash"))||0;return c.store("resfile://"+n,function(e){e.dependOn(i.IoC.resolve("ITransport",{dataType:o?"text":"xml",url:function(){var e=n+(o?".fast.xml":".xml");if(r)e=e.replace(/(\.fast)?(\.v[0-9a-f]+)?(\.l[\S-]+)?(\.xml)$/,"$1.r"+r+"$2$3$4");return e}()}).execute(null))})}if(i.constants.xmlPackages[r]&&!o)return(new a).dependOn(n(i.constants.xmlPackages[r])).addCallback(function(e){for(var n=e.documentElement,t=n.childNodes.length-1;t>=0;--t){if(n.childNodes[t].nodeType!=l.ELEMENT_NODE)continue;if(n.childNodes[t].getAttribute("id")==r)return n.childNodes[t]}return new Error(r+" is not found in the package "+i.constants.xmlPackages[r])});var t=r.charAt(0),s="";if("/"!==t&&"."!==t)if(r in i.constants.xmlContents){if("/"!==(t=(r=i.constants.xmlContents[r]).charAt(0)))s=i.constants.resourceRoot}else s=i.constants.wsRoot+"res/xml/";return n(s+r)}});