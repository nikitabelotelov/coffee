define("Browser/_TransportOld/FastTemplate",["Browser/_TransportOld/Template","Env/Env","Core/helpers/Number/randomId","Core/core-attach","Core/Context","Core/Deferred","Core/CommandDispatcher","Core/core-instance","Core/moduleStubs"],function(t,C,y,p,_,v,w,b,k){var e,n=function(t,e,n){if(null===t||void 0===t||0===t.length)return;var o,r,i;if(t instanceof Array){if(t.forEach)t.forEach(e,n);else for(r=t.length,o=0;o<r;o++)if(o in t)e.call(n,t[o],o,t)}else if("length"in t&&t.length-1 in t){for(r=parseInt(t.length,10),o=0;o<r;o++)if(o in t)e.call(n,t[o],o,t)}else for(i in t)if(t.hasOwnProperty(i))e.call(n,t[i],i,t)},A=function(t,o,r){var i=[];if(null===t||void 0===t)return i;return n(t,function(t,e,n){if(o){if(o.call(r,t,e,n))i[i.length]=t}else if(!!t)i[i.length]=t},r),i},o=function(t,o,e,r){var i=arguments.length>2,s=e;if(null===t||void 0===t)t=[];if(n(t,function(t,e,n){if(!i)s=t,i=true;else s=o.call(r,s,t,e,n)}),!i)throw new TypeError("Reduce of empty array with no initial value");return s},N=function(t,e,n){function o(){var t;if("getElementsByClassName"in document)t=document.getElementsByClassName("ws-style-holder-current")[0];else for(var e=document.getElementsByTagName("style"),n=0,o=e.length;n<o;n++)if(i(e[n],"ws-style-holder-current")){t=e[n];break}return t=t||r()}function r(){var t=document.createElement("style"),e=document.getElementsByTagName("head")[0];return t.setAttribute("type","text/css"),t.setAttribute("media","all"),t.className="ws-style-holder ws-style-holder-current",e.appendChild(t),t}function i(t,e){for(var n=" "+t.className+" ",o=e.split(" "),r=0,i=o.length;r<i;r++)if(-1==n.indexOf(" "+o[r]+" "))return false;return true}function s(){var t,e="absolute"===f.css("position"),n=+new Date-d>C.constants.styleLoadTimeout,o=$("#onlineChecker");if(e||n)if(f.remove(),u)if(clearInterval(u),n)o.text(rk("Страница загружается слишком долго. Попробуйте перезагрузить страницу")),o.css("display",""),o.css("zIndex",9999),l.callback();else l.callback();return e}var a="",l=null,c,f,u,d,h;if(e)c=y("cssReady-"),f=$('<div id="'+c+'" style="display: none;" />').appendTo($("body")),a="#"+c+" { position: absolute; }";if(C.compatibility.standartStylesheetProperty)(h=r()).appendChild(document.createTextNode(t+a));else{var g,m,p;if(t+=a,((h=o()).styleSheet.cssText.match(/\{|,/g)||[]).length+(t.match(/\{|,/g)||[]).length>4e3)h.className="ws-style-holder",h=r();try{h.styleSheet.cssText+=t}catch(t){throw C.IoC.resolve("ILogger").error("insertCss","Failed to insert styles to document! IE8/9 Stylesheet limit exceeded (31 per document)?"),t}}if(e)if(d=+new Date,!s())(l=new v).addErrback(function(t){return t}),u=setInterval(s,1);return l};return e=t.extend({$protected:{_options:{template:""},_dom:null,_rootConfig:{},_controlsConfig:[]},$constructor:function(){var n=this;if(this._dom=document.createElement("div"),this._dom.innerHTML=this._options.template,!this._dom.firstChild)throw new Error("Wrong template ("+this.getName()+") came from server");var t=this._dom.firstChild;for(var o in this._rootConfig=JSON.parse(t.getAttribute("templateConfig")),this._controlsConfig=JSON.parse(t.getAttribute("config")),t.removeAttribute("templateConfig"),t.removeAttribute("config"),this._controlsConfig.functions)if(this._controlsConfig.functions.hasOwnProperty(o)){var e,r='["'+(e=this._controlsConfig.functions[o]).split("/").join('"]["')+'"]',i=new Function("s","val","return arguments.length == 1 ? s"+r+" : (s"+r+" = val);"),s=n._controlsConfig,a=i(s).split("#");switch(a[0]){case"function":n._dReady.push(p.getHandler(a[1]).addCallback(function(t){i(s,t)}));break;case"moduleFunc":var l=a[1].split("/"),c=l.length>1?l.pop():"",f=l.join("/");n._dReady.push(k.require(f).addCallback(function(t){var e=t[0][c];if(!e)C.IoC.resolve("ILogger").error(rk("Шаблон")+" "+n.getName(),rk("В шаблоне указан обработчик, но в модуле")+" "+f+" "+rk("не найдена функция")+" "+c+" "+rk("для этого обработчика"));else e.wsHandlerPath=f+(c?":"+c:""),i(s,e)}));break;case"floatArea":i(s,function(t){var e=this.getTopParent().getContainer();this.setEnabled(false),p.attachInstance("Lib/Control/FloatArea/FloatArea",{opener:this,template:a[1],target:e,side:"right",autHide:true,animationLength:300,offset:{x:0,y:window.scrollY>e.offset().top?window.scrollY:0},handlers:{onAfterClose:function(){this.getOpener().setEnabled(true)}}})});break;case"dialog":i(s,function(){var t=new v,e=_.createContext(t,null,this.getLinkedContext());p.attachInstance("Lib/Control/Dialog/Dialog",{template:a[1],opener:this,context:e,handlers:{onDestroy:function(){t.callback()}}})});break;case"command":var u=function(t){t.setResult(w.sendCommand.apply(w,[this,a[1]].concat(Array.prototype.slice.call(arguments,1))))};u.isCommand=true,i(s,u);break;case"newpage":case"page":i(s,function(){var t="function"===typeof this.getOpenLink?this.getOpenLink()||a[1]:a[1];if("page"==a[0])window.location=t;else window.open(t)});break;case"menu":i(s,function(){if(b.instanceOfModule(this,"Deprecated/Controls/Button/Button"))this._options.menuName=a[1],this.unsubscribe("onActivated",arguments.callee),this._initMenu(),this._notify("onActivated")})}}for(var o in this._rootConfig)if(this._rootConfig.hasOwnProperty(o)){var e=this._rootConfig[o];if("on"==o.substr(0,2)){var d;e.split("|").forEach(function(t,e){n._dReady.push(p.getHandler(t).addCallback(function(t){return n._loadedHandlers[o]=n._loadedHandlers[o]||[],n._loadedHandlers[o][e]=t}))})}}if(this._rootConfig.style){var h=N(this._rootConfig.style,true,this.getName());if(h)this._dReady.push(h)}var g=A(this._dom.firstChild.childNodes,function(t){return"I"==t.nodeName});if(g.length>0){var m=g[0].getAttribute("spec");if(m){try{m=JSON.parse(m)}catch(t){m=false}if(m)m.js&&n._dReady.push(p.attachSequentally(m.js)),m.css&&n._dReady.push(p.attachSequentally(m.css))}}this._dReady.done()},_getIncludeDescriptorNodes:function(){return A(this._dom.firstChild.childNodes,function(t){return"I"==t.nodeName})},_collectAllControlsToPreload:function(t){return o(t,function(t,e){if(e.children&&e.children.length)t=t.concat(this._collectAllControlsToPreload(e.children));return t.push(e),t},[],this)},isPage:function(){return!this._rootConfig.isApplication},getConfig:function(){for(var t in this._rootConfig)if(this._rootConfig.hasOwnProperty(t))this._mergeAttrToConfig(this._configuration,t,this._rootConfig[t]);return this._configuration},getStyle:function(){return this._rootConfig.windowStyle||""},getAlignment:function(){var t=this._rootConfig.HorizontalAlignment,e=this._rootConfig.VerticalAlignment;return{horizontalAlignment:!t?"Stretch":t,verticalAlignment:!e?"Stretch":e}},getTitle:function(){return this._rootConfig.title},createMarkup:function(t){t.html(this._dom.firstChild.innerHTML)},getDimensions:function(){var t=this._rootConfig.width+"",e=this._rootConfig.height+"";return{width:!t?"":"auto"===t.toLowerCase()?"auto":t.indexOf("%")>=0?t:parseInt(t,10)+"px",height:!e?"":"auto"===e.toLowerCase()?"auto":e.indexOf("%")>=0?e:parseInt(e,10)+"px"}},getControls:function(t){if(t)return[];return this._controlsConfig.children},needSetZindexByOrder:function(){return true}})});