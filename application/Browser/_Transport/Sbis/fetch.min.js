define("Browser/_Transport/Sbis/fetch",["require","exports","tslib","Browser/_Transport/fetch/fetch","Browser/_Transport/fetch/Errors","Env/Constants","Core/UserInfo","Env/Event","Browser/_Transport/_utils","Browser/_Transport/fetch/responseParser"],function(r,e,o,i,t,n,s,a,u,c){"use strict";Object.defineProperty(e,"__esModule",{value:true}),e.RESPONSE_TYPE=c.RESPONSE_TYPE;var f={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01"},h={method:"GET"},l="X-LastModification",p={},d=function(r){var e=o.__assign({},h,r),t=o.__assign({},f,r.headers);for(var n in t)if(t.hasOwnProperty(n)&&!t[n])delete t[n];if(p[e.url])t[l]=p[e.url];return e.headers=t,e},E=function(r){if(n.constants.checkSessionCookie&&!s.isValid())return Promise.reject(new t.Auth(r));return Promise.resolve()},_=function(r){if(r instanceof t.Auth)a.Bus.channel("errors").notify("onAuthError");throw r},T=function(r){return p[r.url]=r.headers.get(l),r},P=function(r,e){if(void 0===e)e=c.RESPONSE_TYPE.TEXT;var t=d(r),n,o,s=E(t.url).then(function(){if(n=i.default(t),o)n.abort();return n}).then(T,_).then(function(r){return c.parse(r,e)});return u.getAbortedPromise(s,{abort:function(){n&&n.abort(),o=true}})};e.fetch=P,e.default=P});