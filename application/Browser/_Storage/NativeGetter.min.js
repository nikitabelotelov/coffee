define("Browser/_Storage/NativeGetter",["require","exports","Env/Event","Browser/_Storage/LocalNative","Browser/_Storage/utils","Env/Env","Browser/_Storage/utils/item"],function(e,t,r,n,f,i,s){"use strict";var l=function(){return this||(0,eval)("this")}(),d="__storage",c=function(){return r.Bus.channel("local_storage")},a="ws-store-always-keys",o="ws-local-keys",u=f.prefix.add("ie-fix-event",d),g=[];function v(e){return e.length>=2143}var m=/\$ie-fix\{(\d+)\}/i,h=Math.random().toString().substr(2),p=function(e){return"$ie-fix{"+h+"}"+e},I=function(e){return e&&e.replace(m,"")||e},w;function y(e){if(!(e=e||l.event))return;var t=e.key,r=e.newValue,n=e.oldValue;if(r==n)return e.stopPropagation(),void e.stopImmediatePropagation();var i=Date.now(),a,o;if(w&&w.key===t&&w.newValue===r&&w.oldValue===n&&i-w.date<=2*1e3)return;if(w={key:t,newValue:r,oldValue:n,date:i},r){var u=r.match(m);if(u)r=r.replace(u[0],""),a=u[1],o=true,e.stopPropagation(),e.stopImmediatePropagation()}if(a===h)return;if(f.prefix.startsWith(t,d))return E(t,r,n);if(v(r))g.push({key:t,length:r.length});if(o)c().notify("onChange",t,s.deserialize(r))}function E(e,t,r){var n=f.prefix.remove(e,d),i=t;if(n===u)setTimeout(function(){var t=k.getItem(i),r=g.filter(function(e){return e.key===i&&e.length===t.length});if(!r)c().notify("onChange",i,s.deserialize(t));g=g.filter(function(e){return e!==r})},10)}var k={getItem:function(e){return I(n.default.getItem(e))},setItem:function(e,t){if(e===a||e===o)return n.default.setItem(e,t);t=p(t);var r=n.default.setItem(e,t);if(r&&v(t))n.default.setItem(u,e),n.default.removeItem(u);return r}};return["getLength","getKeys","removeItem","clear"].forEach(function(e){k[e]=n.default[e].bind(k)}),function(){if(i.detection.isIE&&l.addEventListener)return l.addEventListener("storage",y,false),k;return n.default}});