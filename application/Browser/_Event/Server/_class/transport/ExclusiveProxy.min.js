define("Browser/_Event/Server/_class/transport/ExclusiveProxy",["require","exports","Core/Deferred","Browser/Storage","Browser/_Event/Server/_class/Constants","Browser/_Event/Server/_class/DeviceEnv","Browser/_Event/Server/_class/transport/TransportChooser","Browser/_Event/Server/_class/Subscribe","Browser/_Event/Server/DebugUtils"],function(e,t,c,a,r,u,b,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(){this.message="Need subscribe connect to subscribe",this.name="SubscribeExclusiveError"}return e}(),o=function(){function i(e,t,r){this.transport=e,this.isExclusive=t,this.options=r}return i.init=function(t,r,s){if(void 0===t)t=false;var n=new c,o;return u.DeviceEnv.getOptions().addCallback(function(e){return o=e,new b.TransportChooser(e,r,t,s).choose()}).addCallback(function(e){try{if(l.attachDebugFn(),s.logConnect({connectOptions:o,transport:e.constructor.getLocalName()}),window&&"true"===a.LocalStorageNative.getItem("shared-bus-debug"))window["sharedBusWatch"]()}catch(e){}n.callback(new i(e,t,o))}).addErrback(function(e){return n.errback(e),e}),n},i.prototype.subscribe=function(e){if(e.getDeliveryType()!==r.DELIVERY_COMMON&&!this.isExclusive)throw new n;if(e instanceof s.RawChanneledSubscribe)return void this.transport.subscribe(s.Subscribe.create(e.getChannelName(),e.isChanneled(),this.isExclusive,this.options.getUid(e.getScope())));this.transport.subscribe(e)},i.prototype.unsubscribe=function(e){if(e instanceof s.RawChanneledSubscribe)return void this.transport.unsubscribe(s.Subscribe.create(e.getChannelName(),e.isChanneled(),this.isExclusive,this.options.getUid(e.getScope())));this.transport.unsubscribe(e)},i.prototype.setDelivery=function(e){this.transport.setDelivery(e)},i.prototype.close=function(){this.transport.close(),this.transport=void 0},i.prototype.setWatchDog=function(e){this.transport.setWatchDog(e)},i}();t.ExclusiveProxy=o});