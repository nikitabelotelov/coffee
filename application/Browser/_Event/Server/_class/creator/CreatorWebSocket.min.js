define("Browser/_Event/Server/_class/creator/CreatorWebSocket",["require","exports","Env/Env","Core/UserInfo","Browser/Storage","Browser/_Event/Server/_class/creator/TransportConnect","Browser/_Event/Server/_class/transport/Constants"],function(s,r,t,n,o,a,c){"use strict";Object.defineProperty(r,"__esModule",{value:true});var e=function(){function r(r,t){if(void 0===t)t=new a.TransportConnect;this.connectOptions=r,this.transportConnect=t,this.ls=new o.LocalStorage("SEB");var e=n.get("ЛогинПользователя")||"";this.isGuestAccess=e.indexOf("__сбис__гость__")>-1}return r.prototype.isAvailableInEnv=function(r){if(r)return false;return!this.connectOptions.isDesktop()&&!t.detection.isMobileIOS},r.prototype.build=function(t){var e=this;return this.chooseTransportConstructor().then(function(r){return e.createTransport(r,t)})},r.prototype.createTransport=function(t,e){var n=this;if("LocalSlaveTransport"===t.getLocalName())return Promise.resolve(new t);return this.transportConnect.connect(this.connectOptions,true).then(function(r){return new t(r,e,!n.isGuestAccess,n.connectOptions.exchange)})},r.prototype.chooseTransportConstructor=function(){var n=this,o=this.ls.getItem(c.KEY_ACTUAL_DATE);return new Promise(function(t,e){if(!o)return t(n.loadMainTransport());var r=new Date(o+2*c.CHECK_MIN_INTERVAL);if(r<new Date||isNaN(r.valueOf()))return t(n.loadMainTransport());s(["Browser/_Event/Server/_class/transport/LocalSlaveTransport"],function(r){if(!r.LocalSlaveTransport)return e(new Error("Browser/_Event/Server/_class/transport/LocalSlaveTransport not found"));t(r.LocalSlaveTransport)})})},r.prototype.loadMainTransport=function(){return new Promise(function(t,e){s(["Browser/_Event/Server/_class/transport/LocalMainTransport"],function(r){if(!r.LocalMainTransport)return e(new Error("Browser/_Event/Server/_class/transport/LocalMainTransport not found"));t(r.LocalMainTransport)})})},r}();r.CreatorWebSocket=e});