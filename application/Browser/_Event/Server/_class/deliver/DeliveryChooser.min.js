define("Browser/_Event/Server/_class/deliver/DeliveryChooser",["require","exports","Core/Deferred","Env/Env","Browser/_Event/Server/_class/Notifier","Browser/_Event/Server/_class/deliver/Browser","Browser/_Event/Server/_class/deliver/Page"],function(t,e,o,i,r,s,c){"use strict";Object.defineProperty(e,"__esModule",{value:true});var d=new r.Notifier,n=function(){function e(e){this.watcher=e,d.setWatcher(e)}return e.prototype.choose=function(e){if("WorkerTransport"===e.getLocalName()||i.detection.isMobileIOS)return o.success(new c.Page(d));var r=c.Page,n;if("LocalPageTransport"!==e.getLocalName())r=s.Browser;if(i.detection.isMobileAndroid&&"undefined"!==typeof Promise&&"undefined"!==typeof indexedDB&&null!==indexedDB)return this.tryLazyIndexedDb().addErrback(function(){return new r(d)});return o.success(new r(d))},e.prototype.tryLazyIndexedDb=function(){var r=new o,n;return t(["Browser/_Event/Server/_class/deliver/IndexedDB"],function(e){if(!e)return r.errback();try{n=setTimeout(function(){r.errback("Timeout crete indexedDB")},3e3),r.dependOn(e.IndexedDB.create(d))}catch(e){r.errback(e)}}),r.addCallback(function(e){return clearTimeout(n),e}),r},e}();e.DeliveryChooser=n});