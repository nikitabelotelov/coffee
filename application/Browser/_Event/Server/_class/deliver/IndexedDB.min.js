define("Browser/_Event/Server/_class/deliver/IndexedDB",["require","exports","Browser/_Event/Server/native/_IndexedDB"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=5e3,r=function(){function r(e,t){this.notifier=e,this.connect=t,this.lastReaded=Date.now()-r.INIT_TIMEOUT,this.tick=this.tick.bind(this),this.timer=setInterval(this.tick,i),this.reader=this.connect.createReader()}return r.prototype.deliver=function(e,t,r){if(!this.writer)this.writer=this.connect.createWriter();this.writer.write(e,t,r)},r.prototype.tick=function(){var c=this,e=this.lastReaded;this.lastReaded=Date.now(),this.reader.query(e).then(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=n.channelName,o=n.eventName,s=n.body;c.notifier.fire(i,o,s)}})},r.prototype.destroy=function(){if(this.destroy=function(){},this.connect=null,clearInterval(this.timer),this.writer)this.writer.destructor()},r.create=function(t){return n.Connector.connect(n.Connector.DB_DELIVER,n.Connector.EVENTS_STORE_NAME,new n.AdapterEvent(2)).addCallback(function(e){return new r(t,e)})},r.INIT_TIMEOUT=4e3,r}();t.IndexedDB=r});