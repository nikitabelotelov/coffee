define("Browser/_Event/Server/native/_IndexedDB/Writer",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});var r=function(){function a(t,e,r){this.db=t,this.storeName=e,this.adapter=r,this.garbageCollection=this.garbageCollection.bind(this),this.gc_work=setInterval(this.garbageCollection,a.GC_INTERVAL)}return a.prototype.write=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.adapter.prepare.apply(this.adapter,t.slice());try{this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).add(r)}catch(t){return false}return true},a.prototype.createStore=function(){try{this.db.deleteObjectStore(this.storeName)}catch(t){}try{this.db.createObjectStore(this.storeName,{keyPath:this.adapter.getKeyPath(),autoIncrement:false})}catch(t){return false}return true},a.prototype.garbageCollection=function(){var t=this;try{var e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName),r=e.count();r.onsuccess=function(){if(!t.adapter)return;if(r.result<=t.adapter.getGCLimit())return;e.delete(t.adapter.getGCKeyBound())},r.onerror=function(){}}catch(t){return false}return true},a.prototype.destructor=function(){clearInterval(this.gc_work),this.write=function(){return false},this.createStore=function(){return false},this.db=void 0,this.adapter=void 0},a.GC_INTERVAL=1e4,a.GC_EVENT_LIMIT=5*60*1e3,a}();e.Writer=r});