define("Browser/_Event/Server/resources/stomp",[],function(){function t(){var w,r,v,c,s={}.hasOwnProperty,a=[].slice;if(w={LF:"\n",NULL:"\0"},v=function(){var o;function y(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}return y.prototype.toString=function(){var t,e,n,i,r;if(t=[this.command],n=false===this.headers["content-length"]?true:false)delete this.headers["content-length"];for(e in r=this.headers){if(!s.call(r,e))continue;i=r[e],t.push(e+":"+i)}if(this.body&&!n)t.push("content-length:"+y.sizeOfUTF8(this.body));return t.push(w.LF+this.body),t.join(w.LF)},y.sizeOfUTF8=function(t){if(t)return encodeURI(t).match(/%..|./g).length;else return 0},o=function(t){var e,n,i,r,s,o,a,u,c,f,h,l,p,d,b,g,v;function m(t){if("string"===typeof t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t.charAt(n);if("\\"==r){var s=t.charAt(n+1);switch(s){case"c":e.push(":");break;case"n":e.push("\n");break;case"r":e.push("\r");break;case"\\":e.push("\\");break;default:e.push(r,s)}n++}else e.push(r)}return e.join("")}return t}for(r=t.search(RegExp(""+w.LF+w.LF)),i=(s=t.substring(0,r).split(w.LF)).shift(),o={},l=function(t){return t.replace(/^\s+|\s+$/g,"")},p=0,b=(g=s.reverse()).length;p<b;p++)u=(f=g[p]).indexOf(":"),o[l(f.substring(0,u))]=m(l(f.substring(u+1)));if(e="",h=r+2,o["content-length"])c=parseInt(o["content-length"]),e=(""+t).substring(h,h+c);else for(n=null,a=d=h,v=t.length;h<=v?d<v:d>v;a=h<=v?++d:--d){if((n=t.charAt(a))===w.NULL)break;e+=n}return new y(i,o,e)},y.unmarshall=function(t){var r,s,e,n;if(s=t.split(RegExp(""+w.NULL+w.LF+"*")),(n={frames:[],partial:""}).frames=function(){var t,e,n,i;for(i=[],t=0,e=(n=s.slice(0,-1)).length;t<e;t++)r=n[t],i.push(o(r));return i}(),(e=s.slice(-1)[0])===w.LF||-1!==e.search(RegExp(""+w.NULL+w.LF+"*$")))n.frames.push(o(e));else n.partial=e;return n},y.marshall=function(t,e,n){var i;return(i=new y(t,e,n)).toString()+w.NULL},y}(),r=function(){var g;function t(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=false,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16*1024,this.subscriptions={},this.partialData=""}return t.prototype.debug=function(t){var e;return"undefined"!==typeof window&&null!==window?null!=(e=window.console)?e.log(t):void 0:void 0},g=function(){if(Date.now)return Date.now();else return(new Date).valueOf},t.prototype._transmit=function(t,e,n){var i;if(i=v.marshall(t,e,n),"function"===typeof this.debug)this.debug(">>> "+i);while(true)if(i.length>this.maxWebSocketFrameSize){if(this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"===typeof this.debug)this.debug("remaining = "+i.length)}else return this.ws.send(i)},t.prototype._setupHeartbeat=function(r){var t,e,n,s,i,o,a,u;if((i=r.version)!==c.VERSIONS.V1_1&&i!==c.VERSIONS.V1_2)return;if(e=(o=function(){var t,e,n,i;for(i=[],t=0,e=(n=r["heart-beat"].split(",")).length;t<e;t++)s=n[t],i.push(parseInt(s));return i}())[0],t=o[1],!(0===this.heartbeat.outgoing||0===t)){if(n=Math.max(this.heartbeat.outgoing,t),"function"===typeof this.debug)this.debug("send PING every "+n+"ms");this.pinger=c.setInterval(n,(a=this,function(){try{return a.ws.send(w.LF),"function"===typeof a.debug?a.debug(">>> PING"):void 0}catch(t){a.debug("WARNING: can't send heartbeat. Reason: "+t.message)}}))}if(!(0===this.heartbeat.incoming||0===e)){if(n=Math.max(this.heartbeat.incoming,e),"function"===typeof this.debug)this.debug("check PONG every "+n+"ms");return this.ponger=c.setInterval(n,(u=this,function(){var t;if((t=g()-u.serverActivity)>2*n){if("function"===typeof u.debug)u.debug("did not receive server activity for the last "+t+"ms");return u.ws.close()}}))}},t.prototype._parseConnect=function(){var t,e,n,i;switch(i={},(t=1<=arguments.length?a.call(arguments,0):[]).length){case 2:i=t[0],e=t[1];break;case 3:if(t[1]instanceof Function)i=t[0],e=t[1],n=t[2];else i.login=t[0],i.passcode=t[1],e=t[2];break;case 4:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3];break;default:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3],i.host=t[4]}return[i,e,n]},t.prototype.connect=function(){var t,d,e,n,b;if(t=1<=arguments.length?a.call(arguments,0):[],n=this._parseConnect.apply(this,t),e=n[0],this.connectCallback=n[1],d=n[2],"function"===typeof this.debug)this.debug("Opening Web Socket...");this.ws.onmessage=(b=this,function(t){var i,r,e,n,s,o,a,u,c,f,h,l,p;if(n="undefined"!==typeof ArrayBuffer&&t.data instanceof ArrayBuffer?(i=new Uint8Array(t.data),"function"===typeof b.debug&&b.debug("--- got data length: "+i.length),function(){var t,e,n;for(n=[],t=0,e=i.length;t<e;t++)r=i[t],n.push(String.fromCharCode(r));return n}().join("")):t.data,b.serverActivity=g(),n===w.LF){if("function"===typeof b.debug)b.debug("<<< PONG");return}if("function"===typeof b.debug)b.debug("<<< "+n);for(c=v.unmarshall(b.partialData+n),b.partialData=c.partial,p=[],f=0,h=(l=c.frames).length;f<h;f++)switch((s=l[f]).command){case"CONNECTED":if("function"===typeof b.debug)b.debug("connected to server "+s.headers.server);b.connected=true,b._setupHeartbeat(s.headers),p.push("function"===typeof b.connectCallback?b.connectCallback(s):void 0);break;case"MESSAGE":if(u=s.headers.subscription,a=b.subscriptions[u]||b.onreceive)e=b,o=s.headers["message-id"],s.ack=function(t){if(null==t)t={};return e.ack(o,u,t)},s.nack=function(t){if(null==t)t={};return e.nack(o,u,t)},p.push(a(s));else p.push("function"===typeof b.debug?b.debug("Unhandled received MESSAGE: "+s):void 0);break;case"RECEIPT":p.push("function"===typeof b.onreceipt?b.onreceipt(s):void 0);break;case"ERROR":p.push("function"===typeof d?d(s):void 0);break;default:p.push("function"===typeof b.debug?b.debug("Unhandled frame: "+s):void 0)}return p});var i=(r=this,function(){var t;if(t="Whoops! Lost connection to "+r.ws.url,"function"===typeof r.debug)r.debug(t);return r._cleanUp(),"function"===typeof d?d(t):void 0}),r,s=(o=this,function(){if("function"===typeof o.debug)o.debug("Web Socket Opened...");return e["accept-version"]=c.VERSIONS.supportedVersions(),e["heart-beat"]=[o.heartbeat.outgoing,o.heartbeat.incoming].join(","),o._transmit("CONNECT",e)}),o;if(this.ws.readyState>=this.ws.OPEN)s();else this.ws.onopen=s;if(this.ws.readyState>=this.ws.CLOSING)i();else this.ws.onclose=i},t.prototype.disconnect=function(t,e){if(null==e)e={};try{this._transmit("DISCONNECT",e)}catch(t){}return this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"===typeof t?t():void 0},t.prototype._cleanUp=function(){if(this.connected=false,this.pinger)c.clearInterval(this.pinger);if(this.ponger)return c.clearInterval(this.ponger)},t.prototype.send=function(t,e,n){if(null==e)e={};if(null==n)n="";return e.destination=t,this._transmit("SEND",e,n)},t.prototype.subscribe=function(t,e,n){var i;if(null==n)n={};if(!n.id)n.id="sub-"+this.counter++;return n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),i=this,{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}},t.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},t.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},t.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},t.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},t.prototype.ack=function(t,e,n){if(null==n)n={};return n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},t.prototype.nack=function(t,e,n){if(null==n)n={};return n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},t}(),c={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){var n,i;if(null==e)e=["v10.stomp","v11.stomp"];return i=new(n=c.WebSocketClass||WebSocket)(t,e),new r(i)},over:function(t){return new r(t)},Frame:v},"undefined"!==typeof exports&&null!==exports)exports.Stomp=c;if("undefined"!==typeof window&&null!==window)c.setInterval=function(t,e){return window.setInterval(e,t)},c.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=c;else if("undefined"!==typeof self&&null!==self)self.Stomp=c;return c}return t.call(this)});