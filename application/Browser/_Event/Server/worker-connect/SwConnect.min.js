define("Browser/_Event/Server/worker-connect/SwConnect",["require","exports","Browser/_Event/Server/worker-connect/Constants","Browser/_Event/Server/worker-connect/messages/Page"],function(e,n,o,u){"use strict";var t;return function(e){var t=function(){function e(e){this._onmessage=function(){},this._onready=function(){},this._ondisconnect=function(){},this._onwebsocketclose=function(){},this._connect=e,this._connect.port1.onmessage=this.messageHandler.bind(this)}return e.prototype.subscribe=function(e){this._connect.port1.postMessage(new u.PmSubscribe(e))},e.prototype.subscribeChanneled=function(e,n){this._connect.port1.postMessage(new u.PmSubChanneled(e,n))},e.prototype.unsubscribeChanneled=function(e,n){this._connect.port1.postMessage(new u.PmUnsubChanneled(e,n))},Object.defineProperty(e.prototype,"onmessage",{set:function(e){if(!(e instanceof Function))return void(this._onmessage=function(){});this._onmessage=e},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,"onready",{set:function(e){if(!(e instanceof Function))return void(this._onready=function(){});this._onready=e},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,"ondisconnect",{set:function(e){if(!(e instanceof Function))return void(this._ondisconnect=function(){});this._ondisconnect=e},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,"onwebsocketclose",{set:function(e){if(!(e instanceof Function))return void(this._onwebsocketclose=function(){});this._onwebsocketclose=e},enumerable:true,configurable:true}),Object.defineProperty(e.prototype,"connect",{get:function(){return this._connect},enumerable:true,configurable:true}),e.prototype.messageHandler=function(e){if(!(e&&e.data&&e.data.type))return;if(e.data.type==o.SW_MESSAGES.WEBSOCKET_CLOSE)return this._onwebsocketclose();if(!(e&&e.data&&e.data.headers&&e.data.headers["event-type"]))return;var n=e.data.headers["event-type"].toLocaleLowerCase();if(e.data.type==o.SW_MESSAGES.CLOSE)return this._ondisconnect(n);if(e.data.type==o.SW_MESSAGES.READY)return this._onready(n);if(e.data.type!=o.SW_MESSAGES.MESSAGE)return;this._onmessage(e.data.message)},e.prototype.closePort=function(){this._connect.port1.postMessage(new u.PmDisconnect),this._connect.port1.close()},e.prototype.destructor=function(){this.closePort(),this._connect=void 0},e}();e.Connect=t;var n=function(){function e(e){this.channel=e}return e.prototype.connect=function(e,n,r,s,c,i){var a=this;return new Promise(function(t,o){a.channel.port1.onmessage=function(e){var n=e.data;if("error"==n.type)return o(e.data.message);if(a.channel.port1.onmessage=void 0,"connect"==n.type)t(a.channel)},a.channel.port1.postMessage(new u.PmConnect(e,n,r,s,c,i))}).then(function(e){return new t(e)})},e}();e.Connector=n}(t||(t={})),t});