define("tmpl!Browser/_Event/Server/StompTest/StompTest",["View/Executor/TClosure"],function(){var e=Array.prototype.slice.call(arguments),T=e[0],v={},t=function e(t,n,r,o,s){function i(){debugger}var a="undefined"===typeof T||!T?arguments[arguments.length-1]:T;if("undefined"===typeof a||!a._isTClosure)eval("var thelpers = null;"),a=function(){return this||(0,eval)("this")}().requirejs("View/Executor/TClosure");var d="undefined"===typeof v?void 0:v;if("undefined"===typeof includedTemplates)eval("var includedTemplates = undefined;"),includedTemplates=this&&this.includedTemplates?this.includedTemplates:{};var c=0,u=0,l=n&&n.key||"_",p={id:[],def:void 0},w=a.configResolver.calcParent(this,"undefined"===typeof currentPropertyName?void 0:currentPropertyName,t),m=a.getMarkupGenerator(o);if("undefined"===typeof includedTemplates)eval("var includedTemplates = undefined;"),includedTemplates=this&&this.includedTemplates?this.includedTemplates:{};try{var f=m.joinElements([m.createDirective('!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"'),m.createTag("html",{attributes:{lang:"ru","xml:lang":"ru",xmlns:"http://www.w3.org/1999/xhtml",class:"ws-bootup-autofocus"},events:"undefined"===typeof window?{}:{},key:l+"0_"},[m.createTag("head",{attributes:{xmlns:"http://www.w3.org/1999/xhtml"},events:"undefined"===typeof window?{}:{},key:l+"0_0_"},[m.createText(' %{INCLUDE "/Tema_Skrepka/Шаблоны/includes/common-meta.html"} ',l+"0_0_0_"),m.createTag("title",{attributes:{xmlns:"http://www.w3.org/1999/xhtml"},events:"undefined"===typeof window?{}:{},key:l+"0_0_1_"},[m.createText(""+a.rk("Тестовая страница STOMP"),l+"0_0_1_0_")],n?{context:n.context,key:l+"0_0_1_"}:{},p,w),m.createTag("script",{attributes:{type:"text/javascript",xmlns:"http://www.w3.org/1999/xhtml"},events:"undefined"===typeof window?{}:{},key:l+"undefined"},[m.createText(" // new config support window.wsConfig = { appRoot: '"+a.wrapUndef(m.escape(a.getter(t,["appRoot"])))+"', wsRoot: '"+a.wrapUndef(m.escape(a.getter(t,["wsRoot"])))+"', resourceRoot: '"+a.wrapUndef(m.escape(a.getter(t,["resourceRoot"])))+"', defaultServiceUrl: '"+a.wrapUndef(m.escape(a.getter(t,["servicesPath"])||""))+"' || '/service/', fasttemplate: true }; ",l+"NaN_")],n?{context:n.context,key:l+"undefined"}:{},p,w),m.createText(' %{INCLUDE "/Tema_Skrepka/Шаблоны/includes/ws.html"} ',l+"0_0_2_"),m.createTag("script",{attributes:{type:"text/javascript",xmlns:"http://www.w3.org/1999/xhtml"},events:"undefined"===typeof window?{}:{},key:l+"undefined"},[m.createText(" var TIME_LIMIT = 15000; var _Test = { 'times': { 'start': Date.now(), 'coreReady': 0, 'busReady': 0, 'channelReady': 0, 'msgSent': 0, 'msgReceived': 0, 'callDone': 0 }, 'msgID': Math.random() * 1e6 | 0 }; requirejs([\"Core/core-init\"], function(coreInit){ coreInit.addCallback(function() { _Test.times.coreReady = Date.now(); requirejs(['Lib/ServerEvent/Bus'], function(ServerEventBus) { _Test.times.busReady = Date.now(); ServerEventBus.serverChannel('system.echo', {exclusive: true}) .subscribe('onReady', function onReady() { _Test.times.channelReady = Date.now(); onEverythingReady(); }) .subscribe('onMessage', onMessage); }); }); }); function onMessage(event, data) { if (typeof data === 'object' && data.id === _Test.msgID) { _Test.times.msgReceived = Date.now(); done(); } } function onEverythingReady() { _Test.times.msgSent = Date.now(); var payload = { 'ts': _Test.times.msgSent, 'id': _Test.msgID }; requirejs(['Types/source'], function (source) { var SbisService = source.SbisService; var source = new SbisService({endpoint: 'Test'}); source.call('PushEcho', {'payload': payload}) .addCallbacks( function onDone() { _Test.times.callDone = Date.now(); }, function onError() { _Test.times.callDone = -1; } ); }); setTimeout(done, TIME_LIMIT); } function done() { if (window.opener && window.opener._Test) { window.opener._Test.res = _Test.times; window.close(); } } ",l+"NaN_")],n?{context:n.context,key:l+"undefined"}:{},p,w)],n?{context:n.context,key:l+"0_0_"}:{},p,w),m.createTag("body",{attributes:{xmlns:"http://www.w3.org/1999/xhtml"},events:"undefined"===typeof window?{}:{},key:l+"0_1_"},[],n?{context:n.context,key:l+"0_1_"}:{},p,w)],n,p,w)],l,p);if(p.def)f=m.chain(f,p,n),p=void 0}catch(e){a.templateError("resources/Browser/_Event/Server/StompTest/StompTest.tmpl",e,t)}return f||m.createText("")};return t.includedFunctions={},t.stable=true,t.toJSON=function(){return{$serialized$:"func",module:"tmpl!Browser/_Event/Server/StompTest/StompTest"}},t});