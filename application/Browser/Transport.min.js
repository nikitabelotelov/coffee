define("Browser/Transport",["Core/helpers/createGUID","Core/helpers/i18n/transliterate","Core/base64","Core/core-classicExtend","Core/i18n","tslib","Env/Event","Core/UserInfo","Core/Deferred","Env/Env","Env/Constants","Core/core-extend","require","exports"],function(n,o,s,a,i,u,c,f,l,d,p,h,v,e){Object.defineProperty(e,"__esModule",{value:true}),e["Browser/_Transport/URL/serializeData"]=true;var _=function(){"use strict";var e={},r=function(e,r,n){function t(t){if(t instanceof Object&&Object.getPrototypeOf(t)===Object.prototype)t=Object.keys(t).sort().reduce(function(e,r){return e[r]=t[r],e},{});var e=JSON.stringify(void 0===t?"":t);if(-1!==e.indexOf("\\u"))e=unescape(e.replace(/\\u/g,"%u"));return n.encode(e)}Object.defineProperty(r,"__esModule",{value:true}),r.default=t}(v,e,s);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/_utils"]=true;var T=function(){"use strict";var e={},r=(t=v,n=e,Object.defineProperty(n,"__esModule",{value:true}),n.getAbortedPromise=function(e,r){return Object.assign(e,{abort:function(){if(r)r.abort()}})},void(n.delay=function(r){return new Promise(function(e){setTimeout(e,r||0)})})),t,n;if(r instanceof Function)return r;else for(var o in r)if(r.hasOwnProperty(o))e[o]=r[o];return e}();e["Browser/_Transport/RPC/fallback"]=true;var y=function(){"use strict";var e={},r=function(r,e,t){Object.defineProperty(e,"__esModule",{value:true});var u="system.bl_async_replies",c=function(n){return function(e,r){if(!r)return;var t;if("string"===typeof r)t=JSON.parse(r);if(t&&t.guid===n.guid)clearTimeout(n.timeout),n.deferred.callback(t.data)}},n=function(e){var n=e.data,o=e.headers,s=e.transport,a=e.timeout,i=new t;return r(["Env/ServerEvent/Bus"],function(e){var t=function(){return e.serverChannel(u)};t().once("onReady",function(){var e={deferred:i,guid:o["X-UNIQ-ID"]},r=c(e);e.timeout=setTimeout(function(){t().unsubscribe("onMessage",r),i.errback("Timeout")},a),t().subscribe("onMessage",r),s.execute(n,o)})},function(e){i.errback(e)}),i};e.default=n}(v,e,l);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/ajax-emulator"]=true;var m=function(){"use strict";var e={},r=function(e,r){function p(e,r,t){var n,o,s,a,i=e.contents,u=e.dataTypes;while("*"===u[0])if(u.shift(),void 0===n)n=e.mimeType||r.getResponseHeader("Content-Type");if(n)for(o in i)if(i[o]&&i[o].test(n)){u.unshift(o);break}if(u[0]in t)s=u[0];else{for(o in t){if(!u[0]||e.converters[o+" "+u[0]]){s=o;break}if(!a)a=o}s=s||a}if(s){if(s!==u[0])u.unshift(s);return t[s]}}function h(e,r,t,n){var o,s,a,i,u,c={},f=e.dataTypes.slice();if(f[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];s=f.shift();while(s){if(e.responseFields[s])t[e.responseFields[s]]=r;if(u=s,s=f.shift())if("*"===s)s=u;else if("*"!==u&&u!==s){if(!(a=c[u+" "+s]||c["* "+s]))for(o in c)if((i=o.split(" "))[1]===s)if(a=c[u+" "+i[0]]||c["* "+i[0]]){if(true===a)a=c[o];else if(true!==c[o])s=i[0],f.unshift(i[1]);break}if(true!==a)if(a&&e.throws)r=a(r);else try{r=a(r)}catch(e){return{state:"parsererror",error:a?e:new Error("No conversion from "+u+" to "+s)}}}}return{state:"success",data:r}}function s(e){var r=e.headers||{};if(e.data&&e.hasContent&&false!==e.contentType||e.contentType)r["Content-Type"]=e.contentType;if(r["Accept"]=e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+("*"!==e.dataTypes[0]?", "+o+"; q=0.01":""):e.accepts["*"],!e.crossDomain&&!r["X-Requested-With"])r["X-Requested-With"]="XMLHttpRequest";return r}function a(e,r){var t=new XMLHttpRequest,n=s(e);if(t.open(e.type,e.url,e.async),e.mimeType&&t.overrideMimeType)t.overrideMimeType(e.mimeType);for(var o in n)t.setRequestHeader(o,n[o]);return t.onload=function(e){r(c[t.status]||t.status,t.statusText,"string"!==typeof t.responseText?{binary:t.response}:{text:t.responseText},t.getAllResponseHeaders())},t.onabort=function(e){r(t.status,"abort")},t.onerror=function(e){r(t.status,t.statusText)},t}function i(n){var o,r={readyState:0,getResponseHeader:function(e){var r,t=n.getAllResponseHeaders();if(!t)return null;if(!o){o={};while(r=l.exec(t))o[r[1].toLowerCase()]=r[2]}return null==(r=o[e.toLowerCase()])?null:r}};return["setRequestHeader","getAllResponseHeaders","overrideMimeType","abort","send"].forEach(function(e){r[e]=function(){return n[e].apply(n,arguments)}}),r}function t(e){var r;if(!e||"string"!==typeof e)return null;try{r=(new window.DOMParser).parseFromString(e,"text/xml")}catch(e){r=void 0}if(!r||r.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+e);return r}var u="undefined"!==typeof location?location:{href:"",protocol:"https"},n=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,v=/^\/\//,c={0:200},o="*/".concat("*"),f={url:u.href,type:"GET",isLocal:n.test(u.protocol),global:true,processData:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":o,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":JSON.parse,"text xml":t},success:function(){},error:function(){}},_=/^(?:GET|HEAD)$/,T=/\?/,y=/%20/g,m=/#.*$/,E=/[^\x20\t\r\n\f]+/g,w=/([?&])_=[^&]*/,l=/^(.*?):[ \t]*([^\r\n]*)$/gm,g=Date.now();function R(e){return Object.assign({},f,e)}function d(e){var c,r,f,l,t,d=R(e),n,o=document.createElement("a");if(o.href=u.href,d.url=((d.url||loc_locationation.href)+"").replace(v,u.protocol+"//"),d.dataTypes=(d.dataType||"*").toLowerCase().match(E)||[""],null==d.crossDomain){n=document.createElement("a");try{n.href=d.url,n.href=n.href,d.crossDomain=o.protocol+"//"+o.host!==n.protocol+"//"+n.host}catch(e){d.crossDomain=true}}if(d.type=d.type.toUpperCase(),d.hasContent=!_.test(d.type),r=d.url.replace(m,""),!d.hasContent){if(t=d.url.slice(r.length),d.data)r+=(T.test(r)?"&":"?")+d.data,delete d.data;if(false===d.cache)r=r.replace(w,"$1"),t=(T.test(r)?"&":"?")+"_="+g+++t;d.url=r+t}else if(d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded"))d.data=d.data.replace(y,"+");if(c=i(a(d,s)),d.beforeSend&&false===d.beforeSend.call(null,c,d))return c.abort();try{c.send(d.hasContent&&d.data||null)}catch(e){s(-1,e)}function s(e,r,t,n){var o,s,a,i,u=r;if(l=true,f=n||"",o=e>=200&&e<300||304===e,t)i=p(d,c,t);if(i=h(d,i,c,o),o)if(204===e||"HEAD"===d.type)u="nocontent";else if(304===e)u="notmodified";else u=i.state,s=i.data,o=!(a=i.error);else if(a=u,e||!u)if(u="error",e<0)e=0;if(Object.assign(c,{statusText:u,status:e}),o)d.success(s,u,c);else d.error(c,u,a)}return c}return d}(v,e);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}(),r=m;e["Browser/_Transport/ITransport"]=true;var E=function(){"use strict";var e={},r=function(e,r,t){Object.defineProperty(r,"__esModule",{value:true});var n=t({},{execute:function(e,r){throw new Error("Method not implemented")}});r.default=n}(v,e,h);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}(),t=E;e["Browser/_Transport/RPC/Headers"]=true;var w=function(){"use strict";var e={},r=function(e,r,t,i,n,o,s,u){Object.defineProperty(r,"__esModule",{value:true});var c="X-LastModification",f={};t.Bus.channel("Transport").subscribe("onResponseSuccess",function(e,r,t,n){f[n]=r.getResponseHeader(c)||f[n]});var l=function(e,r){switch(e){case"GET":var t={},n=i.getCurrent();if(n){var o=n.split("-"),s=o[0],a=o[1];t["X-SbisSessionsID"]=n,t["X-CID"]=s,t["X-UID"]=a}return t;case"POST":var t={};if(f[r])t[c]=f[r];return t;default:return{}}},d=function(e){if(!e)return{};return{"X-CalledMethod":o(""+e),"X-OriginalMethodName":s.encode(""+e),"Accept-Language":(n.getLang()||"ru-RU")+";q=0.8,en-US;q=0.5,en;q=0.3"}},a=function(){function e(e){var r=e.fallback,t=e.asyncInvoke,n=e.url,o=e.recent,s=e.method,a=e.httpMethod,i=e.headers;if(r)this["X-PublishAsyncResponse"]=true,this["X-UNIQ-ID"]=u();if(t||r)this["X-ASYNCINVOKE"]=true;if(o)this["X-RequireRecent"]=true;Object.assign(this,d(s),l(a,n),i)}return e.getForMethod=d,e}();r.default=a}(v,e,c,f,i,o,s,n);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/URL/getUrl"]=true;var g=function(){"use strict";var e={},r=function(e,r){function t(){var e=process&&process.domain&&process.domain.req;return e?e.originalUrl:location?location.href:""}Object.defineProperty(r,"__esModule",{value:true}),r.default=t}(v,e);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/fetch/Errors"]=true;var R=function(){"use strict";var e={},r=function(e,f,r,t,n){Object.defineProperty(f,"__esModule",{value:true}),f.ERROR_TEXT={get timeout(){return t.rk("Таймаут запроса")},get unknown(){return t.rk("Неизвестная ошибка")},get parsererror(){return t.rk("Ошибка разбора документа")},get abort(){return t.rk("Запрос был прерван")},get lossOfConnection(){return t.rk("Потеряна связь с сайтом")},get 401(){return t.rk("Ошибка авторизации")},get 403(){return t.rk("У вас недостаточно прав для выполнения данного действия")},get 404(){return t.rk("Документ не найден")},get 413(){return t.rk("Превышен допустимый размер загружаемого файла")},get 423(){return t.rk("Действие заблокировано лицензией")},get 500(){return t.rk("Внутренняя ошибка сервера")},get 502(){return t.rk("Сервис находится на техническом обслуживании")},get 503(){return t.rk("Сервис находится на техническом обслуживании")},get 504(){return t.rk("Сервис находится на техническом обслуживании")}},f.DETAILS_TEXT={get default(){return t.rk("Мы знаем об этом и уже исправляем. Попробуйте заглянуть сюда через 15 минут.")},get lossOfConnection(){return t.rk("Проверьте настройки подключения к сети")}};var o=function(){function e(e){var r=e.url,t=e.message,n=e.details,o=e.name;this.name="TransportError",this.processed=false,this.message=t,this.stack=(new Error).stack,this.url=r,this.details=n,this.name=this.name||o}return e.prototype.toString=function(){return this.name+": "+this.message+"; url: "+this.url},e}();n(f.Transport=o,Error);var s=function(c){function e(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=this,o;if("string"==typeof e){var s,a,i,u;o={message:e,httpError:r[0],url:r[1],payload:r[2],details:r[3]}}else o=e;return(n=c.call(this,o)||this).name="HTTP Error",n.payload=o.payload||"",n.status=o.httpError,n.details=n.details||f.DETAILS_TEXT.default,n.xhr=o.xhr,n.httpError="undefined"!==typeof n.status?n.status:"",n}return r.__extends(e,c),e.prototype.toString=function(){return this.name+": "+this.message+"; httpError: "+this.httpError+"; url: "+this.url},e}(o);f.HTTP=s;var a=function(o){function e(e){var r=e.url,t=e.details,n=o.call(this,{url:r,details:t,message:f.ERROR_TEXT.parsererror})||this;return n.name="ParseError",n}return r.__extends(e,o),e}(o);f.Parse=a;var i=function(t){function e(e){var r=t.call(this,{url:e,message:f.ERROR_TEXT.lossOfConnection,details:f.DETAILS_TEXT.lossOfConnection})||this;return r.name="ConnectionError",r._isOfflineMode=true,r}return r.__extends(e,t),e}(o);f.Connection=i;var u=function(t){function e(e){var r=t.call(this,{url:e,message:f.ERROR_TEXT[401]})||this;return r.name="AuthError",r}return r.__extends(e,t),e}(o);f.Auth=u;var c=function(t){function e(e){var r=t.call(this,{url:e,message:f.ERROR_TEXT.abort})||this;return r.canceled=true,r}return r.__extends(e,t),e}(o);f.Abort=c}(v,e,u,i,a);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/URL/getQueryParam"]=true;var O=function(){"use strict";var e={},r=function(e,r){function n(e,r){var t=r.exec(e);return t&&decodeURI(t[1])}function t(e){var r="undefined"!==typeof process&&process.domain&&process.domain.req,t=new RegExp("[?&]"+e+"=([^&]*)");return r&&r.query?r.query[e]:"undefined"!==typeof location?n(location.search,t):""}Object.defineProperty(r,"__esModule",{value:true}),r.default=t}(v,e);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/URL/getHostName"]=true;var P=function(){"use strict";var e={},r=function(e,r){function t(){var e=process&&process.domain&&process.domain.req;return e?e.hostname:location.hostname}Object.defineProperty(r,"__esModule",{value:true}),r.default=t}(v,e);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/fetch/interface"]=true;var b=function(){"use strict";var e={},r=(t=v,n=e,void Object.defineProperty(n,"__esModule",{value:true})),t,n;if(r instanceof Function)return r;else for(var o in r)if(r.hasOwnProperty(o))e[o]=r[o];return e}();e["Browser/_Transport/URL/deserializeData"]=true;var C=function(){"use strict";var e={},r=function(e,r,t){function n(e){return JSON.parse(t.decode(e))}Object.defineProperty(r,"__esModule",{value:true}),r.default=n}(v,e,s);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/URL"]=true;var x=function(){"use strict";var e={},r=(t=v,n=e,o=C,s=_,a=P,i=O,u=g,Object.defineProperty(n,"__esModule",{value:true}),n.deserializeData=o.default,n.serializeData=s.default,n.getHostName=a.default,n.getQueryParam=i.default,void(n.getUrl=u.default)),t,n,o,s,a,i,u;if(r instanceof Function)return r;else for(var c in r)if(r.hasOwnProperty(c))e[c]=r[c];return e}(),S=x;e["Browser/_Transport/fetch/fetch"]=true;var k=function(){"use strict";var e={},r=function(e,r,d,t,p,h){Object.defineProperty(r,"__esModule",{value:true});var v={method:"GET",url:""},_=2e3,n=600,T=false,o=false,s,y=function(e){return o||300==e||405==e},m=function(e){return e>=200&&e<300||304===e},E=function(e){return"AbortError"==e.name},w=function(e,r){var t=true;return r.forEach(function(e,r){t=false}),0===e&&t};(function(){if("undefined"===typeof window)return;if(t.detection.firefox)window.addEventListener("beforeunload",function(){T=true,setTimeout(function(){T=false},n)});else window.addEventListener("unload",function(){T=true});window.addEventListener("online",function(){o=false}),window.addEventListener("offline",function(){o=true})})();var a=function(e){var r=d.__assign({},v,e),s=r.url,t=r.method,n=r.body,o=r.headers,a=r.credentials,i=r.cache,u=r.redirect,c=r.mode,f=new AbortController,l=X(s,{method:t,headers:o,redirect:u,mode:c,body:n,credentials:a,cache:i,signal:f.signal}).then(function(e){var r=e.status,t=e.statusText,n=e.headers;if(m(r))return e;if(401==r)throw new p.Auth(s);if(y(r)||w(r,n))throw new p.Connection(s);var o=p.ERROR_TEXT[r]||p.ERROR_TEXT[t]||p.ERROR_TEXT.unknown;return e.text().then(function(e){throw new p.HTTP({url:s,message:o,payload:e,httpError:r})})},function(e){if(E(e)||T)throw new p.Abort(s);return h.delay(_).then(function(){if(y())throw new p.Connection(s);throw e})});return h.getAbortedPromise(l,f)};r.default=a}(v,e,u,d,R,T);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/RPC/Error"]=true;var M=function(){"use strict";var e={},r=function(e,r,t,n){Object.defineProperty(r,"__esModule",{value:true});var o=function(h){function e(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=this,o;if("string"===typeof e){var s,a,i,u,c,f,l,d,p;o={message:e,httpError:r[0],code:r[1],methodName:r[2],details:r[3],url:r[4],classid:r[5],errType:r[6],addinfo:r[7],error_code:r[8]}}else o=e;return(n=h.call(this,o)||this).name="Transport error",n.code=o.code||0,n.details=o.details||"",n.methodName=o.methodName||"",n.classid=o.classid||"",n.errType=o.errType||"error",n.addinfo=o.addinfo||"",n.error_code=o.error_code,n}return t.__extends(e,h),e.prototype.toString=function(){return this.name+": "+this.message+"; method: "+this.methodName+"; code: "+this.code+"; httpError: "+this.httpError+"; details: "+this.details},e}(n.HTTP);r.default=o}(v,e,u,R);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/fetch/responseParser"]=true;var B=function(){"use strict";var e={},r=function(e,r,o){Object.defineProperty(r,"__esModule",{value:true});var s=function(e){switch(e){case"XML":return"xml";case"JSON":return"json";case"TEXT":return"text";case"BLOB":return"blob";default:return"text"}},a={xml:function(e){return e.text().then(function(e){var r;if(!e)return null;if("undefined"!==typeof DOMParser)try{r=(new DOMParser).parseFromString(e,"text/xml")}catch(e){r=void 0}if(!r||r.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+e);return r})}};r.parse=function(r,e){var t=s(e),n;if(t in r)n=r[t];else n=a[t];return n.call(r,r).catch(function(e){throw new o.Parse({url:r.url,details:e.message})})},r.RESPONSE_TYPE={TEXT:"TEXT",JSON:"JSON",BLOB:"BLOB",XML:"XML"}}(v,e,R);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/RPC/ErrorCreator"]=true;var j=function(){"use strict";var e={},r=(t=v,s=e,n=M,o=p,a=R,Object.defineProperty(s,"__esModule",{value:true}),s.fromRPC=function(e,r,t){return new n.default({httpError:"undefined"!==e.httpError?e.httpError:"",code:e.code,methodName:r,details:e.details,url:t||o.constants.defaultServiceUrl,message:e.message,classid:e.data&&e.data.classid,errType:e.type,addinfo:e.data&&e.data.addinfo,error_code:e.data&&e.data.error_code})},void(s.fromHTTP=function(e,r){if(!(e instanceof a.HTTP))return e;var t={message:e.message,httpError:e.httpError,code:0},n;try{n=JSON.parse(e.payload)}catch(e){n={}}var o=n.error;return Object.assign(t,o),s.fromRPC(t,r,e.url)})),t,s,n,o,a;if(r instanceof Function)return r;else for(var i in r)if(r.hasOwnProperty(i))e[i]=r[i];return e}();e["Browser/_Transport/fetch"]=true;var I=function(){"use strict";var e={},r=(t=v,n=e,o=R,s=k,a=B,i=b,Object.defineProperty(n,"__esModule",{value:true}),n.Errors=o,n.fetch=s.default,n.RESPONSE_TYPE=a.RESPONSE_TYPE,n.responseParser=a.parse,n.AbortPromise=i.AbortPromise,n.FetchConfig=i.FetchConfig,n.FetchTransport=i.FetchTransport,n.HttpMethod=i.HttpMethod,void(n.default=s.default)),t,n,o,s,a,i;if(r instanceof Function)return r;else for(var u in r)if(r.hasOwnProperty(u))e[u]=r[u];return e}(),X=I;e["Browser/_Transport/RPC/Body"]=true;var L=function(){"use strict";var e={},r=(t=v,n=e,o=p,s=x,Object.defineProperty(n,"__esModule",{value:true}),n.getBody=function(e,r,t){return JSON.stringify({jsonrpc:"2.0",protocol:o.constants.JSONRPC_PROOTOCOL_VERSION,method:e,params:r,id:void 0!==t?t:1})},n.getURL=function(e,r,t){return"?protocol="+o.constants.JSONRPC_PROOTOCOL_VERSION+"&method="+encodeURI(e)+"&params="+encodeURIComponent(s.serializeData(r))+"&id="+(void 0!==t?t:1)},void(n.getEmptyResponse=function(){return{error:{message:rk("Получен пустой ответ от сервиса"),code:"",details:""}}})),t,n,o,s;if(r instanceof Function)return r;else for(var a in r)if(r.hasOwnProperty(a))e[a]=r[a];return e}();e["Browser/_Transport/RPC/getInvocationUrl"]=true;var N=function(){"use strict";var e={},r=function(e,r,i,u){Object.defineProperty(r,"__esModule",{value:true});var c=".";function t(e,r,t,n){var n,o=(n=n||{}).id||0,s=n.url||i.constants.defaultServiceUrl,a=e+c+r;return s+"?id="+encodeURIComponent(o)+"&method="+encodeURIComponent(a)+"&protocol="+encodeURIComponent(i.constants.JSONRPC_PROOTOCOL_VERSION)+"&params="+encodeURIComponent(u.serializeData(t||{}))}r.default=t}(v,e,p,x);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/RPC/request"]=true;var H=function(){"use strict";var e={},r=function(e,r,t,a,i){Object.defineProperty(r,"__esModule",{value:true});var u=function(e){t.Bus.channel("errors").notify("onRPCError",e)},n=function(e){var r=e.data,t=e.headers,n=e.transport,o=e.method,s=e.url;return n.execute(r,t).addCallbacks(function(e){var r=e||a.getEmptyResponse();if("error"in r)return i.fromRPC(r.error,o,s);return r.result},function(e){return i.fromHTTP(e,o)}).addErrback(function(e){return u(e),e})};r.default=n}(v,e,c,L,j);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();e["Browser/_Transport/RPC"]=true;var U,F=function(){"use strict";var e={},r=(t=v,n=e,o=L,s=j,a=w,i=M,u=N,Object.defineProperty(n,"__esModule",{value:true}),n.Body=o,n.ErrorCreator=s,n.Headers=a.default,n.Error=i.default,void(n.getInvocationUrl=u.default)),t,n,o,s,a,i,u;if(r instanceof Function)return r;else for(var c in r)if(r.hasOwnProperty(c))e[c]=r[c];return e}();e["Browser/_Transport/XHR"]=true;var A=function(){"use strict";var e={},r=function(e,r,o,t,l,n,s,a,d,i){Object.defineProperty(r,"__esModule",{value:true});var u,p=i.Bus.channel("Transport"),h=i.Bus.channel("errors");function v(r,t){if(u.isOfflineError(r)){var n;try{(n=JSON.parse(t).method.split(".")).push(r)}catch(e){n=[t,r]}return!!u.notifyOfflineError(n)}}var _=false;if("undefined"!==typeof window)if(o.detection.firefox)window.addEventListener("beforeunload",function(){_=true,setTimeout(function(){_=false},600)});else window.addEventListener("unload",function(){_=true});if((u=a.default.extend({$protected:{_options:{method:"GET",dataType:"text",contentType:"application/x-www-form-urlencoded",url:"",async:true},_xhr:void 0},$constructor:function(){if(""===this._options.url)throw new Error("Request with no URL is ambiguous")},execute:function(i,e){var u=new l({cancelCallback:this.abort.bind(this)}),c=this;if(t.constants.checkSessionCookie&&!n.isValid())return u.errback(d.Errors.ERROR_TEXT[401]),h.notify("onAuthError"),u;var f=this._options.url;try{this._xhr=s({type:this._options.method,dataType:this._options.dataType,contentType:this._options.contentType,url:f,headers:e||{},data:i,async:this._options.async,beforeSend:function(e,r){return p.notify("onBeforeSend",e,r)},success:function(e,r,t){if(v(e.error,i))return void u.errback(new d.Errors.Connection(f));var n=l.success(e);return p.notify("onResponseSuccess",t,n,c._options.url),u.dependOn(n),e},error:function(e,r){if(e.responseJSON&&v(e.responseJSON.error,i))return void u.errback(new d.Errors.Connection(f));if("abort"===r)return void u.cancel();var t=e.status,n=d.Errors.ERROR_TEXT[t]||d.Errors.ERROR_TEXT[r]||d.Errors.ERROR_TEXT.unknown||"";if(0===t&&""===e.getAllResponseHeaders()){var o="/"===c._options.url.charAt(0)?window.location.hostname:c._options.url;n=d.Errors.ERROR_TEXT.lossOfConnection+" "+o}var s=new d.Errors.HTTP({message:n,httpError:t,url:c._options.url,payload:e.responseText,xhr:e});if(h.notify("onHTTPError",s),"401"==t)if(true===h.notify("onAuthError"))return;var a=new l;if(p.notify("onResponseError",c._xhr,a),a.addCallback(function(e){u.callback(e)}).addErrback(function(e){u.errback(e)}),_)a.cancel();else a.errback(s)}})}catch(e){u.errback("JavaScript exception while trying to execute request: "+e.message)}return u},setUrl:function(e){if("string"==typeof e)this._options.url=e},abort:function(){if(this._xhr)this._xhr.abort()}})).ERRORS_TEXT=d.Errors.ERROR_TEXT,u.isOfflineError=function(e){var r;return 300==(r=e&&(e.data&&e.data.error_code||e.httpError||e.code))||405==r},u.notifyOfflineError=function(e){var r,t,n;if(r=i.Bus.globalChannel(),t=["onOfflineModeError"].concat(e),n=r.notify.apply(r,t))o.IoC.resolve("ILogger").info("XHRTransport","Работа в offline-режиме");return n},u.getServiceByName=function(e){return t.constants.services[e]||t.constants.defaultServiceUrl},!o.IoC.has("ITransport"))o.IoC.bind("ITransport",u);r.default=u}(v,e,d,p,l,f,m,E,I,c);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}(),D=A;e["Browser/_Transport/RPCJSON"]=true;var q,J=function(){"use strict";var e={},r=function(e,r,t,o,n,i,u,s,a,c){Object.defineProperty(r,"__esModule",{value:true});var f=n.IoC.resolve("ILogger");function l(e,r){r=r?', use "'+r+'"':"",f.log("Browser/_Transport/RPCJSON",'Method "'+e+'" is deprecated and will be removed'+r)}function d(e,r,t){return function(){return l(e,r),t.apply(this,arguments)}}function p(e){if("undefined"===typeof window||!window.cachedMethods||!window.cachedMethods.length)return false;return window.cachedMethods.indexOf(e)>-1}function h(e){return e.length<2*1024}var v=t({},{$protected:{_transports:null,_options:{serviceUrl:"",fallback:false,timeout:6e4,asyncInvoke:false,async:true}},$constructor:function(){this._transports={}},callMethod:function(e,r,t){var n=this.__getRequestParam(e,r,t),o;return this._transports.current=n.transport,(this._options.fallback?a.default:s.default)(n).addErrback(function(e){if(!e.details){var r=e.httpError||0;e.details=r>500?rk("Попробуйте заглянуть сюда через 15 минут"):""}return e})},abort:function(){f.log("Browser/_Transport/RPCJSON",'Метод "abort" обрывает только последний созданный запрос. Если вам необходима эта логика используйде Core/Deferred#cancel'),this._transports.current&&this._transports.current.abort()},__getRequestParam:function(e,r,t){var n="",o=false,s="POST",a;if(p(e))n=i.getURL(e,r);if(n&&h(n))s="GET",(a=this.__getTransport(s)).setUrl(this.__getServiceAddress(n)),o=true;return{method:e,timeout:this._options.timeout,headers:new u.default({method:e,httpMethod:s,fallback:this._options.fallback,asyncInvoke:this._options.asyncInvoke,recent:t}),transport:a||this.__getTransport(),data:o?"":i.getBody(e,r),url:this.__getServiceAddress()}},__getTransport:function(e){if(e=e||"POST",!this._transports[e])this._transports[e]=this.__createTransport(e);return this._transports[e]},__createTransport:function(e){return n.IoC.resolve("ITransport",{url:this.__getServiceAddress(),method:e,dataType:"json",contentType:"application/json; charset=utf-8",async:this._options.async})},__getServiceAddress:function(e){var r=this._options.serviceUrl||o.constants.defaultServiceUrl,t,n=(r+=r.indexOf("?")>-1?"&":"?")+("x_version="+o.constants.buildnumber);if(e)n+=e.replace(/^\?/,"&");return n},_setHeaders:function(e,r,t){l("_setHeaders","Browser/_Transport/RPC/Headers"),Object.assign(e.reqHeaders,new u.default({recent:t,httpMethod:r,fallback:this._options.fallback,asyncInvoke:this._options.asyncInvoke}))},_fallbackResponse:function(e,r,t,n){l("_fallbackResponse")}});v.jsonRpcPreparePacket=function(e,r,t){return l("jsonRpcPreparePacket",'Browser/_Transport/RPC/Body" or "Browser/_Transport/RPC/Headers'),{reqUrl:i.getURL(e,r,t),reqBody:i.getBody(e,r,t),reqHeaders:u.default.getForMethod(e)}},v.getEmptyRpcResponse=d("getEmptyRpcResponse","Browser/_Transport/RPC/Body#getEmptyResponse",i.getEmptyResponse),v.handleHTTPError=d("handleHTTPError","Browser/_Transport/RPC/ErrorNotifier#HTTP",c.fromHTTP),v.handleRPCError=d("handleRPCError","Browser/_Transport/RPC/ErrorNotifier#RPC",c.fromRPC),r.default=v}(v,e,h,p,d,L,w,H,y,j,A);if(r instanceof Function)return r;else for(var t in r)if(r.hasOwnProperty(t))e[t]=r[t];return e}();return e.fetch=X,e.URL=S,e.RPC=F,e.ajax=r,e.ITransport=t.default,e.RPCJSON=J.default,e.XHR=D.default,e});