define("Types/_display/Tree",["require","exports","tslib","Types/_display/Collection","Types/_display/CollectionItem","Types/_display/GroupItem","Types/_display/TreeItem","Types/_display/TreeChildren","Types/_display/itemsStrategy/Direct","Types/_display/itemsStrategy/AdjacencyList","Types/_display/itemsStrategy/MaterializedPath","Types/_display/itemsStrategy/Root","Types/di","Types/util"],function(t,e,r,o,i,y,p,n,a,h,l,u,s,d){"use strict";function _(t,e,r,o,i,n){var s=this.instance._getItems().filter(function(t){return t.isNode&&t.isNode()}),p=this.instance._getItemsState(s),a=this.instance._startUpdateSession();this.instance._reIndex(),this.prev(t,e,r,o,i,n),this.instance._finishUpdateSession(a,false),this.instance._checkItemsDiff(a,s,p)}function c(t,e,r,o){this.instance._reIndex(),this.prev(t,e,r,o)}function f(t){return"!"===t[0]?t.slice(1):"!"+t}Object.defineProperty(e,"__esModule",{value:true});var m=function(s){function t(t){var e=this;if(e._childrenMap={},t&&!t.hasChildrenProperty&&t.loadedProperty)t.hasChildrenProperty=f(t.loadedProperty);if((e=s.call(this,t)||this)._$parentProperty)e._setImportantProperty(e._$parentProperty);if(e._$childrenProperty)e._setImportantProperty(e._$childrenProperty);return e}return r.__extends(t,s),t.prototype.destroy=function(){this._childrenMap={},s.prototype.destroy.call(this)},t.prototype._getSerializableState=function(t){return(t=s.prototype._getSerializableState.call(this,t))._root=this._root,t},t.prototype._setSerializableState=function(t){var e=s.prototype._setSerializableState.call(this,t);return function(){this._root=t._root,e.call(this)}},t.prototype.getIndexBySourceItem=function(t){if(this._$rootEnumerable&&this.getRoot().getContents()===t)return 0;return s.prototype.getIndexBySourceItem.call(this,t)},t.prototype.moveToNext=function(){return this._moveTo(true)},t.prototype.moveToPrevious=function(){return this._moveTo(false)},t.prototype._exctractItemId=function(t){var e=[s.prototype._exctractItemId.call(this,t)],r;while((r=t.getParent())&&!r.isRoot())e.push(s.prototype._exctractItemId.call(this,r)),t=r;return e.join(":")},t.prototype.getParentProperty=function(){return this._$parentProperty},t.prototype.setParentProperty=function(t){this._unsetImportantProperty(this._$parentProperty),this._$parentProperty=t,this._resetItemsStrategy(),this._setImportantProperty(t),this._reBuild(true)},t.prototype.getNodeProperty=function(){return this._$nodeProperty},t.prototype.getChildrenProperty=function(){return this._$childrenProperty},t.prototype.getHasChildrenProperty=function(){return this._$hasChildrenProperty},t.prototype.getLoadedProperty=function(){return f(this._$hasChildrenProperty)},t.prototype.getRoot=function(){if(null===this._root)if(this._root=this._$root,!(this._root instanceof p.default))this._root=new p.default({contents:this._root,owner:this,node:true,expanded:true,hasChildren:false});return this._root},t.prototype.setRoot=function(t){if(this._$root===t)return;this._$root=t,this._root=null,this._reIndex(),this._reAnalize()},t.prototype.isRootEnumerable=function(){return this._$rootEnumerable},t.prototype.setRootEnumerable=function(t){if(this._$rootEnumerable===t)return;var e=this._startUpdateSession();if(this._$rootEnumerable=t)this._wrapRootStrategy(this._composer);else this._unwrapRootStrategy(this._composer);this._reSort(),this._reFilter(),this._finishUpdateSession(e)},t.prototype.getChildren=function(t,e){return new n.default({owner:t,items:this._getChildrenArray(t,e)})},t.prototype.moveToAbove=function(){var t=this.getCurrent();if(!t)return false;var e=t.getParent();if(!e||e.isRoot())return false;return this.setCurrent(e),true},t.prototype.moveToBelow=function(){var t=this.getCurrent();if(!t||!t.isNode())return false;var e=this._getChildrenArray(t);if(0===e.length)return false;return this.setCurrent(e[0]),true},t.prototype._getItemsFactory=function(){var n=s.prototype._getItemsFactory.call(this);return function t(e){var r=this._$hasChildrenProperty,o=false;if("string"===typeof r&&"!"===r[0])r=r.substr(1),o=!o;var i=d.object.getPropertyValue(e.contents,r);if(e.hasChildren=o?!i:i,!("node"in e))e.node=d.object.getPropertyValue(e.contents,this._$nodeProperty);return n.call(this,e)}},t.prototype._createComposer=function(){var t=s.prototype._createComposer.call(this);if(this._$childrenProperty)t.remove(a.default),t.prepend(l.default,{display:this,childrenProperty:this._$childrenProperty,nodeProperty:this._$nodeProperty,hasChildrenProperty:this._$hasChildrenProperty,root:this.getRoot.bind(this)});else t.append(h.default,{idProperty:this._$idProperty,parentProperty:this._$parentProperty,nodeProperty:this._$nodeProperty,hasChildrenProperty:this._$hasChildrenProperty});return this._wrapRootStrategy(t),t},t.prototype._wrapRootStrategy=function(t){if(this._$rootEnumerable&&!t.getInstance(u.default))t.append(u.default,{root:this.getRoot.bind(this)})},t.prototype._unwrapRootStrategy=function(t){if(!this._$rootEnumerable)t.remove(u.default)},t.prototype._reIndex=function(){s.prototype._reIndex.call(this),this._childrenMap={}},t.prototype._bindHandlers=function(){s.prototype._bindHandlers.call(this),this._onCollectionChange=_.bind({instance:this,prev:this._onCollectionChange}),this._onCollectionItemChange=c.bind({instance:this,prev:this._onCollectionItemChange})},t.prototype._replaceItems=function(t,e){var o=s.prototype._replaceItems.call(this,t,e),i=this._getItemsStrategy(),n=i.count;return o.forEach(function(t,e){var r=o.start+e;if(r<n)i.at(r).setExpanded(t.isExpanded(),true)}),o},t.prototype._getItemState=function(t){var e=s.prototype._getItemState.call(this,t);if(t instanceof p.default)e.parent=t.getParent(),e.childrenCount=t.getOwner()._getChildrenArray(t,false).length,e.level=t.getLevel(),e.node=t.isNode(),e.expanded=t.isExpanded();return e},t.prototype._checkItem=function(t){if(!t||!(t instanceof i.default))throw new Error(this._moduleName+"::_checkItem(): item should be in instance of Types/Display/CollectionItem")},t.prototype._getChildrenArray=function(t,e){this._checkItem(t),e=void 0===e?true:!!e;var r,o=t.getInstanceId()+"|"+e;if(!(o in this._childrenMap)){var i=[],n=void 0;if(e)n=this.getEnumerator();else n=this._buildEnumerator(this._getItems.bind(this),this._filterMap.map(function(){return true}),this._sortMap);if(n.setCurrent(t),n.getCurrent()===t||t.isRoot()){var s=void 0;while(n.moveNext()){if(!((s=n.getCurrent())instanceof p.default))continue;if(s.getParent()===t)i.push(s);else if(s.getLevel()===t.getLevel())break}}this._childrenMap[o]=i}return this._childrenMap[o]},t.prototype._getNearbyItem=function(t,e,r,o){var i=r?"moveNext":"movePrevious",n=e&&e.getParent&&e.getParent()||this.getRoot(),s=true,p=t.getCurrent(),a=false,h,l;t.setCurrent(e);while(s&&!a){if(s=t[i](),l=t.getCurrent(),o&&l instanceof y.default){l=void 0;continue}a=l?l.getParent()===n:false,h=s&&a?l:void 0}return t.setCurrent(p),h},t.prototype._moveTo=function(t){var e=this._getCursorEnumerator(),r=this.getCurrent(),o=this._getNearbyItem(e,r,t,true),i=!!o;if(i)this.setCurrent(o);else e.setCurrent(r);return i},t.prototype._notifyItemsParent=function(t,e,r){if(r.hasOwnProperty(this.getParentProperty()))this._notifyItemsParentByItem(t.getParent()),this._notifyItemsParentByItem(e)},t.prototype._notifyItemsParentByItem=function(t){while(t!==this.getRoot())this.notifyItemChange(t,{children:[]}),t=t.getParent()},t}(o.default);(e.default=m).prototype._moduleName="Types/display:Tree",m.prototype["[Types/_display/Tree]"]=true,m.prototype._itemModule="Types/display:TreeItem",m.prototype._$parentProperty="",m.prototype._$nodeProperty="",m.prototype._$childrenProperty="",m.prototype._$hasChildrenProperty="",m.prototype._$root=void 0,m.prototype._$rootEnumerable=false,m.prototype._root=null,m.prototype["[WS.Data/Display/Tree]"]=true,s.register("Types/display:Tree",m)});