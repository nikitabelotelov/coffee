define("Types/_display/itemsStrategy/AdjacencyList",["require","exports","tslib","Types/_display/GroupItem","Types/entity","Types/util","Types/shim","Types/function"],function(t,e,i,u,s,O,h,r){"use strict";Object.defineProperty(e,"__esModule",{value:true});var n=O.protect("initialized"),o=r.throttle(O.logger.info,300);function b(t){if("number"===typeof t)t=String(t);return t}function a(t,e){for(var r=new h.Map,i=t.length,s,n,o,a,p=0;p<i;p++){if(n=(s=t[p]).getContents(),s instanceof u.default)continue;if(a=b(O.object.getPropertyValue(n,e)),r.has(a))o=r.get(a);else o=[];o.push(p),r.set(a,o)}return r}function p(t){var r=new h.Map,i;return t.forEach(function(t,e){if(t instanceof u.default)i=e;else r.set(t,i)}),r}function P(t,e){var r=[],i=t.sourceItems,s=t.childrenMap,n=t.parentsMap,o=t.groupsMap,a=t.lastGroup,p=t.path,u=t.idProperty,l=p[p.length-1];if(p.indexOf(l)>-1&&p.indexOf(l)<p.length-1)return O.logger.error("Types/display:itemsStrategy.AdjacencyList",'Wrong data hierarchy relation: recursive traversal detected: parent with id "'+l+'" is already in progress. Path: '+p.join(" -> ")+"."),r;for(var c=s.has(l)?s.get(l):[],h=c.length,f,d,_,m,y,g=0;g<h;g++){if(_=(f=i[d=c[g]]).getContents(),(m=o.get(f))!==a){if(y)r.pop(),n.pop();r.push(m),n.push(e),a=t.lastGroup=m}if(r.push(d),n.push(e),y)y=false;if(_&&u){var v=b(O.object.getPropertyValue(_,u));p.push(v);var I=P(t,n.length-1);if(r.push.apply(r,I),m!==t.lastGroup&&(void 0!==e||g<h-1))r.push(m),n.push(e),a=t.lastGroup=m,y=true;p.pop()}}return r}var l=function(r){function t(t){var e=r.call(this)||this;if(e["[Types/_display/IItemsStrategy]"]=true,!(e._options=t).idProperty)o(e._moduleName+'::constructor(): option "idProperty" is not defined. Only root elements will be presented');return e}return i.__extends(t,r),Object.defineProperty(t.prototype,"options",{get:function(){return this.source.options},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"source",{get:function(){return this._options.source},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){var t;return this._getItemsOrder().length},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this._getItems();if(!t[n]){for(var e=t.length,r=0;r<e;r++)if(void 0===t[r])this.at(r);t[n]=true}return t},enumerable:true,configurable:true}),t.prototype.at=function(t){var e=this._getItems();if(e[t])return e[t];var r,i=this._getItemsOrder()[t],s=this._getSourceItems()[i],n;if(void 0===s)throw new ReferenceError("Collection index "+t+" is out of bounds.");if(s instanceof u.default)n=s;else n=this.options.display.createItem({contents:s.getContents(),parent:this._getParent(t)});return e[t]=n},t.prototype.splice=function(s,n,t){t=t||[];for(var o=function(e,r){return function(t){return t>=e?t+r:t}},a=this.source,e=[],r=s;r<s+n;r++)e.push(a.getDisplayIndex(r));a.splice(s,n,t);var p=this._getItems(),u=this._getItemsOrder(),l=this._getSourceItems();if(t.hasBeenRemoved)t.forEach(function(t,e){var r=a.getDisplayIndex(s+e-n),i=u.indexOf(r);if(-1===i)i=u.length;l.splice(r,0,t),(u=u.map(o(r,1))).splice(i,0,r),p.splice(i,0,t)});var c=[];if(n>0){var i=function(i){return function(t,e){var r=i.indexOf(t)>-1;if(r)c.push(p.splice(e,1)[0]),l.splice(t,1);return!r}};u=u.filter(i(e)),e.sort().reverse().forEach(function(t){u=u.map(o(t,-1))}),c.hasBeenRemoved=true}return this._itemsOrder=u,this._syncItemsOrder(),c},t.prototype.reset=function(){this._items=null,this._sourceItems=null,this._itemsOrder=null,this.source.reset()},t.prototype.invalidate=function(){this.source.invalidate(),this._syncItemsOrder()},t.prototype.getDisplayIndex=function(t){var e=this.source.getDisplayIndex(t),r=this._getItemsOrder(),i=r.indexOf(e);return-1===i?r.length:i},t.prototype.getCollectionIndex=function(t){var e=this.source.getCollectionIndex(t),r,i=this._getItemsOrder()[e];return void 0===i?-1:i},t.prototype._getSerializableState=function(t){return(t=s.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t._items=this._items,t._itemsOrder=this._itemsOrder,t._parentsMap=this._parentsMap,t},t.prototype._setSerializableState=function(t){var e=s.SerializableMixin.prototype._setSerializableState(t);return function(){e.call(this),this._items=t._items,this._itemsOrder=t._itemsOrder,this._parentsMap=t._parentsMap}},t.prototype._getItems=function(){if(!this._items)this._initItems();return this._items},t.prototype._initItems=function(){this._items=[],this._items.length=this._getItemsOrder().length},t.prototype._getItemsOrder=function(){if(!this._itemsOrder)this._itemsOrder=this._createItemsOrder();return this._itemsOrder},t.prototype._syncItemsOrder=function(){var r=this;if(!this._itemsOrder)return;var t=this._itemsOrder,i=this._getItems(),s=this._getSourceItems(),e=this._createItemsOrder(),n=this._sourceItems,o=new h.Map;t.forEach(function(t,e){o.set(s[t],i[e])});for(var a=new Array(e.length),p,u,l,c=0;c<e.length;c++)if(u=n[l=e[c]],(p=o.get(u))&&p.getContents()===u.getContents())a[c]=p,o.delete(u);this._itemsOrder=e,this._items=a,i.forEach(function(t){if(t.setParent)t.setParent(void 0)}),a.forEach(function(t,e){if(t.setParent)t.setParent(r._getParent(e))})},t.prototype._getSourceItems=function(){if(!this._sourceItems)this._sourceItems=this.source.items;return this._sourceItems},t.prototype._createItemsOrder=function(){this._sourceItems=null,this._parentsMap=[];var t=this._options,e=this._getSourceItems(),r=this.options.display.getRoot();if((r=r&&r.getContents?r.getContents():r)&&r instanceof Object)r=r.valueOf();r=b(r&&"object"===typeof r?O.object.getPropertyValue(r,t.idProperty):r);var i=a(e,t.parentProperty),s=p(e);if(null===r&&!i.has(r)&&i.has(void 0))r=void 0;return P({idProperty:t.idProperty,sourceItems:e,childrenMap:i,groupsMap:s,parentsMap:this._parentsMap,path:[r]})},t.prototype._getParent=function(t){var e,r=this._parentsMap[t];if(-1===r)return;return void 0===r?this.options.display.getRoot():this.at(r)},t}(O.mixin(s.DestroyableMixin,s.SerializableMixin));e.default=l,Object.assign(l.prototype,{"[Types/_display/itemsStrategy/AdjacencyList]":true,_moduleName:"Types/display:itemsStrategy.AdjacencyList",_options:null,_items:null,_sourceItems:null,_itemsOrder:null,_parentsMap:null})});