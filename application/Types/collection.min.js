define("Types/collection",["Types/shim","Types/object","Types/util","Types/di","Types/entity","tslib","require","exports"],function(n,r,o,a,s,l,u,e){Object.defineProperty(e,"__esModule",{value:true}),e["Types/_collection/IObservable"]=true;var c=function(){"use strict";var e={},t=function(e,t){Object.defineProperty(t,"__esModule",{value:true});var i={"[Types/_collection/IObservable]":true,ACTION_ADD:"a",ACTION_REMOVE:"rm",ACTION_CHANGE:"ch",ACTION_REPLACE:"rp",ACTION_MOVE:"m",ACTION_RESET:"rs"};t.default=i}(u,e);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}(),t=c;e["Types/_collection/Indexer"]=true;var f=function(){"use strict";var e={},t=function(e,t){function l(e,t){var i=e.length,n=i,r=Math.floor(n/2),o;while(n>0&&r<i)if(o=e[r],n=Math.floor(n/2),o>t)r-=n;else r+=Math.max(n,1);return r}Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e,t,i,n){this._collection=e,this._count=t,this._at=i,this._prop=n,this.resetIndex()}return e.prototype.getIndexByValue=function(e,t){var i=this.getIndicesByValue(e,t);return i.length?i[0]:-1},e.prototype.getIndicesByValue=function(e,t){var i=this._getIndex(e);if(i){if(i[t])return i[t].slice();if(i[t="["+(Array.isArray(t)?t.join(","):t)+"]"])return i[t].slice()}return[]},e.prototype.resetIndex=function(){this._indices=null},e.prototype.updateIndex=function(e,t){var i=this._indices;if(!i)return;for(var n in i)this._updateIndex(n,e,t)},e.prototype.shiftIndex=function(i,e,n){var r=i+e;this._eachIndexItem(function(e){for(var t=0;t<e.length;t++)if(e[t]>=i&&e[t]<r)e[t]+=n})},e.prototype.removeFromIndex=function(n,r){this._eachIndexItem(function(e){for(var t,i=0;i<r;i++)if((t=e.indexOf(n+i))>-1)e.splice(t,1)})},e.prototype._eachIndexItem=function(e){var t=this._indices,i;if(!t)return;for(var n in t)for(var r in i=t[n])e(i[r],r,n)},e.prototype._getIndex=function(e){if(!e)return;if(!this._hasIndex(e))this._createIndex(e);return this._indices[e]},e.prototype._hasIndex=function(e){return e&&this._indices?e in this._indices:false},e.prototype._deleteIndex=function(e){delete this._indices[e]},e.prototype._createIndex=function(e){if(!e)return;if(!this._indices)this._indices=Object.create(null);this._indices[e]=Object.create(null),this._updateIndex(e,0,this._count(this._collection))},e.prototype._updateIndex=function(e,t,i){var n=this._indices[e],r,o,a;if(!n)return;for(var s=t;s<t+i;s++){if(r=this._at(this._collection,s),(o=this._prop(r,e))instanceof Array)o="["+o.join(",")+"]";if(!(o in n))n[o]=[];(a=n[o]).splice(l(a,s),0,s)}},e}();(t.default=i).prototype["[Types/_collection/Indexer]"]=true,i.prototype._collection=null,i.prototype._count=null,i.prototype._at=null,i.prototype._prop=null,i.prototype._indices=null}(u,e);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/factory/recordSet"]=true;var h=function(){"use strict";var e={},t=function(e,t,n){function i(e,t){if(!e||!e["[Types/_collection/IEnumerable]"])throw new TypeError('Argument "items" should implement Types/collection:IEnumerable');delete(t=t||{}).rawData;var i=n.create("Types/collection:RecordSet",t);return e.each(function(e){i.add(e)}),i}Object.defineProperty(t,"__esModule",{value:true}),t.default=i}(u,e,a);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/enumerator/Objectwise"]=true;var d=function(){"use strict";var e={},t=function(e,t){Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e){this["[Types/_collection/IEnumerator]"]=true;var t=e;if(void 0===t)t={};if(!(t instanceof Object))throw new Error("Argument items should be an instance of Object");this._items=t,this._keys=Object.keys(t)}return e.prototype.getCurrent=function(){if(this._index<0)return;return this._items[this._keys[this._index]]},e.prototype.moveNext=function(){if(1+this._index>=this._keys.length)return false;this._index++;var e=this.getCurrent();if(this._filter&&!this._filter(e,this.getCurrentIndex()))return this.moveNext();return true},e.prototype.reset=function(){this._index=-1},e.prototype.getCurrentIndex=function(){return this._keys[this._index]},e.prototype.setFilter=function(e){this._filter=e},e}();t.default=i,Object.assign(i.prototype,{"[Types/_collection/enumerator/Objectwise]":true,_items:null,_keys:null,_index:-1,_filter:null})}(u,e);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/enumerator/Mapwise"]=true;var p=function(){"use strict";var e={},t=function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e){if(this["[Types/_collection/IEnumerator]"]=true,void 0===e)e=new i.Map;if(!(e instanceof i.Map))throw new Error("Argument items should be an instance of Map");this._items=e}return Object.defineProperty(e.prototype,"_keys",{get:function(){if(!this._cachedKeys){var i=[];this._items.forEach(function(e,t){i.push(t)}),this._cachedKeys=i}return this._cachedKeys},enumerable:true,configurable:true}),e.prototype.getCurrent=function(){return-1===this._index?void 0:this._items.get(this._keys[this._index])},e.prototype.moveNext=function(){var e=this._keys;if(this._index>=e.length-1)return false;return this._index++,true},e.prototype.reset=function(){this._cachedKeys=void 0,this._index=-1},e.prototype.getCurrentIndex=function(){return this._keys[this._index]},e}();t.default=n,Object.assign(n.prototype,{"[Types/_collection/enumerator/Mapwise]":true,_items:null,_index:-1,_cachedKeys:void 0})}(u,e,n);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/IList"]=true;var i,_=function(){"use strict";var e={},t=(i=u,n=e,void Object.defineProperty(n,"__esModule",{value:true})),i,n;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IEnumerator"]=true;var y,m=function(){"use strict";var e={},t=(i=u,n=e,void Object.defineProperty(n,"__esModule",{value:true})),i,n;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IEnum"]=true;var g,v=function(){"use strict";var e={},t=(i=u,n=e,void Object.defineProperty(n,"__esModule",{value:true})),i,n;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IFlags"]=true;var I,x=function(){"use strict";var e={},t=(i=u,n=e,void Object.defineProperty(n,"__esModule",{value:true})),i,n;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IEnumerable"]=true;var C,b=function(){"use strict";var e={},t=(i=u,n=e,void Object.defineProperty(n,"__esModule",{value:true})),i,n;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/enumerableComparator"]=true;var w=function(){"use strict";var e={},t=function(e,t,f){Object.defineProperty(t,"__esModule",{value:true});var i=0;function n(){if(i>65534)i=0;return i++}function r(e,t){var i=e.getEnumerator(),n=[],r=[],o;i.reset();while(i.moveNext())if(o=i.getCurrent(),n.push(o),t)r.push(o[t]());return{items:n,contents:t?r:null}}function h(e,t,i,n,r){t.addedProcessed=t.addedProcessed||[],t.removedProcessed=t.removedProcessed||{};var o=t.before,a=t.after,s=t.beforeContents,l=t.afterContents,u=t.addedProcessed,c=t.removedProcessed,f=[],h=0,d=[],p=0,_,y,m,g,v=false,I,x=Math.max(o.length,a.length),C,b;for(r=r||0,I=n=n||0;I<x;I++){switch(_=o[I],m=a[I],e){case"added":if(!m)continue;g=I,C=0,b=true;do{if(-1===(y=o.indexOf(m,C)))b=false;else if(u.indexOf(y)>-1)C=y+1;else{if(!f.length)u.push(y);b=false}}while(b);if(-1===y)f.push(m),h=1===f.length?g:h;else if(f.length)v=true;break;case"removed":if(!_)continue;y=I,C=0,b=true;do{if(-1===(g=a.indexOf(_,C)))b=false;else if(c[g])C=g+1;else{if(!d.length)c[g]=true;b=false}}while(b);if(-1===g)d.push(_),p=1===d.length?y:p;else if(d.length)v=true;break;case"replaced":if(!s){I=-1,v=true;break}if(!m)continue;if(g=I,(y=o.indexOf(m))===g&&s[I]!==l[I])d.push(i._getItemsStrategy().convertToItem(s[I])),f.push(m),p=h=1===d.length?y:p;else if(d.length)v=true;break;case"moved":if(o.length!==a.length)throw new Error('The "before" and "after" arrays are not synchronized by the length - "move" can\'t be applied.');if(_===m){if(0===d.length)continue;v=true;break}if(g=I,(y=o.indexOf(m,I))!==g)if(d.length&&y!==p+d.length||f.length&&g!==h+f.length)v=true;else{if(0===d.length)p=y;if(d.push(m),0===f.length)h=g;f.push(m)}}if(v)break}return{newItems:f,newItemsIndex:h,oldItems:d,oldItemsIndex:p,endAt:v?I:-1,offset:r}}function d(e,t,i){var n=i.before,r=i.beforeContents,o=i.afterContents;switch(e){case"added":if(n.splice.apply(n,[t.newItemsIndex,0].concat(t.newItems)),i.addedProcessed){for(var a=t.newItems.length,s=0;s<i.addedProcessed.length;s++)if(i.addedProcessed[s]>=t.newItemsIndex)i.addedProcessed[s]+=a;for(var s=0;s<a;s++)i.addedProcessed.push(t.newItemsIndex+s)}if(null!==r){var l=o.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);r.splice.apply(r,[t.newItemsIndex,0].concat(l))}break;case"removed":if(n.splice(t.oldItemsIndex,t.oldItems.length),null!==r)r.splice(t.oldItemsIndex,t.oldItems.length);if(-1!==t.endAt)t.endAt-=t.oldItems.length;break;case"replaced":if(n.splice.apply(n,[t.oldItemsIndex,t.oldItems.length].concat(t.newItems)),null!==r){var l=o.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);r.splice.apply(r,[t.oldItemsIndex,t.oldItems.length].concat(l))}break;case"moved":var u=t.oldItemsIndex+t.oldItems.length>t.newItemsIndex?t.newItemsIndex:t.newItemsIndex-t.oldItems.length+1;if(n.splice(t.oldItemsIndex,t.oldItems.length),n.splice.apply(n,[u,0].concat(t.newItems)),null!==r){r.splice(t.oldItemsIndex,t.oldItems.length);var l=o.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);r.splice.apply(r,[u,0].concat(l))}if(-1!==t.endAt&&t.oldItemsIndex<t.newItemsIndex)t.endAt-=t.oldItems.length}}var o={"[Types/_collection/enumerableComparator]":true,startSession:function(e,t){var i=r(e,t);return{id:n(),before:i.items,beforeContents:i.contents}},finishSession:function(e,t,i){var n=r(t,i);e.after=n.items,e.afterContents=n.contents},analizeSession:function(e,t,i){for(var n=["removed","added","replaced","moved"],r,o=Math.max(65535,n.length*e.before.length*e.after.length),a,s,l,u,c=0;c<n.length;c++){s=a=0,l=n[c];while(-1!==a){if((r=h(l,e,t,a,s)).newItems.length||r.oldItems.length){if(i){switch(u="",l){case"added":u=f.default.ACTION_ADD;break;case"removed":u=f.default.ACTION_REMOVE;break;case"replaced":u=f.default.ACTION_REPLACE;break;case"moved":u=f.default.ACTION_MOVE}i(u,r)}d(l,r,e)}if(-1!==r.endAt&&r.endAt<=a)if(0===--o)throw new Error("Endless cycle detected.");a=r.endAt,s=r.offset}}}};t.default=o}(u,e,c);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}(),T=w;e["Types/_collection/IndexedEnumeratorMixin"]=true;var O=function(){"use strict";var e={},t=function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:true});var i={"[Types/_collection/IndexedEnumeratorMixin]":true,_enumeratorIndexes:null,constructor:function(){this._enumeratorIndexes={},this._onCollectionChange=this._onCollectionChange.bind(this)},reIndex:function(e,t,i){switch(e){case a.default.ACTION_ADD:this._shiftIndex(t,i),this._addToIndex(t,i);break;case a.default.ACTION_REMOVE:this._removeFromIndex(t,i),this._shiftIndex(t+i,-i);break;case a.default.ACTION_REPLACE:this._replaceInIndex(t,i);break;default:this._resetIndex()}},getIndexByValue:function(e,t){var i=this._getIndexForPropertyValue(e,t);return i.length?i[0]:-1},getIndicesByValue:function(e,t){return this._getIndexForPropertyValue(e,t)},setObservableCollection:function(e){e.subscribe("onCollectionChange",this._onCollectionChange)},unsetObservableCollection:function(e){e.unsubscribe("onCollectionChange",this._onCollectionChange)},_getIndexForPropertyValue:function(e,t){var i=this._getIndex(e);return i&&i[t]||[]},_hasIndex:function(e){if(e)return Object.prototype.hasOwnProperty.call(this._enumeratorIndexes,e);return 0===Object.keys(this._enumeratorIndexes).length},_getIndex:function(e){if(e&&!this._hasIndex(e))this._createIndex(e);return this._enumeratorIndexes[e]},_resetIndex:function(){this._enumeratorIndexes={}},_deleteIndex:function(e){delete this._enumeratorIndexes[e]},_createIndex:function(e){var t={},i=0;this._enumeratorIndexes[e]=t,this.reset();while(this.moveNext())this._setToIndex(t,e,this.getCurrent(),i),i++},_addToIndex:function(e,t){var i,n=e+t,r;for(var o in this._enumeratorIndexes)if(this._enumeratorIndexes.hasOwnProperty(o)){i=this._enumeratorIndexes[o],r=0,this.reset();while(this.moveNext()){if(r>=e)this._setToIndex(i,o,this.getCurrent(),r);if(++r>=n)break}}},_removeFromIndex:function(e,t){var i,n,r,o;for(var a in this._enumeratorIndexes)if(this._enumeratorIndexes.hasOwnProperty(a))for(n in i=this._enumeratorIndexes[a])if(i.hasOwnProperty(n)){r=i[n];for(var s=0;s<t;s++)if((o=r.indexOf(e+s))>-1)r.splice(o,1)}},_replaceInIndex:function(e,t){this._removeFromIndex(e,t),this._addToIndex(e,t)},_shiftIndex:function(e,t){var i,n;for(var r in this._enumeratorIndexes)if(this._enumeratorIndexes.hasOwnProperty(r))for(var o in i=this._enumeratorIndexes[r])if(i.hasOwnProperty(o)){n=i[o];for(var a=0;a<n.length;a++)if(n[a]>=e)n[a]+=t}},_setToIndex:function(e,t,i,n){var r=o.object.getPropertyValue(i,t);if(void 0===r&&i instanceof Object&&"function"===typeof i.getContents)r=o.object.getPropertyValue(i.getContents(),t);if(!Object.prototype.hasOwnProperty.call(e,r))e[r]=[];e[r].push(n)},_onCollectionChange:function(e,t,i,n,r,o){switch(t){case a.default.ACTION_ADD:case a.default.ACTION_REPLACE:this.reIndex(t,n,i.length);break;case a.default.ACTION_REMOVE:this.reIndex(t,o,r.length);break;default:this.reIndex(t)}}};t.default=i}(u,e,o,c);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}(),E=O;e["Types/_collection/enumerator/Arraywise"]=true;var A=function(){"use strict";var e={},t=function(e,t,i,r,n,o){Object.defineProperty(t,"__esModule",{value:true});var a=function(n){function e(e){var t=n.call(this)||this,i=e;if(void 0===i)i=[];if(!(i instanceof Array))throw new Error("Argument items should be an instance of Array");return t._items=i,r.default.constructor.call(t),t}return i.__extends(e,n),e.prototype.getCurrent=function(){if(this._index<0)return;return this._resolver?this._resolver(this._index):this._items[this._index]},e.prototype.getCurrentIndex=function(){return this._index},e.prototype.moveNext=function(){if(1+this._index>=this._items.length)return false;this._index++;var e=this.getCurrent();if(this._filter&&!this._filter(e,this._index))return this.moveNext();return true},e.prototype.reset=function(){this._index=-1},e.prototype.setResolver=function(e){this._resolver=e},e.prototype.setFilter=function(e){this._filter=e},e}(o.mixin(Object,r.default));(t.default=a).prototype["[Types/_collection/enumerator/Arraywise]"]=true,a.prototype._items=null,a.prototype._index=-1,a.prototype._resolver=null,a.prototype._filter=null,n.register("Types/collection:enumerator.Arraywise",a,{instantiate:false})}(u,e,l,O,a,o);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/EventRaisingMixin"]=true;var D=function(){"use strict";var e={},t=function(e,t,r){Object.defineProperty(t,"__esModule",{value:true});var i={"[Types/_entity/EventRaisingMixin]":true,_eventRaising:true,_sessionItemContentsGetter:"",_beforeRaiseOff:null,constructor:function(){this._publish("onEventRaisingChange")},setEventRaising:function(e,t){e=!!e,t=!!t;var i=this._eventRaising===e;if(t&&i)throw new Error("The events raising is already "+(e?"enabled":"disabled")+" with analize=true");if(t)if(e)this._eventRaising=e,this._finishUpdateSession(this._beforeRaiseOff),this._beforeRaiseOff=null;else this._beforeRaiseOff=this._startUpdateSession(),this._eventRaising=e;else this._eventRaising=e;if(!i)this._notify("onEventRaisingChange",e,t)},isEventRaising:function(){return this._eventRaising},_startUpdateSession:function(){if(!this._eventRaising)return null;return r.default.startSession(this,this._sessionItemContentsGetter)},_finishUpdateSession:function(e,t){if(!e)return;if(t=void 0===t?true:t,r.default.finishSession(e,this,this._sessionItemContentsGetter),t)this._analizeUpdateSession(e)},_analizeUpdateSession:function(i){var n=this;if(!i)return;r.default.analizeSession(i,this,function(e,t){n._notifyCollectionChange(e,t.newItems,t.newItemsIndex,t.oldItems,t.oldItemsIndex,i)})},_notifyCollectionChange:function(e,t,i,n,r){if(!this._isNeedNotifyCollectionChange())return;this._notify("onCollectionChange",e,t,i,n,r)},_extractPacksByList:function(e,t,i){for(var n=function(e,t){i(e.slice(),t),e.length=0},r=[],o,a,s=0;s<t.length;s++)o=t[s],r[a=e.getIndex(o)]=o;for(var l=[],u=0,c=r.length-1,f=0;f<=c;f++){if(!(o=r[f])){if(l.length)n(l,u);continue}if(!l.length)u=f;l.push(o)}if(l.length)n(l,u)},_isNeedNotifyCollectionChange:function(){return this._eventRaising&&this.hasEventHandlers("onCollectionChange")}};t.default=i}(u,e,w);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}(),R=D;e["Types/_collection/List"]=true;var $=function(){"use strict";var e={},t=function(o,e,t,a,i,s,l,n,u){Object.defineProperty(e,"__esModule",{value:true});var r=function(r){function n(e){var t=this;if(e&&"items"in e&&!(e.items instanceof Array))throw new TypeError('Option "items" should be an instance of Array');t=r.call(this,e)||this,l.OptionsToPropertyMixin.call(t,e),l.SerializableMixin.constructor.call(t),l.ReadWriteMixin.constructor.call(t,e),t._$items=t._$items||[];for(var i=0,n=t._$items.length;i<n;i++)t._addChild(t._$items[i]);return t}return t.__extends(n,r),n.extend=function(e,t){if(u.logger.info("Types/_collection/List","Method extend is deprecated, use ES6 extends or Core/core-extend"),!o.defined("Core/core-extend"))throw new ReferenceError('You should require module "Core/core-extend" to use old-fashioned "Types/_collection/List::extend()" method.');var i;return o("Core/core-extend")(this,e,t)},n.prototype.destroy=function(){this._$items=null,this._indexer=null,l.ReadWriteMixin.destroy.call(this),r.prototype.destroy.call(this)},n.prototype.getEnumerator=function(){return new i.default(this._$items)},n.prototype.each=function(e,t){for(var i=0,n=this.getCount();i<n;i++)e.call(t||this,this.at(i),i,this)},n.prototype.assign=function(e){for(var t=0,i=this._$items.length;t<i;t++)this._removeChild(this._$items[t]);for(var t=this._$items.length=0,i=(e=this._splice(e||[],0,a.default.ACTION_RESET)).length;t<i;t++)this._addChild(e[t]);this._childChanged(e)},n.prototype.append=function(e){for(var t=0,i=(e=this._splice(e,this.getCount(),a.default.ACTION_ADD)).length;t<i;t++)this._addChild(e[t]);this._childChanged(e)},n.prototype.prepend=function(e){for(var t=0,i=(e=this._splice(e,0,a.default.ACTION_ADD)).length;t<i;t++)this._addChild(e[t]);this._childChanged(e)},n.prototype.clear=function(){this._$items.length=0,this._reindex(),this._getMediator().clear(this),this._childChanged(),this._nextVersion()},n.prototype.add=function(e,t){if(void 0===t)t=this._$items.length,this._$items.push(e);else{if(0!==(t=t||0)&&!this._isValidIndex(t,true))throw new Error("Index is out of bounds");this._$items.splice(t,0,e)}this._addChild(e),this._childChanged(e),this._nextVersion(),this._reindex(a.default.ACTION_ADD,t,1)},n.prototype.at=function(e){return this._$items[e]},n.prototype.remove=function(e){var t=this.getIndex(e);if(-1!==t)return this.removeAt(t),this._childChanged(e),true;return false},n.prototype.removeAt=function(e){if(!this._isValidIndex(e))throw new Error("Index is out of bounds");this._removeChild(this._$items[e]);var t=this._$items.splice(e,1);return this._reindex(a.default.ACTION_REMOVE,e,1),this._childChanged(e),this._nextVersion(),t[0]},n.prototype.replace=function(e,t){if(!this._isValidIndex(t))throw new Error("Index is out of bounds");var i=this._$items[t];if(i===e)return;this._removeChild(i),this._$items[t]=e,this._addChild(e),this._reindex(a.default.ACTION_REPLACE,t,1),this._childChanged(e),this._nextVersion()},n.prototype.move=function(e,t){if(!this._isValidIndex(e))throw new Error('Argument "from" is out of bounds');if(!this._isValidIndex(t))throw new Error('Argument "to" is out of bounds');if(e===t)return;var i=this._$items.splice(e,1);if(this._$items.splice(t,0,i[0]),e<t)this._reindex(a.default.ACTION_REPLACE,e,1+t-e);else this._reindex(a.default.ACTION_REPLACE,t,1+e-t);this._childChanged(i[0]),this._nextVersion()},n.prototype.getIndex=function(e){return this._$items.indexOf(e)},n.prototype.getCount=function(){return this._$items.length},n.prototype.getIndexByValue=function(e,t){return this._getIndexer().getIndexByValue(e,t)},n.prototype.getIndicesByValue=function(e,t){return this._getIndexer().getIndicesByValue(e,t)},n.prototype.isEqual=function(e){if(e===this)return true;if(!e||!(e instanceof n))return false;if(this.getCount()!==e.getCount())return false;for(var t=0,i=this.getCount();t<i;t++)if(this.at(t)!==e.at(t))return false;return true},n.prototype._getSerializableState=function(e){return l.SerializableMixin.prototype._getSerializableState.call(this,e)},n.prototype._setSerializableState=function(e){var t=l.SerializableMixin.prototype._setSerializableState(e);return function(){t.call(this),this._clearIndexer()}},n.prototype._getIndexer=function(){return this._indexer||(this._indexer=new s.default(this._$items,function(e){return e.length},function(e,t){return e[t]},function(e,t){return u.object.getPropertyValue(e,t)}))},n.prototype._clearIndexer=function(){this._indexer=null},n.prototype._isValidIndex=function(e,t){var i=this.getCount();if(t)i++;return e>=0&&e<i},n.prototype._reindex=function(e,t,i){if(!this._indexer)return;var n=this._getIndexer();switch(e){case a.default.ACTION_ADD:n.shiftIndex(t,this.getCount()-t,i),n.updateIndex(t,i);break;case a.default.ACTION_REMOVE:n.removeFromIndex(t,i),n.shiftIndex(t+i,this.getCount()-t,-i);break;case a.default.ACTION_REPLACE:n.removeFromIndex(t,i),n.updateIndex(t,i);break;case a.default.ACTION_RESET:n.resetIndex();break;default:if(i>0)n.removeFromIndex(t,i),n.updateIndex(t,i);else n.resetIndex()}},n.prototype._splice=function(e,t,i){var n;return e=this._itemsToArray(e),(n=this._$items).splice.apply(n,[t,0].concat(e)),this._reindex(i,t,e.length),this._nextVersion(),e},n.prototype._itemsToArray=function(e){if(e instanceof Array)return e;else if(e&&e["[Types/_collection/IEnumerable]"]){var t=[];return e.each(function(e){t.push(e)}),t}else throw new TypeError('Argument "items" must be an instance of Array or implement Types/collection:IEnumerable.')},n}(u.mixin(l.DestroyableMixin,l.OptionsToPropertyMixin,l.ObservableMixin,l.SerializableMixin,l.CloneableMixin,l.ManyToManyMixin,l.ReadWriteMixin,l.VersionableMixin));e.default=r,Object.assign(r.prototype,{"[Types/_collection/List]":true,"[Types/_collection/IEnumerable]":true,"[Types/_collection/IIndexedCollection]":true,"[Types/_collection/IList]":true,"[Types/_entity/ICloneable]":true,"[Types/_entity/IEquatable]":true,"[Types/_entity/IVersionable]":true,_moduleName:"Types/collection:List",_$items:null,_indexer:null}),r.prototype.forEach=r.prototype.each,r.prototype["[WS.Data/Collection/List]"]=true,r.prototype["[WS.Data/Collection/IEnumerable]"]=true,r.prototype["[WS.Data/Collection/IList]"]=true,r.prototype["[WS.Data/Collection/IIndexedCollection]"]=true,r.prototype["[WS.Data/Entity/ICloneable]"]=true,n.register("Types/collection:List",r,{instantiate:false})}(u,e,l,c,A,f,s,a,o);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}(),P=$;e["Types/_collection/enumerator"]=true;var M,F=function(){"use strict";var e={},t=(i=u,n=e,r=A,o=p,a=d,Object.defineProperty(n,"__esModule",{value:true}),n.Arraywise=r.default,n.Mapwise=o.default,void(n.Objectwise=a.default)),i,n,r,o,a;if(t instanceof Function)return t;else for(var s in t)if(t.hasOwnProperty(s))e[s]=t[s];return e}();e["Types/_collection/Dictionary"]=true;var N=function(){"use strict";var e={},t=function(e,t,n,r,o,a,i){Object.defineProperty(t,"__esModule",{value:true});var s=function(i){function s(e){var t=i.call(this)||this;return a.OptionsToPropertyMixin.call(t,e),a.ObservableMixin.call(t,e),t._$dictionary=t._$dictionary||[],t}return n.__extends(s,i),s.prototype.destroy=function(){a.ObservableMixin.prototype.destroy.call(this),i.prototype.destroy.call(this)},s.prototype.getDictionary=function(e){var t=e&&this._$localeDictionary?this._$localeDictionary:this._$dictionary;return t?Array.isArray(t)?t.slice():n.__assign({},t):t},s.prototype.each=function(e,t,i){t=t||this;var n=this.getEnumerator(i);while(n.moveNext())e.call(t,n.getCurrent(),n.getCurrentIndex())},s.prototype.getEnumerator=function(e){var t=e&&this._$localeDictionary?this._$localeDictionary:this._$dictionary,i=t instanceof Array?new r.default(t):new o.default(t);return i.setFilter(function(e,t){return"null"!==t}),i},s.prototype.isEqual=function(e){if(!(e instanceof s))return false;var t=this.getEnumerator(),i=e.getEnumerator(),n,r,o,a;do{if(r=t.moveNext(),a=i.moveNext(),(n=r?t.getCurrent():void 0)!==(o=a?i.getCurrent():void 0))return false;if(t.getCurrentIndex()!==i.getCurrentIndex())return false}while(r||a);return true},s.prototype._getIndex=function(e,t){var i=this.getEnumerator(t);while(i.moveNext())if(i.getCurrent()===e)return i.getCurrentIndex();return},s.prototype._getValue=function(e,t){return t&&this._$localeDictionary?this._$localeDictionary[e]:this._$dictionary[e]},s.prototype._getDictionaryByFormat=function(e){if(!e)return[];return(e.getDictionary?e.getDictionary():e.meta&&e.meta.dictionary)||[]},s.prototype._getLocaleDictionaryByFormat=function(e){if(!e)return;return(e.getLocaleDictionary?e.getLocaleDictionary():e.meta&&e.meta.localeDictionary)||void 0},s}(a.DestroyableMixin);t.default=s,i.applyMixins(s,a.OptionsToPropertyMixin,a.ObservableMixin),Object.assign(s.prototype,{"[Types/_collection/Dictionary]":true,"[Types/_collection/IEnumerable]":true,"[Types/_entity/IEquatable]":true,_$dictionary:void 0,_$localeDictionary:void 0,_type:void 0}),s.prototype["[WS.Data/Collection/IEnumerable]"]=true}(u,e,l,A,d,s,o);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/Flags"]=true;var S,j=function(){"use strict";var e={},t=function(e,t,r,o,a,i,n){function s(e){return null===e||void 0===e?null:!!e}Object.defineProperty(t,"__esModule",{value:true});var l=function(i){function n(e){var t=i.call(this,e)||this;return a.SerializableMixin.constructor.call(t),t._publish("onChange"),t._$values=t._$values||[],t}return r.__extends(n,i),n.produceInstance=function(e,t){return new this({dictionary:this.prototype._getDictionaryByFormat(t&&t.format),localeDictionary:this.prototype._getLocaleDictionaryByFormat(t&&t.format),values:e})},n.prototype.destroy=function(){a.ManyToManyMixin.destroy.call(this),i.prototype.destroy.call(this)},n.prototype.get=function(e,t){var i=this._getOrdinalIndex(e,t);if(void 0!==i)return s(this._$values[i]);return},n.prototype.set=function(e,t,i){var n=this._getOrdinalIndex(e,i);if(void 0===n)throw new ReferenceError(this._moduleName+'::set(): the value "'+e+"\" doesn't found in dictionary");if(t=s(t),this._$values[n]===t)return;this._$values[n]=t;var r=this._getIndex(e,i);this._notifyChange(e,r,t)},n.prototype.getByIndex=function(e){var t=this._getValue(e),i=this._getOrdinalIndex(t);return this._$values[i]},n.prototype.setByIndex=function(e,t){var i=this._getValue(e);if(void 0===i)throw new ReferenceError(this._moduleName+"::setByIndex(): the index "+e+" doesn't found in dictionary");var n=this._getOrdinalIndex(i);if(t=s(t),this._$values[n]===t)return;this._$values[n]=t,this._notifyChange(i,e,t)},n.prototype.fromArray=function(e){var t=this._$values,i=this.getEnumerator(),n=0,r=[];while(i.moveNext()){var o=void 0===e[n]?null:e[n],a;t[n]=o,r[i.getCurrentIndex()]=o,n++}this._notifyChanges(r)},n.prototype.setFalseAll=function(){this._setAll(false)},n.prototype.setTrueAll=function(){this._setAll(true)},n.prototype.setNullAll=function(){this._setAll(null)},n.prototype.isEqual=function(e){if(!(e instanceof n))return false;if(!o.default.prototype.isEqual.call(this,e))return false;var t=this.getEnumerator(),i;while(t.moveNext())if(i=t.getCurrent(),this.get(i)!==e.get(i))return false;return true},n.prototype.toString=function(){return"["+this._$values.map(function(e){return null===e?"null":e}).join(",")+"]"},n.prototype._getOrdinalIndex=function(e,t){var i=this.getEnumerator(t),n=0;while(i.moveNext()){if(i.getCurrent()===e)return n;n++}return},n.prototype._setAll=function(e){var t=this._$dictionary,i=this._$values,n=this.getEnumerator(),r=0;while(n.moveNext()){if(i[r]!==e){i[r]=e;var o=n.getCurrentIndex();this._notifyChange(t[o],o,e)}r++}},n.prototype._notifyChange=function(e,t,i){var n={};n[String(e)]=i,this._childChanged(n),this._notify("onChange",e,t,i)},n.prototype._notifyChanges=function(e){this._childChanged(e),this._notify("onChange",e)},n}(o.default);t.default=l,n.applyMixins(l,a.ManyToManyMixin,a.SerializableMixin,a.CloneableMixin),Object.assign(l.prototype,{"[Types/_collection/Flags]":true,"[Types/_collection/IFlags]":true,"[Types/_entity/ICloneable]":true,"[Types/_entity/IProducible]":true,_moduleName:"Types/collection:Flags",_$values:void 0,_type:"flags"}),l.prototype["[WS.Data/Type/Flags]"]=true,l.prototype["[WS.Data/Entity/ICloneable]"]=true,i.register("Types/collection:Flags",l,{instantiate:false})}(u,e,l,N,s,a,o);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/Enum"]=true;var k,V=function(){"use strict";var e={},t=function(e,t,n,r,o,i,a){Object.defineProperty(t,"__esModule",{value:true});var s=function(i){function t(e){var t=i.call(this,e)||this;return o.SerializableMixin.constructor.call(t),t._publish("onChange"),t._checkIndex(),t}return n.__extends(t,i),t.produceInstance=function(e,t){return new this({dictionary:this.prototype._getDictionaryByFormat(t&&t.format),localeDictionary:this.prototype._getLocaleDictionaryByFormat(t&&t.format),index:e})},t.prototype.destroy=function(){o.ManyToManyMixin.destroy.call(this),i.prototype.destroy.call(this)},t.prototype.get=function(){return this._$index},t.prototype.set=function(e){var t,i=void 0!==this._$dictionary[e],n=this._$index!==e;if(null===e||i)this._$index=e,this._checkIndex();else throw new ReferenceError(this._moduleName+'::set(): the index "'+e+'" is out of range');if(n)this._notifyChange(this._$index,this.getAsValue())},t.prototype.getAsValue=function(e){return this._getValue(this._$index,e)},t.prototype.setByValue=function(e,t){var i=this._getIndex(e,t),n=i!==this._$index;if(null===e)this._$index=e;else if(void 0===i)throw new ReferenceError(this._moduleName+'::setByValue(): the value "'+e+"\" doesn't found in dictionary");else this._$index=i;if(n)this._notifyChange(i,e)},t.prototype.isEqual=function(e){if(!(e instanceof t))return false;if(!r.default.prototype.isEqual.call(this,e))return false;return this.get()===e.get()},t.prototype.valueOf=function(){return this.get()},t.prototype.toString=function(){var e=this.getAsValue();return void 0===e||null===e?"":String(e)},t.prototype._checkIndex=function(){if(null===this._$index)return;this._$index=parseInt(String(this._$index),10)},t.prototype._notifyChange=function(e,t){var i={};i[e]=t,this._childChanged(i),this._notify("onChange",e,t)},t}(r.default);t.default=s,a.applyMixins(s,o.ManyToManyMixin,o.SerializableMixin,o.CloneableMixin),Object.assign(s.prototype,{"[Types/_collection/Enum]":true,"[Types/_collection/IEnum]":true,"[Types/_entity/ICloneable]":true,"[Types/_entity/IProducible]":true,_moduleName:"Types/collection:Enum",_$index:null,_type:"enum"}),s.prototype["[WS.Data/Type/Enum]"]=true,s.prototype["[WS.Data/Entity/ICloneable]"]=true,i.register("Types/collection:Enum",s,{instantiate:false})}(u,e,l,N,s,a,o);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/ObservableList"]=true;var L=function(){"use strict";var e={},t=function(e,t,i,r,n,o,a,s){Object.defineProperty(t,"__esModule",{value:true});var l=Array.prototype.slice,u=function(n){function e(e){var t=n.call(this,e)||this;return o.default.constructor.call(t,e),t._publish("onCollectionChange","onCollectionItemChange"),t}return i.__extends(e,n),e.prototype.assign=function(e){var t=this._itemsSlice(),i=this._eventRaising;if(this._eventRaising=false,n.prototype.assign.call(this,e),this._eventRaising=i,t.length>0||this._$items.length>0)this._notifyCollectionChange(r.default.ACTION_RESET,this._itemsSlice(),0,t,0)},e.prototype.append=function(e){var t=this._eventRaising;this._eventRaising=false;var i=this.getCount();n.prototype.append.call(this,e),this._eventRaising=t,this._notifyCollectionChange(r.default.ACTION_ADD,this._itemsSlice(i),i,[],0)},e.prototype.prepend=function(e){var t=this._eventRaising;this._eventRaising=false;var i=this.getCount();n.prototype.prepend.call(this,e),this._eventRaising=t,this._notifyCollectionChange(r.default.ACTION_ADD,this._itemsSlice(0,this.getCount()-i),0,[],0)},e.prototype.clear=function(){var e=this._$items.slice(),t=this._eventRaising;this._eventRaising=false,n.prototype.clear.call(this),this._eventRaising=t,this._notifyCollectionChange(r.default.ACTION_RESET,this._itemsSlice(),0,e,0)},e.prototype.add=function(e,t){n.prototype.add.call(this,e,t),t=this._isValidIndex(t)?t:this.getCount()-1,this._notifyCollectionChange(r.default.ACTION_ADD,this._itemsSlice(t,t+1),t,[],0)},e.prototype.removeAt=function(e){var t=n.prototype.removeAt.call(this,e);return this._notifyCollectionChange(r.default.ACTION_REMOVE,[],0,[t],e),t},e.prototype.replace=function(e,t){var i=this._$items[t];if(n.prototype.replace.call(this,e,t),i!==e)this._notifyCollectionChange(r.default.ACTION_REPLACE,this._itemsSlice(t,t+1),t,[i],t)},e.prototype.move=function(e,t){var i=this._$items[e];if(n.prototype.move.call(this,e,t),e!==t)this._notifyCollectionChange(r.default.ACTION_MOVE,[i],t,[i],e)},e.prototype.relationChanged=function(e,t){var i=e.target,n=this.getIndex(i),r={},o;if(n>-1)this._reindex("",n,1);if(void 0===t[0])this._notifyItemChange(i,e.data||{});return{target:r[n]=i,data:r}},e.prototype.setEventRaising=function(e,t){var i=this;if(o.default.setEventRaising.call(this,e,t),e&&t&&this._silentChangedItems)if(this._silentChangedItems.length>=Math.min(this._resetChangesCount,this._$items.length))this._notifyCollectionChange(r.default.ACTION_RESET,this._itemsSlice(),0,[],0);else o.default._extractPacksByList(this,this._silentChangedItems,function(e,t){i._notifyCollectionChange(r.default.ACTION_CHANGE,e,t,e,t)});delete this._silentChangedItems},e.prototype._notifyItemChange=function(e,t){if(this._isNeedNotifyCollectionItemChange()){var i=this.getIndex(e);this._notify("onCollectionItemChange",this._$items[i],i,t)}if((this.hasEventHandlers("onCollectionItemChange")||this.hasEventHandlers("onCollectionChange"))&&!this._eventRaising){if(!this._silentChangedItems)this._silentChangedItems=[];this._silentChangedItems.push(e)}},e.prototype._itemsSlice=function(e,t){return l.apply(this._$items,arguments)},e.prototype._isNeedNotifyCollectionItemChange=function(){return this._eventRaising&&this.hasEventHandlers("onCollectionItemChange")},e}(s.mixin(n.default,r.default,o.default));t.default=u,Object.assign(u.prototype,{"[Types/_collection/ObservableList]":true,"[Types/_entity/relation/IReceiver]":true,_moduleName:"Types/collection:ObservableList",_resetChangesCount:100}),a.register("Types/collection:ObservableList",u,{instantiate:false})}(u,e,l,c,$,D,a,o);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}(),z=L;e["Types/_collection/factory/list"]=true;var B=function(){"use strict";var e={},t=function(e,t,i){function n(e){if(!e||!e["[Types/_collection/IEnumerable]"])throw new TypeError('Argument "items" should implement Types/collection:IEnumerable');var t=[];return e.each(function(e){t.push(e)}),new i.default({items:t})}Object.defineProperty(t,"__esModule",{value:true}),t.default=n}(u,e,$);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/format/Format"]=true;var q=function(){"use strict";var e={},t=function(e,t,i,o,n,r){Object.defineProperty(t,"__esModule",{value:true});var a=function(r){function n(e){for(var t=r.call(this,e)||this,i=0,n=t._$items.length;i<n;i++)t._checkItem(t._$items[i]),t._checkName(t._$items[i],i);return t}return i.__extends(n,r),n.prototype.add=function(e,t){this._checkItem(e),this._checkName(e),r.prototype.add.call(this,e,t)},n.prototype.remove=function(e){return this._checkItem(e),r.prototype.remove.call(this,e)},n.prototype.replace=function(e,t){this._checkItem(e),this._checkName(e,t),r.prototype.replace.call(this,e,t)},n.prototype.assign=function(e){for(var t=0,i=(e=this._itemsToArray(e)).length;t<i;t++)this._checkItem(e[t]);r.prototype.assign.call(this,e);for(var t=0,i=this._$items.length;t<i;t++)this._checkName(this._$items[t],t)},n.prototype.append=function(e){for(var t=0,i=(e=this._itemsToArray(e)).length;t<i;t++)this._checkItem(e[t]),this._checkName(e[t]);r.prototype.append.call(this,e)},n.prototype.prepend=function(e){for(var t=0,i=(e=this._itemsToArray(e)).length;t<i;t++)this._checkItem(e[t]),this._checkName(e[t]);r.prototype.prepend.call(this,e)},n.prototype.getCount=function(){return r.prototype.getCount.call(this)},n.prototype.at=function(e){return r.prototype.at.call(this,e)},n.prototype.getIndexByValue=function(e,t){return r.prototype.getIndexByValue.call(this,e,t)},n.prototype.removeAt=function(e){return r.prototype.removeAt.call(this,e)},n.prototype.isEqual=function(e){if(e===this)return true;if(!e)return false;if(!(e instanceof n))return false;if(this.getCount()!==e.getCount())return false;for(var t=0,i=this.getCount();t<i;t++)if(!this.at(t).isEqual(e.at(t)))return false;return true},n.prototype.removeField=function(e){var t=this.getIndexByValue("name",e);if(-1===t)throw new ReferenceError(this._moduleName+'::removeField(): field "'+e+"\" doesn't found");this.removeAt(t)},n.prototype.getFieldIndex=function(e){return this.getIndexByValue("name",e)},n.prototype.getFieldName=function(e){return this.at(e).getName()},n.prototype._checkItem=function(e){if(!e||!(e instanceof o.format.Field))throw new TypeError('Item should be an instance of "Types/entity:format.Field"')},n.prototype._checkName=function(e,t){var i=this.getFieldIndex(e.getName());if(i>-1&&i!==t)throw new ReferenceError(this._moduleName+': field with name "'+e.getName()+'" already exists')},n.prototype._itemsToArray=function(e){return r.prototype._itemsToArray.call(this,e)},n}(n.default);t.default=a,Object.assign(a.prototype,{"[Types/_collection/format/Format]":true,"[Types/_entity/IEquatable]":true,_moduleName:"Types/collection:format.Format"}),r.register("Types/collection:format.Format",a,{instantiate:false})}(u,e,l,s,$,a);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/factory"]=true;var W,H=function(){"use strict";var e={},t=(i=u,n=e,r=B,o=h,Object.defineProperty(n,"__esModule",{value:true}),n.list=r.default,void(n.recordSet=o.default)),i,n,r,o;if(t instanceof Function)return t;else for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];return e}();e["Types/_collection/format/factory"]=true;var G=function(){"use strict";var e={},t=function(e,t,n,r,i){function o(e){if(!e||!(e instanceof Array))throw new TypeError("Types/_collection/format/factory: declaration should be an instance of Array");for(var t=new n.default,i=0;i<e.length;i++)t.add(r.format.fieldsFactory(e[i]));return t}Object.defineProperty(t,"__esModule",{value:true}),t.default=o,i.register("Types/collection:format.factory",o,{instantiate:false})}(u,e,q,s,a);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();e["Types/_collection/format"]=true;var U,K=function(){"use strict";var e={},t=(i=u,n=e,r=G,o=q,Object.defineProperty(n,"__esModule",{value:true}),n.factory=r.default,void(n.Format=o.default)),i,n,r,o;if(t instanceof Function)return t;else for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];return e}();e["Types/_collection/RecordSet"]=true;var Y,J=function(){"use strict";var e={},t=function(e,t,p,n,i,r,o,u,l,c,f){Object.defineProperty(t,"__esModule",{value:true});var a="Types/entity:Model",h=u.Record.RecordState,s=false;function d(e,t){if(s&&t)if(e&&e["[Types/_entity/Record]"]&&null===e.get(t))c.logger.info("Types/_collection/RecordSet: Id propery must not be null");else if(e instanceof _)e.each(function(e){d(e,t)})}var _=function(a){function s(e){var t=this;if(e)if("items"in e)c.logger.stack('Types/_collection/RecordSet: option "items" give no effect, use "rawData" instead',1);if(t=a.call(this,e)||this,e)if("meta"in e)t._$metaData=e.meta;if(!t._$format&&t._$model&&"function"===typeof t._$model&&t._$model.prototype._$format)t._$format=t._$model.prototype._$format;if(u.FormattableMixin.constructor.call(t,e),!t._$idProperty)t._$idProperty=t._getAdapter().getKeyField(t._getRawData());if(t._$rawData)t._assignRawData(t._getRawData(true),true),t._initByRawData();return t._publish("onPropertyChange"),t}return p.__extends(s,a),s.produceInstance=function(e,t){var i={rawData:e};if(t){if(t.adapter)i.adapter=t.adapter;if(t.model)i.model=t.model}return new this(i)},s.patch=function(i,e){e=e||["changed","added","removed"];var t=function(e){var t=new s({adapter:i.getAdapter(),idProperty:i.getIdProperty()});return i.each(function(e){t.add(e)},e),t},n=function(e){var t=[],i=e.getIdProperty();return e.each(function(e){t.push(e.get(i))}),t},r=new u.Record({format:[{name:e[0],type:"recordset"},{name:e[1],type:"recordset"},{name:e[2],type:"array",kind:"string"}],adapter:i.getAdapter()});return r.set(e[0],t(h.CHANGED)),r.set(e[1],t(h.ADDED)),r.set(e[2],n(t(h.DELETED))),r.acceptChanges(),r},s.prototype.destroy=function(){this._$model="",this._$metaData=null,this._metaData=null,a.prototype.destroy.call(this)},s.prototype.relationChanged=function(e,t){var i=this.getIndex(e.target);if(i>-1){var n,r=this._getRawDataAdapter().at(i),o=e.target.getRawData(true);if(r!==o)this._getRawDataAdapter().replace(o,i)}return a.prototype.relationChanged.call(this,e,t)},s.prototype.clone=function(e){var t=a.prototype.clone.call(this,e);if(e)t._$items=this._$items.slice();return t},s.prototype.isEqual=function(e){if(e===this)return true;if(!e)return false;if(!(e instanceof s))return false;return f.isEqual(this._getRawData(),e.getRawData(true))},s.prototype.getEnumerator=function(t){var i=this,e=new r.default(this._$items);if(e.setResolver(function(e){return i.at(e)}),t)e.setFilter(function(e){return e.getState()===t});return e},s.prototype.each=function(e,t,i){if(t instanceof Object)i=t,t=void 0;i=i||this;for(var n=this.getCount(),r=0,o,a,s=0;s<n;s++){if(a=this.at(s),t)o=a.getState()===t;else o=true;if(o)e.call(i,a,r++,this)}},s.prototype.clear=function(){for(var e,t=0,i=this._$items.length;t<i;t++)if(e=this._$items[t])e.detach();this._getRawDataAdapter().clear(),a.prototype.clear.call(this)},s.prototype.add=function(e,t){return e=this._normalizeItems([e],h.ADDED)[0],this._getRawDataAdapter().add(e.getRawData(true),t),a.prototype.add.call(this,e,t),e},s.prototype.at=function(e){return this._getRecord(e)},s.prototype.remove=function(e){return this._checkItem(e),a.prototype.remove.call(this,e)},s.prototype.removeAt=function(e){this._getRawDataAdapter().remove(e);var t=this._$items[e],i=a.prototype.removeAt.call(this,e);if(t)t.detach();return i},s.prototype.replace=function(e,t){e=this._normalizeItems([e],h.CHANGED)[0],this._getRawDataAdapter().replace(e.getRawData(true),t);var i=this._$items[t];if(a.prototype.replace.call(this,e,t),i)i.detach();return e},s.prototype.move=function(e,t){this._getRecord(e),this._getRawDataAdapter().move(e,t),a.prototype.move.call(this,e,t)},s.prototype.assign=function(e){if(e===this)return[];var t=this._$items.slice(),i,n;if(e instanceof s)this._$adapter=e.getAdapter(),this._assignRawData(e.getRawData(),this._hasFormat()),i=new Array(e.getCount()),a.prototype.assign.call(this,i);else{if((e=this._itemsToArray(e)).length&&e[0]&&e[0]["[Types/_entity/Record]"])this._$adapter=e[0].getAdapter();e=this._normalizeItems(e,h.ADDED),this._assignRawData(null,this._hasFormat()),e=this._addItemsToRawData(e),a.prototype.assign.call(this,e),i=e}for(var r=0,o=t.length;r<o;r++)if(n=t[r])n.detach();return i},s.prototype.append=function(e){return e=this._itemsToArray(e),e=this._normalizeItems(e,h.ADDED),e=this._addItemsToRawData(e),a.prototype.append.call(this,e),e},s.prototype.prepend=function(e){return e=this._itemsToArray(e),e=this._normalizeItems(e,h.ADDED),e=this._addItemsToRawData(e,0),a.prototype.prepend.call(this,e),e},s.prototype._getIndexer=function(){var i=this,e;if(this._indexer)return this._indexer;if(this._$model===this._defaultModel){var n=this._getAdapter(),r=this._getRawDataAdapter();e=new o.default(this._getRawData(),function(){return r.getCount()},function(e,t){return r.at(t)},function(e,t){return n.forRecord(e).get(t)})}else e=new o.default(this._$items,function(e){return e.length},function(e,t){return i.at(t)},function(e,t){return e.get(t)});return this._indexer=e},s.prototype._itemsSlice=function(e,t){if(this._isNeedNotifyCollectionChange()){if(void 0===e)e=0;if(void 0===t)t=this._$items.length;for(var i=e;i<t;i++)this._getRecord(i)}return a.prototype._itemsSlice.call(this,e,t)},s.prototype._getSerializableState=function(e){return e=i.default.prototype._getSerializableState.call(this,e),(e=u.FormattableMixin._getSerializableState.call(this,e))._instanceId=this.getInstanceId(),delete e.$options.items,e},s.prototype._setSerializableState=function(e){var t=a.prototype._setSerializableState.call(this,e),i=u.FormattableMixin._setSerializableState(e);return function(){t.call(this),i.call(this),this._instanceId=e._instanceId}},s.prototype.setRawData=function(e){var t=this._$items.slice(),i=this._eventRaising;this._eventRaising=false,this.clear(),this._eventRaising=i,this._assignRawData(e),this._initByRawData(),this._notifyCollectionChange(n.default.ACTION_RESET,this._$items,0,t,0)},s.prototype.addField=function(e,t,i){if(e=this._buildField(e),u.FormattableMixin.addField.call(this,e,t),this._parentChanged(u.Record.prototype.addField),void 0!==i){var n=e.getName();this.each(function(e){e.set(n,i)})}this._nextVersion()},s.prototype.removeField=function(e){u.FormattableMixin.removeField.call(this,e),this._nextVersion(),this._parentChanged(u.Record.prototype.removeField)},s.prototype.removeFieldAt=function(e){u.FormattableMixin.removeFieldAt.call(this,e),this._nextVersion(),this._parentChanged(u.Record.prototype.removeFieldAt)},s.prototype._createRawDataAdapter=function(){return this._getAdapter().forTable(this._getRawData(true))},s.prototype._assignRawData=function(e,t){if(u.FormattableMixin.setRawData.call(this,e),this._clearIndexer(),!t)this._clearFormat();this._nextVersion()},s.prototype.getModel=function(){return this._$model},s.prototype.acceptChanges=function(e){var i=[];this.each(function(e,t){if(e.getState()===h.DELETED)i.push(t);e.acceptChanges()});for(var t=i.length-1;t>=0;t--)this.removeAt(i[t]);if(e)this._childChanged(u.Record.prototype.acceptChanges)},s.prototype.isChanged=function(){for(var e=false,t=this._$items,i=t.length,n=0;n<i;n++)if(t[n].isChanged()){e=true;break}return e},s.prototype.getIdProperty=function(){return this._$idProperty},s.prototype.setIdProperty=function(t){if(this._$idProperty===t)return;this._$idProperty=t,this.each(function(e){if(e.setIdProperty)e.setIdProperty(t)}),this._notify("onPropertyChange",{idProperty:this._$idProperty})},s.prototype.getRecordById=function(e){return this.at(this.getIndexByValue(this._$idProperty,e))},s.prototype.getMetaData=function(){var r=this;if(this._metaData)return this._metaData;var o=function(e,t){return u.factory.cast(e,t,{format:t,adapter:r._getAdapter(),idProperty:r._$idProperty})},a=this._$metaFormat?u.FormattableMixin._buildFormat(this._$metaFormat):null,s={};if(this._$metaData)if(this._$metaData instanceof Object&&Object.getPrototypeOf(this._$metaData)===Object.prototype)Object.keys(this._$metaData).forEach(function(e){var t=r._$metaData[e];if(a){var i=void 0,n=a.getFieldIndex(e);if(n>-1)i=a.at(n),t=o(t,i.getType())}s[e]=t});else s=this._$metaData;else{var l=this._getRawDataAdapter();if(l["[Types/_entity/adapter/IDecorator]"])l=l.getOriginal();if(l["[Types/_entity/adapter/IMetaData]"])l.getMetaDataDescriptor().forEach(function(e){var t=e.getName(),i;if(a){var n=a.getFieldIndex(t);if(n>-1)i=a.at(n)}s[t]=o(l.getMetaData(t),i?i.getType():r._getFieldType(e))})}return this._metaData=s,this._metaData},s.prototype.setMetaData=function(n){var r=this;if(this._metaData=this._$metaData=n,n instanceof Object){var o=this._getRawDataAdapter();if(o["[Types/_entity/adapter/IMetaData]"])o.getMetaDataDescriptor().forEach(function(e){var t=e.getName(),i=u.factory.serialize(n[t],{format:e,adapter:r.getAdapter()});o.setMetaData(t,i)})}this._notify("onPropertyChange",{metaData:n})},s.prototype.merge=function(e,t){if(t instanceof Object&&t.hasOwnProperty("merge")&&!t.hasOwnProperty("replace"))t.replace=t.merge;t=p.__assign({add:true,remove:true,replace:true,inject:false},t||{});var i=e.getCount(),n=this._$idProperty,r={},o={},a=[],s=[],l=[],u,c,f;this.each(function(e,t){r[e.get(n)]=t});for(var h=0;h<i;h++){if(c=(u=e.at(h)).get(n),0===h)this._checkItem(u);if(r.hasOwnProperty(c)){if(t.inject){if(f=r[c],!u.isEqual(this.at(f)))l.push([u,f])}else if(t.replace)if(f=r[c],!u.isEqual(this.at(f)))s.push([u,f])}else if(t.add)a.push(u);if(t.remove)o[c]=true}if(s.length)for(var h=0;h<s.length;h++)this.replace(s[h][0],s[h][1]);if(l.length)for(var h=0;h<l.length;h++)(u=this.at(l[h][1])).setRawData(l[h][0].getRawData());if(a.length)this.append(a);if(t.remove){var d=[];this.each(function(e,t){if(!o.hasOwnProperty(e.get(n)))d.push(t)});for(var h=d.length-1;h>=0;h--)this.removeAt(d[h])}},s.prototype._addItemsToRawData=function(e,t){for(var i=this._getRawDataAdapter(),n,r=0,o=(e=this._itemsToArray(e)).length;r<o;r++)n=e[r],i.add(n.getRawData(true),void 0===t?void 0:t+r);return e},s.prototype._normalizeItems=function(e,t){for(var i=this._hasFormat(),n,r=[],o,a,s=0;s<e.length;s++){if(a=e[s],this._checkItem(a),!i&&0===this.getCount())n=a.getFormat(true),this._clearFormat(),this._resetRawDataFields();else if(!n)n=this._getFormat(true);if(o=this._normalizeItemData(a,n),t)o.setState(t);r.push(o)}return r},s.prototype._normalizeItemData=function(e,t){var i=e.getFormat(true),n;if(t.isEqual(i))n=this._buildRecord(e.getRawData());else{var r=this.getAdapter().forRecord(null,this._getRawData()),o=e.getAdapter().forRecord(e.getRawData(true));t.each(function(e,t){var i=e.getName();r.addField(e,t),r.set(i,o.get(i))}),n=this._buildRecord(r.getData())}return n},s.prototype._checkItem=function(e){if(!e||!e["[Types/_entity/Record]"])throw new TypeError("Item should be an instance of Types/entity:Record");d(e,this.getIdProperty()),this._checkAdapterCompatibility(e.getAdapter())},s.prototype._buildRecord=function(e){var t;return l.create(this._$model,{owner:this,writable:this.writable,state:h.UNCHANGED,adapter:this.getAdapter(),rawData:e,idProperty:this._$idProperty})},s.prototype._getRecord=function(e){var t=this;if(e<0||e>=this._$items.length)return;var i=this._$items[e];if(!i){var n=this._getRawDataAdapter();i=this._$items[e]=this._buildRecord(function(){return n.at(i?t.getIndex(i):e)}),this._addChild(i),d(i,this.getIdProperty())}return i},s.prototype._initByRawData=function(){var e=this._getRawDataAdapter();this._$items.length=0,this._$items.length=e.getCount()},s}(c.mixin(i.default,u.FormattableMixin,u.InstantiableMixin));t.default=_,Object.assign(_.prototype,{"[Types/_collection/RecordSet]":true,"[Types/_entity/IInstantiable]":true,"[Types/_entity/IObservableObject]":true,"[Types/_entity/IProducible]":true,_moduleName:"Types/collection:RecordSet",_instancePrefix:"recordset-",_defaultModel:a,_$model:a,_$idProperty:"",_$metaData:null,_$metaFormat:null,_metaData:null}),_.prototype.forEach=_.prototype.each,_.prototype["[WS.Data/Collection/RecordSet]"]=true,l.register("Types/collection:RecordSet",_,{instantiate:false})}(u,e,l,c,L,A,f,s,a,o,r);if(t instanceof Function)return t;else for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}();return e.enumerableComparator=T.default,e.Enum=V.default,e.enumerator=F,e.EventRaisingMixin=R.default,e.factory=H,e.format=K,e.Flags=j.default,e.IEnum=v.default,e.IFlags=x.default,e.IFlagsValue=x.IValue,e.IEnumerable=b.default,e.EnumeratorCallback=b.EnumeratorCallback,e.IEnumerator=m.default,e.IList=_.default,e.IndexedEnumeratorMixin=E.default,e.IObservable=t.default,e.List=P.default,e.ObservableList=z.default,e.RecordSet=J.default,e});