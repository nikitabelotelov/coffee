define("Types/collection",["Types/shim","Core/helpers/Object/isEqual","Core/core-extend","Types/util","Types/di","Types/entity","tslib","require","exports"],function(i,r,o,a,s,l,u,c,e){"use strict";Object.defineProperty(e,"__esModule",{value:true}),e["Types/_collection/IObservable"]=true;var f=function(){var e={},t=function(e,t){Object.defineProperty(t,"__esModule",{value:true});var n={"[Types/_collection/IObservable]":true,ACTION_ADD:"a",ACTION_REMOVE:"rm",ACTION_CHANGE:"ch",ACTION_REPLACE:"rp",ACTION_MOVE:"m",ACTION_RESET:"rs"};t.default=n}(c,e);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),t=f;e["Types/_collection/Indexer"]=true;var h=function(){var e={},t=function(e,t){function l(e,t){var n=e.length,i=n,r=Math.floor(i/2),o;while(i>0&&r<n)if(o=e[r],i=Math.floor(i/2),o>t)r-=i;else r+=Math.max(i,1);return r}Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t,n,i){this._collection=e,this._count=t,this._at=n,this._prop=i,this.resetIndex()}return e.prototype.getIndexByValue=function(e,t){var n=this.getIndicesByValue(e,t);return n.length?n[0]:-1},e.prototype.getIndicesByValue=function(e,t){var n=this._getIndex(e);if(n){if(n[t])return n[t].slice();if(n[t="["+(Array.isArray(t)?t.join(","):t)+"]"])return n[t].slice()}return[]},e.prototype.resetIndex=function(){this._indices=null},e.prototype.updateIndex=function(e,t){var n=this._indices;if(!n)return;for(var i in n)this._updateIndex(i,e,t)},e.prototype.shiftIndex=function(n,e,i){var r=n+e;this._eachIndexItem(function(e){for(var t=0;t<e.length;t++)if(e[t]>=n&&e[t]<r)e[t]+=i})},e.prototype.removeFromIndex=function(i,r){this._eachIndexItem(function(e){for(var t,n=0;n<r;n++)if((t=e.indexOf(i+n))>-1)e.splice(t,1)})},e.prototype._eachIndexItem=function(e){var t=this._indices,n;if(!t)return;for(var i in t)for(var r in n=t[i])e(n[r],r,i)},e.prototype._getIndex=function(e){if(!e)return;if(!this._hasIndex(e))this._createIndex(e);return this._indices[e]},e.prototype._hasIndex=function(e){return e&&this._indices?e in this._indices:false},e.prototype._deleteIndex=function(e){delete this._indices[e]},e.prototype._createIndex=function(e){if(!e)return;if(!this._indices)this._indices=Object.create(null);this._indices[e]=Object.create(null),this._updateIndex(e,0,this._count(this._collection))},e.prototype._updateIndex=function(e,t,n){var i=this._indices[e],r,o,a;if(!i)return;for(var s=t;s<t+n;s++){if(r=this._at(this._collection,s),(o=this._prop(r,e))instanceof Array)o="["+o.join(",")+"]";if(!(o in i))i[o]=[];(a=i[o]).splice(l(a,s),0,s)}},e}();(t.default=n).prototype["[Types/_collection/Indexer]"]=true,n.prototype._collection=null,n.prototype._count=null,n.prototype._at=null,n.prototype._prop=null,n.prototype._indices=null}(c,e);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/factory/recordSet"]=true;var p=function(){var e={},t=function(e,t,r){function n(e,t){if(!e||!e["[Types/_collection/IEnumerable]"])throw new TypeError('Argument "items" should implement Types/collection:IEnumerable');var n=r.resolve(r.isRegistered("collection.$recordset")?"collection.$recordset":"Types/collection:RecordSet");delete(t=t||{}).rawData;var i=new n(t);return e.each(function(e){i.add(e)}),i}Object.defineProperty(t,"__esModule",{value:true}),t.default=n}(c,e,s);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/enumerator/Objectwise"]=true;var d=function(){var e={},t=function(e,t){Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e){this["[Types/_collection/IEnumerator]"]=true;var t=e;if(void 0===t)t={};if(!(t instanceof Object))throw new Error("Argument items should be an instance of Object");this._items=t,this._keys=Object.keys(t)}return e.prototype.getCurrent=function(){if(this._index<0)return;return this._items[this._keys[this._index]]},e.prototype.moveNext=function(){if(1+this._index>=this._keys.length)return false;this._index++;var e=this.getCurrent();if(this._filter&&!this._filter(e,this.getCurrentIndex()))return this.moveNext();return true},e.prototype.reset=function(){this._index=-1},e.prototype.getCurrentIndex=function(){return this._keys[this._index]},e.prototype.setFilter=function(e){this._filter=e},e}();(t.default=n).prototype["[Types/_collection/enumerator/Objectwise]"]=true,n.prototype._items=null,n.prototype._keys=null,n.prototype._index=-1,n.prototype._filter=null}(c,e);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/enumerator/Mapwise"]=true;var _=function(){var e={},t=function(e,t,n){Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e){if(this["[Types/_collection/IEnumerator]"]=true,void 0===e)e=new n.Map;if(!(e instanceof n.Map))throw new Error("Argument items should be an instance of Map");this._items=e}return Object.defineProperty(e.prototype,"_keys",{get:function(){if(!this._cachedKeys){var n=[];this._items.forEach(function(e,t){n.push(t)}),this._cachedKeys=n}return this._cachedKeys},enumerable:true,configurable:true}),e.prototype.getCurrent=function(){return-1===this._index?void 0:this._items.get(this._keys[this._index])},e.prototype.moveNext=function(){var e=this._keys;if(this._index>=e.length-1)return false;return this._index++,true},e.prototype.reset=function(){this._cachedKeys=void 0,this._index=-1},e.prototype.getCurrentIndex=function(){return this._keys[this._index]},e}();(t.default=i).prototype["[Types/_collection/enumerator/Mapwise]"]=true,i.prototype._items=null,i.prototype._index=-1,i.prototype._cachedKeys=void 0}(c,e,i);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/IList"]=true;var n,y=function(){var e={},t=(n=c,i=e,void Object.defineProperty(i,"__esModule",{value:true})),n,i;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IEnumerator"]=true;var m,g=function(){var e={},t=(n=c,i=e,void Object.defineProperty(i,"__esModule",{value:true})),n,i;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IEnum"]=true;var v,I=function(){var e={},t=(n=c,i=e,void Object.defineProperty(i,"__esModule",{value:true})),n,i;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IFlags"]=true;var x,C=function(){var e={},t=(n=c,i=e,void Object.defineProperty(i,"__esModule",{value:true})),n,i;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/IEnumerable"]=true;var b,w=function(){var e={},t=(n=c,i=e,void Object.defineProperty(i,"__esModule",{value:true})),n,i;if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Types/_collection/enumerableComparator"]=true;var T=function(){var e={},t=function(e,t,f){Object.defineProperty(t,"__esModule",{value:true});var n=0;function i(){if(n>65534)n=0;return n++}function r(e,t){var n=e.getEnumerator(),i=[],r=[],o;n.reset();while(n.moveNext())if(o=n.getCurrent(),i.push(o),t)r.push(o[t]());return{items:i,contents:t?r:null}}function h(e,t,n,i,r){t.addedProcessed=t.addedProcessed||[],t.removedProcessed=t.removedProcessed||{};var o=t.before,a=t.after,s=t.beforeContents,l=t.afterContents,u=t.addedProcessed,c=t.removedProcessed,f=[],h=0,p=[],d=0,_,y,m,g,v=false,I,x=Math.max(o.length,a.length),C,b;for(r=r||0,I=i=i||0;I<x;I++){switch(_=o[I],m=a[I],e){case"added":if(!m)continue;g=I,C=0,b=true;do{if(-1===(y=o.indexOf(m,C)))b=false;else if(u.indexOf(y)>-1)C=y+1;else{if(!f.length)u.push(y);b=false}}while(b);if(-1===y)f.push(m),h=1===f.length?g:h;else if(f.length)v=true;break;case"removed":if(!_)continue;y=I,C=0,b=true;do{if(-1===(g=a.indexOf(_,C)))b=false;else if(c[g])C=g+1;else{if(!p.length)c[g]=true;b=false}}while(b);if(-1===g)p.push(_),d=1===p.length?y:d;else if(p.length)v=true;break;case"replaced":if(!s){I=-1,v=true;break}if(!m)continue;if(g=I,(y=o.indexOf(m))===g&&s[I]!==l[I])p.push(n._getItemsStrategy().convertToItem(s[I])),f.push(m),d=h=1===p.length?y:d;else if(p.length)v=true;break;case"moved":if(o.length!==a.length)throw new Error('The "before" and "after" arrays are not synchronized by the length - "move" can\'t be applied.');if(_===m){if(0===p.length)continue;v=true;break}if(g=I,(y=o.indexOf(m,I))!==g)if(p.length&&y!==d+p.length||f.length&&g!==h+f.length)v=true;else{if(0===p.length)d=y;if(p.push(m),0===f.length)h=g;f.push(m)}}if(v)break}return{newItems:f,newItemsIndex:h,oldItems:p,oldItemsIndex:d,endAt:v?I:-1,offset:r}}function p(e,t,n){var i=n.before,r=n.beforeContents,o=n.afterContents;switch(e){case"added":if(i.splice.apply(i,[t.newItemsIndex,0].concat(t.newItems)),n.addedProcessed){for(var a=t.newItems.length,s=0;s<n.addedProcessed.length;s++)if(n.addedProcessed[s]>=t.newItemsIndex)n.addedProcessed[s]+=a;for(var s=0;s<a;s++)n.addedProcessed.push(t.newItemsIndex+s)}if(null!==r){var l=o.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);r.splice.apply(r,[t.newItemsIndex,0].concat(l))}break;case"removed":if(i.splice(t.oldItemsIndex,t.oldItems.length),null!==r)r.splice(t.oldItemsIndex,t.oldItems.length);if(-1!==t.endAt)t.endAt-=t.oldItems.length;break;case"replaced":if(i.splice.apply(i,[t.oldItemsIndex,t.oldItems.length].concat(t.newItems)),null!==r){var l=o.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);r.splice.apply(r,[t.oldItemsIndex,t.oldItems.length].concat(l))}break;case"moved":var u=t.oldItemsIndex+t.oldItems.length>t.newItemsIndex?t.newItemsIndex:t.newItemsIndex-t.oldItems.length+1;if(i.splice(t.oldItemsIndex,t.oldItems.length),i.splice.apply(i,[u,0].concat(t.newItems)),null!==r){r.splice(t.oldItemsIndex,t.oldItems.length);var l=o.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);r.splice.apply(r,[u,0].concat(l))}if(-1!==t.endAt&&t.oldItemsIndex<t.newItemsIndex)t.endAt-=t.oldItems.length}}var o={"[Types/_collection/enumerableComparator]":true,startSession:function(e,t){var n=r(e,t);return{id:i(),before:n.items,beforeContents:n.contents}},finishSession:function(e,t,n){var i=r(t,n);e.after=i.items,e.afterContents=i.contents},analizeSession:function(e,t,n){for(var i=["removed","added","replaced","moved"],r,o=Math.max(65535,i.length*e.before.length*e.after.length),a,s,l,u,c=0;c<i.length;c++){s=a=0,l=i[c];while(-1!==a){if((r=h(l,e,t,a,s)).newItems.length||r.oldItems.length){if(n){switch(u="",l){case"added":u=f.default.ACTION_ADD;break;case"removed":u=f.default.ACTION_REMOVE;break;case"replaced":u=f.default.ACTION_REPLACE;break;case"moved":u=f.default.ACTION_MOVE}n(u,r)}p(l,r,e)}if(-1!==r.endAt&&r.endAt<=a)if(0===--o)throw new Error("Endless cycle detected.");a=r.endAt,s=r.offset}}}};t.default=o}(c,e,f);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),O=T;e["Types/_collection/IndexedEnumeratorMixin"]=true;var E=function(){var e={},t=function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:true});var n={"[Types/_collection/IndexedEnumeratorMixin]":true,_enumeratorIndexes:null,constructor:function(){this._enumeratorIndexes={},this._onCollectionChange=this._onCollectionChange.bind(this)},reIndex:function(e,t,n){switch(e){case a.default.ACTION_ADD:this._shiftIndex(t,n),this._addToIndex(t,n);break;case a.default.ACTION_REMOVE:this._removeFromIndex(t,n),this._shiftIndex(t+n,-n);break;case a.default.ACTION_REPLACE:this._replaceInIndex(t,n);break;default:this._resetIndex()}},getIndexByValue:function(e,t){var n=this._getIndexForPropertyValue(e,t);return n.length?n[0]:-1},getIndicesByValue:function(e,t){return this._getIndexForPropertyValue(e,t)},setObservableCollection:function(e){e.subscribe("onCollectionChange",this._onCollectionChange)},unsetObservableCollection:function(e){e.unsubscribe("onCollectionChange",this._onCollectionChange)},_getIndexForPropertyValue:function(e,t){var n=this._getIndex(e);return n&&n[t]||[]},_hasIndex:function(e){if(e)return Object.prototype.hasOwnProperty.call(this._enumeratorIndexes,e);return 0===Object.keys(this._enumeratorIndexes).length},_getIndex:function(e){if(e&&!this._hasIndex(e))this._createIndex(e);return this._enumeratorIndexes[e]},_resetIndex:function(){this._enumeratorIndexes={}},_deleteIndex:function(e){delete this._enumeratorIndexes[e]},_createIndex:function(e){var t={},n=0;this._enumeratorIndexes[e]=t,this.reset();while(this.moveNext())this._setToIndex(t,e,this.getCurrent(),n),n++},_addToIndex:function(e,t){var n,i=e+t,r;for(var o in this._enumeratorIndexes)if(this._enumeratorIndexes.hasOwnProperty(o)){n=this._enumeratorIndexes[o],r=0,this.reset();while(this.moveNext()){if(r>=e)this._setToIndex(n,o,this.getCurrent(),r);if(++r>=i)break}}},_removeFromIndex:function(e,t){var n,i,r,o;for(var a in this._enumeratorIndexes)if(this._enumeratorIndexes.hasOwnProperty(a))for(i in n=this._enumeratorIndexes[a])if(n.hasOwnProperty(i)){r=n[i];for(var s=0;s<t;s++)if((o=r.indexOf(e+s))>-1)r.splice(o,1)}},_replaceInIndex:function(e,t){this._removeFromIndex(e,t),this._addToIndex(e,t)},_shiftIndex:function(e,t){var n,i;for(var r in this._enumeratorIndexes)if(this._enumeratorIndexes.hasOwnProperty(r))for(var o in n=this._enumeratorIndexes[r])if(n.hasOwnProperty(o)){i=n[o];for(var a=0;a<i.length;a++)if(i[a]>=e)i[a]+=t}},_setToIndex:function(e,t,n,i){var r=o.object.getPropertyValue(n,t);if(void 0===r&&n instanceof Object&&"function"===typeof n.getContents)r=o.object.getPropertyValue(n.getContents(),t);if(!Object.prototype.hasOwnProperty.call(e,r))e[r]=[];e[r].push(i)},_onCollectionChange:function(e,t,n,i,r,o){switch(t){case a.default.ACTION_ADD:case a.default.ACTION_REPLACE:this.reIndex(t,i,n.length);break;case a.default.ACTION_REMOVE:this.reIndex(t,o,r.length);break;default:this.reIndex(t)}}};t.default=n}(c,e,a,f);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),A=E;e["Types/_collection/enumerator/Arraywise"]=true;var D=function(){var e={},t=function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:true});var a=function(i){function e(e){var t=i.call(this)||this,n=e;if(void 0===n)n=[];if(!(n instanceof Array))throw new Error("Argument items should be an instance of Array");return t._items=n,r.default.constructor.call(t),t}return n.__extends(e,i),e.prototype.getCurrent=function(){if(this._index<0)return;return this._resolver?this._resolver(this._index):this._items[this._index]},e.prototype.getCurrentIndex=function(){return this._index},e.prototype.moveNext=function(){if(1+this._index>=this._items.length)return false;this._index++;var e=this.getCurrent();if(this._filter&&!this._filter(e,this._index))return this.moveNext();return true},e.prototype.reset=function(){this._index=-1},e.prototype.setResolver=function(e){this._resolver=e},e.prototype.setFilter=function(e){this._filter=e},e}(o.mixin(Object,r.default));(t.default=a).prototype["[Types/_collection/enumerator/Arraywise]"]=true,a.prototype._items=null,a.prototype._index=-1,a.prototype._resolver=null,a.prototype._filter=null,i.register("Types/collection:enumerator.Arraywise",a,{instantiate:false})}(c,e,u,E,s,a);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/EventRaisingMixin"]=true;var R=function(){var e={},t=function(e,t,r){Object.defineProperty(t,"__esModule",{value:true});var n={"[Types/_entity/EventRaisingMixin]":true,_eventRaising:true,_sessionItemContentsGetter:"",_beforeRaiseOff:null,constructor:function(){this._publish("onEventRaisingChange")},setEventRaising:function(e,t){e=!!e,t=!!t;var n=this._eventRaising===e;if(t&&n)throw new Error("The events raising is already "+(e?"enabled":"disabled")+" with analize=true");if(t)if(e)this._eventRaising=e,this._finishUpdateSession(this._beforeRaiseOff),this._beforeRaiseOff=null;else this._beforeRaiseOff=this._startUpdateSession(),this._eventRaising=e;else this._eventRaising=e;if(!n)this._notify("onEventRaisingChange",e,t)},isEventRaising:function(){return this._eventRaising},_startUpdateSession:function(){if(!this._eventRaising)return null;return r.default.startSession(this,this._sessionItemContentsGetter)},_finishUpdateSession:function(e,t){if(!e)return;if(t=void 0===t?true:t,r.default.finishSession(e,this,this._sessionItemContentsGetter),t)this._analizeUpdateSession(e)},_analizeUpdateSession:function(n){var i=this;if(!n)return;r.default.analizeSession(n,this,function(e,t){i._notifyCollectionChange(e,t.newItems,t.newItemsIndex,t.oldItems,t.oldItemsIndex,n)})},_notifyCollectionChange:function(e,t,n,i,r){if(!this._isNeedNotifyCollectionChange())return;this._notify("onCollectionChange",e,t,n,i,r)},_extractPacksByList:function(e,t,n){for(var i=function(e,t){n(e.slice(),t),e.length=0},r=[],o,a,s=0;s<t.length;s++)o=t[s],r[a=e.getIndex(o)]=o;for(var l=[],u=0,c=r.length-1,f=0;f<=c;f++){if(!(o=r[f])){if(l.length)i(l,u);continue}if(!l.length)u=f;l.push(o)}if(l.length)i(l,u)},_isNeedNotifyCollectionChange:function(){return this._eventRaising&&this.hasEventHandlers("onCollectionChange")}};t.default=n}(c,e,T);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),$=R;e["Types/_collection/List"]=true;var P=function(){var e={},t=function(e,t,n,o,a,s,l,i,u,c){Object.defineProperty(t,"__esModule",{value:true});var r=function(r){function i(e){var t=this;if(e&&"items"in e&&!(e.items instanceof Array))throw new TypeError('Option "items" should be an instance of Array');t=r.call(this,e)||this,l.OptionsToPropertyMixin.call(t,e),l.SerializableMixin.constructor.call(t),l.ReadWriteMixin.constructor.call(t,e),t._$items=t._$items||[];for(var n=0,i=t._$items.length;n<i;n++)t._addChild(t._$items[n]);return t}return n.__extends(i,r),i.prototype.destroy=function(){this._$items=null,this._indexer=null,l.ReadWriteMixin.destroy.call(this),r.prototype.destroy.call(this)},i.prototype.getEnumerator=function(){return new a.default(this._$items)},i.prototype.each=function(e,t){for(var n=0,i=this.getCount();n<i;n++)e.call(t||this,this.at(n),n,this)},i.prototype.assign=function(e){for(var t=0,n=this._$items.length;t<n;t++)this._removeChild(this._$items[t]);for(var t=this._$items.length=0,n=(e=this._splice(e||[],0,o.default.ACTION_RESET)).length;t<n;t++)this._addChild(e[t]);this._childChanged(e)},i.prototype.append=function(e){for(var t=0,n=(e=this._splice(e,this.getCount(),o.default.ACTION_ADD)).length;t<n;t++)this._addChild(e[t]);this._childChanged(e)},i.prototype.prepend=function(e){for(var t=0,n=(e=this._splice(e,0,o.default.ACTION_ADD)).length;t<n;t++)this._addChild(e[t]);this._childChanged(e)},i.prototype.clear=function(){this._$items.length=0,this._reindex(),this._getMediator().clear(this),this._childChanged(),this._nextVersion()},i.prototype.add=function(e,t){if(void 0===t)t=this._$items.length,this._$items.push(e);else{if(0!==(t=t||0)&&!this._isValidIndex(t,true))throw new Error("Index is out of bounds");this._$items.splice(t,0,e)}this._addChild(e),this._childChanged(e),this._nextVersion(),this._reindex(o.default.ACTION_ADD,t,1)},i.prototype.at=function(e){return this._$items[e]},i.prototype.remove=function(e){var t=this.getIndex(e);if(-1!==t)return this.removeAt(t),this._childChanged(e),true;return false},i.prototype.removeAt=function(e){if(!this._isValidIndex(e))throw new Error("Index is out of bounds");this._removeChild(this._$items[e]);var t=this._$items.splice(e,1);return this._reindex(o.default.ACTION_REMOVE,e,1),this._childChanged(e),this._nextVersion(),t[0]},i.prototype.replace=function(e,t){if(!this._isValidIndex(t))throw new Error("Index is out of bounds");var n=this._$items[t];if(n===e)return;this._removeChild(n),this._$items[t]=e,this._addChild(e),this._reindex(o.default.ACTION_REPLACE,t,1),this._childChanged(e),this._nextVersion()},i.prototype.move=function(e,t){if(!this._isValidIndex(e))throw new Error('Argument "from" is out of bounds');if(!this._isValidIndex(t))throw new Error('Argument "to" is out of bounds');if(e===t)return;var n=this._$items.splice(e,1);if(this._$items.splice(t,0,n[0]),e<t)this._reindex(o.default.ACTION_REPLACE,e,1+t-e);else this._reindex(o.default.ACTION_REPLACE,t,1+e-t);this._childChanged(n[0]),this._nextVersion()},i.prototype.getIndex=function(e){return this._$items.indexOf(e)},i.prototype.getCount=function(){return this._$items.length},i.prototype.getIndexByValue=function(e,t){return this._getIndexer().getIndexByValue(e,t)},i.prototype.getIndicesByValue=function(e,t){return this._getIndexer().getIndicesByValue(e,t)},i.prototype.isEqual=function(e){if(e===this)return true;if(!e||!(e instanceof i))return false;if(this.getCount()!==e.getCount())return false;for(var t=0,n=this.getCount();t<n;t++)if(this.at(t)!==e.at(t))return false;return true},i.prototype._getSerializableState=function(e){return l.SerializableMixin.prototype._getSerializableState.call(this,e)},i.prototype._setSerializableState=function(e){var t=l.SerializableMixin.prototype._setSerializableState(e);return function(){t.call(this),this._clearIndexer()}},i.prototype._getIndexer=function(){return this._indexer||(this._indexer=new s.default(this._$items,function(e){return e.length},function(e,t){return e[t]},function(e,t){return u.object.getPropertyValue(e,t)}))},i.prototype._clearIndexer=function(){this._indexer=null},i.prototype._isValidIndex=function(e,t){var n=this.getCount();if(t)n++;return e>=0&&e<n},i.prototype._reindex=function(e,t,n){if(!this._indexer)return;var i=this._getIndexer();switch(e){case o.default.ACTION_ADD:i.shiftIndex(t,this.getCount()-t,n),i.updateIndex(t,n);break;case o.default.ACTION_REMOVE:i.removeFromIndex(t,n),i.shiftIndex(t+n,this.getCount()-t,-n);break;case o.default.ACTION_REPLACE:i.removeFromIndex(t,n),i.updateIndex(t,n);break;case o.default.ACTION_RESET:i.resetIndex();break;default:if(n>0)i.removeFromIndex(t,n),i.updateIndex(t,n);else i.resetIndex()}},i.prototype._splice=function(e,t,n){var i;return e=this._itemsToArray(e),(i=this._$items).splice.apply(i,[t,0].concat(e)),this._reindex(n,t,e.length),this._nextVersion(),e},i.prototype._itemsToArray=function(e){if(e instanceof Array)return e;else if(e&&e["[Types/_collection/IEnumerable]"]){var t=[];return e.each(function(e){t.push(e)}),t}else throw new TypeError('Argument "items" must be an instance of Array or implement Types/collection:IEnumerable.')},i.extend=function(e,t){return u.logger.error("Types/source:Base","Method extend is deprecated, use ES6 extends or Core/core-extend"),c(this,e,t)},i}(u.mixin(l.DestroyableMixin,l.OptionsToPropertyMixin,l.ObservableMixin,l.SerializableMixin,l.CloneableMixin,l.ManyToManyMixin,l.ReadWriteMixin,l.VersionableMixin));(t.default=r).prototype._moduleName="Types/collection:List",r.prototype["[Types/_collection/List]"]=true,r.prototype["[Types/_collection/IEnumerable]"]=true,r.prototype["[Types/_collection/IIndexedCollection]"]=true,r.prototype["[Types/_collection/IList]"]=true,r.prototype["[Types/_entity/ICloneable]"]=true,r.prototype["[Types/_entity/IEquatable]"]=true,r.prototype["[Types/_entity/IVersionable]"]=true,r.prototype._$items=null,r.prototype._indexer=null,r.prototype.forEach=r.prototype.each,r.prototype["[WS.Data/Collection/List]"]=true,r.prototype["[WS.Data/Collection/IEnumerable]"]=true,r.prototype["[WS.Data/Collection/IList]"]=true,r.prototype["[WS.Data/Collection/IIndexedCollection]"]=true,r.prototype["[WS.Data/Entity/ICloneable]"]=true,i.register("Types/collection:List",r,{instantiate:false})}(c,e,u,f,D,h,l,s,a,o);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),M=P;e["Types/_collection/enumerator"]=true;var F,N=function(){var e={},t=(n=c,i=e,r=D,o=_,a=d,Object.defineProperty(i,"__esModule",{value:true}),i.Arraywise=r.default,i.Mapwise=o.default,void(i.Objectwise=a.default)),n,i,r,o,a;if(t instanceof Function)return t;else for(var s in t)if(t.hasOwnProperty(s))e[s]=t[s];return e}();e["Types/_collection/Dictionary"]=true;var S=function(){var e={},t=function(e,t,i,r,o,a,n){Object.defineProperty(t,"__esModule",{value:true});var s=function(n){function s(e){var t=n.call(this)||this;return a.OptionsToPropertyMixin.call(t,e),a.ObservableMixin.call(t,e),t._$dictionary=t._$dictionary||[],t}return i.__extends(s,n),s.prototype.destroy=function(){a.ObservableMixin.prototype.destroy.call(this),n.prototype.destroy.call(this)},s.prototype.getDictionary=function(e){var t=e&&this._$localeDictionary?this._$localeDictionary:this._$dictionary;return t?Array.isArray(t)?t.slice():Object.assign({},t):t},s.prototype.each=function(e,t,n){t=t||this;var i=this.getEnumerator(n);while(i.moveNext())e.call(t,i.getCurrent(),i.getCurrentIndex())},s.prototype.getEnumerator=function(e){var t=e&&this._$localeDictionary?this._$localeDictionary:this._$dictionary,n=t instanceof Array?new r.default(t):new o.default(t);return n.setFilter(function(e,t){return"null"!==t}),n},s.prototype.isEqual=function(e){if(!(e instanceof s))return false;var t=this.getEnumerator(),n=e.getEnumerator(),i,r,o,a;do{if(r=t.moveNext(),a=n.moveNext(),(i=r?t.getCurrent():void 0)!==(o=a?n.getCurrent():void 0))return false;if(t.getCurrentIndex()!==n.getCurrentIndex())return false}while(r||a);return true},s.prototype._getIndex=function(e,t){var n=this.getEnumerator(t);while(n.moveNext())if(n.getCurrent()===e)return n.getCurrentIndex();return},s.prototype._getValue=function(e,t){return t&&this._$localeDictionary?this._$localeDictionary[e]:this._$dictionary[e]},s.prototype._getDictionaryByFormat=function(e){if(!e)return[];return(e.getDictionary?e.getDictionary():e.meta&&e.meta.dictionary)||[]},s.prototype._getLocaleDictionaryByFormat=function(e){if(!e)return;return(e.getLocaleDictionary?e.getLocaleDictionary():e.meta&&e.meta.localeDictionary)||void 0},s}(a.DestroyableMixin);t.default=s,n.applyMixins(s,a.OptionsToPropertyMixin,a.ObservableMixin),s.prototype["[Types/_collection/Dictionary]"]=true,s.prototype["[Types/_collection/IEnumerable]"]=true,s.prototype["[Types/_entity/IEquatable]"]=true,s.prototype._$dictionary=void 0,s.prototype._$localeDictionary=void 0,s.prototype._type=void 0,s.prototype["[WS.Data/Collection/IEnumerable]"]=true}(c,e,u,D,d,l,a);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/Flags"]=true;var k,j=function(){var e={},t=function(e,t,r,o,a,n,i){function s(e){return null===e||void 0===e?null:!!e}Object.defineProperty(t,"__esModule",{value:true});var l=function(n){function i(e){var t=n.call(this,e)||this;return a.SerializableMixin.constructor.call(t),t._publish("onChange"),t._$values=t._$values||[],t}return r.__extends(i,n),i.prototype.destroy=function(){a.ManyToManyMixin.destroy.call(this),n.prototype.destroy.call(this)},i.prototype.get=function(e,t){var n=this._getOrdinalIndex(e,t);if(void 0!==n)return s(this._$values[n]);return},i.prototype.set=function(e,t,n){var i=this._getOrdinalIndex(e,n);if(void 0===i)throw new ReferenceError(this._moduleName+'::set(): the value "'+e+"\" doesn't found in dictionary");if(t=s(t),this._$values[i]===t)return;this._$values[i]=t;var r=this._getIndex(e,n);this._notifyChange(e,r,t)},i.prototype.getByIndex=function(e){var t=this._getValue(e),n=this._getOrdinalIndex(t);return this._$values[n]},i.prototype.setByIndex=function(e,t){var n=this._getValue(e);if(void 0===n)throw new ReferenceError(this._moduleName+"::setByIndex(): the index "+e+" doesn't found in dictionary");var i=this._getOrdinalIndex(n);if(t=s(t),this._$values[i]===t)return;this._$values[i]=t,this._notifyChange(n,e,t)},i.prototype.setFalseAll=function(){this._setAll(false)},i.prototype.setTrueAll=function(){this._setAll(true)},i.prototype.setNullAll=function(){this._setAll(null)},i.prototype.isEqual=function(e){if(!(e instanceof i))return false;if(!o.default.prototype.isEqual.call(this,e))return false;var t=this.getEnumerator(),n;while(t.moveNext())if(n=t.getCurrent(),this.get(n)!==e.get(n))return false;return true},i.produceInstance=function(e,t){return new this({dictionary:this.prototype._getDictionaryByFormat(t&&t.format),localeDictionary:this.prototype._getLocaleDictionaryByFormat(t&&t.format),values:e})},i.prototype.toString=function(){return"["+this._$values.map(function(e){return null===e?"null":e}).join(",")+"]"},i.prototype._getOrdinalIndex=function(e,t){var n=this.getEnumerator(t),i=0;while(n.moveNext()){if(n.getCurrent()===e)return i;i++}return},i.prototype._setAll=function(e){var t=this._$dictionary,n=this._$values,i=this.getEnumerator(),r=0;while(i.moveNext()){if(n[r]!==e){n[r]=e;var o=i.getCurrentIndex();this._notifyChange(t[o],o,e)}r++}},i.prototype._notifyChange=function(e,t,n){var i={};i[String(e)]=n,this._childChanged(i),this._notify("onChange",e,t,n)},i}(o.default);t.default=l,i.applyMixins(l,a.ManyToManyMixin,a.SerializableMixin,a.CloneableMixin),l.prototype["[Types/_collection/Flags]"]=true,l.prototype["[Types/_collection/IFlags]"]=true,l.prototype["[Types/_entity/ICloneable]"]=true,l.prototype["[Types/_entity/IProducible]"]=true,l.prototype._moduleName="Types/collection:Flags",l.prototype._$values=void 0,l.prototype._type="flags",l.prototype["[WS.Data/Type/Flags]"]=true,l.prototype["[WS.Data/Entity/ICloneable]"]=true,n.register("Types/collection:Flags",l,{instantiate:false})}(c,e,u,S,l,s,a);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/Enum"]=true;var V,z=function(){var e={},t=function(e,t,i,r,o,n,a){Object.defineProperty(t,"__esModule",{value:true});var s=function(n){function t(e){var t=n.call(this,e)||this;return o.SerializableMixin.constructor.call(t),t._publish("onChange"),t._checkIndex(),t}return i.__extends(t,n),t.prototype.destroy=function(){o.ManyToManyMixin.destroy.call(this),n.prototype.destroy.call(this)},t.prototype.get=function(){return this._$index},t.prototype.set=function(e){var t,n=void 0!==this._$dictionary[e],i=this._$index!==e;if(null===e||n)this._$index=e,this._checkIndex();else throw new ReferenceError(this._moduleName+'::set(): the index "'+e+'" is out of range');if(i)this._notifyChange(this._$index,this.getAsValue())},t.prototype.getAsValue=function(e){return this._getValue(this._$index,e)},t.prototype.setByValue=function(e,t){var n=this._getIndex(e,t),i=n!==this._$index;if(null===e)this._$index=e;else if(void 0===n)throw new ReferenceError(this._moduleName+'::setByValue(): the value "'+e+"\" doesn't found in dictionary");else this._$index=n;if(i)this._notifyChange(n,e)},t.prototype.isEqual=function(e){if(!(e instanceof t))return false;if(!r.default.prototype.isEqual.call(this,e))return false;return this.get()===e.get()},t.produceInstance=function(e,t){return new this({dictionary:this.prototype._getDictionaryByFormat(t&&t.format),localeDictionary:this.prototype._getLocaleDictionaryByFormat(t&&t.format),index:e})},t.prototype.valueOf=function(){return this.get()},t.prototype.toString=function(){var e=this.getAsValue();return void 0===e||null===e?"":String(e)},t.prototype._checkIndex=function(){if(null===this._$index)return;this._$index=parseInt(String(this._$index),10)},t.prototype._notifyChange=function(e,t){var n={};n[e]=t,this._childChanged(n),this._notify("onChange",e,t)},t}(r.default);t.default=s,a.applyMixins(s,o.ManyToManyMixin,o.SerializableMixin,o.CloneableMixin),s.prototype["[Types/_collection/Enum]"]=true,s.prototype["[Types/_collection/IEnum]"]=true,s.prototype["[Types/_entity/ICloneable]"]=true,s.prototype["[Types/_entity/IProducible]"]=true,s.prototype._moduleName="Types/collection:Enum",s.prototype._$index=null,s.prototype._type="enum",s.prototype["[WS.Data/Type/Enum]"]=true,s.prototype["[WS.Data/Entity/ICloneable]"]=true,n.register("Types/collection:Enum",s,{instantiate:false})}(c,e,u,S,l,s,a);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/ObservableList"]=true;var L=function(){var e={},t=function(e,t,n,r,i,o,a,s){Object.defineProperty(t,"__esModule",{value:true});var l=Array.prototype.slice,u=function(i){function e(e){var t=i.call(this,e)||this;return o.default.constructor.call(t,e),t._publish("onCollectionChange","onCollectionItemChange"),t}return n.__extends(e,i),e.prototype.assign=function(e){var t=this._itemsSlice(),n=this._eventRaising;if(this._eventRaising=false,i.prototype.assign.call(this,e),this._eventRaising=n,t.length>0||this._$items.length>0)this._notifyCollectionChange(r.default.ACTION_RESET,this._itemsSlice(),0,t,0)},e.prototype.append=function(e){var t=this._eventRaising;this._eventRaising=false;var n=this.getCount();i.prototype.append.call(this,e),this._eventRaising=t,this._notifyCollectionChange(r.default.ACTION_ADD,this._itemsSlice(n),n,[],0)},e.prototype.prepend=function(e){var t=this._eventRaising;this._eventRaising=false;var n=this.getCount();i.prototype.prepend.call(this,e),this._eventRaising=t,this._notifyCollectionChange(r.default.ACTION_ADD,this._itemsSlice(0,this.getCount()-n),0,[],0)},e.prototype.clear=function(){var e=this._$items.slice(),t=this._eventRaising;this._eventRaising=false,i.prototype.clear.call(this),this._eventRaising=t,this._notifyCollectionChange(r.default.ACTION_RESET,this._itemsSlice(),0,e,0)},e.prototype.add=function(e,t){i.prototype.add.call(this,e,t),t=this._isValidIndex(t)?t:this.getCount()-1,this._notifyCollectionChange(r.default.ACTION_ADD,this._itemsSlice(t,t+1),t,[],0)},e.prototype.removeAt=function(e){var t=i.prototype.removeAt.call(this,e);return this._notifyCollectionChange(r.default.ACTION_REMOVE,[],0,[t],e),t},e.prototype.replace=function(e,t){var n=this._$items[t];if(i.prototype.replace.call(this,e,t),n!==e)this._notifyCollectionChange(r.default.ACTION_REPLACE,this._itemsSlice(t,t+1),t,[n],t)},e.prototype.move=function(e,t){var n=this._$items[e];if(i.prototype.move.call(this,e,t),e!==t)this._notifyCollectionChange(r.default.ACTION_MOVE,[n],t,[n],e)},e.prototype.relationChanged=function(e,t){var n=e.target,i=this.getIndex(n),r={},o;if(i>-1)this._reindex("",i,1);if(void 0===t[0])this._notifyItemChange(n,e.data||{});return{target:r[i]=n,data:r}},e.prototype.setEventRaising=function(e,t){var n=this;if(o.default.setEventRaising.call(this,e,t),e&&t&&this._silentChangedItems)if(this._silentChangedItems.length>=Math.min(this._resetChangesCount,this._$items.length))this._notifyCollectionChange(r.default.ACTION_RESET,this._itemsSlice(),0,[],0);else o.default._extractPacksByList(this,this._silentChangedItems,function(e,t){n._notifyCollectionChange(r.default.ACTION_CHANGE,e,t,e,t)});delete this._silentChangedItems},e.prototype._notifyItemChange=function(e,t){if(this._isNeedNotifyCollectionItemChange()){var n=this.getIndex(e);this._notify("onCollectionItemChange",this._$items[n],n,t)}if((this.hasEventHandlers("onCollectionItemChange")||this.hasEventHandlers("onCollectionChange"))&&!this._eventRaising){if(!this._silentChangedItems)this._silentChangedItems=[];this._silentChangedItems.push(e)}},e.prototype._itemsSlice=function(e,t){return l.apply(this._$items,arguments)},e.prototype._isNeedNotifyCollectionItemChange=function(){return this._eventRaising&&this.hasEventHandlers("onCollectionItemChange")},e}(s.mixin(i.default,r.default,o.default));(t.default=u).prototype["[Types/_collection/ObservableList]"]=true,u.prototype["[Types/_entity/relation/IReceiver]"]=true,u.prototype._moduleName="Types/collection:ObservableList",u.prototype._resetChangesCount=100,a.register("Types/collection:ObservableList",u,{instantiate:false})}(c,e,u,f,P,R,s,a);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}(),B=L;e["Types/_collection/factory/list"]=true;var q=function(){var e={},t=function(e,t,n){function i(e){if(!e||!e["[Types/_collection/IEnumerable]"])throw new TypeError('Argument "items" should implement Types/collection:IEnumerable');var t=[];return e.each(function(e){t.push(e)}),new n.default({items:t})}Object.defineProperty(t,"__esModule",{value:true}),t.default=i}(c,e,P);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/format/Format"]=true;var W=function(){var e={},t=function(e,t,n,o,i,r){Object.defineProperty(t,"__esModule",{value:true});var a=function(r){function i(e){for(var t=r.call(this,e)||this,n=0,i=t._$items.length;n<i;n++)t._checkItem(t._$items[n]),t._checkName(t._$items[n],n);return t}return n.__extends(i,r),i.prototype.add=function(e,t){this._checkItem(e),this._checkName(e),r.prototype.add.call(this,e,t)},i.prototype.remove=function(e){return this._checkItem(e),r.prototype.remove.call(this,e)},i.prototype.replace=function(e,t){this._checkItem(e),this._checkName(e,t),r.prototype.replace.call(this,e,t)},i.prototype.assign=function(e){for(var t=0,n=(e=this._itemsToArray(e)).length;t<n;t++)this._checkItem(e[t]);r.prototype.assign.call(this,e);for(var t=0,n=this._$items.length;t<n;t++)this._checkName(this._$items[t],t)},i.prototype.append=function(e){for(var t=0,n=(e=this._itemsToArray(e)).length;t<n;t++)this._checkItem(e[t]),this._checkName(e[t]);r.prototype.append.call(this,e)},i.prototype.prepend=function(e){for(var t=0,n=(e=this._itemsToArray(e)).length;t<n;t++)this._checkItem(e[t]),this._checkName(e[t]);r.prototype.prepend.call(this,e)},i.prototype.getCount=function(){return r.prototype.getCount.call(this)},i.prototype.at=function(e){return r.prototype.at.call(this,e)},i.prototype.getIndexByValue=function(e,t){return r.prototype.getIndexByValue.call(this,e,t)},i.prototype.removeAt=function(e){return r.prototype.removeAt.call(this,e)},i.prototype.isEqual=function(e){if(e===this)return true;if(!e)return false;if(!(e instanceof i))return false;if(this.getCount()!==e.getCount())return false;for(var t=0,n=this.getCount();t<n;t++)if(!this.at(t).isEqual(e.at(t)))return false;return true},i.prototype.removeField=function(e){var t=this.getIndexByValue("name",e);if(-1===t)throw new ReferenceError(this._moduleName+'::removeField(): field "'+e+"\" doesn't found");this.removeAt(t)},i.prototype.getFieldIndex=function(e){return this.getIndexByValue("name",e)},i.prototype.getFieldName=function(e){return this.at(e).getName()},i.prototype._checkItem=function(e){if(!e||!(e instanceof o.format.Field))throw new TypeError('Item should be an instance of "Types/entity:format.Field"')},i.prototype._checkName=function(e,t){var n=this.getFieldIndex(e.getName());if(n>-1&&n!==t)throw new ReferenceError(this._moduleName+': field with name "'+e.getName()+'" already exists')},i.prototype._itemsToArray=function(e){return r.prototype._itemsToArray.call(this,e)},i}(i.default);(t.default=a).prototype["[Types/_collection/format/Format]"]=true,a.prototype["[Types/_entity/IEquatable]"]=true,a.prototype._moduleName="Types/collection:format.Format",r.register("Types/collection:format.Format",a,{instantiate:false})}(c,e,u,l,P,s);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/factory"]=true;var H,G=function(){var e={},t=(n=c,i=e,r=q,o=p,Object.defineProperty(i,"__esModule",{value:true}),i.list=r.default,void(i.recordSet=o.default)),n,i,r,o;if(t instanceof Function)return t;else for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];return e}();e["Types/_collection/format/factory"]=true;var U=function(){var e={},t=function(e,t,i,r,n){function o(e){if(!e||!(e instanceof Array))throw new TypeError("Types/_collection/format/factory: declaration should be an instance of Array");for(var t=new i.default,n=0;n<e.length;n++)t.add(r.format.fieldsFactory(e[n]));return t}Object.defineProperty(t,"__esModule",{value:true}),t.default=o,n.register("Types/collection:format.factory",o,{instantiate:false})}(c,e,W,l,s);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();e["Types/_collection/format"]=true;var K,J=function(){var e={},t=(n=c,i=e,r=U,o=W,Object.defineProperty(i,"__esModule",{value:true}),i.factory=r.default,void(i.Format=o.default)),n,i,r,o;if(t instanceof Function)return t;else for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];return e}();e["Types/_collection/RecordSet"]=true;var Q,X=function(){var e={},t=function(e,t,n,i,r,o,l,u,c,f,h){Object.defineProperty(t,"__esModule",{value:true});var a="Types/entity:Model",p=u.Record.RecordState,s=false;function d(e,t){if(s&&t)if(e&&e["[Types/_entity/Record]"]&&null===e.get(t))f.logger.info("Types/Collection/RecordSet: Id propery must not be null");else if(e instanceof _)e.each(function(e){d(e,t)})}var _=function(a){function s(e){var t=this;if(e)if("items"in e)f.logger.stack('Types/Collection/RecordSet: option "items" give no effect, use "rawData" instead',1);if(t=a.call(this,e)||this,e)if("meta"in e)t._$metaData=e.meta;if(!t._$format&&t._$model&&"function"===typeof t._$model&&t._$model.prototype._$format)t._$format=t._$model.prototype._$format;if(u.FormattableMixin.constructor.call(t,e),!t._$idProperty)t._$idProperty=t._getAdapter().getKeyField(t._getRawData());if(t._$rawData)t._assignRawData(t._getRawData(true),true),t._initByRawData();return t._publish("onPropertyChange"),t}return n.__extends(s,a),s.prototype.destroy=function(){this._$model="",this._$metaData=null,this._metaData=null,a.prototype.destroy.call(this)},s.prototype.relationChanged=function(e,t){var n=this.getIndex(e.target);if(n>-1){var i,r=this._getRawDataAdapter().at(n),o=e.target.getRawData(true);if(r!==o)this._getRawDataAdapter().replace(o,n)}return a.prototype.relationChanged.call(this,e,t)},s.prototype.clone=function(e){var t=a.prototype.clone.call(this,e);if(e)t._$items=this._$items.slice();return t},s.produceInstance=function(e,t){var n={rawData:e};if(t){if(t.adapter)n.adapter=t.adapter;if(t.model)n.model=t.model}return new this(n)},s.prototype.isEqual=function(e){if(e===this)return true;if(!e)return false;if(!(e instanceof s))return false;return h(this._getRawData(),e.getRawData(true))},s.prototype.getEnumerator=function(t){var n=this,e=new o.default(this._$items);if(e.setResolver(function(e){return n.at(e)}),t)e.setFilter(function(e){return e.getState()===t});return e},s.prototype.each=function(e,t,n){if(t instanceof Object)n=t,t=void 0;n=n||this;for(var i=this.getCount(),r=0,o,a,s=0;s<i;s++){if(a=this.at(s),t)o=a.getState()===t;else o=true;if(o)e.call(n,a,r++,this)}},s.prototype.clear=function(){for(var e,t=0,n=this._$items.length;t<n;t++)if(e=this._$items[t])e.detach();this._getRawDataAdapter().clear(),a.prototype.clear.call(this)},s.prototype.add=function(e,t){return e=this._normalizeItems([e],p.ADDED)[0],this._getRawDataAdapter().add(e.getRawData(true),t),a.prototype.add.call(this,e,t),e},s.prototype.at=function(e){return this._getRecord(e)},s.prototype.remove=function(e){return this._checkItem(e),a.prototype.remove.call(this,e)},s.prototype.removeAt=function(e){this._getRawDataAdapter().remove(e);var t=this._$items[e],n=a.prototype.removeAt.call(this,e);if(t)t.detach();return n},s.prototype.replace=function(e,t){e=this._normalizeItems([e],p.CHANGED)[0],this._getRawDataAdapter().replace(e.getRawData(true),t);var n=this._$items[t];if(a.prototype.replace.call(this,e,t),n)n.detach();return e},s.prototype.move=function(e,t){this._getRecord(e),this._getRawDataAdapter().move(e,t),a.prototype.move.call(this,e,t)},s.prototype.assign=function(e){if(e===this)return[];var t=this._$items.slice(),n,i;if(e instanceof s)this._$adapter=e.getAdapter(),this._assignRawData(e.getRawData(),this._hasFormat()),n=new Array(e.getCount()),a.prototype.assign.call(this,n);else{if((e=this._itemsToArray(e)).length&&e[0]&&e[0]["[Types/_entity/Record]"])this._$adapter=e[0].getAdapter();e=this._normalizeItems(e,p.ADDED),this._assignRawData(null,this._hasFormat()),e=this._addItemsToRawData(e),a.prototype.assign.call(this,e),n=e}for(var r=0,o=t.length;r<o;r++)if(i=t[r])i.detach();return n},s.prototype.append=function(e){return e=this._itemsToArray(e),e=this._normalizeItems(e,p.ADDED),e=this._addItemsToRawData(e),a.prototype.append.call(this,e),e},s.prototype.prepend=function(e){return e=this._itemsToArray(e),e=this._normalizeItems(e,p.ADDED),e=this._addItemsToRawData(e,0),a.prototype.prepend.call(this,e),e},s.prototype._getIndexer=function(){var n=this,e;if(this._indexer)return this._indexer;if(this._$model===this._defaultModel){var i=this._getAdapter(),r=this._getRawDataAdapter();e=new l.default(this._getRawData(),function(){return r.getCount()},function(e,t){return r.at(t)},function(e,t){return i.forRecord(e).get(t)})}else e=new l.default(this._$items,function(e){return e.length},function(e,t){return n.at(t)},function(e,t){return e.get(t)});return this._indexer=e},s.prototype._itemsSlice=function(e,t){if(this._isNeedNotifyCollectionChange()){if(void 0===e)e=0;if(void 0===t)t=this._$items.length;for(var n=e;n<t;n++)this._getRecord(n)}return a.prototype._itemsSlice.call(this,e,t)},s.prototype._getSerializableState=function(e){return e=r.default.prototype._getSerializableState.call(this,e),(e=u.FormattableMixin._getSerializableState.call(this,e))._instanceId=this.getInstanceId(),delete e.$options.items,e},s.prototype._setSerializableState=function(e){var t=a.prototype._setSerializableState.call(this,e),n=u.FormattableMixin._setSerializableState(e);return function(){t.call(this),n.call(this),this._instanceId=e._instanceId}},s.prototype.setRawData=function(e){var t=this._$items.slice(),n=this._eventRaising;this._eventRaising=false,this.clear(),this._eventRaising=n,this._assignRawData(e),this._initByRawData(),this._notifyCollectionChange(i.default.ACTION_RESET,this._$items,0,t,0)},s.prototype.addField=function(e,t,n){if(e=this._buildField(e),u.FormattableMixin.addField.call(this,e,t),this._parentChanged(u.Record.prototype.addField),void 0!==n){var i=e.getName();this.each(function(e){e.set(i,n)})}this._nextVersion()},s.prototype.removeField=function(e){u.FormattableMixin.removeField.call(this,e),this._nextVersion(),this._parentChanged(u.Record.prototype.removeField)},s.prototype.removeFieldAt=function(e){u.FormattableMixin.removeFieldAt.call(this,e),this._nextVersion(),this._parentChanged(u.Record.prototype.removeFieldAt)},s.prototype._createRawDataAdapter=function(){return this._getAdapter().forTable(this._getRawData(true))},s.prototype._assignRawData=function(e,t){if(u.FormattableMixin.setRawData.call(this,e),this._clearIndexer(),!t)this._clearFormat();this._nextVersion()},s.prototype.getModel=function(){return this._$model},s.prototype.acceptChanges=function(e){var n=[];this.each(function(e,t){if(e.getState()===p.DELETED)n.push(t);e.acceptChanges()});for(var t=n.length-1;t>=0;t--)this.removeAt(n[t]);if(e)this._childChanged(u.Record.prototype.acceptChanges)},s.prototype.isChanged=function(){for(var e=false,t=this._$items,n=t.length,i=0;i<n;i++)if(t[i].isChanged()){e=true;break}return e},s.prototype.getIdProperty=function(){return this._$idProperty},s.prototype.setIdProperty=function(t){if(this._$idProperty===t)return;this._$idProperty=t,this.each(function(e){if(e.setIdProperty)e.setIdProperty(t)}),this._notify("onPropertyChange",{idProperty:this._$idProperty})},s.prototype.getRecordById=function(e){return this.at(this.getIndexByValue(this._$idProperty,e))},s.prototype.getMetaData=function(){var r=this;if(this._metaData)return this._metaData;var o=function(e,t){return u.factory.cast(e,t,{format:t,adapter:r._getAdapter(),idProperty:r._$idProperty})},a=this._$metaFormat?u.FormattableMixin._buildFormat(this._$metaFormat):null,s={};if(this._$metaData)if(this._$metaData instanceof Object&&Object.getPrototypeOf(this._$metaData)===Object.prototype)Object.keys(this._$metaData).forEach(function(e){var t=r._$metaData[e];if(a){var n=void 0,i=a.getFieldIndex(e);if(i>-1)n=a.at(i),t=o(t,n.getType())}s[e]=t});else s=this._$metaData;else{var l=this._getRawDataAdapter();if(l["[Types/_entity/adapter/IDecorator]"])l=l.getOriginal();if(l["[Types/_entity/adapter/IMetaData]"])l.getMetaDataDescriptor().forEach(function(e){var t=e.getName(),n=void 0;if(a){var i=a.getFieldIndex(t);if(i>-1)n=a.at(i)}s[t]=o(l.getMetaData(t),n?n.getType():r._getFieldType(e))})}return this._metaData=s,this._metaData},s.prototype.setMetaData=function(i){var r=this;if(this._metaData=this._$metaData=i,i instanceof Object){var o=this._getRawDataAdapter();if(o["[Types/_entity/adapter/IMetaData]"])o.getMetaDataDescriptor().forEach(function(e){var t=e.getName(),n=u.factory.serialize(i[t],{format:e,adapter:r.getAdapter()});o.setMetaData(t,n)})}this._notify("onPropertyChange",{metaData:i})},s.prototype.merge=function(e,t){if(t instanceof Object&&t.hasOwnProperty("merge")&&!t.hasOwnProperty("replace"))t.replace=t.merge;t=Object.assign({add:true,remove:true,replace:true,inject:false},t||{});var n=e.getCount(),i=this._$idProperty,r={},o={},a=[],s=[],l=[],u,c,f;this.each(function(e,t){r[e.get(i)]=t});for(var h=0;h<n;h++){if(c=(u=e.at(h)).get(i),0===h)this._checkItem(u);if(r.hasOwnProperty(c)){if(t.inject){if(f=r[c],!u.isEqual(this.at(f)))l.push([u,f])}else if(t.replace)if(f=r[c],!u.isEqual(this.at(f)))s.push([u,f])}else if(t.add)a.push(u);if(t.remove)o[c]=true}if(s.length)for(var h=0;h<s.length;h++)this.replace(s[h][0],s[h][1]);if(l.length)for(var h=0;h<l.length;h++)(u=this.at(l[h][1])).setRawData(l[h][0].getRawData());if(a.length)this.append(a);if(t.remove){var p=[];this.each(function(e,t){if(!o.hasOwnProperty(e.get(i)))p.push(t)});for(var h=p.length-1;h>=0;h--)this.removeAt(p[h])}},s.prototype._addItemsToRawData=function(e,t){for(var n=this._getRawDataAdapter(),i,r=0,o=(e=this._itemsToArray(e)).length;r<o;r++)i=e[r],n.add(i.getRawData(true),void 0===t?void 0:t+r);return e},s.prototype._normalizeItems=function(e,t){for(var n=this._hasFormat(),i,r=[],o,a,s=0;s<e.length;s++){if(a=e[s],this._checkItem(a),!n&&0===this.getCount())i=a.getFormat(true),this._clearFormat(),this._resetRawDataFields();else if(!i)i=this._getFormat(true);if(o=this._normalizeItemData(a,i),t)o.setState(t);r.push(o)}return r},s.prototype._normalizeItemData=function(e,t){var n=e.getFormat(true),i;if(t.isEqual(n))i=this._buildRecord(e.getRawData());else{var r=this.getAdapter().forRecord(null,this._getRawData()),o=e.getAdapter().forRecord(e.getRawData(true));t.each(function(e,t){var n=e.getName();r.addField(e,t),r.set(n,o.get(n))}),i=this._buildRecord(r.getData())}return i},s.prototype._checkItem=function(e){if(!e||!e["[Types/_entity/Record]"])throw new TypeError("Item should be an instance of Types/entity:Record");d(e,this.getIdProperty()),this._checkAdapterCompatibility(e.getAdapter())},s.prototype._buildRecord=function(e){var t;return c.create(this._$model,{owner:this,writable:this.writable,state:p.UNCHANGED,adapter:this.getAdapter(),rawData:e,idProperty:this._$idProperty})},s.prototype._getRecord=function(e){var t=this;if(e<0||e>=this._$items.length)return;var n=this._$items[e];if(!n){var i=this._getRawDataAdapter();n=this._$items[e]=this._buildRecord(function(){return i.at(n?t.getIndex(n):e)}),this._addChild(n),d(n,this.getIdProperty())}return n},s.prototype._initByRawData=function(){var e=this._getRawDataAdapter();this._$items.length=0,this._$items.length=e.getCount()},s.patch=function(n,e){e=e||["changed","added","removed"];var t=function(e){var t=new s({adapter:n.getAdapter(),idProperty:n.getIdProperty()});return n.each(function(e){t.add(e)},e),t},i=function(e){var t=[],n=e.getIdProperty();return e.each(function(e){t.push(e.get(n))}),t},r=new u.Record({format:[{name:e[0],type:"recordset"},{name:e[1],type:"recordset"},{name:e[2],type:"array",kind:"string"}],adapter:n.getAdapter()});return r.set(e[0],t(p.CHANGED)),r.set(e[1],t(p.ADDED)),r.set(e[2],i(t(p.DELETED))),r.acceptChanges(),r},s}(f.mixin(r.default,u.FormattableMixin,u.InstantiableMixin));(t.default=_).prototype["[Types/_collection/RecordSet]"]=true,_.prototype["[Types/_entity/IInstantiable]"]=true,_.prototype["[Types/_entity/IObservableObject]"]=true,_.prototype["[Types/_entity/IProducible]"]=true,_.prototype._moduleName="Types/collection:RecordSet",_.prototype._instancePrefix="recordset-",_.prototype._defaultModel=a,_.prototype._$model=a,_.prototype._$idProperty="",_.prototype._$metaData=null,_.prototype._$metaFormat=null,_.prototype._metaData=null,_.prototype.forEach=_.prototype.each,_.prototype["[WS.Data/Collection/RecordSet]"]=true,c.register("Types/collection:RecordSet",_,{instantiate:false})}(c,e,u,f,L,D,h,l,s,a,r);if(t instanceof Function)return t;else for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}();return e.enumerableComparator=O.default,e.Enum=z.default,e.enumerator=N,e.EventRaisingMixin=$.default,e.factory=G,e.format=J,e.Flags=j.default,e.IEnum=I.default,e.IFlags=C.default,e.IEnumerable=w.default,e.EnumeratorCallback=w.EnumeratorCallback,e.IEnumerator=g.default,e.IList=y.default,e.IndexedEnumeratorMixin=A.default,e.IObservable=t.default,e.List=M.default,e.ObservableList=B.default,e.RecordSet=X.default,e});