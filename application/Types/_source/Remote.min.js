define("Types/_source/Remote",["require","exports","tslib","Types/_source/Base","Types/_source/DataMixin","Types/_source/DataCrudMixin","Types/_source/BindingMixin","Types/_source/EndpointMixin","Types/_source/OptionsMixin","Types/entity","Types/di","Types/util","require"],function(e,t,i,r,u,n,o,a,s,d,p,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});var f,_=(0,eval)("this").DeferredCanceledError,y={PAGE:"Page",OFFSET:"Offset"};function h(e){return null===e||void 0===e}function g(e){return""===e||h(e)}function v(e){return[e]}function P(e,t){return[e,t]}function b(e,t){if(this._$options.updateOnlyChanged){var r=this._getValidIdProperty(e);if(!g(r))if(u.default.isModelInstance(e)&&!h(e.get(r))){var i=c("Types/entity").Record,n=e.getChanged();n.unshift(r),e=i.filterFields(e,n)}else if(u.default.isListInstance(e))o=e,s=new(0,c("Types/collection").RecordSet)({adapter:o._$adapter,idProperty:o._$idProperty}),o.each(function(e){if(h(e.get(r))||e.isChanged())s.add(e)}),e=s}var o,a,s;return[e,t]}function m(e,t){return[e,t]}function $(e){return[e]}function T(e,t){return[e,t]}function C(e,t){return[e,t]}function R(e,t,r){return[e,t,r]}var A=function(r){function e(e){var t=this;return t["[Types/_source/ICrud]"]=true,t["[Types/_source/ICrudPlus]"]=true,t["[Types/_source/IProvider]"]=true,o.default.constructor.call(t,e),a.default.constructor.call(t,e),t=r.call(this,e)||this,d.ObservableMixin.call(t,e),t._publish("onBeforeProviderCall"),t}return i.__extends(e,r),e.prototype.create=function(e){var t=this;return this._callProvider(this._$binding.create,this._$passing.create.call(this,e)).addCallback(function(e){return t._loadAdditionalDependencies().addCallback(function(){return t._prepareCreateResult(e)})})},e.prototype.read=function(e,t){var r=this;return this._callProvider(this._$binding.read,this._$passing.read.call(this,e,t)).addCallback(function(e){return r._loadAdditionalDependencies().addCallback(function(){return r._prepareReadResult(e)})})},e.prototype.update=function(t,e){var r=this;return this._callProvider(this._$binding.update,this._$passing.update.call(this,t,e)).addCallback(function(e){return r._prepareUpdateResult(t,e)})},e.prototype.destroy=function(e,t){return this._callProvider(this._$binding.destroy,this._$passing.destroy.call(this,e,t))},e.prototype.query=function(e){var t=this;return this._callProvider(this._$binding.query,this._$passing.query.call(this,e)).addCallback(function(e){return t._loadAdditionalDependencies().addCallback(function(){return t._prepareQueryResult(e)})})},e.prototype.merge=function(e,t){return this._callProvider(this._$binding.merge,this._$passing.merge.call(this,e,t))},e.prototype.copy=function(e,t){var r=this;return this._callProvider(this._$binding.copy,this._$passing.copy.call(this,e,t)).addCallback(function(e){return r._prepareReadResult(e)})},e.prototype.move=function(e,t,r){return this._callProvider(this._$binding.move,this._$passing.move.call(this,e,t,r))},e.prototype.getEndpoint=function(){return a.default.getEndpoint.call(this)},e.prototype.getProvider=function(){if(!this._provider)this._provider=this._createProvider(this._$provider,{endpoint:this._$endpoint,options:this._$options});return this._provider},e.prototype._createProvider=function(e,t){if(!e)throw new Error("Remote access provider is not defined");if("string"===typeof e)e=p.create(e,t);return e},e.prototype._callProvider=function(t,e){var r=this,i=this.getProvider(),n=this._notify("onBeforeProviderCall",t,e);if(void 0!==n)e=n;var o=i.call(t,this._prepareProviderArguments(e));if(this._$options.debug)o.addErrback(function(e){if(e instanceof _)l.logger.info(r._moduleName,'calling of remote service "'+t+'" has been cancelled.');else l.logger.error(r._moduleName,'remote service "'+t+'" throws an error "'+e.message+'".');return e});return o},e.prototype._prepareProviderArguments=function(e){return this.getAdapter().serialize(e)},e.prototype._getValidIdProperty=function(e){var t=this.getIdProperty();if(!g(t))return t;if("function"===typeof e.getIdProperty)return e.getIdProperty();return t},Object.defineProperty(e,"NAVIGATION_TYPE",{get:function(){return y},enumerable:true,configurable:true}),e}(l.mixin(r.default,d.ObservableMixin,n.default,o.default,a.default));(t.default=A).prototype["[Types/_source/Remote]"]=true,A.prototype._$provider=null,A.prototype._$passing={create:v,read:P,update:b,destroy:m,query:$,copy:T,merge:C,move:R},A.prototype._$options=s.default.addOptions(r.default,{updateOnlyChanged:false,navigationType:y.PAGE}),A.prototype._moduleName="Types/source:Remote",A.prototype._provider=null,A.prototype._prepareArgumentsForCall=A.prototype._prepareProviderArguments});