define("Types/_source/Remote",["require","exports","tslib","Types/_source/Base","Types/_source/DataMixin","Types/_source/DataCrudMixin","Types/_source/BindingMixin","Types/_source/EndpointMixin","Types/_source/OptionsMixin","Types/entity","Types/di","Types/util"],function(u,e,t,r,d,i,n,o,a,s,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:true});var c,f=(0,eval)("this").DeferredCanceledError,_={PAGE:"Page",OFFSET:"Offset"};function h(e){return null===e||void 0===e}function y(e){return""===e||h(e)}function g(e){return[e]}function v(e,t){return[e,t]}function P(e,t){if(this._$options.updateOnlyChanged){var r=this._getValidIdProperty(e);if(!y(r))if(d.default.isModelInstance(e)&&!h(e.get(r))){var i=u("Types/entity").Record,n=e.getChanged();n.unshift(r),e=i.filterFields(e,n)}else if(d.default.isListInstance(e))o=e,s=new(0,u("Types/collection").RecordSet)({adapter:o._$adapter,idProperty:o._$idProperty}),o.each(function(e){if(h(e.get(r))||e.isChanged())s.add(e)}),e=s}var o,a,s;return[e,t]}function b(e,t){return[e,t]}function m(e){return[e]}function $(e,t){return[e,t]}function T(e,t){return[e,t]}function C(e,t,r){return[e,t,r]}var R=function(r){function e(e){var t=this;return t["[Types/_source/ICrud]"]=true,t["[Types/_source/ICrudPlus]"]=true,t["[Types/_source/IProvider]"]=true,n.default.constructor.call(t,e),o.default.constructor.call(t,e),t=r.call(this,e)||this,s.ObservableMixin.call(t,e),t._publish("onBeforeProviderCall"),t}return t.__extends(e,r),e.prototype.create=function(e){var t=this;return this._callProvider(this._$binding.create,this._$passing.create.call(this,e)).addCallback(function(e){return t._loadAdditionalDependencies().addCallback(function(){return t._prepareCreateResult(e)})})},e.prototype.read=function(e,t){var r=this;return this._callProvider(this._$binding.read,this._$passing.read.call(this,e,t)).addCallback(function(e){return r._loadAdditionalDependencies().addCallback(function(){return r._prepareReadResult(e)})})},e.prototype.update=function(t,e){var r=this;return this._callProvider(this._$binding.update,this._$passing.update.call(this,t,e)).addCallback(function(e){return r._prepareUpdateResult(t,e)})},e.prototype.destroy=function(e,t){return this._callProvider(this._$binding.destroy,this._$passing.destroy.call(this,e,t))},e.prototype.query=function(e){var t=this;return this._callProvider(this._$binding.query,this._$passing.query.call(this,e)).addCallback(function(e){return t._loadAdditionalDependencies().addCallback(function(){return t._prepareQueryResult(e)})})},e.prototype.merge=function(e,t){return this._callProvider(this._$binding.merge,this._$passing.merge.call(this,e,t))},e.prototype.copy=function(e,t){var r=this;return this._callProvider(this._$binding.copy,this._$passing.copy.call(this,e,t)).addCallback(function(e){return r._prepareReadResult(e)})},e.prototype.move=function(e,t,r){return this._callProvider(this._$binding.move,this._$passing.move.call(this,e,t,r))},e.prototype.getEndpoint=function(){return o.default.getEndpoint.call(this)},e.prototype.getProvider=function(){if(!this._provider)this._provider=this._createProvider(this._$provider,{endpoint:this._$endpoint,options:this._$options});return this._provider},e.prototype._createProvider=function(e,t){if(!e)throw new Error("Remote access provider is not defined");if("string"===typeof e)e=l.create(e,t);return e},e.prototype._callProvider=function(t,e){var r=this,i=this.getProvider(),n=this._notify("onBeforeProviderCall",t,e);if(void 0!==n)e=n;var o=i.call(t,this._prepareProviderArguments(e));if(this._$options.debug)o.addErrback(function(e){if(e instanceof f)p.logger.info(r._moduleName,'calling of remote service "'+t+'" has been cancelled.');else p.logger.error(r._moduleName,'remote service "'+t+'" throws an error "'+e.message+'".');return e});return o},e.prototype._prepareProviderArguments=function(e){return this.getAdapter().serialize(e)},e.prototype._getValidIdProperty=function(e){var t=this.getIdProperty();if(!y(t))return t;if("function"===typeof e.getIdProperty)return e.getIdProperty();return t},Object.defineProperty(e,"NAVIGATION_TYPE",{get:function(){return _},enumerable:true,configurable:true}),e}(p.mixin(r.default,s.ObservableMixin,i.default,n.default,o.default));e.default=R,Object.assign(R.prototype,{"[Types/_source/Remote]":true,_moduleName:"Types/source:Remote",_provider:null,_$provider:null,_$passing:{create:g,read:v,update:P,destroy:b,query:m,copy:$,merge:T,move:C},_$options:a.default.addOptions(r.default,{updateOnlyChanged:false,navigationType:_.PAGE})}),R.prototype._prepareArgumentsForCall=R.prototype._prepareProviderArguments});