define("Types/_source/SbisService",["require","exports","tslib","Types/_source/Rpc","Types/_source/OptionsMixin","Types/_source/DataMixin","Types/_source/Query","Types/di","Types/util","Core/ParallelDeferred"],function(e,t,r,o,n,s,i,d,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});var v=Object.assign({POSITION:"Position"},o.default.NAVIGATION_TYPE),u=",",p=/^[0-9]+,[А-яA-z0-9]+$/;function l(e){if((e=String(e||"")).match(p))return e.split(u)[0];return e}function f(e,t){if((e=String(e||"")).match(p))return e.split(u)[1];return t}function h(e,t){if((e=String(e||"")).match(p))return e.split(u,2);return[e,t]}function y(e,t){for(var r={},n,i=0,o=e.length;i<o;i++)r[n=f(e[i],t)]=r[n]||[],r[n].push(l(e[i]));return r}function _(e,t,r,n){return e._callProvider(e._$endpoint.contract===r?e._$binding.destroy:r+"."+e._$binding.destroy,e._$passing.destroy.call(e,t,n))}function g(e,t){var r;return d.resolve("Types/entity:Record").fromObject(e,t)}function b(e,t,r){if(null===e)return e;if(e&&s.default.isListInstance(e))return e;for(var n,i=new(d.resolve("Types/collection:RecordSet"))({adapter:t,idProperty:r}),o=e.length||0,a=0;a<o;a++)i.add(g(e[a],t));return i}function m(e){if(!e)return null;var t=e.getOrderBy();if(0===t.length)return null;for(var r=[],n,i=0;i<t.length;i++)n=t[i],r.push({n:n.getSelector(),o:n.getOrder(),l:!n.getOrder()});return r}function $(e,t,r){if(!e)return null;var n=e.getOffset(),i=e.getLimit(),o=e.getMeta(),a=t.hasMoreProperty,s=o.hasOwnProperty(a),d=s?o[a]:n>=0,c=0===n,u=void 0===i||null===i;if(s)delete o[a],e.meta(o);var p=null;switch(t.navigationType){case v.PAGE:if(!c||!u)p={"Страница":i>0?Math.floor(n/i):0,"РазмерСтраницы":i,"ЕстьЕще":d};break;case v.POSITION:if(!u){var l=e.getWhere(),f=/(.+)([<>]=|~)$/,h=null,y="",_;Object.keys(l).forEach(function(e){if(_=e.match(f)){if(!h)h={};if(h[_[1]]=l[e],!y)switch(_[2]){case"~":y="both";break;case"<=":y="before"}delete l[e]}}),p={HaveMore:d,Limit:i,Order:y=y||"after",Position:g(h,r)}}break;default:if(!c||!u)p={Offset:n||0,Limit:i,HaveMore:d}}return p}function P(e){var t=null;if(e){t=e.getWhere();var r=e.getMeta();if(r)switch(r.expand){case i.ExpandMode.None:t["Разворот"]="Без разворота";break;case i.ExpandMode.Nodes:t["Разворот"]="С разворотом",t["ВидДерева"]="Только узлы";break;case i.ExpandMode.Leaves:t["Разворот"]="С разворотом",t["ВидДерева"]="Только листья";break;case i.ExpandMode.All:t["Разворот"]="С разворотом",t["ВидДерева"]="Узлы и листья"}}return t}function O(e){var t=[];if(e){if((t=e.getMeta())&&s.default.isModelInstance(t)){var r={};t.each(function(e,t){r[e]=t}),t=r}if(t instanceof Object){var n=[];for(var i in t)if(t.hasOwnProperty(i))n.push(t[i]);t=n}if(!(t instanceof Array))throw new TypeError("Types/_source/SbisService::getAdditionalParams(): unsupported metadata type: only Array, Types/_entity/Record or Object allowed")}return t}function T(e){if(!s.default.isModelInstance(e))if(!("ВызовИзБраузера"in(e=Object.assign({},e||{}))))e["ВызовИзБраузера"]=true;return{"Фильтр":g(e,this._$adapter),"ИмяМетода":this._$binding.format||null}}function j(e,t){var r={"ИдО":e,"ИмяМетода":this._$binding.format||null};if(t&&Object.keys(t).length)r["ДопПоля"]=t;return r}function M(e,t){var r=o.default.prototype["_$passing"].update.call(this,e,t),n={},i;if(n[s.default.isListInstance(r[0])?"Записи":"Запись"]=r[0],r[1]&&Object.keys(r[1]).length)n["ДопПоля"]=r[1];return n}function S(e,t){var r,n=d.resolve("Types/collection:RecordSet").patch(e);return{changed:n.get("changed"),added:n.get("added"),removed:n.get("removed")}}function A(e,t){var r={"ИдО":e};if(t&&Object.keys(t).length)r["ДопПоля"]=t;return r}function I(e){var t=$(e,this._$options,this._$adapter),r=P(e),n=m(e),i=O(e);return{"Фильтр":g(r,this._$adapter),"Сортировка":b(n,this._$adapter,this.getIdProperty()),"Навигация":g(t,this._$adapter),"ДопПоля":i}}function N(e,t){var r={"ИдО":e,"ИмяМетода":this._$binding.format};if(t&&Object.keys(t).length)r["ДопПоля"]=t;return r}function k(e,t){return{"ИдО":e,"ИдОУд":t}}function w(e,t,r){return{IndexNumber:this._$orderProperty,HierarchyName:r.parentProperty||null,ObjectName:r.objectName,ObjectId:e,DestinationId:t,Order:r.position,ReadMethod:r.objectName+"."+this._$binding.read,UpdateMethod:r.objectName+"."+this._$binding.update}}function x(e,t,r,n){a.logger.info(e._moduleName,"Move elements through moveAfter and moveBefore methods have been deprecated, please use just move instead."),t=t;var i=n.before?e._$binding.moveBefore:e._$binding.moveAfter,o={"ПорядковыйНомер":e._$orderProperty,"Иерархия":n.hierField||null,"Объект":e._$endpoint.moveContract,"ИдО":h(t,e._$endpoint.contract)};return o[n.before?"ИдОДо":"ИдОПосле"]=h(r,e._$endpoint.contract),e._callProvider(e._$endpoint.moveContract+"."+i,o)}t.buildRecord=g,t.buildRecordSet=b,t.getSortingParams=m,t.getPagingParams=$,t.getAdditionalParams=O;var D=function(i){function e(e){var t=i.call(this,e)||this;if(!t._$endpoint.moveContract)t._$endpoint.moveContract="IndexNumber";return t}return r.__extends(e,i),e.prototype.getOrderProperty=function(){return this._$orderProperty},e.prototype.setOrderProperty=function(e){this._$orderProperty=e},e.prototype.create=function(t){var r=this;return t=a.object.clonePlain(t,true),this._loadAdditionalDependencies(function(e){r._connectAdditionalDependencies(i.prototype.create.call(r,t),e)})},e.prototype.update=function(t,r){var n=this;if(this._$binding.updateBatch&&s.default.isListInstance(t))return this._loadAdditionalDependencies(function(e){n._connectAdditionalDependencies(n._callProvider(n._$binding.updateBatch,S(t,r)).addCallback(function(e){return n._prepareUpdateResult(t,e)}),e)});return i.prototype.update.call(this,t,r)},e.prototype.destroy=function(e,t){if(!(e instanceof Array))return _(this,[l(e)],f(e,this._$endpoint.contract),t);var r=y(e,this._$endpoint.contract),n=new c;for(var i in r)if(r.hasOwnProperty(i))n.push(_(this,r[i],i,t));return n.done().getResult()},e.prototype.query=function(t){var r=this;return t=a.object.clonePlain(t,true),this._loadAdditionalDependencies(function(e){r._connectAdditionalDependencies(i.prototype.query.call(r,t),e)})},e.prototype.move=function(e,t,r){if(r=r||{},this._$binding.moveBefore)return x(this,e,t,r);var n=y(e,this._$endpoint.contract),i=Object.keys(n).length,o=new c;if(null!==t)t=l(t);for(var a in n)if(n.hasOwnProperty(a)){r.objectName=a;var s=this._callProvider(this._$binding.move.indexOf(".")>-1?this._$binding.move:this._$endpoint.moveContract+"."+this._$binding.move,this._$passing.move.call(this,n[a],t,r));if(1===i)return s;o.push(s)}return o.done().getResult()},e.prototype.getProvider=function(){if(!this._provider)this._provider=this._createProvider(this._$provider,{endpoint:this._$endpoint,options:this._$options,service:this._$endpoint.address,resource:this._$endpoint.contract});return this._provider},Object.defineProperty(e,"NAVIGATION_TYPE",{get:function(){return v},enumerable:true,configurable:true}),e}(o.default);(t.default=D).prototype["[Types/_source/SbisService]"]=true,D.prototype._moduleName="Types/source:SbisService",D.prototype._$binding={create:"Создать",read:"Прочитать",update:"Записать",updateBatch:"",destroy:"Удалить",query:"Список",copy:"Копировать",merge:"Объединить",move:"Move",format:""},D.prototype._$passing={create:T,read:j,update:M,destroy:A,query:I,copy:N,merge:k,move:w},D.prototype._$adapter="Types/entity:adapter.Sbis",D.prototype._$provider="Types/source:provider.SbisBusinessLogic",D.prototype._$orderProperty="ПорНомер",D.prototype._$options=n.default.addOptions(o.default,{hasMoreProperty:"hasMore"}),D.prototype._additionalDependencies=o.default.prototype._additionalDependencies.slice(),d.register("Types/source:SbisService",D,{instantiate:false})});