define("Types/display",["Types/function","Types/shim","Types/collection","Types/util","Types/di","Types/entity","tslib","require","exports"],function(i,n,o,s,a,u,l,_,t){Object.defineProperty(t,"__esModule",{value:true}),t["Types/_display/IBind"]=true;var p=function(){"use strict";var t={},e=function(t,e,r){Object.defineProperty(e,"__esModule",{value:true});var i={"[Types/_display/IBind]":true,ACTION_ADD:r.IObservable.ACTION_ADD,ACTION_REMOVE:r.IObservable.ACTION_REMOVE,ACTION_CHANGE:r.IObservable.ACTION_CHANGE,ACTION_REPLACE:r.IObservable.ACTION_REPLACE,ACTION_MOVE:r.IObservable.ACTION_MOVE,ACTION_RESET:r.IObservable.ACTION_RESET};e.default=i}(_,t,o);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/Abstract"]=true;var c=function(){"use strict";var t={},e=function(t,e,i,n,o,r){Object.defineProperty(e,"__esModule",{value:true});var s=[],a=[],u=[],l=function(r){function t(t){var e=r.call(this,t)||this;return n.OptionsToPropertyMixin.call(e,t),n.ObservableMixin.call(e,t),e}return i.__extends(t,r),t.prototype.destroy=function(){n.DestroyableMixin.prototype.destroy.call(this),n.ObservableMixin.prototype.destroy.call(this)},t.getDefaultDisplay=function(t,e,r){if(2===arguments.length&&"object"!==typeof e)r=e,e={};var i=r?s.indexOf(t):-1;if(-1===i){var n=void 0;if(((e=e||{}).collection=t)&&t["[Types/_collection/IEnum]"])n=o.create("Types/display:Enum",e);else if(t&&t["[Types/_collection/IFlags]"])n=o.create("Types/display:Flags",e);else if(t&&t["[Types/_collection/IEnumerable]"])n=o.create("Types/display:Collection",e);else if(t instanceof Array)n=o.create("Types/display:Collection",e);else throw new TypeError('Argument "collection" should implement Types/_collection/IEnumerable or be an \' +\n               \'instance of Array, but "'+t+'" given.');if(r)s.push(t),a.push(n),u.push(1);return n}else return u[i]++,a[i]},t.releaseDefaultDisplay=function(t){var e=a.indexOf(t);if(-1===e)return false;if(u[e]--,0===u[e])a[e].destroy(),u.splice(e,1),a.splice(e,1),s.splice(e,1);return true},t}(r.mixin(n.DestroyableMixin,n.OptionsToPropertyMixin,n.ObservableMixin));(e.default=l).prototype["[Types/_display/Abstract]"]=true,l.prototype["[WS.Data/Display/Display]"]=true}(_,t,l,u,a,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),e=c;t["Types/_display/CollectionItem"]=true;var h=function(){"use strict";var t={},e=function(t,e,i,n,r,o){Object.defineProperty(e,"__esModule",{value:true});var s=function(r){function t(t){var e=r.call(this)||this;return n.OptionsToPropertyMixin.call(e,t),n.SerializableMixin.constructor.call(e),e}return i.__extends(t,r),t.prototype.getOwner=function(){return this._$owner},t.prototype.setOwner=function(t){this._$owner=t},t.prototype.getContents=function(){if(void 0!==this._contentsIndex)this._$contents=this.getOwner().getCollection().at(this._contentsIndex),this._contentsIndex=void 0;return this._$contents},t.prototype.setContents=function(t,e){if(this._$contents===t)return;if(this._$contents=t,!e)this._notifyItemChangeToOwner("contents")},t.prototype.getUid=function(){if(!this._$owner)return;return this._$owner.getItemUid(this)},t.prototype.isSelected=function(){return this._$selected},t.prototype.setSelected=function(t,e){if(this._$selected===t)return;if(this._$selected=t,!e)this._notifyItemChangeToOwner("selected")},t.prototype._getSerializableState=function(t){if((t=n.SerializableMixin.prototype._getSerializableState.call(this,t)).$options.owner){var e=t.$options.owner.getCollection(),r=e["[Types/_collection/IList]"]?e.getIndex(t.$options.contents):-1;if(r>-1)t.ci=r,delete t.$options.contents}return t.iid=this.getInstanceId(),t},t.prototype._setSerializableState=function(t){var e=n.SerializableMixin.prototype._setSerializableState(t);return function(){if(e.call(this),t.hasOwnProperty("ci"))this._contentsIndex=t.ci;this._instanceId=t.iid}},t.prototype._getSourceCollection=function(){return this.getOwner().getCollection()},t.prototype._notifyItemChangeToOwner=function(t){if(this._$owner)this._$owner.notifyItemChange(this,t)},t}(o.mixin(n.DestroyableMixin,n.OptionsToPropertyMixin,n.InstantiableMixin,n.SerializableMixin));e.default=s,Object.assign(s.prototype,{"[Types/_display/CollectionItem]":true,_moduleName:"Types/display:CollectionItem",_$owner:null,_$contents:null,_$selected:false,_instancePrefix:"collection-item-",_contentsIndex:void 0}),s.prototype["[WS.Data/Display/CollectionItem]"]=true,r.register("Types/display:CollectionItem",s)}(_,t,l,u,a,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),r=h;t["Types/_display/itemsStrategy/Root"]=true;var y=function(){"use strict";var t={},e=function(t,e,i,n,r){Object.defineProperty(e,"__esModule",{value:true});var o=function(r){function t(t){var e=r.call(this)||this;return e["[Types/_display/IItemsStrategy]"]=true,e._options=t,e}return i.__extends(t,r),Object.defineProperty(t.prototype,"root",{get:function(){return this._options.root()},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"source",{get:function(){return this._options.source},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"options",{get:function(){return this.source.options},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){return this.source.count+1},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){return[this.root].concat(this.source.items)},enumerable:true,configurable:true}),t.prototype.at=function(t){if(0===t)return this.root;else return this.source.at(t-1)},t.prototype.splice=function(t,e,r){return this.source.splice(t,e,r)},t.prototype.reset=function(){return this.source.reset()},t.prototype.invalidate=function(){return this.source.invalidate()},t.prototype.getDisplayIndex=function(t){if(isNaN(parseInt(String(t),10)))return-1;return-1===(t=this.source.getDisplayIndex(t))?t:1+t},t.prototype.getCollectionIndex=function(t){return this.source.getCollectionIndex(t-1)},t.prototype._getSerializableState=function(t){return(t=n.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t},t.prototype._setSerializableState=function(t){var e=n.SerializableMixin.prototype._setSerializableState(t);return function(){e.call(this)}},t}(r.mixin(n.DestroyableMixin,n.SerializableMixin));(e.default=o).prototype._moduleName="Types/display:itemsStrategy.Root",o.prototype["[Types/_display/itemsStrategy/Root]"]=true}(_,t,l,u,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/itemsStrategy/AbstractStrategy"]=true;var d=function(){"use strict";var t={},e=function(t,e,i,n,r){Object.defineProperty(e,"__esModule",{value:true});var o=function(r){function t(t){var e=r.call(this)||this;return e["[Types/_display/IItemsStrategy]"]=true,e._options=t,e}return i.__extends(t,r),Object.defineProperty(t.prototype,"options",{get:function(){return Object.assign({},this._options)},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"source",{get:function(){return null},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){throw new Error("Property must be implemented")},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){return this._getItems()},enumerable:true,configurable:true}),t.prototype.at=function(t){throw new Error("Method must be implemented")},t.prototype.splice=function(t,e,r){throw new Error("Method must be implemented")},t.prototype.reset=function(){this._items=null,this._sourceItems=null},t.prototype.invalidate=function(){},t.prototype.getDisplayIndex=function(t){return t},t.prototype.getCollectionIndex=function(t){return t},t.prototype._getSerializableState=function(t){return(t=n.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t._items=this._items,t},t.prototype._setSerializableState=function(t){var e=n.SerializableMixin.prototype._setSerializableState(t);return function(){e.call(this),this._items=t._items}},t.prototype._getCollection=function(){return this._options.display.getCollection()},t.prototype._getCollectionEnumerator=function(){return this._getCollection().getEnumerator(this._options.localize)},t.prototype._getItems=function(){if(!this._items)this._initItems();return this._items},t.prototype._initItems=function(){this._items=this._items||[],this._items.length=this._options.display.getCollectionCount()},t.prototype._getSourceItems=function(){if(this._sourceItems)return this._sourceItems;var t=this._getCollectionEnumerator(),e=[];t.reset();while(t.moveNext())e.push(t.getCurrent());return this._sourceItems=e},t.prototype._createItem=function(t){return this.options.display.createItem({contents:t})},t}(r.mixin(n.DestroyableMixin,n.SerializableMixin));e.default=o,Object.assign(o.prototype,{"[Types/_display/itemsStrategy/DestroyableMixin]":true,_moduleName:"Types/display:itemsStrategy.DestroyableMixin",_items:null,_sourceItems:null})}(_,t,l,u,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/itemsStrategy/Composer"]=true;var g=function(){"use strict";var t={},e=function(t,e,o,r,i){Object.defineProperty(e,"__esModule",{value:true});var n=function(e){function t(){var t=e.call(this)||this;return t._modules=[],t._options=[],t}return o.__extends(t,e),t.prototype.destroy=function(){this._modules=null,this._options=null,this._result=null,e.prototype.destroy.call(this)},t.prototype.append=function(t,e,r){var i=this._modules.indexOf(r);if(-1===i)i=this._modules.length;else i++;return this._modules.splice(i,0,t),this._options.splice(i,0,e),this._reBuild(i,true),this},t.prototype.prepend=function(t,e,r){var i=this._modules.indexOf(r);if(-1===i)i=0;return this._modules.splice(i,0,t),this._options.splice(i,0,e),this._reBuild(i,true),this},t.prototype.remove=function(t){var e=this._modules.indexOf(t);if(-1===e)return;var r=this._getInstance(e);return this._modules.splice(e,1),this._options.splice(e,1),this._reBuild(e),r},t.prototype.reset=function(){return this._modules.length=0,this._options.length=0,this._result=null,this},t.prototype.getInstance=function(t){var e=this._modules.indexOf(t);if(-1===e)return;return this._getInstance(e)},t.prototype.getResult=function(){return this._result},t.prototype._getSerializableState=function(t){return(t=r.SerializableMixin.prototype._getSerializableState.call(this,t)).$options={},t._modules=this._modules,t._options=this._options,t._result=this._result,t},t.prototype._setSerializableState=function(t){var e=r.SerializableMixin.prototype._setSerializableState(t);return function(){e.call(this),this._modules=t._modules,this._options=t._options,this._result=t._result}},t.prototype._reBuild=function(t,e){var i=this,n=function(t,e,r){var i=o.__assign({},r||{});if(t)i.source=t;return new e(i)};if(this._result&&t===this._modules.length+(e?-1:0)){if(e)this._result=n(this._result,this._modules[t],this._options[t]);else this._result=this._result.source;return}this._result=this._modules.reduce(function(t,e,r){return n(t,e,i._options[r])},null)},t.prototype._getInstance=function(t){var e=this._modules.length-t-1,r=0,i=this._result;while(e>r)i=i.source,r++;return i},t}(i.mixin(r.DestroyableMixin,r.SerializableMixin));e.default=n,Object.assign(n.prototype,{"[Types/_display/itemsStrategy/Composer]":true,_moduleName:"Types/display:itemsStrategy.Composer",_result:null})}(_,t,l,u,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/CollectionEnumerator"]=true;var f=function(){"use strict";var t={},e=function(t,e,i,n,o,r){Object.defineProperty(e,"__esModule",{value:true});var s=function(r){function t(t){var e=r.call(this)||this;if(e["[Types/_collection/IEnumerator]"]=true,e._$items=[],e._$filterMap=[],e._$sortMap=[],e._sourceToInternal=[],n.OptionsToPropertyMixin.call(e,t),o.IndexedEnumeratorMixin.constructor.call(e),!(e._$items instanceof Array)&&!(e._$items instanceof Function))throw new TypeError(e._moduleName+"::constructor(): items should be instance of an Array or Function");if(!(e._$filterMap instanceof Array))throw new TypeError(e._moduleName+"::constructor(): filter map should be instance of an Array");if(!(e._$sortMap instanceof Array))throw new TypeError(e._moduleName+"::constructor(): sort map should be instance of an Array");return e}return i.__extends(t,r),Object.defineProperty(t.prototype,"items",{get:function(){if(!this._itemsCache)this._itemsCache=this._$items instanceof Function?this._$items():this._$items;return this._itemsCache},enumerable:true,configurable:true}),t.getAssociativeMap=function(t,e){for(var r=[],i,n=0;n<t.length;n++)if(e[i=t[n]])r.push(i);return r},t.prototype.getCurrent=function(){return this._current},t.prototype.getCurrentIndex=function(){return this._position},t.prototype.reset=function(){this._itemsCache=null,this._position=-1,this._setCurrentByPosition()},t.prototype.reIndex=function(t,e,r){if(o.IndexedEnumeratorMixin.reIndex.call(this,t,e,r),this._itemsCache=null,this._internalToSource=null,this._sourceToInternal=[],this._position=-1,this._current)this._setPositionByCurrent()},t.prototype._createIndex=function(t){var e=this._position,r=this._current;o.IndexedEnumeratorMixin._createIndex.call(this,t),this._position=e,this._current=r},t.prototype.at=function(t){return void 0===t?void 0:this.items[this.getSourceByInternal(t)]},t.prototype.getCount=function(){return this._initInternalMap(),this._internalToSource.length},t.prototype.setCurrent=function(t){this._itemsCache=null,this._position=this.getInternalBySource(this.items.indexOf(t)),this._setCurrentByPosition()},t.prototype.getPosition=function(){return this._position},t.prototype.setPosition=function(t){this._itemsCache=null,this._checkPosition(t),this._position=t,this._setCurrentByPosition()},t.prototype.isValidPosition=function(t){return t>=-1&&t<this.getCount()},t.prototype.movePrevious=function(){if(this._position<1)return false;return this._position--,this._setCurrentByPosition(),true},t.prototype.moveNext=function(){if(this._position>=this.getCount()-1)return false;return this._position++,this._setCurrentByPosition(),true},t.prototype.getInternalBySource=function(t){if(void 0===t||null===t||-1===t)return t;if(this._initInternalMap(),void 0===this._sourceToInternal[t])this._sourceToInternal[t]=this._internalToSource.indexOf(t);return this._sourceToInternal[t]},t.prototype.getSourceByInternal=function(t){if(void 0===t||null===t||-1===t)return t;return this._initInternalMap(),this._internalToSource[t]},t.prototype._initInternalMap=function(){if(null===this._internalToSource)this._internalToSource=t.getAssociativeMap(this._$sortMap,this._$filterMap)},t.prototype._checkPosition=function(t){if(!this.isValidPosition(t))throw new Error(this._moduleName+": position is out of bounds")},t.prototype._setCurrentByPosition=function(){this._current=this._position>-1?this.items[this.getSourceByInternal(this._position)]:void 0},t.prototype._setPositionByCurrent=function(){this._position=-1;var t=this._current?this.items.indexOf(this._current):-1;if(t>-1&&this._$filterMap[t])this._position=this.getInternalBySource(t);else this._current=void 0},t}(r.mixin(n.DestroyableMixin,n.OptionsToPropertyMixin,o.IndexedEnumeratorMixin));e.default=s,Object.assign(s.prototype,{"[Types/_display/CollectionEnumerator]":true,_$items:null,_$filterMap:null,_$sortMap:null,_itemsCache:null,_position:-1,_current:void 0,_internalToSource:null,_sourceToInternal:null})}(_,t,l,u,o,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/BreadcrumbsItem"]=true;var m=function(){"use strict";var t={},e=function(t,e,r,i,n){Object.defineProperty(e,"__esModule",{value:true});var o=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype.getContents=function(){var t=this._$owner?this._$owner.getRoot():{},e=this._$last,r=[];while(e)if(r.unshift(e.getContents()),(e=e.getParent())===t)break;return r},t.prototype.setContents=function(){throw new ReferenceError("BreadcrumbsItem contents is read only.")},t}(i.default);e.default=o,Object.assign(o.prototype,{"[Types/_display/BreadcrumbsItem]":true,_moduleName:"Types/display:BreadcrumbsItem",_$last:null}),n.register("Types/display:BreadcrumbsItem",o)}(_,t,l,h,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/TreeItem"]=true;var v=function(){"use strict";var t={},e=function(t,e,n,r,i){Object.defineProperty(e,"__esModule",{value:true});var o=function(i){function r(t){var e=i.call(this,t)||this;if(t&&!t.hasOwnProperty("hasChildren")&&t.hasOwnProperty("loaded"))e._$hasChildren=!t.loaded;return e._$node=!!e._$node,e._$expanded=!!e._$expanded,e._$hasChildren=!!e._$hasChildren,e}return n.__extends(r,i),r.prototype.getParent=function(){return this._$parent},r.prototype.setParent=function(t){this._$parent=t},r.prototype.getRoot=function(){var t=this.getParent();if(t===this)return;return t?t.getRoot():this},r.prototype.isRoot=function(){return!this.getParent()},r.prototype.getLevel=function(){var t=this.getParent();if(t)return(t instanceof r?t.getLevel():0)+1;var e=this.getOwner();return e&&e.isRootEnumerable()?1:0},r.prototype.isNode=function(){return this._$node},r.prototype.setNode=function(t){this._$node=t},r.prototype.isExpanded=function(){return this._$expanded},r.prototype.setExpanded=function(t,e){if(this._$expanded===t)return;if(this._$expanded=t,!e)this._notifyItemChangeToOwner("expanded")},r.prototype.toggleExpanded=function(){this.setExpanded(!this.isExpanded())},r.prototype.isHasChildren=function(){return this._$hasChildren},r.prototype.setHasChildren=function(t){this._$hasChildren=t},r.prototype.isLoaded=function(){return!this._$hasChildren},r.prototype.setLoaded=function(t){this._$hasChildren=!t},r.prototype.getChildrenProperty=function(){return this._$childrenProperty},r.prototype._getSerializableState=function(t){if("function"===typeof(t=i.prototype._getSerializableState.call(this,t)).$options.parent)delete t.$options.parent;return t},r.prototype._setSerializableState=function(t){var e=i.prototype._setSerializableState.call(this,t);return function(){e.call(this)}},r.prototype._notifyItemChangeToOwner=function(t){i.prototype._notifyItemChangeToOwner.call(this,t);var e=this.getRoot(),r=e?e.getOwner():void 0;if(r&&r!==this._$owner)r.notifyItemChange(this,t)},r}(r.default);e.default=o,Object.assign(o.prototype,{"[Types/_display/TreeItem]":true,_moduleName:"Types/display:TreeItem",_$parent:void 0,_$node:false,_$expanded:false,_$hasChildren:true,_$childrenProperty:"",_instancePrefix:"tree-item-"}),o.prototype["[WS.Data/Display/TreeItem]"]=true,i.register("Types/display:TreeItem",o)}(_,t,l,h,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),I=v;t["Types/_display/itemsStrategy/MaterializedPath"]=true;var C=function(){"use strict";var t={},e=function(t,e,n,r,y){Object.defineProperty(e,"__esModule",{value:true});var i=function(r){function i(t){var e=r.call(this,t)||this;return e._indexToPath=[],e}return n.__extends(i,r),i.prototype.getSorters=function(){var t=this,e=[];return e.push({name:"tree",enabled:true,method:i.sortItems,options:function(){return{indexToPath:t._indexToPath}}}),e},Object.defineProperty(i.prototype,"count",{get:function(){var t=0;while(void 0!==this.at(t))t++;return t},enumerable:true,configurable:true}),Object.defineProperty(i.prototype,"items",{get:function(){var t=0;while(void 0!==this.at(t))t++;return this._getItems()},enumerable:true,configurable:true}),i.prototype.at=function(t){var e=this._getItems();if(!e[t]){var r=this._getCollection(),i=this._getPathTo(r,t),n=void 0;if(i)n=this._getItemByPath(r,i);if(n)e[t]=this.options.display.createItem({contents:n,parent:this._getParent(t,i)})}return e[t]},i.prototype.splice=function(t){return this._getItems().length=t,this._indexToPath.length=t,[]},i.prototype._getPathTo=function(t,e){if(this._indexToPath[e])return this._indexToPath[e];var h=this._options.childrenProperty,f,r,_=function(t,e,r){for(var i=e instanceof Array,n=e["[Types/_collection/IList]"],o=e["[Types/_collection/IEnumerable]"],s,a,u,l,p,c=0;;){if(i){if(!(a=e.length<=c))u=e[c]}else if(n){if(!(a=e.getCount()<=c))u=e.at(c)}else if(o){if(!s)s=e.getEnumerator();a=void 0===(u=s.moveNext()?s.getCurrent():void 0)}else throw new TypeError("Unsupported object type: only Array, Types/_collection/IList or Types/_collection/IEnumerable are supported.");if(a)break;if(t===f)return r.concat(c);if(f++,(l=y.object.getPropertyValue(u,h))instanceof Object)if(p=_(t,l,r.concat(c)))return p;c++}};if(f=0,r=_(e,t,[]))this._indexToPath[e]=r;return r},i.prototype._getItemByPath=function(t,e){for(var r=this._options.childrenProperty,i=t,n=0;n<e.length;)if(i=this._getItemAt(t,e[n]),++n<e.length)t=y.object.getPropertyValue(i,r);return i},i.prototype._getParent=function(t,e){var r=e.slice(0,e.length-1);if(r.length){var i=this._getItems(),n=this._getItemByPath(this._getCollection(),r);if(n)for(var o=t-1;o>=0;o--)if(i[o]&&i[o].getContents()===n)return i[o]}else return"function"===typeof this._options.root?this._options.root():this._options.root},i.prototype._getItemAt=function(t,e){var r=t instanceof Array,i=t["[Types/_collection/IEnumerable]"],n=t["[Types/_collection/IEnumerable]"],o;if(r)o=t[e];else if(i)o=t.at(e);else if(n){var s=t.getEnumerator(),a=void 0,u=0;while(s.moveNext()){if(a=s.getCurrent(),u===e){o=a;break}u++}}else throw new TypeError("Unsupported object type: only Array, Types/_collection/IList or Types/_collection/IEnumerable are supported.");if(void 0===o)throw new ReferenceError("Item at "+e+" is out of range.");return o},i.sortItems=function(t,n,e){var l=e.indexToPath,r,i={},o=function(t){return t.join(".")},s=function(t){return i[o(t)]},p=function(t,e){var r=s(t),i=s(e);return n.indexOf(r)-n.indexOf(i)};return(r=l.map(o)).forEach(function(t,e){i[t]=e}),n.slice().sort(function(t,e){for(var r=l[t],i=l[e],n=r.length,o=i.length,s=Math.min(n,o),a=0,u=0;u<s;u++){if(r[u]===i[u])continue;if(0!==(a=p(r.slice(0,1+u),i.slice(0,1+u))))break}if(0===a&&n!==o)a=n-o;return a})},i}(r.default);(e.default=i).prototype._moduleName="Types/display:itemsStrategy.MaterializedPath",i.prototype["[Types/_display/itemsStrategy/MaterializedPath]"]=true}(_,t,l,d,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/GroupItem"]=true;var b=function(){"use strict";var t={},e=function(t,e,i,r,n){Object.defineProperty(e,"__esModule",{value:true});var o=function(r){function t(t){var e=r.call(this,t)||this;return e._$expanded=!!e._$expanded,e}return i.__extends(t,r),t.prototype.isExpanded=function(){return this._$expanded},t.prototype.setExpanded=function(t,e){if(this._$expanded===t)return;if(this._$expanded=t,!e)this._notifyItemChangeToOwner("expanded")},t.prototype.toggleExpanded=function(){this.setExpanded(!this.isExpanded())},t}(r.default);e.default=o,Object.assign(o.prototype,{"[Types/_display/GroupItem]":true,_moduleName:"Types/display:GroupItem",_instancePrefix:"group-item-",_$expanded:true}),o.prototype["[WS.Data/Display/GroupItem]"]=true,n.register("Types/display:GroupItem",o)}(_,t,l,h,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),S=b;t["Types/_display/FlagsItem"]=true;var x=function(){"use strict";var t={},e=function(t,e,r,i,n){Object.defineProperty(e,"__esModule",{value:true});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.isSelected=function(){return this._$owner.getCollection().get(this._$contents,this._$owner.localize)},e.prototype.setSelected=function(t){if(this.isSelected()===t)return;this._$owner.getCollection().set(this._$contents,t,this._$owner.localize)},e}(i.default);(e.default=o).prototype._moduleName="Types/display:FlagsItem",o.prototype["[Types/_display/FlagsItem]"]=true,n.register("Types/display:FlagsItem",o)}(_,t,l,h,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),O=x;t["Types/_display/itemsStrategy/Direct"]=true;var P=function(){"use strict";var t={},e=function(t,e,r,i,a,s,u){Object.defineProperty(e,"__esModule",{value:true});var n=function(n){function t(t){return n.call(this,t)||this}return r.__extends(t,n),Object.defineProperty(t.prototype,"unique",{set:function(t){this._options.unique=t},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){return this._getItemsOrder().length},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){var e=this._getItems(),t;return this._getItemsOrder().map(function(t){return e[t]})},enumerable:true,configurable:true}),t.prototype.at=function(t){var e=this._getItems(),r,i=this._getItemsOrder()[t];if(void 0===i)throw new ReferenceError("Display index "+t+" is out of bounds.");return e[i]},t.prototype.splice=function(t,e,r){var i=this,n,o=(r=r||[]).map(function(t){return t instanceof a.default?t:i._createItem(t)}),s=(n=this._getItems()).splice.apply(n,[t,e].concat(o));return this._itemsOrder=null,s},t.prototype.reset=function(){n.prototype.reset.call(this),this._itemsOrder=null},t.prototype.invalidate=function(){n.prototype.invalidate.call(this),this._itemsOrder=null},t.prototype.getDisplayIndex=function(t){var e=this._getItemsOrder(),r=e.indexOf(t);return-1===r?e.length:r},t.prototype.getCollectionIndex=function(t){var e,r=this._getItemsOrder()[t];return void 0===r?-1:r},t.prototype._getSerializableState=function(t){return(t=n.prototype._getSerializableState.call(this,t))._itemsOrder=this._itemsOrder,t},t.prototype._setSerializableState=function(t){var e=n.prototype._setSerializableState.call(this,t);return function(){this._itemsOrder=t._itemsOrder,e.call(this)}},t.prototype._initItems=function(){n.prototype._initItems.call(this);for(var t=this._items,e=this._getSourceItems(),r=t.length,i=0;i<r;i++)t[i]=this._createItem(e[i])},t.prototype._getItemsOrder=function(){if(!this._itemsOrder)this._itemsOrder=this._createItemsOrder();return this._itemsOrder},t.prototype._createItemsOrder=function(){return t.sortItems(this._getItems(),{idProperty:this._options.idProperty,unique:this._options.unique})},t.sortItems=function(t,e){var r=e.idProperty;if(!e.unique||!r)return t.map(function(t,e){return e});var i=new u.Set,n=[],o;return t.forEach(function(t,e){if(o=s.object.getPropertyValue(t.getContents(),r),i.has(o))return;i.add(o),n.push(e)}),n},t}(i.default);e.default=n,Object.assign(n.prototype,{"[Types/_display/itemsStrategy/Direct]":true,_moduleName:"Types/display:itemsStrategy.Direct",_itemsOrder:null})}(_,t,l,d,h,s,n);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/itemsStrategy/Search"]=true;var T=function(){"use strict";var t={},e=function(t,e,i,c,n,r){Object.defineProperty(e,"__esModule",{value:true});var o=function(r){function t(t){var e=r.call(this)||this;return e["[Types/_display/IItemsStrategy]"]=true,e._options=t,e}return i.__extends(t,r),Object.defineProperty(t.prototype,"options",{get:function(){return this.source.options},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"source",{get:function(){return this._options.source},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){return this._getItems().length},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){return this._getItems()},enumerable:true,configurable:true}),t.prototype.at=function(t){return this._getItems()[t]},t.prototype.splice=function(t,e,r){return this.source.splice(t,e,r)},t.prototype.reset=function(){return this.source.reset()},t.prototype.invalidate=function(){return this.source.invalidate()},t.prototype.getDisplayIndex=function(t){var e=this.source.getDisplayIndex(t),r=this.source.items[e],i=this._getItems(),n=i.indexOf(r);return-1===n?i.length:n},t.prototype.getCollectionIndex=function(t){var e,r=this._getItems()[t],i,n=this.source.items.indexOf(r);return n>=0?this.source.getCollectionIndex(n):-1},t.prototype._getSerializableState=function(t){return(t=n.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t},t.prototype._setSerializableState=function(t){var e=n.SerializableMixin.prototype._setSerializableState(t);return function(){e.call(this)}},t.prototype._getItems=function(){return t.sortItems(this.source.items,{display:this.options.display})},t.sortItems=function(s,t){var a=t.display,u={},l=null,p=function(t){return t&&t.isNode?t.isNode():false};return s.map(function(t,e){var r=s[e+1],i=p(t),n=p(r);if(i){var o;if(n?t.getLevel()>=r.getLevel():true)return l=new c.default({owner:a,last:t});return l=null,u}return t.setParent(l),t}).filter(function(t){return t!==u})},t}(r.mixin(n.DestroyableMixin,n.SerializableMixin));(e.default=o).prototype._moduleName="Types/display:itemsStrategy.Search",o.prototype["[Types/_display/itemsStrategy/Search]"]=true}(_,t,l,m,u,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/itemsStrategy/User"]=true;var $=function(){"use strict";var t={},e=function(t,e,n,p,o,r){Object.defineProperty(e,"__esModule",{value:true});var i=function(r){function i(t){var e=r.call(this)||this;if(e["[Types/_display/IItemsStrategy]"]=true,!t||!(t.handlers instanceof Array))throw new TypeError('Option "handlers" should be an instance of Array');return e._options=Object.assign({},t),e}return n.__extends(i,r),Object.defineProperty(i.prototype,"source",{get:function(){return this._options.source},enumerable:true,configurable:true}),Object.defineProperty(i.prototype,"handlers",{set:function(t){if(!(t instanceof Array))throw new TypeError('Option "handlers" should be an instance of Array');this._options.handlers=t},enumerable:true,configurable:true}),Object.defineProperty(i.prototype,"options",{get:function(){return this.source.options},enumerable:true,configurable:true}),Object.defineProperty(i.prototype,"count",{get:function(){return this.source.count},enumerable:true,configurable:true}),Object.defineProperty(i.prototype,"items",{get:function(){var e=this.source.items,t;return this._getItemsOrder().map(function(t){return e[t]})},enumerable:true,configurable:true}),i.prototype.at=function(t){var e,r=this._getItemsOrder()[t];return this.source.at(r)},i.prototype.splice=function(t,e,r){return this._itemsOrder=null,this.source.splice(t,e,r)},i.prototype.reset=function(){return this._itemsOrder=null,this.source.reset()},i.prototype.invalidate=function(){return this._itemsOrder=null,this.source.invalidate()},i.prototype.getDisplayIndex=function(t){var e=this.source.getDisplayIndex(t),r=this._getItemsOrder(),i=r.indexOf(e);return-1===i?r.length:i},i.prototype.getCollectionIndex=function(t){var e=this.source.getCollectionIndex(t),r=this._getItemsOrder();return-1===e?e:r[e]},i.prototype._getSerializableState=function(t){if((t=o.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t._itemsOrder=this._itemsOrder,!t._itemsOrder&&this._options.handlers.length)t._itemsOrder=this._getItemsOrder();return t},i.prototype._setSerializableState=function(t){var e=o.SerializableMixin.prototype._setSerializableState(t);return function(){this._itemsOrder=t._itemsOrder,e.call(this)}},i.prototype._getItemsOrder=function(){if(!this._itemsOrder)this._itemsOrder=this._createItemsOrder();return this._itemsOrder},i.prototype._createItemsOrder=function(){var t=this.source.items,e=t.map(function(t,e){return e});return i.sortItems(t,e,this._options&&this._options.handlers||[])},i.sortItems=function(t,e,r){if(!r||0===r.length)return e;for(var i=[],n=[],o,s,a=0,u=e.length;a<u;a++)if((s=t[o=e[a]])instanceof p.default)i.push(o);else n.push({item:s,collectionItem:s.getContents(),index:o,collectionIndex:o});for(var a=r.length-1;a>=0;a--)n.sort(r[a]);for(var l=0,u=n.length;l<u;l++)i.push(n[l].collectionIndex);return i},i}(r.mixin(o.DestroyableMixin,o.SerializableMixin));e.default=i,Object.assign(i.prototype,{"[Types/_display/itemsStrategy/User]":true,_moduleName:"Types/display:itemsStrategy.User",_itemsOrder:null})}(_,t,l,b,u,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/TreeChildren"]=true;var E=function(){"use strict";var t={},e=function(t,e,i,n,r,o){Object.defineProperty(e,"__esModule",{value:true});var s=function(r){function t(t){var e=r.call(this,t)||this;if(!(e._$owner instanceof Object))throw new TypeError("Tree children owner should be an object");if(!(e._$owner instanceof n.default))throw new TypeError("Tree children owner should be an instance of Types/display:TreeItem");return e}return i.__extends(t,r),t.prototype.getOwner=function(){return this._$owner},t}(r.List);(e.default=s).prototype["[Types/_display/TreeChildren]"]=true,s.prototype._$owner=null,o.register("Types/display:TreeChildren",s)}(_,t,l,v,o,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/itemsStrategy/AdjacencyList"]=true;var w=function(){"use strict";var t={},e=function(t,e,i,l,n,C,h,r){Object.defineProperty(e,"__esModule",{value:true});var o=C.protect("initialized"),s=r.throttle(C.logger.info,300);function b(t){if("number"===typeof t)t=String(t);return t}function a(t,e){for(var r=new h.Map,i=t.length,n,o,s,a,u=0;u<i;u++){if(o=(n=t[u]).getContents(),n instanceof l.default)continue;if(a=b(C.object.getPropertyValue(o,e)),r.has(a))s=r.get(a);else s=[];s.push(u),r.set(a,s)}return r}function u(t){var r=new h.Map,i;return t.forEach(function(t,e){if(t instanceof l.default)i=e;else r.set(t,i)}),r}function S(t,e){var r=[],i=t.sourceItems,n=t.childrenMap,o=t.parentsMap,s=t.groupsMap,a=t.lastGroup,u=t.path,l=t.idProperty,p=u[u.length-1];if(u.indexOf(p)>-1&&u.indexOf(p)<u.length-1)return C.logger.error("Types/display:itemsStrategy.AdjacencyList",'Wrong data hierarchy relation: recursive traversal detected: parent with id "'+p+'" is already in progress. Path: '+u.join(" -> ")+"."),r;for(var c=n.has(p)?n.get(p):[],h=c.length,f,_,y,d,g,m=0;m<h;m++){if(y=(f=i[_=c[m]]).getContents(),(d=s.get(f))!==a){if(g)r.pop(),o.pop();r.push(d),o.push(e),a=t.lastGroup=d}if(r.push(_),o.push(e),g)g=false;if(y&&l){var v=b(C.object.getPropertyValue(y,l));u.push(v);var I=S(t,o.length-1);if(r.push.apply(r,I),d!==t.lastGroup&&(void 0!==e||m<h-1))r.push(d),o.push(e),a=t.lastGroup=d,g=true;u.pop()}}return r}var p=function(r){function t(t){var e=r.call(this)||this;if(e["[Types/_display/IItemsStrategy]"]=true,!(e._options=t).idProperty)s(e._moduleName+'::constructor(): option "idProperty" is not defined. Only root elements will be presented');return e}return i.__extends(t,r),Object.defineProperty(t.prototype,"options",{get:function(){return this.source.options},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"source",{get:function(){return this._options.source},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){var t;return this._getItemsOrder().length},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this._getItems();if(!t[o]){for(var e=t.length,r=0;r<e;r++)if(void 0===t[r])this.at(r);t[o]=true}return t},enumerable:true,configurable:true}),t.prototype.at=function(t){var e=this._getItems();if(e[t])return e[t];var r,i=this._getItemsOrder()[t],n=this._getSourceItems()[i],o;if(void 0===n)throw new ReferenceError("Collection index "+t+" is out of bounds.");if(n instanceof l.default)o=n;else o=this.options.display.createItem({contents:n.getContents(),parent:this._getParent(t)});return e[t]=o},t.prototype.splice=function(n,o,t){t=t||[];for(var s=function(e,r){return function(t){return t>=e?t+r:t}},a=this.source,e=[],r=n;r<n+o;r++)e.push(a.getDisplayIndex(r));a.splice(n,o,t);var u=this._getItems(),l=this._getItemsOrder(),p=this._getSourceItems();if(t.hasBeenRemoved)t.forEach(function(t,e){var r=a.getDisplayIndex(n+e-o),i=l.indexOf(r);if(-1===i)i=l.length;p.splice(r,0,t),(l=l.map(s(r,1))).splice(i,0,r),u.splice(i,0,t)});var c=[];if(o>0){var i=function(i){return function(t,e){var r=i.indexOf(t)>-1;if(r)c.push(u.splice(e,1)[0]),p.splice(t,1);return!r}};l=l.filter(i(e)),e.sort().reverse().forEach(function(t){l=l.map(s(t,-1))}),c.hasBeenRemoved=true}return this._itemsOrder=l,this._syncItemsOrder(),c},t.prototype.reset=function(){this._items=null,this._sourceItems=null,this._itemsOrder=null,this.source.reset()},t.prototype.invalidate=function(){this.source.invalidate(),this._syncItemsOrder()},t.prototype.getDisplayIndex=function(t){var e=this.source.getDisplayIndex(t),r=this._getItemsOrder(),i=r.indexOf(e);return-1===i?r.length:i},t.prototype.getCollectionIndex=function(t){var e=this.source.getCollectionIndex(t),r,i=this._getItemsOrder()[e];return void 0===i?-1:i},t.prototype._getSerializableState=function(t){return(t=n.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t._items=this._items,t._itemsOrder=this._itemsOrder,t._parentsMap=this._parentsMap,t},t.prototype._setSerializableState=function(t){var e=n.SerializableMixin.prototype._setSerializableState(t);return function(){e.call(this),this._items=t._items,this._itemsOrder=t._itemsOrder,this._parentsMap=t._parentsMap}},t.prototype._getItems=function(){if(!this._items)this._initItems();return this._items},t.prototype._initItems=function(){this._items=[],this._items.length=this._getItemsOrder().length},t.prototype._getItemsOrder=function(){if(!this._itemsOrder)this._itemsOrder=this._createItemsOrder();return this._itemsOrder},t.prototype._syncItemsOrder=function(){var r=this;if(!this._itemsOrder)return;var t=this._itemsOrder,i=this._getItems(),n=this._getSourceItems(),e=this._createItemsOrder(),o=this._sourceItems,s=new h.Map;t.forEach(function(t,e){s.set(n[t],i[e])});for(var a=new Array(e.length),u,l,p,c=0;c<e.length;c++)if(l=o[p=e[c]],(u=s.get(l))&&u.getContents()===l.getContents())a[c]=u,s.delete(l);this._itemsOrder=e,this._items=a,i.forEach(function(t){if(t.setParent)t.setParent(void 0)}),a.forEach(function(t,e){if(t.setParent)t.setParent(r._getParent(e))})},t.prototype._getSourceItems=function(){if(!this._sourceItems)this._sourceItems=this.source.items;return this._sourceItems},t.prototype._createItemsOrder=function(){this._sourceItems=null,this._parentsMap=[];var t=this._options,e=this._getSourceItems(),r=this.options.display.getRoot();if((r=r&&r.getContents?r.getContents():r)&&r instanceof Object)r=r.valueOf();r=b(r&&"object"===typeof r?C.object.getPropertyValue(r,t.idProperty):r);var i=a(e,t.parentProperty),n=u(e);if(null===r&&!i.has(r)&&i.has(void 0))r=void 0;return S({idProperty:t.idProperty,sourceItems:e,childrenMap:i,groupsMap:n,parentsMap:this._parentsMap,path:[r]})},t.prototype._getParent=function(t){var e,r=this._parentsMap[t];if(-1===r)return;return void 0===r?this.options.display.getRoot():this.at(r)},t}(C.mixin(n.DestroyableMixin,n.SerializableMixin));e.default=p,Object.assign(p.prototype,{"[Types/_display/itemsStrategy/AdjacencyList]":true,_moduleName:"Types/display:itemsStrategy.AdjacencyList",_options:null,_items:null,_sourceItems:null,_itemsOrder:null,_parentsMap:null})}(_,t,l,b,u,s,n,i);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/itemsStrategy/Group"]=true;var M=function(){"use strict";var t={},e=function(t,e,i,y,n,r){Object.defineProperty(e,"__esModule",{value:true});var o=function(r){function t(t){var e=r.call(this)||this;return e._groups=[],e["[Types/_display/IItemsStrategy]"]=true,e._options=t,e}return i.__extends(t,r),Object.defineProperty(t.prototype,"handler",{set:function(t){this._options.handler=t},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"options",{get:function(){return this.source.options},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"source",{get:function(){return this._options.source},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"count",{get:function(){return this._getItemsOrder().length},enumerable:true,configurable:true}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this._getItemsOrder(),e=this._getItems();return t.map(function(t){return e[t]})},enumerable:true,configurable:true}),t.prototype.at=function(t){var e,r=this._getItemsOrder()[t];if(void 0===r)throw new ReferenceError("Index "+t+" is out of bounds.");return this._getItems()[r]},t.prototype.splice=function(t,e,r){return this._itemsOrder=null,this.source.splice(t,e,r)},t.prototype.reset=function(){return this._groups=[],this._itemsOrder=null,this.source.reset()},t.prototype.invalidate=function(){return this._itemsOrder=null,this.source.invalidate()},t.prototype.getDisplayIndex=function(t){var e=this._getItemsOrder(),r,i=this.source.getDisplayIndex(t)+this._groups.length,n=e.indexOf(i);return-1===n?e.length:n},t.prototype.getCollectionIndex=function(t){var e,r,i=this._getItemsOrder()[t]-this._groups.length;return i=i>=0?this.source.getCollectionIndex(i):-1},t.prototype._getSerializableState=function(t){if((t=n.SerializableMixin.prototype._getSerializableState.call(this,t)).$options=this._options,t._groups=this._groups,t._itemsOrder=this._itemsOrder,!t._itemsOrder&&this._options.handler)t._itemsOrder=this._getItemsOrder();return t},t.prototype._setSerializableState=function(t){var e=n.SerializableMixin.prototype._setSerializableState(t);return function(){this._groups=t._groups,this._itemsOrder=t._itemsOrder,e.call(this)}},t.prototype._getItems=function(){return this._groups.concat(this.source.items)},t.prototype._getItemsOrder=function(){if(!this._itemsOrder)this._itemsOrder=this._createItemsOrder();return this._itemsOrder},t.prototype._createItemsOrder=function(){return t.sortItems(this.source.items,{display:this.options.display,handler:this._options.handler,groups:this._groups})},t.prototype._getActiveGroupsCount=function(t){return t.length-this.source.items.length},t.sortItems=function(t,e){var r=e.groups,i=e.display,n=e.handler,o;if(!n)return r.length=0,t.map(function(t,e){return e});o=r.map(function(t){return t.getContents()});for(var s=[],a=[],u=0;u<t.length;u++){var l=t[u],p=n?n(l.getContents(),u,l):void 0,c=o.indexOf(p);if(-1===o.indexOf(p)){var h=new y.default({owner:i,contents:p});c=r.length,r.push(h),o.push(p)}if(-1===s.indexOf(c))s.push(c);if(!a[c])a[c]=[];a[c].push(u)}var f=[],_=r.length;return s.forEach(function(t){f.push(t),a[t].forEach(function(t){f.push(t+_)})}),f},t}(r.mixin(n.DestroyableMixin,n.SerializableMixin));e.default=o,Object.assign(o.prototype,{"[Types/_display/itemsStrategy/Group]":true,_moduleName:"Types/display:itemsStrategy.Group",_groups:null,_itemsOrder:null})}(_,t,l,b,u,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/Collection"]=true;var A=function(){"use strict";var t={},e=function(t,e,n,f,r,o,s,C,a,u,l,p,c,h,_,y,b){Object.defineProperty(e,"__esModule",{value:true});var i,d=(0,eval)("this").console,g="The Display is read only. You should modify the source collection instead.";function m(t){var e=[];return t.each(function(t){e.push(t)}),e}function v(t){if("function"===typeof t)t=[t];return t instanceof Array?t.filter(function(t){return"function"===typeof t}):[]}function I(t,e,r,i,n,o){var s;switch(e){case f.default.ACTION_RESET:var a=m(this),u=void 0;return this._reBuild(true),u=m(this),this._notifyBeforeCollectionChange(),this._notifyCollectionChange(e,u,0,a,0),void this._notifyAfterCollectionChange();case f.default.ACTION_CHANGE:return s=this._startUpdateSession(),this._reGroup(i,r.length),this._reSort(),this._reFilter(),this._finishUpdateSession(s,false),void this._notifyCollectionItemsChange(r,i,s)}switch(s=this._startUpdateSession(),e){case f.default.ACTION_ADD:this._addItems(i,r),this._reGroup(i,r.length),this._reSort(),this._reFilter();break;case f.default.ACTION_REMOVE:if(this._removeItems(o,n.length),this._reSort(),this._isFiltered()&&this._isFilteredByIndex())this._reFilter();break;case f.default.ACTION_REPLACE:this._replaceItems(i,r),this._reGroup(i,r.length),this._reSort(),this._reFilter();break;case f.default.ACTION_MOVE:this._moveItems(i,o,r),this._reSort(),this._reFilter()}this._finishUpdateSession(s)}function S(t,e,r,i){if(!this.isEventRaising())return;if(this._sourceCollectionSynchronized)this._notifySourceCollectionItemChange(t,e,r,i);else this._sourceCollectionDelayedCallbacks=this._sourceCollectionDelayedCallbacks||[],this._sourceCollectionDelayedCallbacks.push([this._notifySourceCollectionItemChange,arguments])}function x(t,e,r){if(!r&&e)this._reBuild(true);this._sourceCollectionSynchronized=e;var i=this._sourceCollectionDelayedCallbacks;if(this._sourceCollectionSynchronized&&i){var n=void 0;while(i.length>0)(n=i[0])[0].apply(this,n[1]),i.shift()}}var O=function(r){function i(t){var e=r.call(this,t)||this;if(e["[Types/_collection/IEnumerable]"]=true,e["[Types/_collection/IList]"]=true,e._itemToUid=new b.Map,e._itemsUid=new b.Set,e._filterMap=[],e._sortMap=[],c.SerializableMixin.constructor.call(e),h.EventRaisingMixin.constructor.call(e,t),e._$filter=e._$filter||[],e._$sort=e._$sort||[],e._$importantItemProperties=e._$importantItemProperties||[],!e._$collection)throw new Error(e._moduleName+": source collection is empty");if(e._$collection instanceof Array)e._$collection=_.create("Types/collection:List",{items:e._$collection});if(!e._$collection["[Types/_collection/IEnumerable]"])throw new TypeError(e._moduleName+": source collection should implement Types/collection:IEnumerable");if(e._$sort=v(e._$sort),e._$filter=v(e._$filter),e._$idProperty)e._setImportantProperty(e._$idProperty);if(e._publish("onCurrentChange","onCollectionChange","onBeforeCollectionChange","onAfterCollectionChange"),e._switchImportantPropertiesByUserSort(true),e._switchImportantPropertiesByGroup(true),e._reBuild(),e._bindHandlers(),e._$collection["[Types/_collection/IObservable]"])e._$collection.subscribe("onCollectionChange",e._onCollectionChange),e._$collection.subscribe("onCollectionItemChange",e._onCollectionItemChange);if(e._$collection["[Types/_entity/EventRaisingMixin]"])e._$collection.subscribe("onEventRaisingChange",e._oEventRaisingChange);return e}return n.__extends(i,r),Object.defineProperty(i.prototype,"localize",{get:function(){return this._localize},enumerable:true,configurable:true}),i._functorToImportantProperties=function(t,e,r){if(c.functor.Compute.isFunctor(t))for(var i=t.properties,n=0;n<i.length;n++)if(r)e._setImportantProperty(i[n]);else e._unsetImportantProperty(i[n])},i.prototype.destroy=function(){if(!this._$collection.destroyed){if(this._$collection["[Types/_collection/IObservable]"])this._$collection.unsubscribe("onCollectionChange",this._onCollectionChange),this._$collection.unsubscribe("onCollectionItemChange",this._onCollectionItemChange);if(this._$collection["[Types/_entity/EventRaisingMixin]"])this._$collection.unsubscribe("onEventRaisingChange",this._oEventRaisingChange)}this._unbindHandlers(),this._composer=null,this._filterMap=[],this._sortMap=[],this._itemToUid=null,this._itemsUid=null,this._cursorEnumerator=null,this._utilityEnumerator=null,r.prototype.destroy.call(this)},i.prototype.getByInstanceId=function(t){return this.at(this._getUtilityEnumerator().getIndexByValue("instanceId",t))},i.prototype.getIndexByInstanceId=function(t){return this._getUtilityEnumerator().getIndexByValue("instanceId",t)},i.prototype.getEnumerator=function(t){return this._getEnumerator()},i.prototype.each=function(t,e){var r=this.getEnumerator(),i;while(r.moveNext())i=r.getCurrentIndex(),t.call(e,r.getCurrent(),i)},i.prototype.assign=function(){throw new Error(g)},i.prototype.append=function(){throw new Error(g)},i.prototype.prepend=function(){throw new Error(g)},i.prototype.clear=function(){throw new Error(g)},i.prototype.add=function(){throw new Error(g)},i.prototype.at=function(t){return this._getUtilityEnumerator().at(t)},i.prototype.remove=function(){throw new Error(g)},i.prototype.removeAt=function(){throw new Error(g)},i.prototype.replace=function(){throw new Error(g)},i.prototype.move=function(){throw new Error(g)},i.prototype.getIndex=function(t){if(!(t instanceof s.default))return-1;return this.getIndexByInstanceId(t.getInstanceId())},i.prototype.getCount=function(t){var e=0;if(t&&this._isGrouped())this.each(function(t){if(!(t instanceof C.default))e++});else e=this._getUtilityEnumerator().getCount();return e},i.prototype.getCollection=function(){return this._$collection},i.prototype.getCollectionCount=function(){var t=this.getCollection();if(t["[Types/_collection/IList]"])return t.getCount();var e=t.getEnumerator(),r=0;e.reset();while(e.moveNext())r++;return r},i.prototype.getItems=function(){return this._getItems().slice()},i.prototype.createItem=function(t){if(!this._itemsFactory)this._itemsFactory=this._getItemsFactory().bind(this);return this._itemsFactory(t)},i.prototype.getItemUid=function(t){var e=this._itemToUid;if(e.has(t))return e.get(t);var r=this._exctractItemId(t);return r=this._searchItemUid(t,r),e.set(t,r),r},i.prototype.getCurrent=function(){return this._getCursorEnumerator().getCurrent()},i.prototype.setCurrent=function(t,e){var r=this.getCurrent();if(r!==t){var i=this._getCursorEnumerator(),n=this.getCurrentPosition();if(i.setCurrent(t),!e)this._notifyCurrentChange(this.getCurrent(),r,i.getPosition(),n)}},i.prototype.getCurrentPosition=function(){return this._getCursorEnumerator().getPosition()},i.prototype.setCurrentPosition=function(t,e){var r=this.getCurrentPosition();if(t!==r){var i=this.getCurrent();if(this._getCursorEnumerator().setPosition(t),!e)this._notifyCurrentChange(this.getCurrent(),i,t,r)}},i.prototype.getFirst=function(){var t=this._getUtilityEnumerator();t.setPosition(0);var e=t.getCurrent();if(e instanceof C.default)return this._getNearbyItem(t,e,true,true);return e},i.prototype.getLast=function(){var t=this._getUtilityEnumerator(),e=t.getCount()-1;t.setPosition(e);var r=t.getCurrent();if(r instanceof C.default)return this._getNearbyItem(t,void 0,false,true);return r},i.prototype.getNext=function(t){return this._getNearbyItem(this._getUtilityEnumerator(),t,true,true)},i.prototype.getPrevious=function(t){return this._getNearbyItem(this._getUtilityEnumerator(),t,false,true)},i.prototype.moveToNext=function(){var t=this.getCurrent(),e=this.getCurrentPosition(),r=this._getCursorEnumerator().moveNext();if(r)this._notifyCurrentChange(this.getCurrent(),t,this.getCurrentPosition(),e);return r},i.prototype.moveToPrevious=function(){var t=this.getCurrent(),e=this.getCurrentPosition(),r=this._getCursorEnumerator().movePrevious();if(r)this._notifyCurrentChange(this.getCurrent(),t,this.getCurrentPosition(),e);return r},i.prototype.moveToFirst=function(){if(0===this.getCurrentPosition())return false;return this.setCurrentPosition(0),0===this._getCursorEnumerator().getPosition()},i.prototype.moveToLast=function(){var t=this.getCount()-1;if(this.getCurrentPosition()===t)return false;return this.setCurrentPosition(t),this.getCurrentPosition()===t},i.prototype.getSourceIndexByIndex=function(t){var e=this._getUtilityEnumerator().getSourceByInternal(t);return e=void 0===e||null===e?-1:e,this._getSourceIndex(e)},i.prototype.getSourceIndexByItem=function(t){var e=this.getIndex(t);return-1===e?-1:this.getSourceIndexByIndex(e)},i.prototype.getIndexBySourceIndex=function(t){t=this._getItemIndex(t);var e=this._getUtilityEnumerator().getInternalBySource(t);return void 0===e||null===e?-1:e},i.prototype.getIndexBySourceItem=function(e){var t=this.getCollection(),r=-1;if(t&&t["[Types/_collection/IList]"])r=t.getIndex(e);else{var i=0;t.each(function(t){if(-1===r&&t===e)r=i;i++},this,this._localize)}return-1===r?-1:this.getIndexBySourceIndex(r)},i.prototype.getItemBySourceIndex=function(t){return-1===(t=this.getIndexBySourceIndex(t))?void 0:this.at(t)},i.prototype.getItemBySourceItem=function(t){var e=this.getIndexBySourceItem(t);return-1===e?void 0:this.at(e)},i.prototype.getFilter=function(){return this._$filter.slice()},i.prototype.setFilter=function(){for(var t=[],e=0,r;e<arguments.length;e++)t[e]=arguments[e];if(t[0]instanceof Array)r=t[0];else r=t;if(this._$filter.length===r.length){for(var i=false,n=0;n<r.length;n++)if(this._$filter[n]!==r[n]){i=true;break}if(!i)return}this._$filter=r.filter(function(t){return"function"===typeof t});var o=this._startUpdateSession();this._reFilter(),this._finishUpdateSession(o)},i.prototype.addFilter=function(t,e){if(this._$filter.indexOf(t)>-1)return;if(void 0===e)this._$filter.push(t);else this._$filter.splice(e,0,t);var r=this._startUpdateSession();this._reFilter(),this._finishUpdateSession(r)},i.prototype.removeFilter=function(t){var e=this._$filter.indexOf(t);if(-1===e)return false;this._$filter.splice(e,1);var r=this._startUpdateSession();return this._reFilter(),this._finishUpdateSession(r),true},i.prototype.getGroup=function(){return this._$group},i.prototype.setGroup=function(t){if(this._$group===t)return;if(this._switchImportantPropertiesByGroup(false),!this._composer)return this._$group=t,void this._switchImportantPropertiesByGroup(true);var e=this._startUpdateSession(),r=this._composer.getInstance(p.default);this._$group=r.handler=t,this._switchImportantPropertiesByGroup(true),this._getItemsStrategy().invalidate(),this._reSort(),this._reFilter(),this._finishUpdateSession(e)},i.prototype.getGroupItems=function(e){var r=[],i;return this.each(function(t){if(t instanceof C.default)return void(i=t.getContents());if(i===e)r.push(t)}),r},i.prototype.getGroupByIndex=function(t){var e,r=this.getEnumerator(),i,n=0;while(r.moveNext()){if((i=r.getCurrent())instanceof C.default)e=i.getContents();if(n===t)break;n++}return e},i.prototype.getSort=function(){return this._$sort.slice()},i.prototype.setSort=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this._startUpdateSession(),i=t[0]instanceof Array?t[0]:t;if(this._$sort.length===i.length){for(var n=false,o=0;o<i.length;o++)if(this._$sort[o]!==i[o]){n=true;break}if(!n)return}if(this._switchImportantPropertiesByUserSort(false),this._$sort.length=0,this._$sort.push.apply(this._$sort,v(i)),this._switchImportantPropertiesByUserSort(true),this._getItemsStrategy().invalidate(),this._reSort(),this._isFiltered())this._reFilter();this._finishUpdateSession(r)},i.prototype.addSort=function(t,e){if(this._$sort.indexOf(t)>-1)return;var r=this._startUpdateSession();if(this._switchImportantPropertiesByUserSort(false),void 0===e)this._$sort.push(t);else this._$sort.splice(e,0,t);if(this._switchImportantPropertiesByUserSort(true),this._getItemsStrategy().invalidate(),this._reSort(),this._isFiltered())this._reFilter();this._finishUpdateSession(r)},i.prototype.removeSort=function(t){var e=this._$sort.indexOf(t);if(-1===e)return false;var r=this._startUpdateSession();if(this._switchImportantPropertiesByUserSort(false),this._$sort.splice(e,1),this._switchImportantPropertiesByUserSort(true),this._getItemsStrategy().invalidate(),this._reSort(),this._isFiltered())this._reFilter();return this._finishUpdateSession(r),true},i.prototype.getIdProperty=function(){return this._$idProperty},i.prototype.isUnique=function(){return this._$unique},i.prototype.setUnique=function(t){if(this._$unique===t)return;var e=this._startUpdateSession();this._$unique=t,this._composer.getInstance(u.default).unique=t,this._getItemsStrategy().invalidate(),this._reSort(),this._finishUpdateSession(e)},i.prototype.notifyItemChange=function(t,e){var r=this._isFiltered(),i=this._isGrouped();if(r||i){var n=this._startUpdateSession();if(i)this._reGroup(),this._reSort();if(r)this._reFilter();this._finishUpdateSession(n)}if(!this.isEventRaising())return;var o=this.getIndex(t),s=[t];s.properties=e,this._notifyBeforeCollectionChange(),this._notifyCollectionChange(f.default.ACTION_CHANGE,s,o,s,o),this._notifyAfterCollectionChange()},i.prototype.getSelectedItems=function(){for(var t=this._getItems(),e=[],r=t.length-1;r>=0;r--)if(t[r].isSelected())e.push(t[r]);return e},i.prototype.setSelectedItems=function(t,e){for(var r=[],i=0,n=t.length;i<n;i++)r.push(this.getItemBySourceItem(t[i]));this._setSelectedItems(r,e)},i.prototype.setSelectedItemsAll=function(t){this._setSelectedItems(this._getItems(),t)},i.prototype.invertSelectedItemsAll=function(){for(var t=this._getItems(),e=t.length-1;e>=0;e--)t[e].setSelected(!t[e].isSelected(),true);this._notifyBeforeCollectionChange(),this._notifyCollectionChange(f.default.ACTION_RESET,t,0,t,0),this._notifyAfterCollectionChange()},i.prototype._getSerializableState=function(t){return(t=c.SerializableMixin.prototype._getSerializableState.call(this,t))._composer=this._composer,t},i.prototype._setSerializableState=function(n){var o=c.SerializableMixin.prototype._setSerializableState(n);return function(){if(o.call(this),this._composer=n._composer,this._composer){var t=this._composer.getInstance(l.default);if(t)t.handlers=this._$sort;var e=this._composer.getInstance(p.default);if(e)e.handler=this._$group;if(this._composer){var r=function(t,e){t.forEach(function(t){if(void 0!==t._contentsIndex)t._$owner=e,t.getContents()})};try{var i=this._composer.getResult();do{if(i._items)r(i._items,this);i=i.source}while(i)}catch(t){if(void 0!==typeof d)d.error(t)}}}}},i.prototype._exctractItemId=function(t){var e=t.getContents(),r;if(e["[Types/_entity/Model]"])r=e.getId();else if(this._$idProperty)r=y.object.getPropertyValue(e,this._$idProperty);else throw new Error('Option "idProperty" must be defined to extract item unique id.');return String(r)},i.prototype._searchItemUid=function(t,e){var r=e,i=this._itemsUid,n=0;while(i.has(r))r=e.concat("-",String(++n));return i.add(r),r},i.prototype._analizeUpdateSession=function(t){if(t)this._notifyBeforeCollectionChange();if(h.EventRaisingMixin._analizeUpdateSession.call(this,t),t)this._notifyAfterCollectionChange()},i.prototype._notifyCollectionChange=function(r,i,n,o,s,t){var a=this;if(!this._isNeedNotifyCollectionChange())return;if(!t||r===f.default.ACTION_RESET||!this._isGrouped())return void this._notifyLater("onCollectionChange",r,i,n,o,s);for(var e=function(t,e){if(t<e)a._notifyLater("onCollectionChange",r,i.slice(t,e),i.length?n+t:0,o.slice(t,e),o.length?s+t:0)},u=r===f.default.ACTION_REMOVE,l=u?o.length:i.length,p=0,c,h=0;h<l;h++){if((c=u?o[h]:i[h])instanceof C.default)e(p,h),p=h;if(h===l-1)e(p,h+1)}},i.prototype._setSelectedItems=function(t,e){var r=[];e=!!e;for(var i=t.length-1;i>=0;i--)if(t[i].isSelected()!==e)t[i].setSelected(e,true),r.push(t[i]);if(r.length>0){var n=this.getIndex(r[0]);this._notifyBeforeCollectionChange(),this._notifyCollectionChange(f.default.ACTION_REPLACE,r,n,r,n),this._notifyAfterCollectionChange()}},i.prototype._setImportantProperty=function(t){var e;if(-1===this._$importantItemProperties.indexOf(t))this._$importantItemProperties.push(t)},i.prototype._unsetImportantProperty=function(t){var e=this._$importantItemProperties.indexOf(t);if(-1!==e)this._$importantItemProperties.splice(e,1)},i.prototype._switchImportantPropertiesByUserSort=function(t){for(var e=0;e<this._$sort.length;e++)i._functorToImportantProperties(this._$sort[e],this,t)},i.prototype._switchImportantPropertiesByGroup=function(t){i._functorToImportantProperties(this._$group,this,t)},i.prototype._bindHandlers=function(){this._onCollectionChange=I.bind(this),this._onCollectionItemChange=S.bind(this),this._oEventRaisingChange=x.bind(this)},i.prototype._unbindHandlers=function(){this._onCollectionChange=null,this._onCollectionItemChange=null,this._oEventRaisingChange=null},i.prototype._getItems=function(){return this._getItemsStrategy().items},i.prototype._getItemsFactory=function(){return function t(e){return e.owner=this,_.resolve(this._itemModule,e)}},i.prototype._getItemsStrategy=function(){if(!this._composer)this._composer=this._createComposer();return this._composer.getResult()},i.prototype._resetItemsStrategy=function(){this._composer=null},i.prototype._createComposer=function(){var t=new a.default;return t.append(u.default,{display:this,localize:this._localize,idProperty:this._$idProperty,unique:this._$unique}).append(l.default,{handlers:this._$sort}).append(p.default,{handler:this._$group}),t},i.prototype._getEnumerator=function(t){return this._buildEnumerator(t?this._getItems().slice():this._getItems.bind(this),t?this._filterMap.slice():this._filterMap,t?this._sortMap.slice():this._sortMap)},i.prototype._buildEnumerator=function(t,e,r){return new o.default({items:t,filterMap:e,sortMap:r})},i.prototype._getCursorEnumerator=function(){return this._cursorEnumerator||(this._cursorEnumerator=this._getEnumerator())},i.prototype._getUtilityEnumerator=function(){return this._utilityEnumerator||(this._utilityEnumerator=this._getEnumerator())},i.prototype._getNearbyItem=function(t,e,r,i){var n=r?"moveNext":"movePrevious",o;t.setCurrent(e);while(t[n]()){if(o=t.getCurrent(),i&&o instanceof C.default){o=void 0;continue}break}return o},i.prototype._getItemIndex=function(t){return this._getItemsStrategy().getDisplayIndex(t)},i.prototype._getSourceIndex=function(t){return this._getItemsStrategy().getCollectionIndex(t)},i.prototype._reBuild=function(t){var e=this._getItemsStrategy();if(this._reIndex(),t)e.reset();if(this._reGroup(),this._reSort(),this._resetFilter(e.count),this._isFiltered())this._reFilter()},i.prototype._reAnalize=function(t,e){t=t||0;var r=this._getItemsStrategy(),i=this._startUpdateSession(),n=r.getDisplayIndex(t);r.invalidate();var o=r.getDisplayIndex(t);if(void 0===e)e=r.count-o;if(this._reGroup(t,e),this._reSort(),n!==o||this._isFilteredByIndex())this._reFilter();else this._reFilter(o,e);this._finishUpdateSession(i)},i.prototype._reIndex=function(){this._getCursorEnumerator().reIndex(),this._getUtilityEnumerator().reIndex()},i.prototype._resetFilter=function(t){for(var e=this._filterMap.length=0;e<t;e++)this._filterMap.push(true);this._reIndex()},i.prototype._reFilter=function(t,e){t=t||0,e=e||this._getItemsStrategy().count-t;var a=this._$filter,u=a.length,r=this._getItems(),i=this._sortMap,n=i.length,o=this._filterMap,s=new b.Set,l=t+e,p=false,c,h,f,_,y=-1,d=-1,g=false,m,v=function(t,e,r,i){for(var n=true,o,s=0;s<u;s++)if(!(n=(o=a[s])(t.getContents(),e,t,r,i)))break;return n},I=function(t,e){var r=o[e];if(t===r)return false;if(t)return o[e]=t,true;else if(void 0!==r)return o[e]=t,true;return false};for(h=0;h<n;h++){if(void 0===(f=i[h])||f<t||f>=l)continue;if(s.add(f),m=true,(c=r[f])instanceof C.default){if(_)p=I(m=v(_,y,d,g),y)||p;_=c,y=f,d=h,g=false}else if(p=I(m=v(c,f,h),f)||p,m)g=true}for(f=t;f<l;f++)if(!s.has(f))o[f]=void 0;if(_)p=I(m=v(_,y,d,g),y)||p;if(p)this._reIndex()},i.prototype._reSort=function(){var t;this._sortMap.length=0;var e=this._buildSortMap();(t=this._sortMap).push.apply(t,e),this._reIndex()},i.prototype._buildSortMap=function(){return this._getItems().map(function(t,e){return e})},i.prototype._reGroup=function(t,e){if(!this._composer)return;var r;this._composer.getInstance(p.default).invalidate()},i.prototype._isFiltered=function(){return this._$filter.length>0},i.prototype._isFilteredByIndex=function(){var e=this;return this._$filter.some(function(t){return e._isFilterUseIndex(t)})},i.prototype._isFilterUseIndex=function(t){return t.length>3},i.prototype._isGrouped=function(){return!!this._$group},i.prototype._addItems=function(t,e){var r,i,n=this._isFiltered(),o=this._getItemsStrategy(),s,a=[],u=[],l=[];return o.splice(t,0,e),s=o.getDisplayIndex(t),e.forEach(function(t,e){a.push(!n),u.push(s+e),l.push(void 0)}),(r=this._filterMap).splice.apply(r,[s,0].concat(a)),(i=this._sortMap).splice.apply(i,[s,0].concat(u)),s},i.prototype._removeItems=function(t,e){t=t||0;var r=this._getItemsStrategy(),i,n;return e=void 0===e?r.count-t:e,i=(n=r.splice(t,e)).start=r.getDisplayIndex(t),this._filterMap.splice(i,e),this._removeFromSortMap(i,e),n},i.prototype._replaceItems=function(t,e){var r=this._getItemsStrategy(),i=r.splice(t,e.length,e);return i.start=r.getDisplayIndex(t),i},i.prototype._moveItems=function(t,e,r){var i=r.length,n=this._getItemsStrategy(),o;return o=n.splice(e,i),n.splice(t,0,o),o.oldIndex=n.getDisplayIndex(e),o},i.prototype._removeFromSortMap=function(t,e){var r=(t=t||0)+(e=e||0),i,n,o=[],s={};for(i=t;i<r;i++)if((n=this._sortMap.indexOf(i))>-1)o.push(n),s[n]=this._sortMap[n];for(o.sort(function(t,e){return t-e}),i=o.length-1;i>=0;i--)this._sortMap.splice(o[i],1);for(i=0;i<this._sortMap.length;i++)if(this._sortMap[i]>=t)this._sortMap[i]-=e;return this._reIndex(),s},i.prototype._getItemState=function(t){return{item:t,selected:t.isSelected()}},i.prototype._getItemsState=function(t){return t.map(this._getItemState)},i.prototype._getItemsDiff=function(i,t){return t.filter(function(e,t){var r=i[t];return Object.keys(e).some(function(t){return e[t]!==r[t]})}).map(function(t){return t.item})},i.prototype._checkItemsDiff=function(r,t,e,i){var n=this,o=e?this._getItemsDiff(e,this._getItemsState(t)):[];if(i)i(o,t);if(o.length)this._notifyBeforeCollectionChange(),h.EventRaisingMixin._extractPacksByList(this,o,function(t,e){n._notifyCollectionChange(f.default.ACTION_CHANGE,t,e,t,e,r)}),this._notifyAfterCollectionChange()},i.prototype._notifyCurrentChange=function(t,e,r,i){if(!this.isEventRaising())return;this._removeFromQueue("onCurrentChange"),this._notify("onCurrentChange",t,e,r,i)},i.prototype._notifyCollectionItemsChange=function(t,e,r){for(var i=this,n=this._getItems(),o=e+t.length,s=[],a=e;a<o;a++)s.push(n[this._getItemIndex(a)]);this._notifyBeforeCollectionChange(),h.EventRaisingMixin._extractPacksByList(this,s,function(t,e){i._notifyCollectionChange(f.default.ACTION_CHANGE,t,e,t,e,r)}),this._notifyAfterCollectionChange()},i.prototype._notifySourceCollectionItemChange=function(t,e,r,i){var n=this._getUtilityEnumerator(),o=this._getItems(),s=this._getItemIndex(r),a,u=o[s],l=n.getInternalBySource(s),p,c=this.isEventRaising(),h=this._startUpdateSession(),f,_;for(var y in i)if(i.hasOwnProperty(y))if(this._$importantItemProperties.indexOf(y)>-1){if(c)_=this._getItemsState(o);this._reAnalize(r,1);break}if(!c)return;this._finishUpdateSession(h,false),a=this._getItemIndex(r),p=n.getInternalBySource(a),f=l!==p,this._checkItemsDiff(h,o,_,function(t){var e=t.indexOf(u);if(f){if(e>-1&&l>p)t.splice(e,1);else if(-1===e&&l<p)t.push(u)}else if(!f&&-1===e)t.push(u)})},i.prototype._notifyBeforeCollectionChange=function(){if(!this.isEventRaising())return;this._notifyLater("onBeforeCollectionChange")},i.prototype._notifyAfterCollectionChange=function(){if(!this.isEventRaising())return;this._notify("onAfterCollectionChange")},i}(y.mixin(r.default,c.SerializableMixin,h.EventRaisingMixin));e.default=O,Object.assign(O.prototype,{"[Types/_display/Collection]":true,_moduleName:"Types/display:Collection",_$collection:null,_$filter:null,_$group:null,_$sort:null,_$idProperty:"",_$unique:false,_$importantItemProperties:null,_localize:false,_itemModule:"Types/display:CollectionItem",_itemsFactory:null,_composer:null,_sourceCollectionSynchronized:true,_sourceCollectionDelayedCallbacks:null,_cursorEnumerator:null,_utilityEnumerator:null,_onCollectionChange:null,_onCollectionItemChange:null,_oEventRaisingChange:null}),O.prototype["[WS.Data/Display/Collection]"]=true,_.register("Types/display:Collection",O)}(_,t,l,p,c,f,h,b,g,P,$,M,u,o,a,s,n);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),N=A;t["Types/_display/itemsStrategy"]=true;var j,z=function(){"use strict";var t={},e=(r=_,i=t,n=d,o=w,s=g,a=P,u=M,l=C,p=y,c=T,h=$,Object.defineProperty(i,"__esModule",{value:true}),i.AbstractStrategy=n.default,i.AdjacencyList=o.default,i.Composer=s.default,i.Direct=a.default,i.Group=u.default,i.MaterializedPath=l.default,i.Root=p.default,i.Search=c.default,void(i.User=h.default)),r,i,n,o,s,a,u,l,p,c,h;if(e instanceof Function)return e;else for(var f in e)if(e.hasOwnProperty(f))t[f]=e[f];return t}();t["Types/_display/Flags"]=true;var F,B=function(){"use strict";var t={},e=function(t,e,i,r,n){function o(t,e){var i=this;if(Array.isArray(e))e.forEach(function(t,e){var r=i.getItemBySourceIndex(e);i.notifyItemChange(r,"selected")});else{var r=this.getItemBySourceItem(e);this.notifyItemChange(r,"selected")}}Object.defineProperty(e,"__esModule",{value:true});var s=function(r){function t(t){var e=r.call(this,t)||this;if(!e._$collection["[Types/_collection/IFlags]"])throw new TypeError(e._moduleName+": source collection should implement Types/_collection/IFlags");if(e._$collection["[Types/_entity/ObservableMixin]"])e._$collection.subscribe("onChange",e._onSourceChange);return e}return i.__extends(t,r),t.prototype.destroy=function(){if(this._$collection["[Types/_entity/DestroyableMixin]"]&&this._$collection["[Types/_entity/ObservableMixin]"]&&!this._$collection.destroyed)this._$collection.unsubscribe("onChange",this._onSourceChange);r.prototype.destroy.call(this)},t.prototype._bindHandlers=function(){r.prototype._bindHandlers.call(this),this._onSourceChange=o.bind(this)},t}(r.default);e.default=s,Object.assign(s.prototype,{"[Types/_display/Flags]":true,_moduleName:"Types/display:Flags",_itemModule:"Types/display:FlagsItem",_localize:true}),n.register("Types/display:Flags",s)}(_,t,l,A,a,x);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/Ladder"]=true;var R,D=function(){"use strict";var t={},e=function(t,e,i,n,o,h,l,f){function a(t){if(t.getInstanceId instanceof Function)return t.getInstanceId();else if(t.getId instanceof Function)return t.getId();else if(t.get instanceof Function)return t.get("id");return t&&t.id}function _(t){return a(t.getContents())}Object.defineProperty(e,"__esModule",{value:true});var r=function(r){function t(t){var e=r.call(this)||this;if(e._collection=null,e._collectionItems=null,e._offset=0,e._converters=null,e._columnNames=[],e._column2primaryId=null,e._onCollectionChangeHandler=null,e._onAfterCollectionChangeHandler=null,e._onEventRaisingChangeHandler=null,o.SerializableMixin.constructor.call(e),e._onCollectionChangeHandler=e._onCollectionChange.bind(e),e._onAfterCollectionChangeHandler=e._onAfterCollectionChange.bind(e),e._onEventRaisingChangeHandler=e._onEventRaisingChange.bind(e),t)e.setCollection(t);else e.reset();return e}return i.__extends(t,r),t.prototype.destroy=function(){this.setCollection(null),r.prototype.destroy.call(this)},t.prototype.getCollection=function(){return this._collection},t.prototype.setCollection=function(t){if(null!==t&&!(t instanceof n.default))throw new TypeError('Argument "collection" should be an instance of Types/_display/Collection');var e=t!==this._collection;if(this._collection&&!this._collection.destroyed)this._collection.unsubscribe("onCollectionChange",this._onCollectionChangeHandler),this._collection.unsubscribe("onAfterCollectionChange",this._onAfterCollectionChangeHandler),this._collection.unsubscribe("onEventRaisingChange",this._onEventRaisingChangeHandler);if(t&&!t.destroyed)t.subscribe("onCollectionChange",this._onCollectionChangeHandler),t.subscribe("onAfterCollectionChange",this._onAfterCollectionChangeHandler),t.subscribe("onEventRaisingChange",this._onEventRaisingChangeHandler);if(this._collection=t,e)this._applyCollection(),this._columnNames=[],this.reset()},t.prototype.setOffset=function(t){t=parseInt(t,10);var e=this._offset;this._offset=t;var r=this._checkRange(this._offset,2);if(this._notifyPrimaryChanges(r),Math.abs(e-t)>1)r=this._checkRange(e,1),this._notifyPrimaryChanges(r)},t.prototype.reset=function(){this._column2primaryId=new f.Map},t.prototype.setConverter=function(t,e){this._converters=this._converters||{},this._converters[t]=e},t.prototype.get=function(t,e){return this.isPrimary(t,e)?l.object.getPropertyValue(t,e):""},t.prototype.isPrimary=function(t,e){if(!this._collection)return true;this._applyColumn(e);var r=a(t),i=this._getColumnData(e),n=i.has(r),o=n?i.get(r):void 0,s=this._collection.getIndexBySourceItem(t);if(!n||o[1]!==s)this._checkRange(s,1,true),o=(n=i.has(r))?i.get(r):void 0;return n?!!o[0]:true},t.prototype.isLadderColumn=function(t){return this._column2primaryId.has(t)},t.prototype._getSerializableState=function(t){if(t=o.SerializableMixin.prototype._getSerializableState.call(this,t),this._collection)t.$options=this._collection;else delete t.$options;if(this._offset)t._offset=this._offset;if(this._columnNames.length)t._columnNames=this._columnNames;return t},t.prototype._setSerializableState=function(t){var e=o.SerializableMixin.prototype._setSerializableState(t);return function(){if(e.call(this),t._offset)this._offset=t._offset;if(t._columnNames)if(this._columnNames=t._columnNames,this._collection)this._checkRange(0,this._collectionItems.length)}},t.prototype._applyCollection=function(){if(!this._collection)return void(this._collectionItems=null);var e=this._collectionItems=[];this._collection.each(function(t){e.push(t)})},t.prototype._spliceCollection=function(t,e,r){var i;if(!this._collectionItems)return;(i=this._collectionItems).splice.apply(i,[t,e].concat(r))},t.prototype._applyColumn=function(t){var e=this._columnNames;if(e.indexOf(t)>-1)return;e.push(t)},t.prototype._getColumnData=function(t){var e=this._column2primaryId;if(e.has(t))return e.get(t);var r=new f.Map;return e.set(t,r),r},t.prototype._onCollectionChange=function(t,e,r,i,n,o){var u=this,s=Array.prototype.push,a=[],l=function(t,e){if(t.length){var r=u._columnNames,i=new f.Set,n=void 0,o=void 0,s=void 0,a=void 0;for(e.forEach(function(t){i.add(_(t))}),n=0;n<r.length;n++)for(o=u._getColumnData(r[n]),s=0;s<t.length;++s)if(a=_(t[s]),!i.has(a))o.delete(a)}},p=function(t,e,r){return e>0?u._checkRange(r-1,t.length+2):[]};switch(e){case h.IObservable.ACTION_ADD:this._spliceCollection(i,0,r),s.apply(a,p(r,r.length,i));break;case h.IObservable.ACTION_REMOVE:this._spliceCollection(o,n.length,[]),l(n,r),s.apply(a,p([],n.length,o));break;case h.IObservable.ACTION_CHANGE:a=this._checkRange(i-1,3);break;case h.IObservable.ACTION_MOVE:this._spliceCollection(o,n.length,[]),this._spliceCollection(i,0,r);var c=i>o?o:o+r.length;s.apply(a,p([],n.length,c)),s.apply(a,p(r,r.length,i));break;default:if(this._applyCollection(),e===h.IObservable.ACTION_RESET&&this._collectionItems&&this._collectionItems.length!==r.length)r=this._collectionItems;l(n,r),s.apply(a,p(r,r.length,i))}this._notifyPrimaryChanges(a)},t.prototype._onEventRaisingChange=function(t,e,r){if(e&&!r)this._applyCollection()},t.prototype._onAfterCollectionChange=function(){if(this._collectionItems&&this._collection.getCount()!==this._collectionItems.length)this._applyCollection()},t.prototype._notifyPrimaryChanges=function(t){var r=this,e=this._collection,i=this._collectionItems,n,o,s,a=t.reduce(function(t,e){if(null!==e)n=e[0],o=e[1],s=i[n],t[n]=t[n]||{},t[n][o]=r.get(s.getContents(),o);return t},{});for(n in a)if(a.hasOwnProperty(n))e.notifyItemChange(i[n],{contents:a[n]})},t.prototype._checkRange=function(t,e,r){var i=[],n=this._collection,o=this._collectionItems,s=this._columnNames,a,u,l,p=Math.min(t+e,r?n.getCount():o.length);for(t=Math.max(0,t),a=0;a<s.length;a++)for(u=t;u<p;++u)if(null!==(l=this._adjustPrimary(u,r?n.at(u):o[u],s[a],r)))i.push(l);return i},t.prototype._adjustPrimary=function(t,e,r,i){if(!e)return null;var n=_(e),o,s,a;if(void 0!==n)if(o=this._getColumnData(r),(s=this._isPrimaryIndex(t,r,i))!==(a=(a=o.get(n))?a[0]:a))return o.set(n,[s,t]),[t,r];return null},t.prototype._isPrimaryIndex=function(t,e,r){if(0===t||t===this._offset)return true;var i=this._collection,n=this._collectionItems,o=(r?i.at(t-1):n[t-1]).getContents(),s=(r?i.at(t):n[t]).getContents(),a=l.object.getPropertyValue(o,e),u=l.object.getPropertyValue(s,e);if(this._converters&&this._converters.hasOwnProperty(e))a=this._converters[e](a,o),u=this._converters[e](u,s);if(a instanceof Object&&u instanceof Object)a=a.valueOf(),u=u.valueOf();return a!==u},t}(l.mixin(o.DestroyableMixin,o.SerializableMixin));(e.default=r).prototype._moduleName="Types/display:Ladder",r.prototype["[Types/_display/Ladder]"]=true}(_,t,l,A,u,o,s,n);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/Enum"]=true;var U,G=function(){"use strict";var t={},e=function(t,e,r,i,n){function s(t,e){this.setCurrentPosition(this.getIndexBySourceIndex(e))}Object.defineProperty(e,"__esModule",{value:true});var o=function(o){function t(t){var e=o.call(this,t)||this;if(!e._$collection["[Types/_collection/IEnum]"])throw new TypeError(e._moduleName+": source collection should implement Types/_collection/IEnum");if(e._getCursorEnumerator().setPosition(e.getIndexBySourceIndex(e._$collection.get())),e._$collection["[Types/_entity/ObservableMixin]"])e._$collection.subscribe("onChange",e._onSourceChange);return e}return r.__extends(t,o),t.prototype.destroy=function(){if(this._$collection["[Types/_entity/DestroyableMixin]"]&&this._$collection["[Types/_entity/ObservableMixin]"]&&!this._$collection.destroyed)this._$collection.unsubscribe("onChange",this._onSourceChange);o.prototype.destroy.call(this)},t.prototype._bindHandlers=function(){o.prototype._bindHandlers.call(this),this._onSourceChange=s.bind(this)},t.prototype._notifyCurrentChange=function(t,e,r,i){var n=null;if(r>-1)n=this.getSourceIndexByIndex(r);this._$collection.set(n),o.prototype._notifyCurrentChange.call(this,t,e,r,i)},t.prototype._getSourceIndex=function(t){var e=this._$collection.getEnumerator(),r=0;if(t>-1)while(e.moveNext()){if(r===t)return e.getCurrentIndex();r++}return-1},t.prototype._getItemIndex=function(t){var e=this._$collection.getEnumerator(),r=0;while(e.moveNext()){if(e.getCurrentIndex()==t)return r;r++}return-1},t}(i.default);e.default=o,Object.assign(o.prototype,{"[Types/_display/Enum]":true,_moduleName:"Types/display:Enum",_localize:true,_onSourceChange:null}),n.register("Types/display:Enum",o)}(_,t,l,A,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();t["Types/_display/Tree"]=true;var k=function(){"use strict";var t={},e=function(t,e,r,i,n,c,a,o,u,l,p,h,s,f){function _(t,e,r,i,n,o){var s=this.instance._getItems().filter(function(t){return t.isNode&&t.isNode()}),a=this.instance._getItemsState(s),u=this.instance._startUpdateSession();this.instance._reIndex(),this.prev(t,e,r,i,n,o),this.instance._finishUpdateSession(u,false),this.instance._checkItemsDiff(u,s,a)}function y(t,e,r,i){this.instance._reIndex(),this.prev(t,e,r,i)}function d(t){return"!"===t[0]?t.slice(1):"!"+t}Object.defineProperty(e,"__esModule",{value:true});var g=function(s){function t(t){var e=this;if(e._childrenMap={},t&&!t.hasChildrenProperty&&t.loadedProperty)t.hasChildrenProperty=d(t.loadedProperty);if((e=s.call(this,t)||this)._$parentProperty)e._setImportantProperty(e._$parentProperty);if(e._$childrenProperty)e._setImportantProperty(e._$childrenProperty);return e}return r.__extends(t,s),t.prototype.destroy=function(){this._childrenMap={},s.prototype.destroy.call(this)},t.prototype._getSerializableState=function(t){return(t=s.prototype._getSerializableState.call(this,t))._root=this._root,t},t.prototype._setSerializableState=function(t){var e=s.prototype._setSerializableState.call(this,t);return function(){this._root=t._root,e.call(this)}},t.prototype.getIndexBySourceItem=function(t){if(this._$rootEnumerable&&this.getRoot().getContents()===t)return 0;return s.prototype.getIndexBySourceItem.call(this,t)},t.prototype.moveToNext=function(){return this._moveTo(true)},t.prototype.moveToPrevious=function(){return this._moveTo(false)},t.prototype._exctractItemId=function(t){var e=[s.prototype._exctractItemId.call(this,t)],r;while((r=t.getParent())&&!r.isRoot())e.push(s.prototype._exctractItemId.call(this,r)),t=r;return e.join(":")},t.prototype.getParentProperty=function(){return this._$parentProperty},t.prototype.setParentProperty=function(t){this._unsetImportantProperty(this._$parentProperty),this._$parentProperty=t,this._resetItemsStrategy(),this._setImportantProperty(t),this._reBuild(true)},t.prototype.getNodeProperty=function(){return this._$nodeProperty},t.prototype.getChildrenProperty=function(){return this._$childrenProperty},t.prototype.getHasChildrenProperty=function(){return this._$hasChildrenProperty},t.prototype.getLoadedProperty=function(){return d(this._$hasChildrenProperty)},t.prototype.getRoot=function(){if(null===this._root)if(this._root=this._$root,!(this._root instanceof a.default))this._root=new a.default({contents:this._root,owner:this,node:true,expanded:true,hasChildren:false});return this._root},t.prototype.setRoot=function(t){if(this._$root===t)return;this._$root=t,this._root=null,this._reIndex(),this._reAnalize()},t.prototype.isRootEnumerable=function(){return this._$rootEnumerable},t.prototype.setRootEnumerable=function(t){if(this._$rootEnumerable===t)return;var e=this._startUpdateSession();if(this._$rootEnumerable=t)this._wrapRootStrategy(this._composer);else this._unwrapRootStrategy(this._composer);this._reSort(),this._reFilter(),this._finishUpdateSession(e)},t.prototype.getChildren=function(t,e){return new o.default({owner:t,items:this._getChildrenArray(t,e)})},t.prototype.moveToAbove=function(){var t=this.getCurrent();if(!t)return false;var e=t.getParent();if(!e||e.isRoot())return false;return this.setCurrent(e),true},t.prototype.moveToBelow=function(){var t=this.getCurrent();if(!t||!t.isNode())return false;var e=this._getChildrenArray(t);if(0===e.length)return false;return this.setCurrent(e[0]),true},t.prototype._getItemsFactory=function(){var o=s.prototype._getItemsFactory.call(this);return function t(e){var r=this._$hasChildrenProperty,i=false;if("string"===typeof r&&"!"===r[0])r=r.substr(1),i=!i;var n=f.object.getPropertyValue(e.contents,r);if(e.hasChildren=i?!n:n,!("node"in e))e.node=f.object.getPropertyValue(e.contents,this._$nodeProperty);return o.call(this,e)}},t.prototype._createComposer=function(){var t=s.prototype._createComposer.call(this);if(this._$childrenProperty)t.remove(u.default),t.prepend(p.default,{display:this,childrenProperty:this._$childrenProperty,nodeProperty:this._$nodeProperty,hasChildrenProperty:this._$hasChildrenProperty,root:this.getRoot.bind(this)});else t.append(l.default,{idProperty:this._$idProperty,parentProperty:this._$parentProperty,nodeProperty:this._$nodeProperty,hasChildrenProperty:this._$hasChildrenProperty});return this._wrapRootStrategy(t),t},t.prototype._wrapRootStrategy=function(t){if(this._$rootEnumerable&&!t.getInstance(h.default))t.append(h.default,{root:this.getRoot.bind(this)})},t.prototype._unwrapRootStrategy=function(t){if(!this._$rootEnumerable)t.remove(h.default)},t.prototype._reIndex=function(){s.prototype._reIndex.call(this),this._childrenMap={}},t.prototype._bindHandlers=function(){s.prototype._bindHandlers.call(this),this._onCollectionChange=_.bind({instance:this,prev:this._onCollectionChange}),this._onCollectionItemChange=y.bind({instance:this,prev:this._onCollectionItemChange})},t.prototype._replaceItems=function(t,e){var i=s.prototype._replaceItems.call(this,t,e),n=this._getItemsStrategy(),o=n.count;return i.forEach(function(t,e){var r=i.start+e;if(r<o)n.at(r).setExpanded(t.isExpanded(),true)}),i},t.prototype._getItemState=function(t){var e=s.prototype._getItemState.call(this,t);if(t instanceof a.default)e.parent=t.getParent(),e.childrenCount=t.getOwner()._getChildrenArray(t,false).length,e.level=t.getLevel(),e.node=t.isNode(),e.expanded=t.isExpanded();return e},t.prototype._checkItem=function(t){if(!t||!(t instanceof n.default))throw new Error(this._moduleName+"::_checkItem(): item should be in instance of Types/_display/CollectionItem")},t.prototype._getChildrenArray=function(t,e){this._checkItem(t),e=void 0===e?true:!!e;var r,i=t.getInstanceId()+"|"+e;if(!(i in this._childrenMap)){var n=[],o=void 0;if(e)o=this.getEnumerator();else o=this._buildEnumerator(this._getItems.bind(this),this._filterMap.map(function(){return true}),this._sortMap);if(o.setCurrent(t),o.getCurrent()===t||t.isRoot()){var s=void 0;while(o.moveNext()){if(!((s=o.getCurrent())instanceof a.default))continue;if(s.getParent()===t)n.push(s);else if(s.getLevel()===t.getLevel())break}}this._childrenMap[i]=n}return this._childrenMap[i]},t.prototype._getNearbyItem=function(t,e,r,i){var n=r?"moveNext":"movePrevious",o=e&&e.getParent&&e.getParent()||this.getRoot(),s=true,a=t.getCurrent(),u=false,l,p;t.setCurrent(e);while(s&&!u){if(s=t[n](),p=t.getCurrent(),i&&p instanceof c.default){p=void 0;continue}u=p?p.getParent()===o:false,l=s&&u?p:void 0}return t.setCurrent(a),l},t.prototype._moveTo=function(t){var e=this._getCursorEnumerator(),r=this.getCurrent(),i=this._getNearbyItem(e,r,t,true),n=!!i;if(n)this.setCurrent(i);else e.setCurrent(r);return n},t.prototype._notifyItemsParent=function(t,e,r){if(r.hasOwnProperty(this.getParentProperty()))this._notifyItemsParentByItem(t.getParent()),this._notifyItemsParentByItem(e)},t.prototype._notifyItemsParentByItem=function(t){while(t!==this.getRoot())this.notifyItemChange(t,{children:[]}),t=t.getParent()},t}(i.default);e.default=g,Object.assign(g.prototype,{"[Types/_display/Tree]":true,_moduleName:"Types/display:Tree",_itemModule:"Types/display:TreeItem",_$parentProperty:"",_$nodeProperty:"",_$childrenProperty:"",_$hasChildrenProperty:"",_$root:void 0,_$rootEnumerable:false,_root:null}),g.prototype["[WS.Data/Display/Tree]"]=true,s.register("Types/display:Tree",g)}(_,t,l,A,h,b,v,E,P,w,C,y,a,s);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}(),L=k;t["Types/_display/Search"]=true;var H,V=function(){"use strict";var t={},e=function(t,e,r,i,n,o){Object.defineProperty(e,"__esModule",{value:true});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._createComposer=function(){var t=e.prototype._createComposer.call(this);return t.append(n.default),t},t}(i.default);(e.default=s).prototype._moduleName="Types/display:Search",s.prototype["[Types/_display/Search]"]=true,o.register("Types/display:Search",s)}(_,t,l,k,T,a);if(e instanceof Function)return e;else for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r];return t}();return t.Abstract=e.default,t.Collection=N.default,t.CollectionItem=r.default,t.Enum=G.default,t.Flags=B.default,t.FlagsItem=O.default,t.GroupItem=S.default,t.itemsStrategy=z,t.Ladder=D.default,t.Search=V.default,t.Tree=L.default,t.TreeItem=I.default,t});