define("Types/_collection/enumerableComparator",["require","exports","Types/_collection/IObservable"],function(e,t,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=0;function s(){if(n>65534)n=0;return n++}function d(e,t){var n=e.getEnumerator(),s=[],d=[],l;n.reset();while(n.moveNext())if(l=n.getCurrent(),s.push(l),t)d.push(l[t]());return{items:s,contents:t?d:null}}function I(e,t,n,s,d){t.addedProcessed=t.addedProcessed||[],t.removedProcessed=t.removedProcessed||{};var l=t.before,r=t.after,o=t.beforeContents,a=t.afterContents,i=t.addedProcessed,f=t.removedProcessed,c=[],I=0,m=[],h=0,u,g,p,w,x=false,v,b=Math.max(l.length,r.length),y,A;for(d=d||0,v=s=s||0;v<b;v++){switch(u=l[v],p=r[v],e){case"added":if(!p)continue;w=v,y=0,A=true;do{if(-1===(g=l.indexOf(p,y)))A=false;else if(i.indexOf(g)>-1)y=g+1;else{if(!c.length)i.push(g);A=false}}while(A);if(-1===g)c.push(p),I=1===c.length?w:I;else if(c.length)x=true;break;case"removed":if(!u)continue;g=v,y=0,A=true;do{if(-1===(w=r.indexOf(u,y)))A=false;else if(f[w])y=w+1;else{if(!m.length)f[w]=true;A=false}}while(A);if(-1===w)m.push(u),h=1===m.length?g:h;else if(m.length)x=true;break;case"replaced":if(!o){v=-1,x=true;break}if(!p)continue;if(w=v,(g=l.indexOf(p))===w&&o[v]!==a[v])m.push(n._getItemsStrategy().convertToItem(o[v])),c.push(p),h=I=1===m.length?g:h;else if(m.length)x=true;break;case"moved":if(l.length!==r.length)throw new Error('The "before" and "after" arrays are not synchronized by the length - "move" can\'t be applied.');if(u===p){if(0===m.length)continue;x=true;break}if(w=v,(g=l.indexOf(p,v))!==w)if(m.length&&g!==h+m.length||c.length&&w!==I+c.length)x=true;else{if(0===m.length)h=g;if(m.push(p),0===c.length)I=w;c.push(p)}}if(x)break}return{newItems:c,newItemsIndex:I,oldItems:m,oldItemsIndex:h,endAt:x?v:-1,offset:d}}function m(e,t,n){var s=n.before,d=n.beforeContents,l=n.afterContents;switch(e){case"added":if(s.splice.apply(s,[t.newItemsIndex,0].concat(t.newItems)),n.addedProcessed){for(var r=t.newItems.length,o=0;o<n.addedProcessed.length;o++)if(n.addedProcessed[o]>=t.newItemsIndex)n.addedProcessed[o]+=r;for(var o=0;o<r;o++)n.addedProcessed.push(t.newItemsIndex+o)}if(null!==d){var a=l.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);d.splice.apply(d,[t.newItemsIndex,0].concat(a))}break;case"removed":if(s.splice(t.oldItemsIndex,t.oldItems.length),null!==d)d.splice(t.oldItemsIndex,t.oldItems.length);if(-1!==t.endAt)t.endAt-=t.oldItems.length;break;case"replaced":if(s.splice.apply(s,[t.oldItemsIndex,t.oldItems.length].concat(t.newItems)),null!==d){var a=l.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);d.splice.apply(d,[t.oldItemsIndex,t.oldItems.length].concat(a))}break;case"moved":var i=t.oldItemsIndex+t.oldItems.length>t.newItemsIndex?t.newItemsIndex:t.newItemsIndex-t.oldItems.length+1;if(s.splice(t.oldItemsIndex,t.oldItems.length),s.splice.apply(s,[i,0].concat(t.newItems)),null!==d){d.splice(t.oldItemsIndex,t.oldItems.length);var a=l.slice(t.newItemsIndex,t.newItemsIndex+t.newItems.length);d.splice.apply(d,[i,0].concat(a))}if(-1!==t.endAt&&t.oldItemsIndex<t.newItemsIndex)t.endAt-=t.oldItems.length}}var l={"[Types/_collection/enumerableComparator]":true,startSession:function(e,t){var n=d(e,t);return{id:s(),before:n.items,beforeContents:n.contents}},finishSession:function(e,t,n){var s=d(t,n);e.after=s.items,e.afterContents=s.contents},analizeSession:function(e,t,n){for(var s=["removed","added","replaced","moved"],d,l=Math.max(65535,s.length*e.before.length*e.after.length),r,o,a,i,f=0;f<s.length;f++){o=r=0,a=s[f];while(-1!==r){if((d=I(a,e,t,r,o)).newItems.length||d.oldItems.length){if(n){switch(i="",a){case"added":i=c.default.ACTION_ADD;break;case"removed":i=c.default.ACTION_REMOVE;break;case"replaced":i=c.default.ACTION_REPLACE;break;case"moved":i=c.default.ACTION_MOVE}n(i,d)}m(a,d,e)}if(-1!==d.endAt&&d.endAt<=r)if(0===--l)throw new Error("Endless cycle detected.");r=d.endAt,o=d.offset}}}};t.default=l});