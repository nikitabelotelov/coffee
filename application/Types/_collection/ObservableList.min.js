define("Types/_collection/ObservableList",["require","exports","tslib","Types/_collection/IObservable","Types/_collection/List","Types/_collection/EventRaisingMixin","Types/di","Types/util"],function(t,e,i,s,n,o,l,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});var h=Array.prototype.slice,r=function(n){function t(t){var e=n.call(this,t)||this;return o.default.constructor.call(e,t),e._publish("onCollectionChange","onCollectionItemChange"),e}return i.__extends(t,n),t.prototype.assign=function(t){var e=this._itemsSlice(),i=this._eventRaising;if(this._eventRaising=false,n.prototype.assign.call(this,t),this._eventRaising=i,e.length>0||this._$items.length>0)this._notifyCollectionChange(s.default.ACTION_RESET,this._itemsSlice(),0,e,0)},t.prototype.append=function(t){var e=this._eventRaising;this._eventRaising=false;var i=this.getCount();n.prototype.append.call(this,t),this._eventRaising=e,this._notifyCollectionChange(s.default.ACTION_ADD,this._itemsSlice(i),i,[],0)},t.prototype.prepend=function(t){var e=this._eventRaising;this._eventRaising=false;var i=this.getCount();n.prototype.prepend.call(this,t),this._eventRaising=e,this._notifyCollectionChange(s.default.ACTION_ADD,this._itemsSlice(0,this.getCount()-i),0,[],0)},t.prototype.clear=function(){var t=this._$items.slice(),e=this._eventRaising;this._eventRaising=false,n.prototype.clear.call(this),this._eventRaising=e,this._notifyCollectionChange(s.default.ACTION_RESET,this._itemsSlice(),0,t,0)},t.prototype.add=function(t,e){n.prototype.add.call(this,t,e),e=this._isValidIndex(e)?e:this.getCount()-1,this._notifyCollectionChange(s.default.ACTION_ADD,this._itemsSlice(e,e+1),e,[],0)},t.prototype.removeAt=function(t){var e=n.prototype.removeAt.call(this,t);return this._notifyCollectionChange(s.default.ACTION_REMOVE,[],0,[e],t),e},t.prototype.replace=function(t,e){var i=this._$items[e];if(n.prototype.replace.call(this,t,e),i!==t)this._notifyCollectionChange(s.default.ACTION_REPLACE,this._itemsSlice(e,e+1),e,[i],e)},t.prototype.move=function(t,e){var i=this._$items[t];if(n.prototype.move.call(this,t,e),t!==e)this._notifyCollectionChange(s.default.ACTION_MOVE,[i],e,[i],t)},t.prototype.relationChanged=function(t,e){var i=t.target,n=this.getIndex(i),s={},o;if(n>-1)this._reindex("",n,1);if(void 0===e[0])this._notifyItemChange(i,t.data||{});return{target:s[n]=i,data:s}},t.prototype.setEventRaising=function(t,e){var i=this;if(o.default.setEventRaising.call(this,t,e),t&&e&&this._silentChangedItems)if(this._silentChangedItems.length>=Math.min(this._resetChangesCount,this._$items.length))this._notifyCollectionChange(s.default.ACTION_RESET,this._itemsSlice(),0,[],0);else o.default._extractPacksByList(this,this._silentChangedItems,function(t,e){i._notifyCollectionChange(s.default.ACTION_CHANGE,t,e,t,e)});delete this._silentChangedItems},t.prototype._notifyItemChange=function(t,e){if(this._isNeedNotifyCollectionItemChange()){var i=this.getIndex(t);this._notify("onCollectionItemChange",this._$items[i],i,e)}if((this.hasEventHandlers("onCollectionItemChange")||this.hasEventHandlers("onCollectionChange"))&&!this._eventRaising){if(!this._silentChangedItems)this._silentChangedItems=[];this._silentChangedItems.push(t)}},t.prototype._itemsSlice=function(t,e){return h.apply(this._$items,arguments)},t.prototype._isNeedNotifyCollectionItemChange=function(){return this._eventRaising&&this.hasEventHandlers("onCollectionItemChange")},t}(a.mixin(n.default,s.default,o.default));(e.default=r).prototype["[Types/_collection/ObservableList]"]=true,r.prototype["[Types/_entity/relation/IReceiver]"]=true,r.prototype._moduleName="Types/collection:ObservableList",r.prototype._resetChangesCount=100,l.register("Types/collection:ObservableList",r,{instantiate:false})});