define("Env/Config",["Types/collection","optional!Types/source","Browser/Storage","Core/Abstract","Core/Deferred","optional!ParametersWebAPI/Scope","Env/Constants","require","exports"],function(n,c,l,d,p,o,a,g,e){Object.defineProperty(e,"__esModule",{value:true}),e["Env/_Constants/constants"]=true;var m=function(){"use strict";var e={},t=function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=+new Date,n=+new Date(2014,9,26),o={JSONRPC_PROOTOCOL_VERSION:5,appRoot:"/",resourceRoot:"/resources/",wsRoot:"/ws/",cdnRoot:"/cdn/",defaultServiceUrl:"/service/",logLevel:"info",buildnumber:"",isBrowserPlatform:"undefined"!==typeof window,isNodePlatform:"undefined"!==typeof process,isServerScript:"undefined"===typeof window&&"undefined"===typeof process,isBuildOnServer:"undefined"!==typeof process&&process.application,isNode:"undefined"!==typeof process&&process&&process.release&&"node"===process.release.name,compat:("undefined"===typeof window||window&&-1===window.location.href.indexOf("withoutLayout"))&&("undefined"===typeof window||false!==window.wsConfig.compatible),i18n:false,defaultLanguage:"",availableLanguage:{},dictionary:{},theme:"wi_scheme",tensorFontsUrl:["Controls-theme/themes/default/fonts/TensorFont.css","Controls-theme/themes/default/fonts/cbus-icons.css","Controls-theme/themes/default/helpers/general.css"],hosts:[],services:{},modules:{},jsCoreModules:{},jsModules:{},moscowTimeOffset:r>=n?3*60:4*60,styleLoadTimeout:4e3,IDENTITY_SPLITTER:",",userConfigSupport:false,globalConfigSupport:true,debug:false,saveLastState:true,checkSessionCookie:true,layoutConfig:{contentArea:["#contentArea","#contentAreaEdit","#ctr"]},isNewNav:true,xmlPackages:{},jsPackages:{},xmlContents:{},htmlNames:{},hdlBindings:{},startDragDistance:4,WINDOW_CLASSES:["Lib/Control/FloatArea/FloatArea","Lib/Control/Window/Window","Deprecated/Controls/FieldEditAtPlace/FieldEditAtPlace"],key:{left:37,up:38,right:39,down:40,insert:45,del:46,space:32,backspace:8,minus:109,plus:107,enter:13,esc:27,f1:112,f3:114,f4:115,f5:116,f7:118,f12:123,meta:157,underscore:95,pageUp:33,pageDown:34,end:35,home:36,tab:9,ctrl:17,b:66,h:72,v:86,y:89,q:81,p:80,m:77,n:78,o:79,androidAnyKey:229},modifiers:{nothing:0,shift:2,control:4,alt:8},operaKeys:{43:"plus",45:"minus"},NON_CTRL:".ws-non-control",fasttemplate:false,nostyle:false,javaStartTimeout:15e3,resizeDelay:40,classLoaderMappings:{},IE_ACTIVEOBJECT_XML_PRINT_TYPE:"Microsoft.XmlDom"},a;(function(){return this||(0,eval)("this")}()).IS_PRODUCTION=o.isProduction,t.default=o}(g,e);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Env/_Config/_ConfigMock"]=true;var i=function(){"use strict";var e={},t=function(e,t,o,r,a,i){Object.defineProperty(t,"__esModule",{value:true});var s="\v\t\b";function n(e){this.__loader=e}function u(){}function f(){}if(n.prototype.getParam=function(t,e){return this.__loader.load([t],e).addCallback(function(e){return e.get(t)}).createDependent()},n.prototype.getParams=function(e,t){var n=e||[];return this.__loader.load(e,t).addCallback(function(e){for(var t=[],r=0;r<n.length;r++)t.push({"Название":n[r],"Значение":e.get(n[r])});return new i.RecordSet({rawData:t,idProperty:"Название"})}).createDependent()},n.prototype.setParam=function(e,t){if(void 0===t||null===t)return this.removeParam(e);return this.__loader.set(e,t).addCallback(function(e){return e&&e.getScalar()}).createDependent()},n.prototype.removeParam=function(e){return this.__loader.remove(e).addCallback(function(e){return e&&e.getScalar()}).createDependent()},n.prototype.getParamValues=function(e){return this.getParam(e).addCallback(function(e){if(!e||"string"!==typeof e)return[];return e.split(s)})},n.prototype.setParamValue=function(t,r,n){if("undefined"===typeof n)n=10;var o=this;return this.getParamValues(t).addCallback(function(e){if(e.length>=n)e.pop();return e.unshift(r),o.setParam(t,e.join(s))}).createDependent()},u.prototype.getParam=function(e){return o.success("")},u.prototype.getParams=function(e){return o.success(new i.RecordSet)},u.prototype.setParam=function(e,t){return o.success(true)},u.prototype.removeParam=function(e){return o.success(true)},u.prototype.getParamValues=function(e){return o.success([])},u.prototype.setParamValue=function(e,t,r){return o.success(true)},f.prototype.getParam=function(e){return o.success(a.SessionStorage.get(e))},f.prototype.getParams=function(e){for(var t=[],r=0;r<e.length;r++)t.push({"Название":e[r],"Значение":a.SessionStorage.get(e[r])});var n=new i.RecordSet({rawData:t,idProperty:"Название"});return o.success(n)},f.prototype.setParam=function(e,t){return o.success(a.SessionStorage.set(e,t))},f.prototype.removeParam=function(e){return o.success(a.SessionStorage.remove(e))},f.prototype.getParamValues=function(e){return this.getParam(e).addCallback(function(e){if(!e||"string"!==typeof e)return[];return e.split(s)})},f.prototype.setParamValue=function(t,r,n){if("undefined"===typeof n)n=10;var o=this;return this.getParamValues(t).addCallback(function(e){if(e.length>=n)e.pop();return e.unshift(r),o.setParam(t,e.join(s))}).createDependent()},r.default.isBrowserPlatform)u=f;t.default={Mock:n,EmptyMock:u}}(g,e,p,a,l,n);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Env/_Config/AbstractConfigOld"]=true;var s=function(){"use strict";var e={},t=(r=g,n=e,o=d,a=p,i=l,s=m,u=c,Object.defineProperty(n,"__esModule",{value:true}),void(n.default=o.extend({$protected:{_blo:null},$constructor:function(){this._publish("onChange")},_isConfigSupport:function(){throw new Error("AbstractConfig:_isConfigSupport must be implemented in child classes")},_getObjectName:function(){throw new Error("AbstractConfig:_getObjectName must be implemented in child classes")},_getBLObject:function(){if(!u.SbisService)throw new Error("Для работы Core/AbstractConfig нужен модуль Types/source.SbisService");var e=new a,t=this;if(null===this._blo)return e.callback().addCallback(function(){return t._blo=new u.SbisService({endpoint:t._getObjectName()}),t._blo});else e.callback(this._blo);return e},_callMethod:function(t,r){if(!this._isConfigSupport())return a.success();return this._getBLObject().addCallback(function(e){return e.call(t,r)})},_prepareParam:function(e,t){var r={"Путь":e};if(t)r["Контекст"]=t;return r},_processingParam:function(e,t,r){if(!s.default.isBrowserPlatform||!t)return;switch(e){case"update":i.SessionStorage.set(t,r);break;case"delete":i.SessionStorage.remove(t);break;case"read":return i.SessionStorage.get(t)}this._notify("onChange",t,r)},_getParam:function(e,r,t){var n=this;return this._callMethod(e,this._prepareParam(r,t)).addCallback(function(e){if(!e)return n._processingParam("read",r);var t=e.getScalar();return n._processingParam("update",r,t),t})},getParam:function(e,t){return this._getParam("ПолучитьЗначение",e,t)},getParams:function(e){var n=this,t=e?{Names:e}:{};return this._callMethod("ПолучитьПараметры",t).addCallback(function(e){if(!e)return{};var t,r;if(t=e.getAll())t.each(function(e){(r=e.get("Название"))&&n._processingParam("update",r,e.get("Значение"))});return t})},setParam:function(e,t,r){if(void 0===t)t=null;if(this._processingParam("update",e,t),!this._isConfigSupport())return(new a).callback(true);var n=this._prepareParam(e,r);return n["ЗначениеПараметра"]=t,this._callMethod("ВставитьЗначение",n).addCallback(function(e){return e&&e.getScalar()})},removeParam:function(e,t){if(this._processingParam("delete",e,null),!this._isConfigSupport())return(new a).callback(true);var r=this._prepareParam(e,t);return this._callMethod("УдалитьПараметр",r).addCallback(function(e){return e&&e.getScalar()})}}))),r,n,o,a,i,s,u;if(t instanceof Function)return t;else for(var f in t)if(t.hasOwnProperty(f))e[f]=t[f];return e}(),t=s;e["Env/_Config/_ConfigMapper"]=true;var u=function(){"use strict";var e={},t=function(e,t,s,u){function f(){var e;if(window&&window.location)e=window.location.hostname;if(!e&&process&&process.domain&&process.domain.req)e=process.domain.req.hostname;return e}function r(e,t,r){if(s.default.isBrowserPlatform&&r)return new u.default.EmptyMock;var n=[];if(void 0!==t)n=[/online\.sbis\.ru$/];for(var o=f(),a=false,i=0;i<n.length&&!a;i++)if(n[i].test(o))a=true;if(!a)return e;return new u.default.Mock(t)}Object.defineProperty(t,"__esModule",{value:true}),r.isPreloadParams=function(){if(!s.default.userConfigSupport&&!s.default.globalConfigSupport)return false;var e=["/reg/","/person/"],t;if(window&&window.location)t=window.location.pathname;if(!t&&process&&process.domain&&process.domain.req)t=process.domain.req.pathname;if(!t)return true;if(null===(t=t.match("/.+?/")))return true;return t=t[0],-1===e.indexOf(t)},t.default=r}(g,e,a,i);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Env/_Config/ClientsGlobalConfigOld"]=true;var f=function(){"use strict";var e={},t=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:true});var o=new(n.default.extend({_getObjectName:function(){return"ГлобальныеПараметрыКлиента"},_isConfigSupport:function(){return r.default.isNodePlatform||r.default.globalConfigSupport}}));t.default=o}(g,e,a,s);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}(),r=f;e["Env/_Config/UserConfigOld"]=true;var h=function(){"use strict";var e={},t=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:true});var o,a=new(n.default.extend({_getObjectName:function(){return"ПользовательскиеПараметры"},_isConfigSupport:function(){return r.constants.isNodePlatform||r.constants.userConfigSupport},getParamValues:function(e,t){return this._getParam("ПолучитьСписокЗначений",e,t).addCallback(function(e){return e||[]})},setParamValue:function(e,t,r,n){var o=this._processingParam("read",e);if(o){if("string"==typeof o)o=[o];if(o.length>=(r||10))o.pop();o.unshift(t)}if(this._processingParam("update",e,o||[t]),!this._isConfigSupport())return(new i).callback(true);var a=this._prepareParam(e,n);return a["Значение"]=t,a["МаксимальноеКоличество"]=r||10,this._callMethod("ДобавитьЗначение",a).addCallback(function(e){return e&&e.getScalar()})}}));t.default=a}(g,e,a,s,p);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}(),v=h;e["Env/_Config/ClientsGlobalConfig"]=true;var _,C=function(){"use strict";var e={},t=function(e,t,r,n,o,a){var i;if(Object.defineProperty(t,"__esModule",{value:true}),a&&a.ACCOUNT)i=a.ACCOUNT;t.default=n.default(r.default,i,!o.default.globalConfigSupport)}(g,e,f,u,a,o);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();e["Env/_Config/UserConfig"]=true;var P,b=function(){"use strict";var e={},t=function(e,t,r,n,o,a){var i;if(Object.defineProperty(t,"__esModule",{value:true}),a&&a.USER)i=a.USER;t.default=n.default(r.default,i,!o.constants.userConfigSupport)}(g,e,h,u,a,o);if(t instanceof Function)return t;else for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}();return e.ClientsGlobalConfig=C.default,e.ClientsGlobalConfigOld=r.default,e.UserConfigOld=v.default,e.UserConfig=b.default,e.AbstractConfigOld=t.default,e});