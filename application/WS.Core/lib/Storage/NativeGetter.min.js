define("Lib/Storage/NativeGetter",["require","exports","Core/EventBus","Core/LocalStorageNative","Lib/Storage/utils/prefix","Core/detection","Lib/Storage/utils/item"],function(e,t,r,n,f,i,s){"use strict";var l=function(){return this||(0,eval)("this")}(),c="__storage",g=function(){return r.channel("local_storage")},a="ws-store-always-keys",o="ws-local-keys",u=f.add("ie-fix-event",c),d=[];function v(e){return e.length>=2143}var m=/\$ie-fix\{(\d+)\}/i,h=Math.random().toString().substr(2),p=function(e){return"$ie-fix{"+h+"}"+e},I=function(e){return e&&e.replace(m,"")||e},y;function k(e){if(!(e=e||l.event))return;var t=e.key,r=e.newValue,n=e.oldValue;if(r==n)return e.stopPropagation(),void e.stopImmediatePropagation();var i=Date.now(),a,o;if(y&&y.key===t&&y.newValue===r&&y.oldValue===n&&i-y.date<=2*1e3)return;if(y={key:t,newValue:r,oldValue:n,date:i},r){var u=r.match(m);if(u)r=r.replace(u[0],""),a=u[1],o=true,e.stopPropagation(),e.stopImmediatePropagation()}if(a===h)return;if(f.startsWith(t,c))return w(t,r,n);if(v(r))d.push({key:t,length:r.length});if(o)g().notify("onChange",t,s.deserialize(r))}function w(e,t,r){var n=f.remove(e,c),i=t;if(n===u)setTimeout(function(){var t=L.getItem(i),r=d.filter(function(e){return e.key===i&&e.length===t.length});if(!r)g().notify("onChange",i,s.deserialize(t));d=d.filter(function(e){return e!==r})},10)}var L={getItem:function(e){return I(n.getItem(e))},setItem:function(e,t){if(e===a||e===o)return n.setItem(e,t);t=p(t);var r=n.setItem(e,t);if(r&&v(t))n.setItem(u,e),n.removeItem(u);return r}};return["getLength","getKeys","removeItem","clear"].forEach(function(e){L[e]=n[e].bind(L)}),function(){if(i.isIE&&l.addEventListener)return l.addEventListener("storage",k,false),L;return n}});