define("Lib/Storage/LocalStorage",["require","exports","tslib","Core/EventBus","Lib/Storage/NativeGetter","Lib/Storage/utils/item","Lib/Storage/utils/prefix","Types/entity"],function(e,t,i,r,n,s,f,o){"use strict";var u=function(){return this||(0,eval)("this")}(),a="ws-store-always-keys",c=["onChange","onRemove","onClear"],h=function(){return r.channel("local_storage")},l=n(),p=false,v;function y(){if(p||!u)return;if(p=true,u.addEventListener)return u.addEventListener("storage",d,false)}function d(e){if(!e&&u.event)e=u.event;if(!e)return;var t=e.key,i=e.newValue,r=e.oldValue;if(!t)return void h().notify("onClear");if(!i)return h().notify("onRemove",t);return h().notify("onChange",t,s.deserialize(i))}function m(e,t,i){if(!t)return this._notify(e.name);if(f.startsWith(t,this.prefix))return this._notify(e.name,f.remove(t,this.prefix),i)}function g(e,t){return s.deserialize(l.getItem(e,!t))}function x(t){return l.getKeys().filter(function(e){return f.startsWith(e,t)})}return function(n){function e(e,t,i){if(void 0===e)e="";if(void 0===t)t=false;if(void 0===i)i=true;var r=n.call(this)||this;return r.prefix=e,r.storeAlways=t,r.isCheckSession=i,r._onStorage=m.bind(r),c.forEach(function(e){h().subscribe(e,r._onStorage)}),r._publish.apply(r,c),y(),r}return i.__extends(e,n),e.prototype.destroy=function(){var t=this;return c.forEach(function(e){h().unsubscribe(e,t._onStorage)}),n.prototype.destroy.call(this)},e.prototype.setItem=function(e,t){var i=f.add(e,this.prefix),r=s.serialize(t),n=l.setItem(i,r,!this.isCheckSession);if(!n||!this.storeAlways)return n;var o=g(a,!this.isCheckSession)||[];if(-1===o.indexOf(i))o.push(i),l.setItem(a,s.serialize(o),!this.isCheckSession);return n},e.prototype.getItem=function(e){return g(f.add(e,this.prefix),!this.isCheckSession)},e.prototype.removeItem=function(e){return l.removeItem(f.add(e,this.prefix))},e.prototype.clear=function(){x(this.prefix).forEach(function(e){l.removeItem(e)})},e.prototype.getKeys=function(){var t=this;return x(this.prefix).map(function(e){return f.remove(e,t.prefix)})},e.prototype.toObject=function(){var t=this,i={};return x(this.prefix).forEach(function(e){i[e]=g(e,!t.isCheckSession)}),i},e.clearAll=function(){l.clear()},e}(o.ObservableMixin)});