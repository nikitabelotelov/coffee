define("Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract",["Core/core-merge","Browser/TransportOld","Core/helpers/String/escapeHtml","Core/Deferred","Env/Env","Lib/Control/AreaAbstract/AreaAbstract"],function(x,s,y,a,r,t){"use strict";var l=t.extend({$protected:{_needOptionsOverrideData:true,_width:"300px",_height:"100px",_title:void 0,_isPage:false,_currentTemplateInstance:null,_options:{template:"",componentOptions:{},page:false,keepSize:true,block_by_task_1173286428:false},_defaultSize:null,_defaultTpl:null,_constructorOptions:[],_initContextRestriction:""},$constructor:function(t){if(this._constructorOptions=Object.keys(t).reduce(function(t,e){return t[e]=1,t}.bind(this),{}),this._defaultSize={autoHeight:this._options.autoHeight,autoWidth:this._options.autoWidth,verticalAlignment:this._verticalAlignment,horizontalAlignment:this._horizontalAlignment,_width:this._options.autoWidth?"auto":this._container.width(),_height:this._options.autoHeight?"auto":this._container.height()},this._prepareElements(),this._options.template)this._defaultTpl=this._options.template;for(var e=["width","height"],i=0,n=e.length;i<n;i++){var o=e[i];if(this._options[o])this["_"+o]=this._options[o]}if(""===this._width)this._width=this._options.autoWidth?"auto":this._container.width();if(""===this._height)this._height=this._options.autoHeight?"auto":this._container.height();this._initContextRestriction=this._context.getRestriction()},_prepareElements:function(){this._title=$("<span />")},_collectControlsToBuild:function(t,e){var i=l.superclass._collectControlsToBuild.apply(this,arguments);if(t&&t instanceof s.CompoundControlTemplate&&1==i.length){var n=this._options.componentOptions,o=r.IoC.resolve("ILogger");if(n){if(n.hasOwnProperty("id"))o.error("в TemplateAreaAbstract Передан componentOptions.id","В конструкторе или методе "+"setTemplate передана опция componentOptions, в которой есть параметр id. Этот параметр нельзя передавать "+"в componentOptions, потому что тогда он перебьёт опцию id у загружаемого контрола, и тот не найдёт себя в вёрстке"),delete n.id;if(n.hasOwnProperty("type"))o.error("в TemplateAreaAbstract передан componentOptions.type","В конструкторе или методе "+"setTemplate передана опция componentOptions, в которой есть параметр type. Этот параметр нельзя передавать "+"в componentOptions, потому что тогда он перебьёт опцию type у загружаемого контрола и его невозможно будет создать"),delete n.type}i[0]=x(i[0],n||{})}return i},_setTemplateDimensions:function(t){if(this._width=t.width,this._height=this._isPage&&!this._parent?"100%":t.height,(this._options.page||"100%"==t.height)&&!this._options.autoHeight)this._container.addClass("ws-area-height-100-fix")},_setMinMaxSizes:function(){this._container.css({"min-width":this._options.minWidth,"min-height":this._options.minHeight,"max-width":this._options.maxWidth==1/0?"":this._options.maxWidth,"max-height":this._options.maxHeight==1/0?"":this._options.maxHeight})},_restoreTemplateOverridenOptions:function(){for(var t in this._templateOverridenOptions)if(this._templateOverridenOptions.hasOwnProperty(t))this._options[t]=this._templateOverridenOptions[t];this._templateOverridenOptions={}},_updateDocumentTitle:function(){var t=this.getTitle(),e=document.title.lastIndexOf(t);if(t&&-1==e)document.title=t+document.title},_clearDocumentTitle:function(){var t=document.title.lastIndexOf(this.getTitle());if(t>0)document.title=document.title.slice(t,document.title.length)},_getTitle:function(){return this._title.text()},_setTitle:function(t){this._clearDocumentTitle(),this._title.attr("title",t),this._title.text(t),this._updateDocumentTitle()},getTitle:function(){return this._getTitle().trim()},setTitle:function(t){if(t)this._setTitle(t)},_loadTemplate:function(o,v){return this._runInBatchUpdate("_loadTemplate "+o+" - "+this._id,function(){this._isReady=false;var t="string"==typeof(o=o||this._options.template)?o:o.getName?o.getName():o instanceof a?"Deferred":"DOM",g=this,O=this._createChildrenLoadCallback(),T=this._makeLoadErrorHandler(O),b=this._createCheckDestroyedFunc("_loadTemplate",t,T),e=function(t){if(b(true))return;function i(t,e,i){if(this._isOptionDefault(i))t[i]=e;return t}function n(t,e,i){return t[i]=this._options[i],t}function o(t,e,i){if(s.indexOf(i)>-1)t[i]=e;return t}var e=(g._currentTemplateInstance=t).getDeclaredHandlers(),s=g._templateOptionsFilter(),a=t.getConfig(),r=Object.keys(a).reduce(function(t,e){return o(t,a[e],e)}.bind(this),{});if(void 0!==r.resizeable)r.resizable=r.resizeable,delete r.resizeable;if(!g._context.isGlobal())r.contextRestriction=r.independentContext?"setget":r.contextRestriction||g._initContextRestriction,g._context.setRestriction(r.contextRestriction);var l=Object.keys(r).reduce(function(t,e){return i.call(g,t,r[e],e)},{}),h=t.getStyle();if(g._restoreTemplateOverridenOptions(),g._templateOverridenOptions=Object.keys(l).reduce(function(t,e){return n.call(g,t,l[e],e)},{}),!g._options.name)g._options.name=a.windowName;if(g._options.autoHeight=g._defaultSize.autoHeight,g._options.autoWidth=g._defaultSize.autoWidth,!g._options.block_by_task_1173286428)g._container.width("").height("").css({"min-width":"","min-height":"","max-width":"","max-height":""});g._options=x(g._options,l);var p=t.getDimensions(),_,c,u;if(g._options.keepSize){if(a.autoWidth)g._options.autoWidth=true;if(a.autoHeight)g._options.autoHeight=true;if("Stretch"!==g._horizontalAlignment)if(g._options.block_by_task_1173286428)if(!g._options.autoWidth){if(g._container.width()<parseInt(p.width))g._container.css("width",p.width)}else g._container.css("width","auto");else g._container.css({width:g._options.autoWidth?"auto":p.width});else g._options.autoWidth=g._options.autoWidth||g._defaultSize.autoWidth;if("Stretch"!==g._verticalAlignment)g._container.css({height:g._options.autoHeight?"auto":p.height});else g._options.autoHeight=g._options.autoHeight||g._defaultSize.autoHeight}else g._options.autoHeight=g._defaultSize.autoHeight,g._options.autoWidth=g._defaultSize.autoWidth,g._options.maxWidth=1/0,g._options.minWidth=0,g._options.maxHeight=1/0,g._options.minHeight=0;for(_ in g._initSizeOptions(),g._setMinMaxSizes(),g._isPage=t.isPage(),e)if(e.hasOwnProperty(_))if("function"===typeof e[_])g.subscribe(_,e[_]);else for(u=e[_].length||0,c=0;c!==u;c++)g.subscribe(_,e[_][c]);var d=(g._container.attr("style")||"").replace(/background-color:.+?;/gi,""),m=t.getTitle()||"",f=h.replace(/background-color:#.+?;/gi,"");if(g._isOptionDefault("title"))g._title.html(y(m)).attr("style",f),g._options.title=m;if(g._options.page)g.setTitle(m);if(g._container.attr("style",d+";"+h),!g._hasMarkup()){if(g._resizer)g._resizer.remove(),g._resizer=null;t.createMarkup(g._container,v)}g._setTemplateDimensions(t.getDimensions()),g._delayToConstructionFinished("_loadControls",true,function(){g._notify("onBeforeControlsLoad");try{g._loadControls(O,t,void 0,b,T)}catch(t){T(t)}})},i=function(t){return t};O.getResult().addErrback(i),this._container.attr("templatename",t);try{if(b(),this._notify("onBeforeLoad"),b(true))return;if("string"===typeof o||!o){var n=o==g._defaultTpl&&g._hasMarkup()?g.getContainer()[0].outerHTML.trim():void 0;s.attachTemplate.attachTemplate(o,{fast:r.constants.fasttemplate,html:n}).addCallback(e).addErrback(T)}else if(o instanceof a)o.addCallback(function(t){return g._options.template=t.getName(),t}).addCallbacks(e,T).addErrback(T);else if(o instanceof s.Template)e(o);else e(new s.Template({templateXML:o}));O.getResult().addCallback(i)}catch(t){T(t)}return O.getResult().createDependent()})},getTemplateName:function(){return this._options.template._templateName},getCurrentTemplateName:function(){var t=this._options.template,e=t instanceof s.Template?t.getName():t;if(-1!==e.indexOf("pre--"))e=e.substr(5);return e},_isOptionDefault:function(t){return!(t in this._constructorOptions)},_templateOptionsFilter:function(){return["isRelativeTemplate","height","minHeight","maxHeight","autoHeight","width","minWidth","maxWidth","autoWidth","title","independentContext","contextRestriction"]},destroy:function(){if(this._currentTemplateInstance=null,this._title)this._title.empty().remove(),this._title=$();l.superclass.destroy.apply(this,arguments)}});return l});