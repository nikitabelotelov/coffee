define("Lib/Control/Control.compatible",["Core/ControlBatchUpdater","Env/Env","Core/helpers/Number/randomId","Core/core-instance","Core/core-merge","Core/ContextBinder","Core/helpers/Object/find","Core/CommandDispatcher","Core/helpers/Hcontrol/isElementVisible","Core/helpers/Hcontrol/focusControl","View/Runner","View/Executor/Utils","Core/helpers/Function/throttle","Core/Deferred","is!browser?jquery"],function(s,r,e,i,o,n,a,h,l,t,c,d,f){var u=[];function p(t){return t.substr(0,1).toUpperCase()+t.substr(1)}function _(t){return t&&t.set&&t.get}function g(t){for(var e={},i=t.length-1;i>=0;i--)for(var n in t[i]){if("element"===n||"parent"===n||"logicParent"===n||"parentEnabled"===n)continue;if("object"===typeof t[i][n]&&t[i][n])if(_(t[i][n]))e[n]=t[i][n];else{if(!e[n])e[n]=Array.isArray(t[i][n])?[]:{};e[n]=o(e[n],t[i][n],{rec:false})}else e[n]=t[i][n]}return e=Object.create(e)}return s.registerDelayedAction("Control.focus",t,"FocusActions"),{_needFocusOnActivated:function(){var t=r.constants.browser.isMobilePlatform,e=this._getOption("focusOnActivatedOnMobiles");return!t||void 0===e||e},_modifyOptions:function(t){if("undefined"!==typeof window&&t&&t["__$config"]&&window.componentOptions&&window.componentOptions.indexOf(t["__$config"])>-1){var e=[];if(this&&this._dotTplFn&&this._dotTplFn.stable&&!this._dotTplFn.fixed){var i=t.parent;while(i&&i._dotTplFn&&i._dotTplFn.stable)e.push(i._options),i=i._parent;if(e.length>0){var n=this._dotTplFn;this._dotTplFn=function(){return n.apply(g(e),arguments)},this._dotTplFn.fixed=true,this._dotTplFn.stable=true}this._fixMyOption(e,t,t,0)}}if(t&&!t.hasOwnProperty("logicParent"))t.logicParent=null;if(t&&!t.hasOwnProperty("parentEnabled"))t.parentEnabled=true;return t},_fixMyOption:function(t,e,o,i){if(o&&o.jquery)return;if("undefined"!==typeof Node&&o instanceof Node)return;if(o&&(void 0!==o._goUp||o._type||o._moduleName))return;if(i>7)return;for(var s in o)try{if("function"===typeof o[s]){if(o[s].fromSerializer)(function(e,i,n){o[s]=function(){return e.apply(g([n].concat(i)),d.Common.addArgument(c.Run,arguments))},o[s].toString=function(){var t=d.Common.addArgument(c.Run,arguments);return t[0]=g([n].concat(i)),e.apply(t[0],t)}})(o[s],t,e)}else if("element"===s||"parent"===s||"logicParent"===s)continue;else if("object"===typeof o[s])this._fixMyOption(t,e,o[s],i+1)}catch(t){}},_runInBatchUpdate:function(t,e,i){var n;return s._runInBatchUpdate(t,this,e,i)},_runInBatchUpdateOpts:function(t){var e=s;return e.ensureBatchUpdate(t.hint||"Control._runInBatchUpdateOpts"),e._runInBatchUpdateOpts(t)},_createBatchUpdateWrapper:function(e,i,n){var o=this;return function(){var t=s;return t.ensureBatchUpdate(e||"Control._runInBatchUpdateOpts"),t._runInBatchUpdate(e,n?this:o,i,arguments)}},_haveBatchUpdate:function(){var t=s;return t.haveBatchUpdate()||t.haveApplyUpdateInProcess()},_needForceOnResizeHandler:function(){return s.haveApplyUpdateInProcess()},_runBatchDelayedFunc:function(t,e){var i;if(this._haveBatchUpdate())s.addDelayedFunc(t,this,e);else i=e.apply(this);return i},_needRecalkInvisible:function(){return false},_getBatchUpdateData:function(){return this._batchUpdateData},_setBatchUpdateData:function(t){this._batchUpdateData=t},_haveAutoSize:function(){return true},runInPropertiesUpdate:function(t,e){var i;try{this._propertiesChangedLock++,i=t.apply(this,e||[])}finally{if(this._propertiesChangedLock--,0===this._propertiesChangedLock&&0!==this._propertiesChangedCnt)this._propertiesChangedCnt=0,this._notify("onPropertiesChanged")}return i},_notifyOnPropertyChanged:function(t){if(this._notify("onPropertyChanged",t),this._propertiesChangedLock>0)this._propertiesChangedCnt++;else this._notify("onPropertiesChanged")},getId:function(){if(!this._id)if(this._isCorrectContainer()){var t=this._id=this._container[0].id;if(!t||""===t)this._id=this._container[0].id=e()}else this._id=e();return this._id},getName:function(){if(this._hasOption("name"))return this._getOption("name");else return this._$name=this._options.name=e("name-"),this._$name},getParentWindow:function(){try{return this.getParentByClass("Lib/Control/Window/Window")}catch(t){return}},_invalidateParentCache:function(){var t=this.getParent();while(t){if(t._childsMapIdCache)delete t._childsMapIdCache[this.getId()],delete t._childsMapNameCache[this.getName()];if(t.allChilds)for(var e=0;e<t.allChilds.length;e++)if(t.allChilds[e]===this){t.allChilds.splice(e,1);break}t=t.getParent()}},getParentByClass:function(e){if(!e)throw new Error("Control.getParentByClass - искомый класс не определен");return this.findParent(function(t){if("string"==typeof e)return i.instanceOfModule(t,e);else return t instanceof e})},_isContainerInsideParent:function(){return this._getOption("isContainerInsideParent")},_$tabindex:-1,getTabindex:function(){var t=this._getOption("tabindex");return void 0===t?-1:+t},setTabindex:function(t,e){var i=this.getParent();if(!e&&i)i.changeControlTabIndex(this,t);else this._setOption("tabindex",t);this._baseTabIndex=t},getTooltip:function(){return this._getOption("tooltip")},_alterTooltipText:function(t){return t},_callOnFocusInside:function(){var t=this.getParent();while(t){if(t.isActive())t._notify("onFocusInside",{to:this});t=t.getParent()}},_getExtendedTooltipModifiers:function(){return""},isActive:function(){return this._isControlActive},_updateActiveStyles:function(){var t=this._isControlActive;if(this._isCorrectContainer())this._container.toggleClass("ws-control-inactive",!t).toggleClass("ws-has-focus",t)},setContainer:function(t){if(this._container&&this._container[0])this._container[0].wsControl=void 0;this._container=$(t),this._container[0].wsControl=this},_getElementToFocus:function(){return this._container},findParent:function(t){if("function"!=typeof t)throw new Error("Control.findParent - требуется передать функцию-фильтр");var e=this;do{e=e.getParent()}while(e&&!t(e));return e},getParent:function(){return this._parent},getTopParent:function(){var t=this;while(t.getParent()&&!i.instanceOfModule(t.getParent(),"OnlineSbisRu/Base/View"))t=t.getParent();return t},getParentByName:function(e){return this.findParent(function(t){return"function"===typeof t.getName&&t.getName()==e})},getLinkedContext:function(){return this._context},addOwnedContext:function(t){if(!this._ownedContexts)this._ownedContexts=[];this._ownedContexts.push(t)},_isCorrectContainer:function(){return void 0!==this._container&&"jquery"in this._container&&1==this._container.length&&!this._container[0].startTag},_onResizeHandler:function(){},_onClickHandlerThrottled:f(function(){return this._onClickHandler.apply(this,arguments)},50),_onActionHandler:function(t){switch(t.type){case"click":var e=t.originalEvent;if(void 0===e)e=t;if(this._shouldUseClickByTap())if(u.indexOf(this.getId())>-1)u.splice(u.indexOf(this.getId()),1);if(!e.ClickEventIsReady){if(this._getOption("activableByClick"))e.ClickEventIsReady=true;this._getOption("clickThrottleAsynch")?this._onClickHandlerThrottled(t):this._onClickHandler(t)}break;case"touchstart":if(this._shouldUseClickByTap()&&!t.addedToClickState)u.push(this.getId()),t.addedToClickState=true,this._tapHoldTimer=setTimeout(function(){u.splice(u.indexOf(this.getId()),1)}.bind(this),this._clickState.tapHoldTimeout),this._clickState.coords=t.touches[0].pageX+t.touches[0].pageY;break;case"touchend":if(this._shouldUseClickByTap()&&!t.addedToClickState)if(t.addedToClickState=true,clearInterval(this._tapHoldTimer),Math.abs(this._clickState.coords-t.changedTouches[0].pageX-t.changedTouches[0].pageY)<this._clickState.maxCoordDiff)setTimeout(function(){if(u.indexOf(this.getId())>-1)t.target.click()}.bind(this),this._clickState.timeout);else u.splice(u.indexOf(this.getId()),1)}},_shouldUseClickByTap:function(){return this._getOption("fix165c4103")||this._getOption("emulateClickByTap")},_onClickHandler:function(t){function e(t){var e=false,i=t;while(i){if(i.controlNodes){e=true;break}i=i.parentElement}return e}if(!e(t.target))if(this._getOption("activableByClick"))if(!this._isControlActive)this.setActive(true);if(this._getOption("activableByClick"))t.stopPropagation();this._notify("onClick",t)},_initKeyboardMonitor:function(t){var n=this,e;(t||n._container).keydown(function(t){var e=n._notify("onKeyPressed",t);if(t.which in n._keysWeHandle&&false!==e&&n._isAcceptKeyEvents()){var i=n._keyboardHover(t);if(!i)return t.preventDefault(),t.stopPropagation(),false;return i}})},_keyboardHover:function(t){},_isAcceptKeyEvents:function(){return this.isEnabled()},isEnabled:function(){return this._getOption("enabled")},show:function(){this._setVisibility(true)},hide:function(){this._setVisibility(false)},toggle:function(t){if(arguments.length>0)this._toggle(!!t);else this._toggle(!this._isVisible)},_toggle:function(t){if(t)this.show();else this.hide()},_setVisibility:function(t){var e,i,n=!t;if(this._isVisible!==t){if(this._notify("onBeforeVisibilityChange",t),this._isVisible=t,this._setOption("visible",this._isVisible),this._isCorrectContainer()){if(this._container.hasClass("ws-hidden")!==n)this._container.toggleClass("ws-hidden",n);if(i=this._getLinkedLabel&&this._getLinkedLabel())if((e=this._container.parent()).hasClass("ws-labeled-control"))e.toggleClass("ws-hidden",n);else i.toggleClass("ws-hidden",n)}if(this._notifyOnPropertyChanged("visible"),this.isInitialized()){var o=s;if(t&&o._needDelayedRecalk(this))o._doDelayedRecalk(this);else this._notifyOnSizeChanged&&this._notifyOnSizeChanged(this,this)}this._notify("onAfterVisibilityChange",t)}},isVisibleWithParents:function(){var t=this,e=(!this.isVisible||this.isVisible())&&l(this.getContainer());while(t&&e)e=!t.isVisible||t.isVisible(),t=t.getParent();return e},setAllowChangeEnable:function(t){this._setOption("allowChangeEnable",!!t)},isAllowChangeEnable:function(){return this._getOption("allowChangeEnable")},_setEnabled:function(t){if(t=!!t,this._enabledApplied!==t)if(this._enabledApplied=t,this._isCorrectContainer())this._container.toggleClass("ws-enabled",t).toggleClass("ws-disabled",!t)},setEnabled:function(e){this._prevEnabled=void 0,e=!!e;var i=this,t;if(n.getBindingsForControl(this).forEach(function(t){a(t.bindings,function(t){if("enabled"===t.propName){if(i.getLinkedContext().hasFieldWithParents(t.fieldName))e=!!i.getLinkedContext().getValue(t.fieldName);else e=!!t.nonExistentValue;return true}})}),this._getOption("allowChangeEnable")&&e!==this._getOption("enabled"))this._setOption("enabled",e),this._setEnabled(e)},getOwner:function(e){var t=null,i,n,o,s;if(this._owner)t=this._owner;else if(this._getOption("owner")){if(this._getOption("owner").indexOf&&-1!==this._getOption("owner").indexOf("/"))n=(i=this._getOption("owner").split("/"))[1],o=i[0];else n=this._getOption("owner");try{if(o)s=this.getParentByName(o);else do{s=(s||this).getParent()}while(s&&!s.hasChildControlByName(n));this._owner=t=s.getChildControlByName(n)}catch(t){if(!e)r.IoC.resolve("ILogger").log("Control",'Некорректно задано св-во owner или отсутствует owner c именем "'+n+'"')}}return t},getContainer:function(){return this._container},sendCommand:function(t){var e=Array.prototype.slice.call(arguments,1);return e.unshift(this,t),h.sendCommand.apply(h,e)},canAcceptFocus:function(){return this.isVisible()&&this.isEnabled()&&this.getTabindex()&&l(this.getContainer())},setUserData:function(t,e){if(!this._userData)this._userData={};this._userData[t]=e},getUserData:function(t){return this._userData&&this._userData[t]},getProperty:function(t){var e=p(t),i="get"+e,n="function"===typeof this[i],o="is"+e,s="function"===typeof this[o],r,a;if(n)r=this[i]();else if(s)r=this[o]();else if(this._hasOption(t))r=this._getOption(t);else throw new Error(a='Метод getProperty вызвали для несуществующего свойства "'+t+'" (не определено соответствующего ему метода '+i+" или "+o+' и нет опции с именем "'+t+'"');return r},setProperty:function(t,e){var i="set"+p(t),n,o,s=void 0;if("function"===typeof this[i])s=this[i](e);else if(this._hasOption(t))this._setOption(t,e);else throw new Error(o='Метод setProperty вызвали для несуществующего свойства "'+t+'" (не определено соответствующего ему метода '+i+' и нет опции с именем "'+t+'"');return s},setProperties:function(i){this.runInPropertiesUpdate(function(){var t;if(i.hasOwnProperty("allowChangeEnable"))t=i.allowChangeEnable,delete i.allowChangeEnable;if(true===t)this.setProperty("allowChangeEnable",true);for(var e in i)if(i.hasOwnProperty(e))this.setProperty(e,i[e]);if(false===t)this.setProperty("allowChangeEnable",false)})},destroy:function(){if(this._ownedContexts){for(var t=0;t<this._ownedContexts.length;t++)if(!this._ownedContexts[t].isDestroyed())this._ownedContexts[t].destroy();this._ownedContexts=[]}}}});