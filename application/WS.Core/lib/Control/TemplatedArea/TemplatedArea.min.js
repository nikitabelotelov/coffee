define("Lib/Control/TemplatedArea/TemplatedArea",["Core/core-instance","Core/helpers/Function/forAliveOnly","Core/ParallelDeferred","Core/Deferred","Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract"],function(e,n,i,s,t){"use strict";function a(){return new Error("Область разрушена до окончания предыдущего вызова в очереди setTemplateQueue")}var r=t.extend({$protected:{_width:"",_height:"",_setTemplateQueue:null},$constructor:function(){this._publish("onBeforeClose","onAfterClose","onBeforeChangeActiveArea"),this._setTemplateQueue=(new s).callback(true),this.getContainer().addClass("ws-templatedArea")},_activeOnLoad:function(){if(!this._parent)this._activateFirstCtrl()},_loadDescendents:function(){this._notify("onStateChanged");var e=r.superclass._loadDescendents;return this._setTemplateQueue.addCallback(n(function(){var t;return(this._options.template?this._loadTemplate():e.apply(this,arguments)).addCallback(this._activeOnLoad.bind(this))},this,a))},_templateInnerCallback:function(){r.superclass._templateInnerCallback.apply(this);var t=this.getCurrentTemplateName();if("string"==typeof t)this._notify("onStateChanged",t)},applyState:function(t){if(t!==this.getCurrentTemplateName())this.setTemplate(t)},_setTemplateDimensions:function(t){var e=arguments;if(!this._options.keepSize)e=[{width:"",height:""}];r.superclass._setTemplateDimensions.apply(this,e)},_prepareTemplate:function(t,e){return this._runInBatchUpdate("_prepareTemplate"+" - "+this._id,function(){return this._loadTemplate(t,e).addCallback(function(){this._notify("onBeforeShow"),this._notifyBatchDelayed("onAfterShow")}.bind(this))})},setTemplate:function(t,e){this._notify("onBeforeChangeActiveArea");var i=n(this._setTemplate.bind(this,t,e),this,a);return this._setTemplateQueue.addBoth(i).createDependent()},clearTemplate:function(){return this.setTemplate("")},_cleanupCurrentTemplate:function(){if(this._currentTemplateInstance){var t=this._currentTemplateInstance.getDeclaredHandlers();for(var e in t)if(t.hasOwnProperty(e))for(var i=t[e],n=0,s=i.length;n<s;n++)this.unsubscribe(e,i[n]);this.unbind("onResize"),this._currentTemplateInstance=null}this._removeControls(),this._container.attr("hasMarkup","false").children().not(".r").empty().remove(),this._options.template="",this._options.children=[]},_setTemplate:function(t,e){return this._runInBatchUpdate("_setTemplate"+" - "+this._id,function(){if(this._cleanupCurrentTemplate(),this._dChildReady=new i,t instanceof s)this._options.template="";else this._options.template=t;return this._prepareTemplate(t,e)})},destroy:function(){var t=!e.instanceOfModule(this,"Lib/Control/FloatArea/FloatArea");if(t)this._notify("onBeforeClose");if(r.superclass.destroy.apply(this,arguments),t)this._notify("onAfterClose")},_postUpdateResizer:function(t,e){if(!this._parent&&this._isPage){var i={};if(this._options.autoWidth)i["min-width"]=t;i["min-height"]=e,this._container.css(i)}},_restoreSize:function(){if(this._isPage&&!this.getParent()){var t=this._container.parent(),e=this._margins.left+this._margins.right,i=t.width()-e;this._container.css({width:"Stretch"===this._horizontalAlignment?"100%":this._options.autoWidth?"auto":this._width,height:"Stretch"===this._verticalAlignment?"100%":this._options.autoHeight?"auto":this._height});var n=t.width()-e;if(i!=n)this._container.css({width:n})}else r.superclass._restoreSize.apply(this,arguments)}});return r});