define("Lib/Control/Infobox/Infobox",["Core/core-instance","Core/helpers/Hcontrol/trackElement","Core/Deferred","Core/helpers/Hcontrol/isElementVisible","Env/Env","Core/helpers/String/escapeTagsFromStr","Core/Abstract","Core/helpers/Function/debounce","tmpl!Lib/Control/Infobox/Infobox","Core/WindowManager","css!Lib/Control/Infobox/Infobox","is!browser?/cdn/jquery-ui/1.12.1.2/jquery-ui-position-min.js"],function(e,i,t,n,s,o,r,h,a){"use strict";var f=1/2,d=44,l=300,c=300,u=22,_=new(r.extend({$protected:{_box:void 0,_content:void 0,_hideTimer:void 0,_showTimer:void 0,_currentTarget:null,_message:"",_width:"auto",_watchTimer:void 0,_measureText:null,_autoHide:false,_state:void 0,_infoboxContentDeferred:new t,_infoboxContent:void 0,_isWaitingToShow:false,_watchLinkedPanel:false,_hideAfterDestroyContent:void 0},_dotTplFn:a,$constructor:function(){if(this._publish("onShow","onHide","onChangeTarget","onBeforeShow"),"undefined"!==typeof window)requirejs(["Lib/Control/InfoboxContent/InfoboxContent"],function(t){return this._infoboxContentDeferred.callback(t),t}.bind(this)),this._hideAfterDestroyContent=this._hide.bind(this,true),$(window).on("resize",h(this._resizeHandler.bind(this),50))},_resizeHandler:function(){if(this.getCurrentTarget()&&!this._isWaitingToShow)this._resizeBox()},getContainer:function(){return this._box},_build:function(){var t=$(".ws-body-scrolling-content"),e=this;if(this._box=$(this._dotTplFn(this)).bind("mouseenter",function(){if(e._hideTimer)clearTimeout(e._hideTimer)}).bind("mouseleave",function(t){if(this._autoHide){if(this._watchLinkedPanel){var e=t.relatedTarget.closest(".ws-infobox-linkedPanel");if(e)return void(this._linkedPanel=e)}this.hide()}}.bind(this)).mousedown(function(t){t.stopPropagation()}),this._content=this.getContainer().find(".ws-infobox-content"),!t.length)t=$(window);t.bind("scroll",function(){e._hide()}),$(".ws-infobox-close-button",this.getContainer()).bind("mousedown touchstart",function(t){return e.hide(0),t.stopPropagation(),false}),$("body").append(this.getContainer())},isCurrentTarget:function(t){if(this._currentTarget&&t)return this._currentTarget==(t.get?t.get(0):t);else return false},getCurrentTarget:function(){return this._currentTarget},setText:function(t){this._setText(t),this._resizeBox(),this._updateZIndex()},_setText:function(t){var e=this._message=t;if("string"===typeof this._message)if(e=o(this._message,["script"]),!this._isInsertHTML(t))e=e.replace(/\n/g,"<br>");if(this.getContainer().toggleClass("ws-infobox-has-title",!!this._title),this._content)if(this._infoboxContentDeferred.isReady())this._createInfoboxContent(this._infoboxContentDeferred.getResult(),e);else this._infoboxContentDeferred.addCallback(function(t){return this._createInfoboxContent(t,e),t}.bind(this))},_createInfoboxContent:function(t,e){if(this._infoboxContent){var i=this._infoboxContent;setTimeout(function(){i.unsubscribe("onDestroy",this._hideAfterDestroyContent),i.destroy()}.bind(this),0),this._infoboxContent._container.empty()}this._infoboxContent=new t({element:$('<div class="ws-infobox-content-root"></div>').appendTo(this.getContainer()),parent:this._getInfoboxParent(),message:e,title:this._title,infoboxSingleton:this,options:this._templateOptions,tabindex:0,handlers:{onDestroy:this._hideAfterDestroyContent}}),this.getContainer()[0].wsControl=this._infoboxContent},_getInfoboxParent:function(){var t=$(this.getCurrentTarget()).wsControl();while(!e.instanceOfModule(t,"Lib/Control/AreaAbstract/AreaAbstract")&&null!=t)t=t.getParent();return t},_isInsertHTML:function(t){var e=false;try{e=""!==$(t).text()}catch(t){}return e},_clearShowTimer:function(){if(this._showTimer)clearTimeout(this._showTimer),this._showTimer=void 0},_clearHideTimer:function(){if(this._hideTimer)clearTimeout(this._hideTimer),this._hideTimer=void 0},_clearWatchTimer:function(){if(this._watchTimer)clearTimeout(this._watchTimer),this._watchTimer=void 0},_clearTimers:function(){this._clearShowTimer(),this._clearHideTimer()},hasTarget:function(){return!!this._currentTarget},_watchTargetPresent:function(){var t=$(this.getCurrentTarget());if(t.length&&!n(t))this._hide(true);else if(this._isCursorOut()&&this._autoHide&&(!this._linkedPanel||!$(this._linkedPanel).is(":visible")))this._linkedPanel=null,this.hide(l)},_isCursorOut:function(){var t=$(this.getCurrentTarget()),e,i;if(!t.length)return;return e=this._isHovered(t)||this._isHovered(this.getContainer()),i=this._isFocused(t)||this._isFocused(this.getContainer()),!e&&!i},_isFocused:function(t){return!t.hasClass("ws-hidden")&&(t[0]===document.activeElement||!!t.find(document.activeElement).length)},_isHovered:function(t){return!!t.filter(":hover").length},show:function(t,e,i,n,s,o,r){if(1===arguments.length&&$.isPlainObject(t)){var h=t,a=h.position,l=h.title,f=h.templateOptions,d=h.modifiers;t=$(h.control),e=h.message,i=h.width,n="number"!==typeof h.showDelay?c:h.showDelay,s=h.hideDelay,o=h.needToShow,r=h.autoHide,this._positionByTarget=h.positionByTarget||t,this._watchLinkedPanel=h.watchLinkedPanel}else t=$(t),n="number"!==typeof n?c:n,this._positionByTarget=t,this._watchLinkedPanel=false;if(!this._isCanShowInfobox(t,e,f,o))return;if(this._linkedPanel=null,this._isWaitingToShow=true,this._message=e,this._title=l,this._templateOptions=f,this._autoHide=!!r,this._width=void 0===i?"auto":i,this._position=a||"tl",!this.getContainer())this._build();if(this._setState("showing"),this._subscribeToMoveTarget(t),this._clearShowTimer(),this.isCurrentTarget(t)&&!this._isWaitingToShow)n=0;if(this._currentTarget=t.get(0),this._updateZIndex(),n)this._showTimer=setTimeout(function(){if(this._isTargetVisible($(this.getCurrentTarget()))&&!this._autoHide||!this._isCursorOut())this._show(t,d,s);else this._setState("hide"),this._hide(true)}.bind(this),n);else this._show(t,d,s)},_show:function(e,t,i){if((this._isWaitingToShow=false)===this._notify("onBeforeShow",e))return void(this._currentTarget=null);if(this._setModifiers(t),this._clearHideTimer(),this._clearWatchTimer(),!this._isTargetVisible(e))return void(this._currentTarget=null);if(!this._currentTarget)this._currentTarget=e.get(0);this._notify("onChangeTarget",this._currentTarget,e.get(0)),this._setText(this._message);var n=this;if(this._infoboxContentDeferred.isReady())this._setInfoboxVisible(e,i);else this._infoboxContentDeferred.addCallback(function(t){return n._setInfoboxVisible(e,i),t})},_isCanShowInfobox:function(t,e,i,n){var s="function"===typeof n?n():true,o="function"===typeof e?e(i||{}):e;return this._isTargetVisible(t)&&!!o&&s},_setState:function(t){this._state=t},_getState:function(){return this._state},_isTargetVisible:function(t){var e=$(this._positionByTarget);return t.closest("html").length&&n(t)&&e.closest("html").length&&n(e)},_setInfoboxVisible:function(t,e){if(this._resizeBox(),this._watchTimer=setInterval(this._watchTargetPresent.bind(this),500),this._setState("show"),this._notify("onShow",t),e)this.hide(e)},_subscribeToMoveTarget:function(t){this._unsubscribeToMoveTarget(),this._targetChanges=i(t,true),this._targetChanges.subscribe("onMove",this._onMoveTarget,this)},_unsubscribeToMoveTarget:function(){if(this._targetChanges){if(this._targetChanges.unsubscribe("onMove",this._onMoveTarget,this),this.hasTarget())i(this.getCurrentTarget(),false);this._targetChanges=null}},_onMoveTarget:function(t,e,i){if(!i)this._unsubscribeToMoveTarget(),this.hide(0)},_setModifiers:function(t){var e=this.getContainer(),i=["ws-infobox-type-lite","ws-infobox-type-help","ws-infobox-type-error","ws-infobox-title-red","ws-infobox-title-black","ws-infobox-title-green","ws-infobox-title-orange","ws-infobox-full-width","ws-infobox-zero-padding"],n;if(e.removeClass(i.join(" ")),t)for(var s=0,o=(n=t.split(" ")).length;s<o;s++)if(i.indexOf(n[s]>-1))e.addClass(n[s])},_resizeBox:function(){var a=this.getContainer(),l=this._getPosition(),t=this._currentTarget,e=this._width;if("hide"===this._state||"hiding"===this._state||!t||!$(t).is(":visible"))return;if("number"===typeof e)a[0].style.width=e+"px";else e="auto";if(a.removeClass("ws-hidden"),a.css({visibility:"hidden",display:"block",left:-1e4,top:-1e4}),"auto"==e)a.css("width",""),a.css("max-width",s.constants.$win.width()*f);else a.css("max-width","");a.css({visibility:"visible"}).position({my:l.my,at:l.at,collision:"flip",of:this._positionByTarget,using:function(t,e){var i=$(".ws-infobox-triangle",a);if("middle"===e.vertical)if(e.element.top===e.target.top)e.vertical="top";else if(e.element.top+e.element.height===e.target.top+e.target.height)e.vertical="bottom";if("t"===this._position[0]||"b"===this._position[0]){if("center"===e.horizontal){if(e.element.left===e.target.left)e.horizontal="left";else if(e.element.left+e.element.width===e.target.left+e.target.width)e.horizontal="right"}else if("middle"!==e.vertical)if("left"===e.horizontal&&t.left<e.target.left)e.horizontal="right";else if("right"===e.horizontal&&Math.abs(e.target.left+e.target.width-(e.element.width+t.left))>1)e.horizontal="left";var n=e.target.element[0],s=n.clientWidth||n.offsetWidth,o=u,r;if(s<d)if(r=Math.floor(o-s/2),"left"==e.horizontal)t.left-=r;else if("right"==e.horizontal)t.left+=r}var h=e.element.left+e.element.width-window.innerWidth;if(h>0)t.left-=h;i.toggleClass("ws-infobox-triangle-top",!l.isSide&&"top"===e.vertical).toggleClass("ws-infobox-triangle-bottom",!l.isSide&&"bottom"===e.vertical).toggleClass("ws-infobox-triangle-right",!l.isSide&&"right"===e.horizontal).toggleClass("ws-infobox-triangle-left",!l.isSide&&"left"===e.horizontal).toggleClass("ws-infobox-triangle-center",!l.isSide&&"center"===e.horizontal).toggleClass("ws-infobox-triangle-vertical-top",l.isSide&&"top"===e.vertical).toggleClass("ws-infobox-triangle-vertical-bottom",l.isSide&&"bottom"===e.vertical).toggleClass("ws-infobox-triangle-vertical-middle",l.isSide&&"middle"===e.vertical).toggleClass("ws-infobox-triangle-vertical-right",l.isSide&&"right"===e.horizontal).toggleClass("ws-infobox-triangle-vertical-left",l.isSide&&"left"===e.horizontal),a.css({top:Math.ceil(t.top),left:Math.ceil(t.left)})}.bind(this)})},_getPosition:function(){var t=$(".ws-infobox-triangle").height(),e=this._position[0]||"t",i=this._position[1]||"l",n,s,o={t:"top",b:"bottom",c:"center",l:"left",r:"right",invertr:"left",invertl:"right",invertt:"bottom",invertb:"top"};switch(e){case"t":case"b":n=o[i]+" "+o["invert"+e],s=o[i]+" "+o[e]+("t"===e?"-":"+")+t;break;case"r":case"l":n=o["invert"+e]+" "+o[i],s=o[e]+("l"===e?"-":"+")+t+" "+o[i]}return{my:n,at:s,isSide:"r"===e||"l"===e}},_updateZIndex:function(){var t=$(this.getCurrentTarget()),e,i;if(t)if((e=t.closest(".ws-float-area-stack-cut-wrapper")).length)i=e.css("z-index");this.getContainer().css("z-index",i||this._getNewZIndex())},_hide:function(t){if("showing"===this._getState()||"hide"===this._getState())return;if(this._setState("hide"),this._clearWatchTimer(),t||s.detection.isIE10)this._hideCallback();else this.getContainer().stop().css("opacity",1).fadeOut("fast",this._hideCallback.bind(this))},_hideCallback:function(){this.getContainer().addClass("ws-hidden"),this._notify("onChangeTarget",this._currentTarget,null),this._unsubscribeToMoveTarget(),this._currentTarget=null,this._notify("onHide")},hide:function(t){if(this._clearTimers(),this._setState("hiding"),this.getContainer())if(0===t)this._hide();else{var e=this;this._hideTimer=setTimeout(function(){e._hide()},void 0===t||"number"!==typeof t?l:t)}},_getNewZIndex:function(){var t=this.getCurrentTarget(),e=".ws-smp-dlg, .controls-Menu__Popup:not(.ws-hidden), .controls-SubmitPopup_popup",i,n;if(t)if(i=$(t).closest(".controls-Popup, .controls-SubmitPopup_popup, .ws-window:not(.ws-hidden):not(.controls-CompoundArea)")[0]){if(i.wsControl)n=i.wsControl.getZIndex();else n=parseInt(i.style.zIndex,10);return n+1}return this._highZIndex()+(!$("body").find(e).length?1:-1)},_highZIndex:function(t,e){e=e||1/0;var i,n,s=1,o,r=0,h=(t=t||document.body).childNodes,a=h.length;while(r<a){if(1!=(i=h[r++]).nodeType||"none"===this._deepCss(i,"display")||"hidden"===this._deepCss(i,"visibility")||$(i).hasClass("ws-info-box"))continue;if(o=this._deepCss(i,"opacity"),"static"!==this._deepCss(i,"position"))if("auto"==(n=this._deepCss(i,"z-index")))n=o<1?0:this._highZIndex(i);else n=parseInt(n,10)||0;else n=o<1?0:this._highZIndex(i);if(n>s&&n<=e)s=n}return s},_deepCss:function(t,e){var i,n,s=document.defaultView||window;if(1==t.nodeType)if(i=e.replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()}),!(n=t.style[i]))if(t.currentStyle)n=t.currentStyle[i];else if(s.getComputedStyle)n=s.getComputedStyle(t,"").getPropertyValue(e);return n||""}}));return _.HIDE_TIMEOUT=500,_.SHOW_TIMEOUT=500,_.ACT_CTRL_HIDE_TIMEOUT=1e4,_});