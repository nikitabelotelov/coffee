define("Lib/KbLayoutRevert/KbLayoutRevert",["Core/core-extend"],function(t){"use strict";var r;return new(t({},{_layouts:{"ru-en":"йцукенгшщзхъфывапролджэячсмитьбюЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮqwertyuiop[]asdfghjkl;'zxcvbnm,.QWERTYUIOP{}ASDFGHJKL:\"ZXCVBNM<>"},_cache:{layoutObjects:{},layoutObjectsSplit:{}},_getLayoutObject:function(t,r){var e,i,o;if(!this._layouts[t])return;if(i=this._layouts[t],r){if(e={},this._cache.layoutObjectsSplit.hasOwnProperty(t))return this._cache.layoutObjectsSplit[t];e.straight={},e.reverse={};var s=i.length/2;for(o=0;o<s;++o)e.straight[i[o]]=i[o+s],e.reverse[i[o+s]]=i[o];this._cache.layoutObjectsSplit[t]=e}else{if(e=[],this._cache.layoutObjects.hasOwnProperty(t))return this._cache.layoutObjects[t];for(o=0;o<i.length;++o)e[i[o]]=0;this._cache.layoutObjects[t]=e}return e},_figureLayout:function(t){var r={matches:0,layoutId:null};for(var e in this._layouts){for(var i=this._getLayoutObject(e),o=0,s=0;s<t.length;++s)if(i.hasOwnProperty(t[s]))++o;if(!r||r.matches<o)r={matches:o,layoutId:e}}return r},_figureConversionDirectionByWorlds:function(t,r){var o=this._getLayoutObject(r,true),e=t.split(/\s/),s=0,a,n=[];return e.forEach(function(t){if(!t)return void n.push({word:" "});for(var r=0,e=0,i=0;i<t.length;++i){if(o.straight.hasOwnProperty(t[i]))++r;if(o.reverse.hasOwnProperty(t[i]))++e}if(a=r>=e?1:-1,r&&e)a=r>=e?-1:1;s+=a,n.push({word:t,direction:a})}),{direction:s<0?-1:1,words:n}},process:function(t,r){if(!(r=r||this._figureLayout(t).layoutId))return t;var e=this._figureConversionDirectionByWorlds(t,r),i=this._getLayoutObject(r,true),o=1===e.direction?i.straight:i.reverse,s="";return e.words.forEach(function(t){var r=t.word;if(" "===r)return void(s+=r);if(o=1===t.direction?i.straight:i.reverse,s.trim().length>0)s+=" ";for(var e=0;e<r.length;++e)if(o.hasOwnProperty(r[e]))s+=o[r[e]];else s+=r[e]}),s}}))});