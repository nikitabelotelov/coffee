define("Lib/ServerEvent/_class/creator/CreatorWebSocket",["require","exports","Core/detection","Core/UserInfo","Lib/Storage/LocalStorage","Lib/ServerEvent/_class/creator/TransportConnect","Lib/ServerEvent/_class/transport/Constants"],function(s,r,t,e,o,a,i){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function r(r,t){if(void 0===t)t=new a.TransportConnect;this.connectOptions=r,this.transportConnect=t,this.ls=new o("SEB");var n=e.get("ЛогинПользователя")||"";this.isGuestAccess=n.indexOf("__сбис__гость__")>-1}return r.prototype.isAvailableInEnv=function(r){if(r)return false;return!this.connectOptions.isDesktop()&&!t.isMobileIOS},r.prototype.build=function(t){var n=this;return this.chooseTransportConstructor().then(function(r){return n.createTransport(r,t)})},r.prototype.createTransport=function(t,n){var e=this;if("LocalSlaveTransport"===t.getLocalName())return Promise.resolve(new t);return this.transportConnect.connect(this.connectOptions,true).then(function(r){return new t(r,n,!e.isGuestAccess,e.connectOptions.exchange)})},r.prototype.chooseTransportConstructor=function(){var e=this,o=this.ls.getItem(i.KEY_ACTUAL_DATE);return new Promise(function(t,n){if(!o)return t(e.loadMainTransport());var r=new Date(o+2*i.CHECK_MIN_INTERVAL);if(r<new Date||isNaN(r.valueOf()))return t(e.loadMainTransport());s(["Lib/ServerEvent/_class/transport/LocalSlaveTransport"],function(r){if(!r.LocalSlaveTransport)return n(new Error("Lib/ServerEvent/_class/transport/LocalSlaveTransport not found"));t(r.LocalSlaveTransport)})})},r.prototype.loadMainTransport=function(){return new Promise(function(t,n){s(["Lib/ServerEvent/_class/transport/LocalMainTransport"],function(r){if(!r.LocalMainTransport)return n(new Error("Lib/ServerEvent/_class/transport/LocalMainTransport not found"));t(r.LocalMainTransport)})})},r}();r.CreatorWebSocket=n});