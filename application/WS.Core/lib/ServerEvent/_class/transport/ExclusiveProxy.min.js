define("Lib/ServerEvent/_class/transport/ExclusiveProxy",["require","exports","Core/Deferred","Core/LocalStorageNative","Lib/ServerEvent/_class/Constants","Lib/ServerEvent/_class/DeviceEnv","Lib/ServerEvent/_class/transport/TransportChooser","Lib/ServerEvent/_class/Subscribe","Lib/ServerEvent/DebugUtils"],function(e,t,c,a,r,u,b,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(){this.message="Need subscribe connect to subscribe",this.name="SubscribeExclusiveError"}return e}(),i=function(){function o(e,t,r){this.transport=e,this.isExclusive=t,this.options=r}return o.init=function(t,r,s){if(void 0===t)t=false;var n=new c,i;return u.DeviceEnv.getOptions().addCallback(function(e){return i=e,new b.TransportChooser(e,r,t,s).choose()}).addCallback(function(e){try{if(l.attachDebugFn(),s.logConnect({connectOptions:i,transport:e.constructor.getLocalName()}),window&&"true"===a.getItem("shared-bus-debug"))window["sharedBusWatch"]()}catch(e){}n.callback(new o(e,t,i))}).addErrback(function(e){return n.errback(e),e}),n},o.prototype.subscribe=function(e){if(e.getDeliveryType()!==r.DELIVERY_COMMON&&!this.isExclusive)throw new n;if(e instanceof s.RawChanneledSubscribe)return void this.transport.subscribe(s.Subscribe.create(e.getChannelName(),e.isChanneled(),this.isExclusive,this.options.getUid(e.getScope())));this.transport.subscribe(e)},o.prototype.unsubscribe=function(e){if(e instanceof s.RawChanneledSubscribe)return void this.transport.unsubscribe(s.Subscribe.create(e.getChannelName(),e.isChanneled(),this.isExclusive,this.options.getUid(e.getScope())));this.transport.unsubscribe(e)},o.prototype.setDelivery=function(e){this.transport.setDelivery(e)},o.prototype.close=function(){this.transport.close(),this.transport=void 0},o.prototype.setWatchDog=function(e){this.transport.setWatchDog(e)},o}();t.ExclusiveProxy=i});