define("Lib/ServerEvent/_class/transport/TransportChooser",["require","exports","Core/Deferred","Lib/ServerEvent/_class/logger/WatchDogAggregator","Lib/ServerEvent/_class/RabbitEnv","Lib/ServerEvent/_class/creator/CreatorWebSocket","Lib/ServerEvent/_class/creator/CreatorSockJs","Lib/ServerEvent/_class/creator/CreatorExclusive","Lib/ServerEvent/_class/creator/CreatorExclusiveSockJs","Lib/ServerEvent/_class/deliver/DeliveryChooser"],function(e,r,s,u,t,l,v,h,d,f){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=function(){function e(e,r,t,o){if(void 0===r)r=function(e){return e};if(void 0===t)t=false;if(void 0===o)o=new u.WatchDogAggregator;this.connectOptions=e,this.onclose=r,this.isExclusive=t,this.watcher=o,this.builders=[],this.deliveryChooser=new f.DeliveryChooser(o);for(var n,i=0,s=[l.CreatorWebSocket,v.CreatorSockJs,h.CreatorExclusive,d.CreatorExclusiveSockJs];i<s.length;i++){var a,c=new(0,s[i])(this.connectOptions);if(!c.isAvailableInEnv(this.isExclusive))continue;this.builders.push(c)}}return e.prototype.destructor=function(){var r=this;this.defStrategy&&this.defStrategy.addCallback(function(e){r.watcher&&r.watcher.logDisconnect("Manual disconnect"),e.close()})},e.prototype.choose=function(){var t=this;if(this.defStrategy)return this.defStrategy.createDependent();return this.defStrategy=this.build(),this.defStrategy.addCallback(function(r){return r.setDisconnectHandler(function(e){t.defStrategy=void 0,t.onclose(e)}),r.setWatchDog(t.watcher),t.deliveryChooser.choose(r).addCallback(function(e){return r.setDelivery(e),r})}),this.defStrategy.createDependent()},e.prototype.build=function(){var r=this,e;return new t.RabbitEnv(this.watcher).up(this.connectOptions).addCallback(function(e){return r.createTransport(e)})},e.prototype.createTransport=function(r){for(var t=new s,e=function(e){t.addErrback(function(){return s.fromPromise(e.build(r))})},o=0,n=this.builders;o<n.length;o++){var i;e(n[o])}return t.addErrback(function(e){return new Error("No one server event bus transport choice.")}),t.errback(),t},e}();r.TransportChooser=o});