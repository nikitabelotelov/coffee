define("Lib/ServerEvent/_class/RabbitEnv",["require","exports","Core/IoC","Core/Deferred","Transport/XHRTransport","Lib/ServerEvent/_class/Constants"],function(e,r,o,i,a,u){"use strict";Object.defineProperty(r,"__esModule",{value:true});var c=2*1e3,t=function(){function e(e){this.watcher=e}return e.prototype.up=function(r){var t=this,n=new i,a=Date.now();return this.tryCreateChannel(r).addCallback(function(e){if(Date.now()-a>c)o.resolve("ILogger").warn("[STOMP][timeout] /!info request to long: "+(Date.now()-a)+"ms");n.callback(e)}).addErrback(function(e){if(e.message==u.ERR_MSG_RABBIT_OFF)return void n.errback(e);setTimeout(function(){t.up(r).addCallback(function(e){n.callback(e)})},5e3)}),n},e.prototype.tryCreateChannel=function(r){var t=this,n=r.getUrl();return new a({url:n,method:"GET",dataType:"json"}).execute().addCallback(function(e){if(!e.websocket)return new Error(u.ERR_MSG_RABBIT_OFF);return r.hash}).addErrback(function(e){return t.watcher.logConnect({message:"error get info",url:n,err:e}),e})},e}();r.RabbitEnv=t});