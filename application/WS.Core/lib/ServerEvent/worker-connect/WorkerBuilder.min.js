define("Lib/ServerEvent/worker-connect/WorkerBuilder",["require","exports","tslib","Core/Deferred","Lib/ServerEvent/worker-connect/SwConnect"],function(e,r,n,u,c){"use strict";var t=318.35,o=function(){return this||(0,eval)("this")}(),i="/ws/";if(window&&window["wsConfig"]&&window["wsConfig"]["wsRoot"])i="/"==(i=window["wsConfig"]["wsRoot"])[i.length-1]?i:i+"/";var s=i+"lib/ServerEvent/worker/",a=s+"event-bus-shared.worker.js?v="+t,f=s+"event-bus-web.worker.js",h=function(){function e(e){if((this.worker=e)instanceof SharedWorker)this.postMessage=this._postSharedWorker}return e.prototype.postMessage=function(e,r){return this.worker.postMessage(e,r)},e.prototype._postSharedWorker=function(e,r){return this.worker.port.postMessage(e,r)},e.prototype.terminate=function(){return this.worker.terminate()},e}(),w,k=function(t){function e(e,r){var n=t.call(this,"handshake")||this;return n.port=e,n.debug=r,n}return n.__extends(e,t),e}(function(){function e(e){this.command=e}return e}()),d=function(){function e(e){this.sw=e,this.channel=new MessageChannel}return e.prototype.shake=function(){var t=this;return new Promise(function(n,e){var r;if(t.channel.port1.onmessage=function(e){var r=e.data;if(t.channel.port1.onmessage=void 0,"handshake"==r.type)n(t.channel)},p.IsDebugPort)r=true;t.sw.postMessage(new k(t.channel.port2,r),[t.channel.port2])})},e}(),v=function(){function n(){}return n.getWorkerContainer=function(e){var r;switch(e){case n.SHARED_WORKER:r=n.getSharedWorker;break;case n.WORKER:default:r=n.getWorker}return r().then(function(e){return new h(e)})},n.getSharedWorker=function(){var e=a;if(!("SharedWorker"in o))return Promise.reject(new ReferenceError("SharedWorker is not support."));var r=new SharedWorker(e);return r.port.start(),Promise.resolve(r)},n.getWorker=function(){var e=f;if(!("Worker"in o))return Promise.reject(new ReferenceError("Worker is not support."));return Promise.resolve(new Worker(e))},n.TIMEOUT=5e3,n.STATE_INSTALLING="installing",n.STATE_INSTALLINED="installed",n.STATE_ACTIVATING="activating",n.STATE_ACTIVATED="activated",n.STATE_REDUNDANT="redundant",n.WORKER="worker",n.SHARED_WORKER="SharedWorker",n.SERVICE_WORKER="ServiceWorker",n}(),p=function(){function e(){}return e.createConnection=function(e,n,t,o,i,s,a){var r=new u;return v.getWorkerContainer(e).then(function(e){var r;return new d(e).shake().then(function(e){return e})}).then(function(e){var r;return new c.Connector(e).connect(n,t,o,i,s,a)}).then(function(e){r.callback(e)}).catch(function(e){r.errback(e)}),r},e.IsDebugPort=false,e.IsDebugEB=false,e}();return p});