define("Lib/Mixins/PendingOperationParentMixin",["Core/helpers/Function/callBefore","Core/helpers/Function/callNext","Core/helpers/Array/findIndex","Core/core-merge","Core/core-clone","Lib/Mixins/PendingOperationProducerMixin","Core/CommandDispatcher","Core/Deferred","Env/Env"],function(i,n,r,e,t,s,d,o,l){function a(n,i){var e=r(i,function(i){return i===n});i.splice(e,1)}function h(i){return!(i instanceof Error||false===i)}var g=l.IoC.resolve("ILogger"),u=t(s),c=s.$protected,p;return e(u,{$protected:{_childPendingOperations:[],_allChildrenPendingOperation:null,_finishPendingQueue:null,_isFinishingChildOperations:false},$constructor:n.call(function(){var i=this._registerChildPendingOperation.bind(this),n=this._unregisterChildPendingOperation.bind(this),e=d.declareCommand.bind(d);e(this,"registerPendingOperation",i),e(this,"unregisterPendingOperation",n)},c.$constructor),_registerChildPendingOperation:function(i){var n,e;if(this._childPendingOperations.push(i),!this._allChildrenPendingOperation)n=(this._moduleName?this._moduleName+"/":"")+"allChildrenPendingOperation",e=this.finishChildPendingOperations.bind(this),this._allChildrenPendingOperation=this._registerPendingOperation(n,e,this.getParent());return true},_unregisterChildPendingOperation:function(i){var n=this._childPendingOperations,e;if(n.length>0)if(a(i,n),0===n.length)e=this._allChildrenPendingOperation,this._allChildrenPendingOperation=null,l.coreDebug.checkAssertion(!!e),this._unregisterPendingOperation(e);return true},finishChildPendingOperations:function(s){var d=this,l=function(i){var n=d._childPendingOperations,e,r;function t(){if(n.length>0)n.shift().cleanup()}if(h(i)&&n.length>0)if((e=n[0].finishFunc(s))instanceof o)e.addCallback(function(i){if(h(i))t();return l(i)}).addErrback(function(i){return l(i)});else{if(h(e))t();e=l(e)}else{if(r=d._allChildrenPendingOperation,0===n.length&&r)d._allChildrenPendingOperation=null,d._unregisterPendingOperation(r);d._isFinishingChildOperations=false,e=i}return e};if(!this._isFinishingChildOperations)this._finishPendingQueue=o.success(true),this._isFinishingChildOperations=true,this._finishPendingQueue.addCallback(l);return this._finishPendingQueue},getChildPendingOperations:function(){return this._childPendingOperations},before:{destroy:i.call(function(){var i=this._allChildrenPendingOperation,n;if(this._isFinishingChildOperations)n="У контрола "+this._moduleName+" (name = "+this.getName()+", id = "+this.getId()+") вызывается метод destroy, "+"хотя у него ещё есть незавёршённые операции (свои или от дочерних контролов",g.error("Lib/Mixins/PendingOperationParentMixin",n);if(this._childPendingOperations=[],this._allChildrenPendingOperation)this._allChildrenPendingOperation=null,this._unregisterPendingOperation(i)},c.destroy)}})});