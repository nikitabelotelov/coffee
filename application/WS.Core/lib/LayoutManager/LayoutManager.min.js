define("Lib/LayoutManager/LayoutManager",["Env/Env","Core/helpers/Object/find","Env/Event","Lib/StickyHeader/StickyHeaderManager/StickyHeaderManager","is!browser?jquery"],function(s,n,o,u){"use strict";var c,i={};function a(t){var e=n(t,function(t){return!!$(t).length});return e?$(e):$()}var t={configureLayoutBlocks:function(t){if(t&&t.contentArea)c=a(t.contentArea)},getLayoutBlocks:function(){return{contentArea:c}},isMainScrollingContainerBody:function(){return 0===$(".ws-body-scrolling-content").length},getMainScrollingContainer:function(){var t=$(".ws-body-scrolling-content");return t.length?t:$("body")},getScrollingContainerFixedOffsets:function(){if(this.isMainScrollingContainerBody()){var t=$("body")[0];return{top:0,right:0,bottom:0,left:0,clientWidth:t&&t.clientWidth,clientHeight:t&&t.clientHeight}}else{var e=this.getMainScrollingContainer()[0];return{top:0,right:e.offsetWidth-e.clientWidth,bottom:e.offsetHeight-e.clientHeight,left:0,clientWidth:e.clientWidth,clientHeight:e.clientHeight}}},registerHandler:function(t,e){if("string"!==typeof t||""===t.trim())throw new Error("LayoutManager: При регистрации обработчика введено неправильное название события");if("function"!==typeof e)throw new Error("LayoutManager: При регистрации обработчика введен неправильный обработчик");if(i.hasOwnProperty(t))o.Bus.globalChannel().unsubscribe(t,i[t]);o.Bus.globalChannel().subscribe(t,e),i[t]=e},init:function(){if("undefined"!==typeof window){this.registerHandler("ContentAbsoluteBlocksChanged",function(t,e){if(!c.length)return;if(e.maxHeight>0){c.css("min-height","");var n,o=e.maxHeight>c.get(0).scrollHeight?Math.max(c.get(0).scrollHeight,e.maxHeight):"";if(""!==o)c.css("min-height",o)}else c.css("min-height","")}),c=a(s.constants.layoutConfig.contentArea);var t=$("body");if(t.on("scroll",function(){if("hidden"===t.css("overflow-y"))this.getMainScrollingContainer().get(0).scrollIntoView(true)}.bind(this)),s.detection.isMobileSafari){var o=0,i=function t(e){$(document.documentElement).css("height",e>0?"calc(100% + "+e+"px)":""),o=e>0?e:0},e=function t(){for(var e=1;e<=4;e++)setTimeout(n,100*Math.pow(e,2))},n=function(){r(),l()},r=function t(e){var n=window.innerHeight-document.documentElement.clientHeight;if((n=n>0?n:0)!==o)i(n)},l=function(){if(t.hasClass("ws-body-no-scroll")&&t[0].scrollTop>0)t[0].scrollTop=0};$(document).bind("visibilitychange",e),$(window).bind("orientationchange",e),r(),setTimeout(r,1e3)}}},setHasAnyFloatArea:function(t){if(s.detection.isMobileIOS&&!this.isMainScrollingContainerBody())this.getMainScrollingContainer().toggleClass("ws-ios-overflow-scrolling-auto",t)},scrollToElement:function(t,e,i){if(!t||!t.length)return;i=i||1/0;for(var n=t.parents().filter(function t(){if(i<=0)return false;var e=$(this),n=e.css("overflow-y"),o="auto"===n||"scroll"===n||this===document.documentElement||e.hasClass("controls-ScrollContainer__content-overflowHidden");if(o)i--;return o&&this.scrollHeight>this.clientHeight}),o=$("html")[0],r=$("body")[0],l=function t(e){var n=e.offset();if(e[0]===o||e[0]===r)n.isHtmlOrBody=true,n.top=r.scrollTop,n.bottom=n.top+e[0].clientHeight;else n.bottom=n.top+e.outerHeight();return n.bottom=Math.ceil(n.bottom),n},s=0;s<n.length;s++){var c=$(n[s]),a=l(c),f=l(t),h=a.isHtmlOrBody?r:c[0],g=c.hasClass("ws-sticky-header__scrollable-container")?u.getStickyHeaderMaxHeight(c):0;if(a.bottom<f.bottom)if(e)h.scrollTop+=f.bottom-a.bottom;else h.scrollTop+=f.top-a.top-g;else if(a.top+g>f.top)if(e)h.scrollTop-=Math.max(a.bottom+g-f.bottom,0);else h.scrollTop-=Math.max(a.top+g-f.top,0)}}};return t.init(),t});