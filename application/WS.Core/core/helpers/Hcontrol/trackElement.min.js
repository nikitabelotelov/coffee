define("Core/helpers/Hcontrol/trackElement",["Core/constants","Core/helpers/Number/randomId","Core/EventBus","Core/detection","Core/helpers/Hcontrol/isElementVisible","Core/ControlBatchUpdater"],function(d,p,w,b,C,g){return function(){var i=[],n=[],t=200,s="ws_trackerChannelId",u="ws_trackerState";function c(e,t,i){var n=e[0];if(n)n[t]=i}function h(e,t){var i=e[0];return i&&i[t]}function o(e){var t=p("tracker-"),i=w.channel(t);return c(e,s,t),i.setEventQueueSize("*",1),i}function a(e){var i=false;return e.parents().each(function(e,t){if("fixed"===$(t).css("position"))return i=true,false}),i}function v(e){var t=C(e),i=a(e),n=e.get(0),r=d.$win,o=t&&n&&n.getBoundingClientRect(),f=o&&0!==o.width&&0!==o.height;if((b.isIE10||b.isIE11)&&t&&!f){var l;return h(e,u)||{}}return{visible:t&&f,fixed:i,left:Math.floor(o?o.left+r.scrollLeft():0),top:Math.floor(o?o.top+r.scrollTop():0),winLeft:Math.floor(o?o.left:0),winTop:Math.floor(o?o.top:0),width:Math.floor(o?o.right-o.left:0),height:Math.floor(o?o.bottom-o.top:0)}}function r(e){if(g&&g.haveBatchUpdate()&&!e)return;var t=$(this),i=h(t,s),n=h(t,u),r,o,f,l,a=false;if(!n)a=true,n={};if(r=v(t),o=w.channel(i),r.visible!==n.visible)o.notify("onVisible",r.visible);if(r.visible)if(l=n,(f=r).fixed!==l.fixed||f.left!==l.left||f.top!==l.top||f.width!==l.width||f.height!==l.height||f.winLeft!==l.winLeft||f.winTop!==l.winTop)if(o.notify("onMove",r,a),!h(t,s))return;c(t,u,r)}function f(e){if(-1===n.indexOf(e[0]))i.push(setInterval(r.bind(e[0]),t)),n.push(e[0])}function l(e){var t=n.indexOf(e[0]);if(t>-1)clearInterval(i[t]),i.splice(t,1),n.splice(t,1)}return function(e,t){var i=$(e),n=h(i,s),r;if(void 0===t)t=true;if(n)r=w.channel(n);else r=o(i);if(t)f(i);else l(i),c(i,s,null),c(i,u,null),r.destroy();return r}}()});