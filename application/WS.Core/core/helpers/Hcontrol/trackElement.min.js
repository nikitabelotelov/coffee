define("Core/helpers/Hcontrol/trackElement",["Env/Env","Core/helpers/Number/randomId","Env/Event","Core/helpers/Hcontrol/isElementVisible","Core/ControlBatchUpdater"],function(d,p,w,b,E){return function(){var n=[],i=[],t=200,s="ws_trackerChannelId",u="ws_trackerState";function c(e,t,n){var i=e[0];if(i)i[t]=n}function h(e,t){var n=e[0];return n&&n[t]}function o(e){var t=p("tracker-"),n=w.Bus.channel(t);return c(e,s,t),n.setEventQueueSize("*",1),n}function a(e){var n=false;return e.parents().each(function(e,t){if("fixed"===$(t).css("position"))return n=true,false}),n}function v(e){var t=b(e),n=a(e),i=e.get(0),r=d.constants.$win,o=t&&i&&i.getBoundingClientRect(),f=o&&0!==o.width&&0!==o.height;if((d.detection.isIE10||d.detection.isIE11)&&t&&!f){var l;return h(e,u)||{}}return{visible:t&&f,fixed:n,left:Math.floor(o?o.left+r.scrollLeft():0),top:Math.floor(o?o.top+r.scrollTop():0),winLeft:Math.floor(o?o.left:0),winTop:Math.floor(o?o.top:0),width:Math.floor(o?o.right-o.left:0),height:Math.floor(o?o.bottom-o.top:0)}}function r(e){if(E&&E.haveBatchUpdate()&&!e)return;var t=$(this),n=h(t,s),i=h(t,u),r,o,f,l,a=false;if(!i)a=true,i={};if(r=v(t),o=w.Bus.channel(n),r.visible!==i.visible)o.notify("onVisible",r.visible);if(r.visible)if(l=i,(f=r).fixed!==l.fixed||f.left!==l.left||f.top!==l.top||f.width!==l.width||f.height!==l.height||f.winLeft!==l.winLeft||f.winTop!==l.winTop)if(o.notify("onMove",r,a),!h(t,s))return;c(t,u,r)}function f(e){if(-1===i.indexOf(e[0]))n.push(setInterval(r.bind(e[0]),t)),i.push(e[0])}function l(e){var t=i.indexOf(e[0]);if(t>-1)clearInterval(n[t]),n.splice(t,1),i.splice(t,1)}return function(e,t){var n=$(e),i=h(n,s),r;if(void 0===t)t=true;if(i)r=w.Bus.channel(i);else r=o(n);if(t)f(n);else l(n),c(n,s,null),c(n,u,null),r.destroy();return r}}()});