define("Core/helpers/collection",["Core/helpers/Function/callNext","Core/EventBus"],function(t,u){return function e(s){s._eventBusChannel=u.channel({strictMode:true}),s._eventBusChannel.publish("onChange","onRemoveItem","onInsertItem","onMove","onChangeOrder");var a=function(){this._eventBusChannel.notify("onChange")},r=function(){a.apply(this),this._eventBusChannel.notify("onChangeOrder")},l=function(){return e(arguments[arguments.length-1])},h=function(e,n){a.apply(this,[]),this._eventBusChannel.notify("onInsertItem",e,n)},o=function(e,n){a.apply(this,[]),this._eventBusChannel.notify("onRemoveItem",e,n)},n=function(e,n){return this._eventBusChannel[e].apply(this._eventBusChannel,n),this},i=function(){return Array.prototype.slice.apply(arguments,[0,arguments.length-1])},p=function(e,n){for(var t=[],s=0;s<n;s++)t.push(e+s);return t};return s.subscribe=function(e,n){return this._eventBusChannel.subscribe(e,n,this),this},s.once=function(){return n.apply(this,["once",arguments])},s.unsubscribe=function(){return n.apply(this,["unsubscribe",arguments])},s.unbind=function(){return n.apply(this,["unbind",arguments])},s.slice=t.call(Array.prototype.slice,l.bind(s)),s.concat=t.call(Array.prototype.concat,l.bind(s)),s.pop=t.call(Array.prototype.pop,function(e){if(this._eventBusChannel.hasEventHandlers("onRemoveItem"))o.apply(this,[[e],[this.length]]);else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.push=t.call(Array.prototype.push,function(){if(this._eventBusChannel.hasEventHandlers("onInsertItem")){var e=i.apply(this,arguments),n=e.length,t=p(this.length-n,n);h.apply(this,[e,t])}else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.reverse=t.call(Array.prototype.reverse,r.bind(s)),s.shift=t.call(Array.prototype.shift,function(){if(this._eventBusChannel.hasEventHandlers("onRemoveItem"))o.apply(this,[Array.prototype.slice.apply(arguments,[]),[0]]);else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.unshift=t.call(Array.prototype.unshift,function(){if(this._eventBusChannel.hasEventHandlers("onInsertItem")){var e=i.apply(this,arguments).reverse(),n=p(0,e.length);h.apply(this,[e,n])}else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.sort=t.call(Array.prototype.sort,r.bind(s)),s.splice=t.call(Array.prototype.splice,function(e,n){var t=arguments.length,s=true;if(this._eventBusChannel.hasEventHandlers("onRemoveItem")&&n>0){var r=arguments[t-1];s=false,o.apply(this,[r,p(e,r.length)])}if(this._eventBusChannel.hasEventHandlers("onInsertItem")&&t>3){var i=Array.prototype.slice.apply(arguments,[2,t-1]);s=false,h.apply(this,[i,p(e,i.length)])}if(s)a.apply(this,[]);return l.apply(this,arguments)}),s.move=function(e,n){var t=this[e];return Array.prototype.splice.apply(this,[e,1]),Array.prototype.splice.apply(this,[n,0,t]),this._eventBusChannel.notify("onMove",e,n),r.bind(s).apply(this),this},s}});