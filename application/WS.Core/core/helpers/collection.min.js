define("Core/helpers/collection",["Core/helpers/Function/callNext","Env/Event"],function(t,u){return function n(s){s._eventBusChannel=u.Bus.channel({strictMode:true}),s._eventBusChannel.publish("onChange","onRemoveItem","onInsertItem","onMove","onChangeOrder");var a=function(){this._eventBusChannel.notify("onChange")},i=function(){a.apply(this),this._eventBusChannel.notify("onChangeOrder")},l=function(){return n(arguments[arguments.length-1])},h=function(n,e){a.apply(this,[]),this._eventBusChannel.notify("onInsertItem",n,e)},o=function(n,e){a.apply(this,[]),this._eventBusChannel.notify("onRemoveItem",n,e)},e=function(n,e){return this._eventBusChannel[n].apply(this._eventBusChannel,e),this},r=function(){return Array.prototype.slice.apply(arguments,[0,arguments.length-1])},p=function(n,e){for(var t=[],s=0;s<e;s++)t.push(n+s);return t};return s.subscribe=function(n,e){return this._eventBusChannel.subscribe(n,e,this),this},s.once=function(){return e.apply(this,["once",arguments])},s.unsubscribe=function(){return e.apply(this,["unsubscribe",arguments])},s.unbind=function(){return e.apply(this,["unbind",arguments])},s.slice=t.call(Array.prototype.slice,l.bind(s)),s.concat=t.call(Array.prototype.concat,l.bind(s)),s.pop=t.call(Array.prototype.pop,function(n){if(this._eventBusChannel.hasEventHandlers("onRemoveItem"))o.apply(this,[[n],[this.length]]);else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.push=t.call(Array.prototype.push,function(){if(this._eventBusChannel.hasEventHandlers("onInsertItem")){var n=r.apply(this,arguments),e=n.length,t=p(this.length-e,e);h.apply(this,[n,t])}else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.reverse=t.call(Array.prototype.reverse,i.bind(s)),s.shift=t.call(Array.prototype.shift,function(){if(this._eventBusChannel.hasEventHandlers("onRemoveItem"))o.apply(this,[Array.prototype.slice.apply(arguments,[]),[0]]);else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.unshift=t.call(Array.prototype.unshift,function(){if(this._eventBusChannel.hasEventHandlers("onInsertItem")){var n=r.apply(this,arguments).reverse(),e=p(0,n.length);h.apply(this,[n,e])}else if(this._eventBusChannel.hasEventHandlers("onChange"))a.apply(this,[])}),s.sort=t.call(Array.prototype.sort,i.bind(s)),s.splice=t.call(Array.prototype.splice,function(n,e){var t=arguments.length,s=true;if(this._eventBusChannel.hasEventHandlers("onRemoveItem")&&e>0){var i=arguments[t-1];s=false,o.apply(this,[i,p(n,i.length)])}if(this._eventBusChannel.hasEventHandlers("onInsertItem")&&t>3){var r=Array.prototype.slice.apply(arguments,[2,t-1]);s=false,h.apply(this,[r,p(n,r.length)])}if(s)a.apply(this,[]);return l.apply(this,arguments)}),s.move=function(n,e){var t=this[n];return Array.prototype.splice.apply(this,[n,1]),Array.prototype.splice.apply(this,[e,0,t]),this._eventBusChannel.notify("onMove",n,e),i.bind(s).apply(this),this},s}});