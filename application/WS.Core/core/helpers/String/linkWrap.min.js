define("Core/helpers/String/linkWrap",["Core/helpers/String/wrapFileOpener"],function(){"use strict";var r="((https?|ftp|file)://|www\\.)[-A-Za-zА-ЯЁа-яё0-9._]+(?::[0-9]+)?(/([-A-Za-zА-ЯЁа-яё0-9+&@#$/%№=~_{|}!?:,.;()*'[\\]](?!nbsp;|amp;nbsp;))*)*",t="<[\\s]*(a|iframe)[\\s\\S]*?>[\\s\\S]*?</(a|iframe)>|",e;return{urlRegExpString:r,excludeLinkString:t,wrapURLs:function(){var e,s=new RegExp(t+'((([^<>()\\[\\]\\.,;:\\s@\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@(([^&<>()[\\]\\.,;:\\s@\\"]+\\.)+[^&<>()[\\]\\.,;:\\s@\\"]{2,}))',"img"),g=new RegExp(t+r,"i"),p=new RegExp("^"+r,"i"),c=/(&quot;)+$/i,o=/^(&nbsp;|,)+/gi,n=/(&nbsp;|,|&quot;)+/i,b=function(e,n,r){if(/^www.*/gi.test(e))e="http://"+e;return'<a rel="noreferrer" class="asLink"'+(r?' target="_blank"':"")+' href="'+e+'">'+n+"</a>"};function k(e){var n=-1,r="",t=0;return e.replace(g,function(e){t=(r=e).length,n=arguments[7]}),{link:r,pos:n,length:t}}function v(e,u){var f=[e];return e.replace(n,function(e,n,r,t){var s=false,i=false,l="";if("&quot;"==e)s=true;var a=t.substr(r,t.length);if(a){if((l=a.replace(o,"")).length>0)i=p.exec(l);if(u&&s||i||0==l.length)f[0]=t.substr(0,r),f[1]=a}}),f}function w(e,n,r,t){var s=[];if(s.push(e+n),r&&r.length>1)s.push(r[1]);if(t)s.push(t);return s}function i(e,n){var r=[],t="",s=e.length,i=false;g.lastIndex=0;var l=k(e);if(-1!==l.pos){if(t=e.substr(0,l.pos))i=c.test(t.trim());var a,u,f=l.link.lastIndexOf(")"),p=l.link.lastIndexOf("(");if(t&&'"'===e[l.pos-1]&&-1!==e.indexOf('"',l.pos)&&"<"!=l.link[0])l.length=e.indexOf('"',l.pos)-l.pos,l.link=e.substr(l.pos,l.length);while("."==l.link[l.length-1])l.length--,l.link=e.substr(l.pos,l.length);if("<"!=l.link.charAt(0)&&"src="!==e.substr(l.pos-5,4)&&"url("!==e.substr(l.pos-5,4)){while(-1!=f&&(p>f||-1==p))l.link=l.link.substr(0,f),l.length=l.link.length,f=l.link.lastIndexOf(")"),p=l.link.lastIndexOf("(");a=v(l.link,i),u=b(a[0],a[0],n)}else u=l.link;var o=l.length+l.pos,h;r=w(t,u,a,o<s?e.substr(o,s):"")}else r.push(e);return r}return function(e,g){var n,r;if("string"===typeof e){if(g=void 0===g?true:g,n=0,(r=[e]).length)while(n<r.length)Array.prototype.splice.apply(r,[n,1].concat(i(r[n],g))),n++;e=r.join(""),s.lastIndex=0;var t=[];e=(e=(e=e.replace(/(<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>)/gim,function(e){return t.push(e),"(ImageFromBuffer)"})).replace(s,function(e,n,r,t,s,i,l,a,u,f,p,o){var h=o.substr(p+e.length);if("<"===e.charAt(0)||h.length>1&&":"==h[0]&&!/\s/.test(h[1]))return e;return b("mailto:"+e,e,g)})).replace(/\(ImageFromBuffer\)/gim,function(){var e=t[0];return t.shift(),e})}return e}}(),wrapFiles:function(){var f=new RegExp(t+"(?:\\b[a-z]:\\\\|\\\\\\\\[a-z0-9 %._-]+\\\\[a-z0-9 $%._-]+)","i"),p=/[:*?"'<>|\r\n]| *[a-z]:\\/gi,o=/([,.]+(([ ]|&nbsp;)*[а-я]|([ ]|&nbsp;)+[a-z]|[:*?"'<>|])|[:*?"'<>|])| *[a-z]:\\|[.,]+$/gi;function s(e){var n=[],r=-1,t="",s="",i=0,l=0,a=e.length,u="undefined"===typeof rk?function(e){return e}:rk;if(e.replace(f,function(e){r=arguments[3],i=e.length}),-1!==r&&"<"!=e[r]){if(t=e.substr(0,r),-1!==(l=e.substr(r+i).search('"'===e[r-1]||"'"===e[r-1]?p:o)))l+=i,s+=e.substr(r,l),r+=l;else s+=e.substr(r),r=a;if(n.push(t+'<a class="asLink" title="'+u("Открыть файл (папку)")+'" data-open-file="'+s+'">'+s+"</a>"),r<a)n.push(e.substr(r,a))}else if("<"==e[r]){if(t=e.substr(0,r),s+=e.substr(r,i),r+=i,n.push(t+s),r<a)n.push(e.substr(r,a))}else n.push(e);return n}return function e(n){var r,t;if("string"===typeof n){if(r=0,(t=[n]).length)while(r<t.length)Array.prototype.splice.apply(t,[r,1].concat(s(t[r]))),r++;return t.join("")}return n}}()}});