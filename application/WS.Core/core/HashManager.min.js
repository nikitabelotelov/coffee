define("Core/HashManager",["require","Core/helpers/Object/isEmpty","Core/EventBus","Core/constants"],function(e,_,t){"use strict";var s={_eventBusChannel:null,eventBusId:"HashManager",_handlers:{},get _location(){return window?window.location:void 0},get _history(){return window?window.history:void 0},_getLocWithoutHash:function(){var e=this._location.toString(),t=e.indexOf("#");if(-1!==t)e=e.substring(0,t);return e},get:function(e){var t="";if(window){var n=decodeURI(this._location.hash),i=new RegExp("(?:#|&)"+e+"=(?:[^&]+$|[^&]+(?=&))","");t=n.match(i)}return t?t[0].replace(/^./,"").replace(e+"=","").replace(/:a:/g,"&"):void 0},_prepareHash:function(e){if(0===e.indexOf("#"))return e.substring(1);return e},set:function(e,t,n,i){if(window&&e){var s={},a={},r=[],o,h;if("object"===typeof e)s=e,i=n,n=t;else s[e]=t;for(o in s)if(s.hasOwnProperty(o))if(void 0===(h=s[o])||!(""+h).trim())r.push(o);else a[o]=h;if(r.length)this.remove(r,n);if(!_(a)){var c=decodeURI(this._location.hash);for(o in c=this._prepareHash(c),a)if(a.hasOwnProperty(o)){var u=(a[o]+"").replace(/&/g,":a:"),l=new RegExp(o+"=[^&]+$|"+o+"=[^&]+(?=&)",""),f=[o,u].join("=");if(c.length)c=c.match(l)?c.replace(l,f):[c,f].join("&");else c=f}this.setHash(c,n,i)}}},setHash:function(e,t,n){var i=this._getLocWithoutHash();this._changeLocation(i,e,this._replace||n),!n&&(this._replace=t)},pushState:function(){if(this._replace=false,this.set("ws-dummy","1"),this._replace=true,this.remove("ws-dummy",true),e.defined("Lib/NavigationController/NavigationController"))e("Lib/NavigationController/NavigationController").saveAllStates()},remove:function(e,t){if(window){if(!(e instanceof Array))e=[e];var n=decodeURI(this._location.hash),i=this._getLocWithoutHash();if(0===n.indexOf("#"))n=n.substring(1);for(var s=0;s<e.length;s++){var a=new RegExp("&?"+e[s]+"=[^&]+$|"+e[s]+"=[^&]+&","g");n=n.replace(a,"")}this._changeLocation(i,n,this._replace),this._replace=t}},_changeLocation:function(e,t,n){var i=e+"#"+encodeURI(t);if(this._prepareHash(t)===this._prepareHash(this._location.hash)||n)this._history.replaceState(this._history.state,"",i);else this._history.pushState(this._history.state,"",i);s._getChannel().notify("onChange")},_getChannel:function(){if(!this._eventBusChannel)this._eventBusChannel=t.channel(this.eventBusId);return this._eventBusChannel},once:function(e,t){this._getChannel().once(e,t,this)},subscribe:function(e,t){return this._getChannel().subscribe(e,t,this),this},unsubscribe:function(e,t){return this._getChannel().unsubscribe(e,t),this}};if("undefined"!==typeof window)s._replace=true,window.onhashchange=function(){s._getChannel().notify("onChange")};return s});