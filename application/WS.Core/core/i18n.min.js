define("Core/i18n",["require","exports","Env/Env","Core/Deferred","Core/polyfill"],function(n,t,o,r){"use strict";var u="plural#",i="|",a=2920,e={"ru-RU":"Русский (Россия)","en-US":"English (USA)"},c=function(){return this||(0,eval)("this")}(),s=o.constants.isServerScript?false:o.constants.isNodePlatform?true:c.contents?!!c.contents.defaultLanguage:o.constants.i18n;function f(t,e){Object.defineProperties(this,{translatedValue:{enumerable:true,get:function(){return String(e(t)||t)}},length:{enumerable:true,get:function(){return this.translatedValue.length}}})}function l(t){var e=new r;return n([t+"/.builder/module"],function(t){e.callback(t)},function(t){e.errback(t)}),e}function d(t,e){for(var n in e)if(e.hasOwnProperty(n)&&!t[n])t[n]=e[n];return t}function g(t,e){var n=t.query;if(0===Object.keys(n).length||1===Object.keys(n).length&&n.hasOwnProperty(e))return t.originalUrl;var r="?";for(var i in n)if(i!==e)r+=i+"="+n[i]+"&";return t.originalUrl.split("?")[0]+r.slice(0,r.length-1)}function h(){if(s)p.setLang(p.detectLanguage());else p.setLang("");if(!c.hasOwnProperty("rk"))Object.defineProperty(c,"rk",{enumerable:true,value:p.rk.bind(p)})}(f.prototype=Object.create(String.prototype)).toString=f.prototype.toJSON=f.prototype.valueOf=function t(){return this.translatedValue};var p={init:function(){if(this.isInit())return;this.__init=true,h()},isInit:function(){return!!this.__init},isEnabled:function(){return s},setEnable:function(t){s=t,h()},detectLanguageBrowser:function(){var r=this,i=this.getDefaultLang(),t=process.domain&&process.domain.req,e=t&&t.headers&&t.headers["accept-language"]&&t.headers["accept-language"].split(",");if(e)e.some(function(t){var e=t.split(";")[0];if(e.includes("-")&&r.hasLang(e))return i=e,true;else if(!e.includes("-"))for(var n in r.getAvailableLang())if(n.startsWith(e))return i=n,true});return i},_setLangOnNode:function(t){var e=process.domain&&process.domain.req,n=process.domain&&process.domain.res;if(e&&n&&!(n.cookies&&n.cookies.hasOwnProperty("lang")))o.cookie.set("lang",t,{expires:a,path:"/"}),n.redirect(g(e,"lang"))},detectLanguage:function(){if(this.isEnabled()){if(o.constants.isNodePlatform){var t=this.getDefaultLang(),e=process.domain&&process.domain.req;if(e){var n=e.cookies&&e.cookies.lang,r=e.query&&e.query.lang;if(t=r||n||this.detectLanguageBrowser(),t=this.hasLang(t)?t:this.getDefaultLang(),r||!n)this._setLangOnNode(t)}return t}if(o.constants.isBrowserPlatform){var i=this.getAvailableLang(),s=o.cookie.get("lang")||"";if(!s)s=o.constants.defaultLanguage||c.contents&&c.contents.defaultLanguage;if(!s||5!==s.length||!i[s])s=Object.keys(i)[0]||"";return s}}return""},getDefaultLang:function(){return o.constants.defaultLanguage||"ru-RU"},getLang:function(){if(this.isEnabled()){if(o.constants.isNodePlatform)return this.detectLanguage();if(o.constants.isBrowserPlatform)return this._currentLang}return""},getAvailableLang:function(){return e},getDictModule:function(t){if(this.isProcessedModule(t))return this._modulesDict[t];return this._modulesDict[t]=l(t).addCallback(function(t){var e={};if(t.dict)for(var n=0,r=t.dict;n<r.length;n++){var i,s=r[n].split(".");e[s[0]]=e[s[0]]||[],e[s[0]].push(s[1]?s[1]:"json")}return e}),this._modulesDict[t]},isProcessedModule:function(t){return this._modulesDict.hasOwnProperty(t)},hasLang:function(t){return t in e},setLang:function(t){var e=this;if(o.constants.isServerScript||o.constants.isNodePlatform)return false;if(this.isEnabled()){var n=false,r=this._currentLang,i;if(t&&"string"===typeof t&&/..-../.test(t)&&t!==this._currentLang){var s=t.split("-");this._currentLang=s[0].toLowerCase()+"-"+s[1].toUpperCase(),n=true}if(n)o.cookie.set("lang",this._currentLang,{expires:a,path:"/"}),i=this._currentLang,document.addEventListener("DOMContentLoaded",function(){if(document.body.classList.length&&r)document.body.classList.remove(r);document.body.classList.add(i)});return n}return document.addEventListener("DOMContentLoaded",function(){if(document.body.classList.length&&e._currentLang)document.body.classList.remove(e._currentLang)}),false},_translate:function(t,e,n){if(null===t||void 0===t||!t.indexOf)return t;var r=t,i="",s=t.indexOf(this._separator);if(s>-1)e=t.substr(0,s),t=t.substr(s+this._separator.length);if("number"===typeof e)n=e,e="";if(r=t,!o.constants.isServerScript&&this.isEnabled())if((i=this.getLang())&&this._dict[i])if(void 0!==n){var a=this._getTransKey(u+t,e,i);r=a?this._plural(a,n):t}else r=this._getTransKey(t,e,i)||t;return r},rk:function(t,e,n){var r=this;if(t instanceof f)return t;if("undefined"!==typeof window||null===t||void 0===t||!t.indexOf)return this._translate(t,e,n);return new f(t,function(){return r._translate(t,e,n)})},_getTransKey:function(t,e,n){var r=this._dict[n][e?""+e+this._separator+t:""+t];if(void 0!==r)return r;if("ru-RU"!==n&&"undefined"!==typeof window&&window.location.host.indexOf("-")>-1)if(/[А-Яа-яA-Za-z]+/.test(t))o.IoC.resolve("ILogger").error("Localization","Для ключа "+t+" отсутствует перевод в словаре.");return},hasDict:function(t,e){return e=e||this.getLang(),this._dictNames[e]?t in this._dictNames[e]:false},setDict:function(t,e,n){if((n=n||this.getLang())&&!this.hasDict(e,n)){if(e)this._dictNames[n]=this._dictNames[n]||{},this._dictNames[n][e]=true;this._dict[n]=d(this._dict[n]||{},t)}},getPathToDict:function(t,e,n){return t+"/lang/"+e+"/"+e+"."+n},_plural:function(t,e){if(void 0!==t){e=Math.abs(e);var n=this.getLang(),r=void 0;switch(r=[e].concat(t.split(i)),n){case"en-US":return this._pluralEn.apply(this,r);case"ru-RU":return this._pluralRu.apply(this,r);default:return t}}return},_pluralRu:function(t,e,n,r,i){if(t%1>0)return i;if((t%=100)>=11&&t<=19)return r;if(1==(t%=10))return e;if(2==t||3==t||4==t)return n;return r},_pluralEn:function(t,e,n){if(t>1||0===t)return n;return e},__init:false,_modulesDict:{},_separator:"@@",_currentLang:"",_dict:{},_dictNames:{},_rkString:f};return p.init(),p});