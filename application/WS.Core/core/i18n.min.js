define("Core/i18n",["require","exports","Core/constants","Core/pathResolver","Core/IoC","Core/cookie","Core/polyfill"],function(t,e,c,l,i,u){"use strict";var d=/(.*\/)?(resources\/(.+?)|ws)\//,g=/\\/g,o="plural#",a="|",f=2920,n={"ru-RU":"Русский (Россия)","en-US":"English (USA)"},h=function(){return this||(0,eval)("this")}(),p=c.isServerScript?false:c.isNodePlatform?true:h.contents?!!h.contents.defaultLanguage:c.i18n;function s(t,e){Object.defineProperties(this,{translatedValue:{enumerable:true,get:function(){return String(e(t)||t)}},length:{enumerable:true,get:function(){return this.translatedValue.length}}})}function r(t,e){for(var n in e)if(e.hasOwnProperty(n)&&!t[n])t[n]=e[n];return t}function v(t,e){if(0===Object.keys(t).length||1===Object.keys(t).length&&t.hasOwnProperty(e))return"";var n="?";for(var r in t)if(r!==e)n+=r+"="+t[r]+"&";return n.slice(0,n.length-1)}function L(){if(p)_.setLang(_.detectLanguage());else _.setLang("");if(!h.hasOwnProperty("rk"))Object.defineProperty(h,"rk",{enumerable:true,value:_.rk.bind(_)})}(s.prototype=Object.create(String.prototype)).toString=s.prototype.toJSON=s.prototype.valueOf=function t(){return this.translatedValue};var _={init:function(){if(this.isInit())return;this.__init=true,L()},isInit:function(){return!!this.__init},isEnabled:function(){return p},setEnable:function(t){p=t,L()},detectLanguage:function(){if(c.isServerScript)return"";if(c.isNodePlatform){var t=c.defaultLanguage,e=process.domain&&process.domain.req;if(e){var n=e.cookies&&e.cookies.lang,r=e.query&&e.query.lang,i=process.domain.res;if(t=r||n||t,t=this.hasLang(t)?t:this.getDefaultLang(),i&&!(i.cookies&&i.cookies.hasOwnProperty("lang"))&&r){u.set("lang",t,{expires:f,path:"/"});var a=e.path+v(e.query,"lang");i.redirect(a)}}return t}if(p){var s=this.getAvailableLang(),t;if(!(t=u.get("lang")||""))t=c.defaultLanguage||h.contents&&h.contents.defaultLanguage;if(!t||5!==t.length||!s[t])t=Object.keys(s)[0]||"";return t}return""},getDefaultLang:function(){return c.defaultLanguage||"ru-RU"},getLang:function(){if(c.isServerScript)return"";if(c.isNodePlatform)return this.detectLanguage();if(p)return this._currentLang;return""},getAvailableLang:function(){return n},hasLang:function(t){return t in n},setLang:function(t){var e=this;if(c.isServerScript||c.isNodePlatform)return false;if(p){var n=false,r=this._currentLang,i;if(t&&"string"===typeof t&&/..-../.test(t)&&t!==this._currentLang){var a=t.split("-");this._currentLang=a[0].toLowerCase()+"-"+a[1].toUpperCase(),n=true}if(!t)this._currentLang="",n=true;if(n)u.set("lang",this._currentLang||null,{expires:f,path:"/"}),i=this._currentLang,document.addEventListener("DOMContentLoaded",function(){if(document.body.classList.length&&r)document.body.classList.remove(r);document.body.classList.add(i)});return n}return u.set("lang",null,{path:"/"}),document.addEventListener("DOMContentLoaded",function(){if(document.body.classList.length&&e._currentLang)document.body.classList.remove(e._currentLang)}),false},_translate:function(t,e,n){if(null===t||void 0===t||!t.indexOf)return t;var r=t,i="",a=t.indexOf(this._separator);if(a>-1)e=t.substr(0,a),t=t.substr(a+this._separator.length);if("number"===typeof e)n=e,e="";if(r=t,!c.isServerScript&&(c.isNodePlatform||p))if((i=this.getLang())&&this._dict[i])if(void 0!==n){var s=this._getTransKey(o+t,e,i);r=s?this._plural(s,n):t}else r=this._getTransKey(t,e,i)||t;return r},rk:function(t,e,n){var r=this;if(t instanceof s)return t;if("undefined"!==typeof window||null===t||void 0===t||!t.indexOf)return this._translate(t,e,n);return new s(t,function(){return r._translate(t,e,n)})},_getTransKey:function(t,e,n){var r=this._dict[n][e?""+e+this._separator+t:""+t];if(void 0!==r)return r;if("ru-RU"!==n&&"undefined"!==typeof window&&window.location.host.indexOf("-")>-1)if(/[А-Яа-яA-Za-z]+/.test(t))i.resolve("ILogger").error("Localization","Для ключа "+t+" отсутствует перевод в словаре.");return},hasDict:function(t,e){return e=e||this.getLang(),this._dictNames[e]?t in this._dictNames[e]:false},setDict:function(t,e,n){if((n=n||this.getLang())&&!this.hasDict(e,n)){if(e)this._dictNames[n]=this._dictNames[n]||{},this._dictNames[n][e]=true;this._dict[n]=r(this._dict[n]||{},t)}},getDictPath:function(t,e,n){var r=l.resolveComponentPath(t),i=c.dictionary||{};if(0===Object.keys(i).length)if("undefined"!==typeof h.contents)i=h.contents.dictionary||{};else if(c.isNodePlatform){var a=process.domain&&process.domain.service&&process.domain.service.getContents();i=a&&a.dictionary||{}}var s=false;if(!r)s=true,r=t;else if(0===r.indexOf("/"))s=true,r=r.slice(1);if(s){if(0!==r.substr(-n.length-1).indexOf("."+n))r=r+"."+n;r=h.requirejs.toUrl(r)}var u=(r=r.replace(g,"/")).match(d),o=u&&(u[3]||u[2]),f;if(o&&i[o+"."+e+"."+n]){if("ws"===o)o="WS";f=o+"/lang/"+e+"/"+e+"."+n}return f},_plural:function(t,e){if(void 0!==t){e=Math.abs(e);var n=this.getLang(),r=void 0;switch(r=[e].concat(t.split(a)),n){case"en-US":return this._pluralEn.apply(this,r);case"ru-RU":return this._pluralRu.apply(this,r);default:return t}}return},_pluralRu:function(t,e,n,r,i){if(t%1>0)return i;if((t%=100)>=11&&t<=19)return r;if(1==(t%=10))return e;if(2==t||3==t||4==t)return n;return r},_pluralEn:function(t,e,n){if(t>1||0===t)return n;return e},__init:false,_separator:"@@",_currentLang:"",_dict:{},_dictNames:{},_rkString:s};return _.init(),_});