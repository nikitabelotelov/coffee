define("Core/AbstractConfigOld",["Core/Abstract","Core/Deferred","Core/SessionStorage","Core/constants","optional!Types/source"],function(e,n,a,i,t){return e.extend({$protected:{_blo:null},$constructor:function(){this._publish("onChange")},_isConfigSupport:function(){throw new Error("AbstractConfig:_isConfigSupport must be implemented in child classes")},_getObjectName:function(){throw new Error("AbstractConfig:_getObjectName must be implemented in child classes")},_getBLObject:function(){if(!t)throw new Error("Для работы Core/AbstractConfig нужен модуль Types/source");var e=new n,r=this;if(null===this._blo)return e.callback().addCallback(function(){return r._blo=new t.SbisService({endpoint:r._getObjectName()}),r._blo});else e.callback(this._blo);return e},_callMethod:function(r,t){if(!this._isConfigSupport())return n.success();return this._getBLObject().addCallback(function(e){return e.call(r,t)})},_prepareParam:function(e,r){var t={"Путь":e};if(r)t["Контекст"]=r;return t},_processingParam:function(e,r,t){if(!i.isBrowserPlatform||!r)return;switch(e){case"update":a.set(r,t);break;case"delete":a.remove(r);break;case"read":return a.get(r)}this._notify("onChange",r,t)},_getParam:function(e,t,r){var a=this;return this._callMethod(e,this._prepareParam(t,r)).addCallback(function(e){if(!e)return a._processingParam("read",t);var r=e.getScalar();return a._processingParam("update",t,r),r})},getParam:function(e,r){return this._getParam("ПолучитьЗначение",e,r)},getParams:function(e){var a=this,r=e?{Names:e}:{};return this._callMethod("ПолучитьПараметры",r).addCallback(function(e){if(!e)return{};var r,t;if(r=e.getAll())r.each(function(e){(t=e.get("Название"))&&a._processingParam("update",t,e.get("Значение"))});return r})},setParam:function(e,r,t){if(void 0===r)r=null;if(this._processingParam("update",e,r),!this._isConfigSupport())return(new n).callback(true);var a=this._prepareParam(e,t);return a["ЗначениеПараметра"]=r,this._callMethod("ВставитьЗначение",a).addCallback(function(e){return e&&e.getScalar()})},removeParam:function(e,r){if(this._processingParam("delete",e,null),!this._isConfigSupport())return(new n).callback(true);var t=this._prepareParam(e,r);return this._callMethod("УдалитьПараметр",t).addCallback(function(e){return e&&e.getScalar()})}})});