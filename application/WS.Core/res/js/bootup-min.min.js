define("bootup-min",["require","Core/detection","Core/IoC","Core/Deferred","Core/ParallelDeferred","Core/EventBus","Core/core-instance","Core/Context","Core/constants","Core/CommandDispatcher","Core/helpers/Array/uniq","Core/helpers/Hcontrol/doAutofocus","Core/helpers/Hcontrol/getChildContainers","Core/Serializer","Core/markup/parse","Core/helpers/Hcontrol/configStorage","Core/moduleStubs","View/decorators","Core/helpers/VdomCtxPlugin","Core/helpers/vdomCtxFields","Core/helpers/Hcontrol/makeInstanceCompatible","is!compatibleLayer?Lib/Control/Control.compatible","is!compatibleLayer?Lib/Control/AreaAbstract/AreaAbstract.compatible","is!compatibleLayer?Lib/Control/BaseCompatible/BaseCompatible"],function(c,e,u,s,f,d,o,p,m,t,C,g,b,i,h,v,w,y,a,l,_){"use strict";var O=[];function n(){if(e.isMobileSafari)setTimeout(window.close,301);else window.close()}function R(e){if(o.instanceOfModule(e,"Deprecated/Controls/RecordArea/RecordArea")&&!window.previousPageURL)e.close=function(){};t.declareCommand(e,"close",e.close?e.close:function(){n()})}function A(e,o){var t;return e.find("[data-component]").toArray().filter(function(e){if(-1===o.indexOf(e))return e.additionalControl=true})}function D(l,i){var e=$(document),o,t=b(e,"[data-component]",function(e){return $(e).parent("#contentArea").length||e.hasAttribute("page-content")}).reduce(function(e,o){var t=$(o).find("[config]");o.__minCfg=-1;for(var n=0;n<t.length;n++){var r=t.eq(n).attr("config");if(/^cfg-[0-9]+$/.test(r)){o.__minCfg=parseInt(r.split("-")[1],10);break}}return e.push(o),e},[]),n=A(e,t=t.sort(function(e,o){if(-1===e.__minCfg&&-1===o.__minCfg)return 0;else if(-1===e.__minCfg)return 1;else if(-1===o.__minCfg)return-1;else return e.__minCfg-o.__minCfg})),a=t.concat(n).reduce(function(e,r){if(!r.wsControl){var i=r.getAttribute("data-component"),a=i,o;if("OnlineSbisRu/Base/View"===i)p.global.setValue("bootupReadyFlagForGenerateId",true);if(!r.additionalControl)o=function(){var e=h(r)||{},o=c(a);e.iWantBeWS3=true,e._fromBootupMin=true;var t=new o(e);if(t._template)if(_(t,e),t.isBuildVDom()){var n=e.element[0]?e.element[0]:e.element;if(!(n.wsControl=t).VDOMReady){if(t.mountToDom)t.mountToDom($(n),e,o);else t.setContainer($(n));if(t.saveOptions)t.saveOptions(e);else t._options=e}}else if(t.setParent(null),"function"===typeof t.init)t.init();if(l&&t.getReadyDeferred)l.push(t.getReadyDeferred());if(O.indexOf(i)>-1)R(t)},e.creators.push(o);e.modules.push(a)}return e},{creators:[],modules:[]}),r;function s(e){l&&l.done().getResult().addCallback(function(){d.globalChannel().setEventQueueSize("bootupReady",1),d.globalChannel().notify("bootupReady",{error:e}),p.global.setValue("bootupReadyFlagForGenerateId",true)})}return w.require(C(a.modules)).addCallback(function(){var e;if("string"===typeof window.componentOptions){if(window.componentOptionsEscaped)window.componentOptions=y.unescape(window.componentOptions);var o=(window.componentOptions||"{}").replace(/\!\@\#\$\^COMMENT_START\^\$\#\@\!/g,"\x3c!--");e=new i,v.merge(JSON.parse(o,e.deserialize))}function t(e){if(g.findAutofocus(e.target).length)r=g(e.target)}var n=$("body"),r=false;if(n.on("onReady",t),a.creators.forEach(function(e){e()}),n.off("onReady",t),!r)g($("[data-component]").eq(0));s()}).addErrback(function(e){u.resolve("ILogger").error("bootup",e&&e.message||e),s(e)})}function S(o,n,a,l){$(document).ready(function(){var r=new f({stopOnFirstError:false}),t=p.global.getValue("editParams")||p.global.getValue("printParams"),i=[];if(m.decoratedLinkService="/linkdecorator/service/",0===arguments.length||1==arguments.length&&"string"!==typeof arguments[0])if($(".ws-root-template").each(function(){var e=$(this),o=e.data("template-name");if(o.indexOf("/")>-1&&void 0==t)O.push(o),e.attr("data-component",o);else i.push({templateName:o,ctr:e})}),i.length>0)c(["old-bootup"],function(e){for(var o=0,t=i.length;o<t;o++){var n=new s;r.push(n),e(i[o].templateName,i[o].ctr,null,n)}D(r,l)});else D(r,l);else c(["old-bootup"],function(e){e(o,n,a)})})}return function(e,o,t,n){S.call(this,e,o,t,n||i);var r=l();a(function(){return r})}});