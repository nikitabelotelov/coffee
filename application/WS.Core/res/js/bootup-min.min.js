define("bootup-min",["require","Core/Deferred","Core/ParallelDeferred","Env/Event","Core/core-instance","Core/Context","Env/Env","Core/CommandDispatcher","Core/helpers/Array/uniq","Core/helpers/Hcontrol/doAutofocus","Core/helpers/Hcontrol/getChildContainers","Core/Serializer","Core/markup/parse","Core/helpers/Hcontrol/configStorage","Core/moduleStubs","View/decorators","Core/helpers/VdomCtxPlugin","Core/helpers/vdomCtxFields","Core/helpers/Hcontrol/makeInstanceCompatible","is!compatibleLayer?Lib/Control/Control.compatible","is!compatibleLayer?Lib/Control/AreaAbstract/AreaAbstract.compatible","is!compatibleLayer?Lib/Control/BaseCompatible/BaseCompatible"],function(c,s,e,u,o,f,d,t,p,m,C,i,g,b,v,h,a,l,w){"use strict";var y=[];function n(){if(d.detection.isMobileSafari)setTimeout(window.close,301);else window.close()}function _(e){if(o.instanceOfModule(e,"Deprecated/Controls/RecordArea/RecordArea")&&!window.previousPageURL)e.close=function(){};t.declareCommand(e,"close",e.close?e.close:function(){n()})}function O(e,o){var t;return e.find("[data-component]").toArray().filter(function(e){if(-1===o.indexOf(e))return e.additionalControl=true})}function R(l,i){var e=$(document),o,t=C(e,"[data-component]",function(e){return $(e).parent("#contentArea").length||e.hasAttribute("page-content")}).reduce(function(e,o){var t=$(o).find("[config]");o.__minCfg=-1;for(var n=0;n<t.length;n++){var r=t.eq(n).attr("config");if(/^cfg-[0-9]+$/.test(r)){o.__minCfg=parseInt(r.split("-")[1],10);break}}return e.push(o),e},[]),n=O(e,t=t.sort(function(e,o){if(-1===e.__minCfg&&-1===o.__minCfg)return 0;else if(-1===e.__minCfg)return 1;else if(-1===o.__minCfg)return-1;else return e.__minCfg-o.__minCfg})),a=t.concat(n).reduce(function(e,r){if(!r.wsControl){var i=r.getAttribute("data-component"),a=i,o;if("OnlineSbisRu/Base/View"===i)f.global.setValue("bootupReadyFlagForGenerateId",true);if(!r.additionalControl)o=function(){var e=g(r)||{},o=c(a);e.iWantBeWS3=true,e._fromBootupMin=true;var t=new o(e);if(t._template)if(w(t,e),t.isBuildVDom()){var n=e.element[0]?e.element[0]:e.element;if(!(n.wsControl=t).VDOMReady){if(t.mountToDom)t.mountToDom($(n),e,o);else t.setContainer($(n));if(t.saveOptions)t.saveOptions(e);else t._options=e}}else if(t.setParent(null),"function"===typeof t.init)t.init();if(l&&t.getReadyDeferred)l.push(t.getReadyDeferred());if(y.indexOf(i)>-1)_(t)},e.creators.push(o);e.modules.push(a)}return e},{creators:[],modules:[]}),r;function s(e){l&&l.done().getResult().addCallback(function(){u.Bus.globalChannel().setEventQueueSize("bootupReady",1),u.Bus.globalChannel().notify("bootupReady",{error:e}),f.global.setValue("bootupReadyFlagForGenerateId",true)})}return v.require(p(a.modules)).addCallback(function(){var e;if("string"===typeof window.componentOptions){if(window.componentOptionsEscaped)window.componentOptions=h.unescape(window.componentOptions);var o=(window.componentOptions||"{}").replace(/\!\@\#\$\^COMMENT_START\^\$\#\@\!/g,"\x3c!--");e=new i,b.merge(JSON.parse(o,e.deserialize))}function t(e){if(m.findAutofocus(e.target).length)r=m(e.target)}var n=$("body"),r=false;if(n.on("onReady",t),a.creators.forEach(function(e){e()}),n.off("onReady",t),!r)m($("[data-component]").eq(0));s()}).addErrback(function(e){d.IoC.resolve("ILogger").error("bootup",e&&e.message||e),s(e)})}function A(o,n,a,l){$(document).ready(function(){var r=new e({stopOnFirstError:false}),t=f.global.getValue("editParams")||f.global.getValue("printParams"),i=[];if(d.constants.decoratedLinkService="/linkdecorator/service/",0===arguments.length||1==arguments.length&&"string"!==typeof arguments[0])if($(".ws-root-template").each(function(){var e=$(this),o=e.data("template-name");if(o.indexOf("/")>-1&&void 0==t)y.push(o),e.attr("data-component",o);else i.push({templateName:o,ctr:e})}),i.length>0)c(["old-bootup"],function(e){for(var o=0,t=i.length;o<t;o++){var n=new s;r.push(n),e(i[o].templateName,i[o].ctr,null,n)}R(r,l)});else R(r,l);else c(["old-bootup"],function(e){e(o,n,a)})})}return function(e,o,t,n){A.call(this,e,o,t,n||i);var r=l();a(function(){return r})}});