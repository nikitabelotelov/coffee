define("Transport/RPCJSON",["Core/core-extend","Core/constants","Core/IoC","Transport/RPC/Body","Transport/RPC/Headers","Transport/RPC/request","Transport/RPC/fallback","Transport/RPC/ErrorCreator","Transport/XHRTransport","Core/ConsoleLogger"],function(r,n,e,i,c,a,p,t){var o=e.resolve("ILogger");function s(r,e){e=e?', use "'+e+'"':"",o.log("Transport/RPCJSON",'Method "'+r+'" is deprecated and will be removed'+e)}function d(r,e,t){return function(){return s(r,e),t.apply(this,arguments)}}function l(r){if("undefined"===typeof window||!window.cachedMethods||!window.cachedMethods.length)return false;return window.cachedMethods.indexOf(r)>-1}function u(r){return r.length<2*1024}var f=r({},{$protected:{_transports:null,_options:{serviceUrl:"",fallback:false,timeout:6e4,asyncInvoke:false,async:true}},$constructor:function(){this._transports={}},callMethod:function(r,e,t){var o=this.__getRequestParam(r,e,t);this._transports.current=o.transport;var n,s=(this._options.fallback?p:a)(o);return s.logCallbackExecutionTime(true),s.addErrback(function(r){if(!r.details){var e=r.httpError||0;r.details=e>500?rk("Попробуйте заглянуть сюда через 15 минут"):""}return r})},abort:function(){o.log("Transport/RPCJSON",'Метод "abort" обрывает только последний созданный запрос. Если вам необходима эта логика используйде Core/Deferred#cancel'),this._transports.current&&this._transports.current.abort()},__getRequestParam:function(r,e,t){var o="",n=false,s="POST",a;if(l(r))o=i.getURL(r,e);if(o&&u(o))s="GET",(a=this.__getTransport(s)).setUrl(this.__getServiceAddress(o)),n=true;return{method:r,timeout:this._options.timeout,headers:new c({method:r,httpMethod:s,fallback:this._options.fallback,asyncInvoke:this._options.asyncInvoke,recent:t}),transport:a||this.__getTransport(),data:n?"":i.getBody(r,e),url:this.__getServiceAddress()}},__getTransport:function(r){if(r=r||"POST",!this._transports[r])this._transports[r]=this.__createTransport(r);return this._transports[r]},__createTransport:function(r){return e.resolve("ITransport",{url:this.__getServiceAddress(),method:r,dataType:"json",contentType:"application/json; charset=utf-8",async:this._options.async})},__getServiceAddress:function(r){var e=this._options.serviceUrl||n.defaultServiceUrl,t,o=(e+=e.indexOf("?")>-1?"&":"?")+("x_version="+n.buildnumber);if(r)o+=r.replace(/^\?/,"&");return o},_setHeaders:function(r,e,t){s("_setHeaders","Transport/RPC/Headers"),Object.assign(r.reqHeaders,new c({recent:t,httpMethod:e,fallback:this._options.fallback,asyncInvoke:this._options.asyncInvoke}))},_fallbackResponse:function(r,e,t,o){s("_fallbackResponse")}});return f.jsonRpcPreparePacket=function(r,e,t){return s("jsonRpcPreparePacket",'Transport/RPC/Body" or "Transport/RPC/Headers'),{reqUrl:i.getURL(r,e,t),reqBody:i.getBody(r,e,t),reqHeaders:c.getForMethod(r)}},f.getEmptyRpcResponse=d("getEmptyRpcResponse","Transport/RPC/Body#getEmptyResponse",i.getEmptyResponse),f.handleHTTPError=d("handleHTTPError","Transport/RPC/ErrorNotifier#HTTP",t.fromHTTP),f.handleRPCError=d("handleRPCError","Transport/RPC/ErrorNotifier#RPC",t.fromRPC),f});