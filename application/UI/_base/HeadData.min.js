define("UI/_base/HeadData",["require","exports","Core/Themes/ThemesController","Env/Env","UI/_base/DepsCollector","View/Request"],function(e,s,u,t,r,d){"use strict";function i(e){var s=e;return s=(s=s.replace(/\/+$/,"")).replace(/^\/+/,"")}function n(e){for(var s=[],t=0;t<e.length;t++)s.push(i(e[t]));return s.join("/")}var o,p,a;Object.defineProperty(s,"__esModule",{value:true});try{p=e("json!resources/module-dependencies")}catch(e){}try{a=e("json!resources/contents")}catch(e){}try{o=e("json!resources/bundlesRoute")}catch(e){}o=o||{},p=p||{links:{},nodes:{}},a=a||{};var l=function(){function e(){var s=this;this.depComponentsMap={},this.additionalDeps={},this.waiterDef=null,this.isDebug=false,this.isNewEnvironment=false,this.resolve=null,this.renderPromise=null,this.renderPromise=new Promise(function(e){s.resolve=e}),this.depComponentsMap={},this.additionalDeps={},this.isDebug="true"===t.cookie.get("s3debug")||"debug"===a.buildMode}return e.prototype.pushDepComponent=function(e,s){if(this.depComponentsMap[e]=true,s)this.additionalDeps[e]=true},e.prototype.pushWaiterDeferred=function(e){var a=this,l=new r.default(p.links,p.nodes,o,true);this.waiterDef=e,this.waiterDef.then(function(){if(!a.resolve)return;var e=Object.keys(a.depComponentsMap),s={};if(a.isDebug)s={};else s=l.collectDependencies(e),u.getInstance().initCss({themedCss:s.css.themedCss,simpleCss:s.css.simpleCss});var t=d.getCurrent().stateReceiver.serialize(),r=[];for(var i in t.additionalDeps)if(t.additionalDeps.hasOwnProperty(i))r.push(i);var n=l.collectDependencies(r);if(s.js=s.js||[],!a.isDebug)for(var o=0;o<n.js.length;o++)if(!~s.js.indexOf(n.js[o]))s.js.push(n.js[o]);a.resolve({js:s.js||[],tmpl:s.tmpl||[],css:s.css||{themedCss:[],simpleCss:[]},errorState:a.err,receivedStateArr:t.serialized,additionalDeps:Object.keys(t.additionalDeps).concat(Object.keys(a.additionalDeps))}),a.resolve=null})},e.prototype.waitAppContent=function(){return this.renderPromise},e.prototype.resetRenderDeferred=function(){var s=this;this.renderPromise=new Promise(function(e){s.resolve=e})},e}();s.default=l});