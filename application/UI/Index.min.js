define("UI/Index",["View/Executor/TClosure","View/Logger","View/Executor/Expressions","View/Executor/Utils","Vdom/Vdom","Core/helpers/Hcontrol/doAutofocus","Core/IoC","require","exports"],function(o,r,i,s,u,a,l,c,t){"use strict";t["wml!UI/_index/Control"]=true;var f=function(){var t={},e=function(p){function t(){debugger}var e=Array.prototype.slice.call(arguments),n=function t(e,n,o,r,i){var s=0,u=0,a=n&&n.key||"_",l={id:[],def:void 0},c=p.configResolver.calcParent(this,"undefined"===typeof currentPropertyName?void 0:currentPropertyName,e),f=p.getMarkupGenerator(r);try{var h=f.joinElements([f.createTag("invisible-node",{attributes:{},events:"undefined"===typeof window?{}:{},key:a+"0_"},[],n,l,c)],a,l);if(l.def)h=f.chain(h,l,n),l=void 0}catch(t){p.templateError("undefined",t,e)}return h||f.createText("")};return n.stable=true,n.toJSON=function(){return{$serialized$:"func",module:"wml!UI/_index/Control"}},n}(o);if(e instanceof Function)return e;else for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n];return t}(),e=f,n,h,t;return t["UI/_index/Control"]=true,t={Control:function(){var t={},e=function(s,t,e,f,l,c,u,a,h){Object.defineProperty(t,"__esModule",{value:true});var p=1,n=function(){function i(t){var e=this;if(this._mounted=false,this._unmounted=false,this._destroyed=false,this._active=false,this._options=null,this._internalOptions=null,this._container=null,this._context=null,this.context=null,this.saveFullContext=null,this._saveContextObject=null,this._saveEnvironment=null,this.saveInheritOptions=null,this._getEnvironment=null,this._notify=null,this._forceUpdate=null,this._getMarkup=null,this.render=null,!t)t={};var l=this._children=null,n=null;this.saveFullContext=function(t){l=t},this._saveContextObject=function(t){n=t,e._context=t},this.context={get:function(t){if(n&&n.hasOwnProperty(t))return n[t];throw new Error("You trying to get unrequired field "+t)},set:function(){throw new Error("Can't set data to context. Context is readonly!")},has:function(){return true}};var o=null,c=null,r=null;this.saveInheritOptions=function(t){c=t},this._saveEnvironment=function(t,e){o=e,r=t},this._getEnvironment=function(){return r},this._notify=function(){return r&&r.startEvent(o,arguments)},this._forceUpdate=function(){var t=e||o&&o.control;if(t&&!t._mounted)t._$needForceUpdate=true;else r&&r.forceRebuild(o.id)},this._getMarkup=function t(e,n,o,r){if(!this._template.stable)return f.resolve("ILogger").error(this._moduleName,"Check what you put in _template"),"";var i;if(void 0===r)r=true;if(!o)o={};for(var s in o.context=l,o.inheritOptions=c,o.events)if(o.events.hasOwnProperty(s))for(var u=0;u<o.events[s].length;u++)if(o.events[s][u].fn.isControlEvent&&!o.events[s][u].fn.controlDestination)o.events[s][u].fn.controlDestination=this;if(i=this._template(this,o,e,r)){if(r)for(var a=0;a<i.length;a++)if(i[a])return i[a]}else i="";return i},this.render=function(t,e){var n=this._getMarkup(null,true,e,false);return this._isRendered=true,n},this._options={},this._internalOptions={},this._children={},this._instId="inst_"+p++,this._afterCreate&&this._afterCreate(t)}return i.prototype.getInstanceId=function(){return this._instId},i.prototype.mountToDom=function(t,e,n){if(!this._mounted)this._mounted=true,this._container=t,c.Synchronizer.mountControlToDOM(this,n,e,this._container);if(e)this.saveOptions(e)},i.prototype.saveOptions=function(t,e){if(void 0===e)e=null;if(this._options=t,e)this._container=e.element;return true},i._getInheritOptions=function(t){var e=t.getInheritOptions&&t.getInheritOptions()||{};if(!e.hasOwnProperty("readOnly"))e.readOnly=false;if(!e.hasOwnProperty("theme"))e.theme="";return e},i.createControl=function(t,e,n){if(u.OptionsResolver.resolveOptions(t,e)){var o={inheritOptions:{}},r;u.OptionsResolver.resolveInheritOptions(t,o,e,true);try{r=new t(e)}catch(t){r=new i({}),h.default.catchLifeCircleErrors("constructor",t)}return r.saveInheritOptions(o.inheritOptions),r._container=n,a.Focus.patchDom(n,e),r.saveFullContext(a.ContextResolver.wrapContext(r,{asd:123})),r.mountToDom(r._container,e,t),r}return null},i.prototype._setInternalOption=function(t,e){if(!this._internalOptions)this._internalOptions={},f.resolve("ILogger").error("Component with "+(this._options?"name "+this._options.name+" config "+this._options.__$config:"maybe id "+this._$id),"Control.constructor wasn't called");this._internalOptions[t]=e},i.prototype._setInternalOptions=function(t){for(var e in t)if(t.hasOwnProperty(e))this._setInternalOption(e,t[e])},i.prototype.destroy=function(){this._destroyed=true;try{var t=this.constructor.contextTypes?this.constructor.contextTypes():{};for(var e in t)if(t.hasOwnProperty(e))this.context.get(e).unregisterConsumer(this);if(this._mounted)this._beforeUnmount(),c.Synchronizer.cleanControlDomLink(this._container)}catch(t){h.default.catchLifeCircleErrors("_beforeUnmount",t)}},i.prototype._blur=function(){var t=this._container[0]?this._container[0]:this._container,e=document.activeElement,n;if(!a.Focus.closest(document.activeElement,t))return;if(-1===document.body.tabIndex)n=document.body.tabIndex,document.body.tabIndex=1;if(document.body.focus(),this._active){var o;t.controlNodes[0].environment._handleFocusEvent({target:document.body,relatedTarget:e})}if(void 0!==n)document.body.tabIndex=n},i.prototype.activate=function(){function t(t){var e=false,n=document.activeElement;if(t.wsControl&&t.wsControl.setActive)if(t.wsControl.canAcceptFocus())t.wsControl.setActive(true),e=t.wsControl.isActive();else e=false;else{if(c.TabIndex.getElementProps(t).tabStop)c.TabIndex.focus(t);if(e=t===document.activeElement,t=this._container[0]?this._container[0]:this._container,e&&!this._active){var o;t.controlNodes[0].environment._handleFocusEvent({target:t,relatedTarget:n})}}return e}for(var e=false,n=this._container[0]?this._container[0]:this._container,o=l.findAutofocusForVDOM(n),r,i,s=0;s<o.length;s++)if(r=o[s],!i)if(r&&r.controlNodes&&r.controlNodes.length)i=e=r.controlNodes[0].control.activate();if(!i){var u=c.TabIndex.getElementProps,a=c.TabIndex.findFirstInContext(n,false,u);if(a)e=t.call(this,a);else e=t.call(this,n)}return e},i.prototype._afterCreate=function(t){},i.prototype._beforeMount=function(){return Promise.resolve()},i.prototype._beforeMountLimited=function(){var t=this;if("undefined"!==typeof window)return this._beforeMount.apply(this,arguments);var r=this._beforeMount.apply(this,arguments);if(r&&r.callback)return new Promise(function(e,n){var o=0;r.then(function(t){if(!o)o=1,e(t);return t},function(t){if(!o)o=1,n(t);return t}),setTimeout(function(){if(!o)f.resolve("ILogger").error("_beforeMount","Wait 20000 ms "+self._moduleName),o=1,new Promise(function(t,e){s(["View/Executor/TClosure"],t,e)}).then(function(i){t._originTemplate=self._template,t._template=function(t,e,n,o,r){try{return this._originTemplate.apply(self,arguments)}catch(t){return i.getMarkupGenerator(o).createText("")}},t._template.stable=true,t._afterMount=function(){},e(false)})},2e4)});return r},i.prototype._afterMount=function(){},i.prototype._beforeUpdate=function(){},i.prototype._shouldUpdate=function(){return true},i.prototype._afterUpdate=function(){},i.prototype._beforeUnmount=function(){},i.isWasaby=true,i}();n.prototype._template=e,t.default=n}(c,t,f,l,a,u,s,i,r);if(e instanceof Function)return e;else for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n];return t}().default}});