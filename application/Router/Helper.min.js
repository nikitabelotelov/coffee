define("Router/Helper",["require","exports","Transport/URL/getUrl","Core/IoC","Router/UrlRewriter"],function(e,r,t,l,c){"use strict";function n(){e(["router"],function(e){c.default._prepare(e)},function(){c.default._prepare({})})}Object.defineProperty(r,"__esModule",{value:true});var i="";function f(e){if(-1!==e.indexOf("/")&&-1!==e.indexOf("="))l.resolve("ILogger").error("RouterHelper","Wrong mask, check it")}function a(e){i=e}function s(e){if(i&&!e)return i;var r=t(),n=(r=r.replace(/^http[s]?:\/\//,"")).indexOf("/");return r=r.slice(n)}function u(e){var r=e;if(-1!==r.indexOf("/"))if("/"===r[0])r="([/]|.*?\\.html/)"+r.slice(1);else r="(.*?/)"+r;else if(-1!==r.indexOf("="))r="(.*?\\?|.*?&)"+r;else r="(.*?/)"+r;if(-1!==r.indexOf("="))r+="(#.*|&.+)?";else r+="(#.*|/.*|\\?.+)?";return r}function o(e,r){var n=/:(\w+)/g,t=n.exec(e);while(t)r({preffixEnd:t.index,postfixStart:t.index+t[0].length,name:t[1]}),t=n.exec(e)}function d(e,r){var n=u(e),t=[];o(n,function(e){t.push({preffixEnd:e.preffixEnd,postfixStart:e.postfixStart}),r&&r(e)});for(var i=t.length-1;i>=0;i--)n=n.slice(0,t[i].preffixEnd)+"([^\\/?&#]+)"+n.slice(t[i].postfixStart);return n}function p(e,r,n){var t=d(e,void 0),i,f,l=c.default.get(n||s()).slice(r||0).match(t);return l?l[1].length:-1}function v(e,r,n,t){var i=[],f=d(e,function(e){i.push({name:e.name,value:r[e.name]})}),l,a,u=c.default.get(n||s()).slice(t||0).match(f);if(u)for(var o=2;o<u.length-1;o++)i[o-2].urlValue=decodeURIComponent(u[o]);return i}function x(n,t){var i=0,f=0;o(n,function(e){if(i++,void 0!==t[e.name]){var r=t[e.name];if("string"!==typeof r)r=JSON.stringify(r);r=encodeURIComponent(r),n=n.replace(":"+e.name,r),f++}});var e="";if(f===i)e=n;else if(0!==f)l.resolve("ILogger").error("RouterHelper","wrong resolvedCount, check it");return e}function g(e){var r={};return e.forEach(function(e){r[e.name]=e.value}),r}function m(e){var r={};return e.forEach(function(e){r[e.name]=void 0===e.urlValue?void 0:decodeURIComponent(e.urlValue)}),r}function O(e,r,n){return f(e),m(v(e,{},r,n))}function h(e,r,n){return f(e),g(v(e,r,void 0,n))}function R(e){if("/"===e[e.length-1])return e;else return e+"/"}function U(e,r,n,t){var i=v(r,n,void 0,t),f=g(i),l,a=x(r,m(i)),u=x(r,f),o=e;if(u&&"/"===u[0])o=u;else if(a)if(u)o=e.replace(a,u);else if(-1!==e.indexOf("/"+a))o=e.replace("/"+a,"");else if(-1!==e.indexOf("?"+a)){var c;if(-1!==e.indexOf("?"+a+"&"))o=e.replace("?"+a+"&","?");else o=e.replace("?"+a,"")}else if(-1!==e.indexOf("&"+a))o=e.replace("&"+a,"");else o=e.replace(a,"");else if(u){var s=e.indexOf("?");if("/"===u[0])o=u;else if(-1!==u.indexOf("="))if(-1!==s)o+="&"+u;else o+="?"+u;else if(-1!==s)o=R(e.slice(0,s))+u+e.slice(s);else o=R(e)+u}return o}function I(e,r,n){var t,i;return f(e),r=r.clear?{}:r,U(c.default.get(s()),e,r,n)}function C(e){var r=e||"";if(-1!==r.indexOf("?"))r=r.replace(/\?.*/,"");if(-1!==r.indexOf("#"))r=r.replace(/#.*/,"");if(-1!==r.indexOf("/"))r=r.split("/")[1];return r}function E(e){return C(e=c.default.get(e))+"/Index"}return n(),r.default={setRelativeUrl:a,getRelativeUrl:s,calculateUrlParams:O,calculateCfgParams:h,calculateHref:I,findIndex:p,getAppNameByUrl:E},r});