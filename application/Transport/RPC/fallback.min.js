define("Transport/RPC/fallback",["require","exports","Core/Deferred"],function(r,e,n){"use strict";var s="system.bl_async_replies",c=function(t){return function(e,r){if(!r)return;var n;if("string"===typeof r)n=JSON.parse(r);if(n&&n.guid===t.guid)clearTimeout(t.timeout),t.deferred.callback(n.data)}},t;return function(e){var t=e.data,u=e.headers,i=e.transport,a=e.timeout,o=new n;return r(["Lib/ServerEvent/Bus"],function(e){var n=function(){return e.serverChannel(s)};n().once("onReady",function(){var e={deferred:o,guid:u["X-UNIQ-ID"]},r=c(e);e.timeout=setTimeout(function(){n().unsubscribe("onMessage",r),o.errback("Timeout")},a),n().subscribe("onMessage",r),i.execute(t,u)})},function(e){o.errback(e)}),o}});