define("Lib/Control/Window/Window",["Core/core-extend","Core/helpers/isNewEnvironment","require","Core/IoC","Core/core-instance","Core/helpers/Function/callNext","Core/helpers/Function/forAliveOnly","Core/WindowManager","Core/CommandDispatcher","Core/constants","Core/helpers/Hcontrol/doAutofocus","Lib/Control/TemplatedAreaAbstract/TemplatedAreaAbstract","Lib/Control/ModalOverlay/ModalOverlay","Lib/FloatAreaManager/FloatAreaManager","Lib/Mixins/LikeWindowMixin","Lib/Mixins/PendingOperationParentMixin","Core/Deferred","Core/EventBus","Core/dom/wheel","Core/dom/getTouchEventCoords","Core/dom/getTouchEventClientCoords","Core/detection","Core/compatibility","css!Lib/Control/FloatArea/FloatArea","i18n!Lib/Control/Window/Window"],function(i,t,e,s,h,n,a,r,o,I,d,l,_,u,f,c,w,p,m,g,v,W){"use strict";var b=10,k=150,C=(I.defaultOptions||{})["Lib/Control/Window/Window"]||{};function A(t,i){var e=function(){var i;try{this._updateCount++,i=t.apply(this,arguments)}finally{if(this._updateCount--,0===this._updateCount&&false!==i){this._updateCount++;try{this._adjustWindowPosition(),this._onResizeHandler()}finally{this._updateCount--}}}return i};return i?e.bind(i):e}var x=i.mixin(l,[f,c]).extend({$protected:{_window:void 0,_windowContent:void 0,_updateCount:0,_titleBar:void 0,_resizeBar:void 0,_resizeBtn:void 0,_isShow:false,_isMaximized:false,_isCenteredV:false,_isCenteredH:false,_isAnimated:false,_isAnimating:false,_animatedWindows:false,_leftOpt:void 0,_topOpt:void 0,_maximizeBtn:void 0,_left:void 0,_top:void 0,_dRender:null,_zIndex:0,_startCoords:null,_options:{modal:false,resizable:true,caption:void 0,windowState:true,disableActions:false,deprecated:false,border:true,maximize:void 0,top:void 0,left:void 0,parent:null,title:"",animatedWindows:void 0,closeOnOverlayClick:true,draggable:true,origWidth:0,needSetDocumentTitle:true,origHeight:0,needRecalcPositionOnSizeChange:true,task_1174068748:false,adjustPositionAfterResize:false},_keysWeHandle:[I.key.esc,I.key.tab,I.key.enter,I.key.left,I.key.right],_haveTitle:false,_haveContentTitleBlock:false,_mouseMoveHandler:null,_mouseUpHandler:null,_absolutePosition:false},$constructor:function(i){if(this._mouseMoveHandler=this._mouseMove.bind(this),this._mouseUpHandler=this._mouseUp.bind(this),this._animatedWindows=void 0===this._options.animatedWindows?C.animatedWindows:this._options.animatedWindows,this._leftOpt=void 0===this._options.left?C.left:this._options.left,this._topOpt=void 0===this._options.top?C.top:this._options.top,this._moveWindowWithRecalc=A(this._moveWindow,this),this._dRender=new w,this._publish("onBeforeClose","onAfterClose","onMove","onAfterMove"),[["close",this.close],["ok",this.ok],["cancel",this.cancel],["maximize",this._maximizeWindow],["rebuildTitleBar",this._rebuildTitleBar]].forEach(function(i){o.declareCommand(this,i[0],i[1])}.bind(this)),void 0!==i.resizeable)this._options.resizable=i.resizeable;var t={left:parseInt(this._options.left,10),top:parseInt(this._options.top,10)};if(I.browser.isMobileSafari&&!this._options.resizable&&this._options.maximize)this._absolutePosition=false,t.right=0;else this._absolutePosition=true;if(this._window=this._createControl().css(t),this.subscribe("onAfterLoad",function(){if(this._options.deprecated)this.close(),e(["SBIS3.CONTROLS/Utils/InformationPopupManager"],function(i){i.showMessageDialog({status:"error",message:rk("У Вас недостаточно прав для просмотра.")})});else if(this._options.visible)this.show()}),I.browser.isIE)this.subscribe("onBatchFinished",function(){this._window.addClass("clear-box-shadow"),this._container.width(),this._window.removeClass("clear-box-shadow")});if(this._adjustWindowPositionSelf=this._mobileInput.bind(this),I.compatibility.touch)p.globalChannel().subscribe("MobileInputFocus",this._adjustWindowPositionSelf),p.globalChannel().subscribe("MobileInputFocusOut",this._adjustWindowPositionSelf);if(this._isModal&&this._options.closeOnOverlayClick)this.subscribeTo(_,"onClick",function(i){if(this.isVisible()&&_.isShownForWindow(this))this._moveFocusToSelf(),i.setResult(true),this.close()}.bind(this));if(p.globalChannel().notify("onWindowCreated",this),this._checkOpener(),this._options.adjustPositionAfterResize)this._orientationChangeHandler=this._orientationChangeHandler.bind(this),window.addEventListener("orientationchange",this._orientationChangeHandler)},_checkOpener:function(){if(t()&&!this._options._openFromAction)s.resolve("ILogger").error("Window","Компонент открыт напрямую без использования хэлперов открытия. \n"+"Для правильной работы компонента окно должно быть открыто через action. \n"+"Подробности: https://wi.sbis.ru/doc/platform/developmentapl/interface-development/ws4/components/templates/open-compound-template/")},_mobileInput:function(i){var t="mobileinputfocus"===i.name;if(this._options.adjustPositionAfterResize&&(this._options.top||this._options.left))return;setTimeout(function(){if(!t)this._adjustWindowPosition()}.bind(this),350)},_activateParent:function(){return false},_templateInnerCallback:A(function(){return x.superclass._templateInnerCallback.apply(this,arguments)}),_getTemplateComponent:function(){return this.getChildControls(void 0,false)[0]},_templateInnerCallbackBeforeReady:function(){var i=parseInt(this._leftOpt,10),t=parseInt(this._topOpt,10),e;if(this._left=isNaN(i)?0:i,this._top=isNaN(t)?0:t,this._isCenteredV=isNaN(t),this._isCenteredH=isNaN(i),this._isMaximized=!!(void 0!==this._options.maximize?this._options.maximize:this._options.windowState&&"maximized"==this._options.windowState),this.getContainer().toggleClass("ws-window-maximized",this._isMaximized),this._createTitleBar(),this._options.resizable&&!(this._options.autoWidth&&this._options.autoHeight))this._resizeBtn=$("<div></div>").addClass("ws-window-resize").bind("mousedown touchstart",function(i){return this._isResizing=true,this._mouseDown(i)}.bind(this)).appendTo(this._window);if(this._container.append('<div style="clear: both;">'),this._isOptionDefault("height")&&this._options.autoHeight)e="auto";else if(this._haveTitle&&!this._haveContentTitleBlock)if(e=parseInt(this._height,10),!isNaN(e))e+=this._titleBar.height();else e=this._height;else e=this._height;this.setSize({width:this._isOptionDefault("width")&&this._options.autoWidth?"auto":this._width,height:e}),this._dRender.callback()},_setMinMaxSizes:function(){},_postUpdateResizer:function(i,t){},describe:function(){return"Window#"+this.getId()+" template: "+(this._currentTemplateInstance&&this._currentTemplateInstance.getName()||this._options.template)},_loadDescendents:function(){return this._loadTemplate()},_childrenLoadCallback:function(){},_setTemplateDimensions:function(i){if(i.width&&this._isOptionDefault("width"))this._width=i.width;if(i.height&&this._isOptionDefault("height"))this._height=i.height},_isAcceptKeyEvents:function(){return true},_keyboardHover:function(i){if(i.which in this._keysWeHandle){if(i.which==I.key.esc)return this.close(),false;if(i.which==I.key.left||i.which==I.key.right)return this._switchingBetweenButtons(i);if(this.isEnabled())return x.superclass._keyboardHover.apply(this,arguments);else return true}return true},_switchingBetweenButtons:function(i){var t=r.getActiveWindow().getActiveChildControl(),e=this.getChildControls(),s=0,n=[],o,a;if(t&&!h.instanceOfModule(t,"Deprecated/Controls/Button/Button"))return true;for(o=0;o<e.length;o++)if(h.instanceOfModule(e[o],"Deprecated/Controls/Button/Button"))n.push(e[o]);for(o=0;o<n.length;o++)if(n[o].isActive()){s=o;break}if(i.which==I.key.left)a=s-1;if(i.which==I.key.right)a=s+1;if(n[a=(n.length+a)%n.length])n[s].setActive(false),n[a].setActive(true);return false},_createControl:function(){var i=this._isModal?"ws-modal":"",t=this._absolutePosition?"ws-absolute":"ws-fixed",e={opacity:0},o;if(this._absolutePosition)e.left=0,e.top=0;return o=$("<div></div>",{tabindex:0}).appendTo(document.body).css(e).addClass(t+" ws-window radius "+[i,this._options.cssClassName,this._options.className].join(" ")),this._windowContent=$("<div>",{style:"z-index: 0"}).addClass("ws-window-content radius").appendTo(o),this._container.prependTo(this._windowContent),this._container.css("z-index",0),m(o,function(i){var t=$(i.target,o),s=i.wheelDelta,e,n;if(!(t.toArray().concat(t.parentsUntil(o).toArray()).filter(function(i){var t=$(i),e=t.css("overflow-y");return("auto"===e||"scroll"===e)&&(s<0&&i.scrollHeight-t.scrollTop()>i.offsetHeight||s>0&&t.scrollTop()>0)}).length>0))if(i.stopPropagation(),!t.is("object"))i.preventDefault()}),o.get(0).wsControl=this,o},_setupTitleVisibility:function(){this._title.toggleClass("ws-hidden",0===this._title.html().trim().length)},_rebuildTitleBar:function(){var i;this._window.find(".ws-window-titlebar-custom.ws-window-titlebar").remove(),this._createTitleBar()},_createTitleBar:function(){var i=this._window.find(".ws-window-titlebar-custom").eq(0),t=this._container.find(".ws-Window__title-border").eq(0),e,s,n,o,a;if(this._haveContentTitleBlock=t.length>0,this._haveTitle=this._options.border||this._haveContentTitleBlock,this._haveTitle){if(this._haveContentTitleBlock)this._titleBar=t;else if(i.length>0)this._titleBar=i;else this._titleBar=$("<div></div>");if(e=this._haveContentTitleBlock?"radius":"ws-window-titlebar radius",o=function(i){if(!this._targetIsHeaderControl(i))i.preventDefault()}.bind(this),a=function(i){if(!this._targetIsHeaderControl(i))this._maximizeWindow()}.bind(this),this._titleBar.addClass(e).mousedown(o).dblclick(a).prependTo(this._window).append("<div>&nbsp;</div>"),!this._haveContentTitleBlock)this._title.addClass("ws-window-title").prependTo(this._titleBar),this._createTitleButtons(),this._applyDrag(this._titleBar);else if(this._title.detach(),(n=this._titleBar.find('div[sbisname="windowTitle"]')).length)this._applyDrag(n);if(this._options.draggable)this._window.addClass("ws-window-draggable");if(this._titleBar.removeClass("ws-hidden"),this._initKeyboardMonitor(this._titleBar),this._initKeyboardMonitor(this._window),s=void 0!==this._options.caption?this._options.caption:this._options.title)this.setTitle(s);this._setupTitleVisibility()}else if(this._titleBar)this._title.detach(),this._titleBar.remove(),this._titleBar=void 0,this._window.removeClass("ws-window-draggable")},_applyDrag:function(i){if(this._options.draggable)i.bind("mousedown touchstart",this._mouseDown.bind(this))},applyDrag:function(i){this._applyDrag(i)},_makeLoadErrorHandler:function(i){var t=x.superclass._makeLoadErrorHandler.call(this,i);return function(i){try{this._createTitleBar()}catch(i){}t.call(this,i)}},_createTitleButtons:function(){var i=this;if(!this._options.disableActions){if(this._options.resizable)this._maximizeBtn=$("<a></a>").addClass("ws-window-titlebar-action maximize").click(function(){i._maximizeWindow()}).prependTo(this._titleBar);$("<a></a>").addClass("ws-float-close ws-float-close-right").click(function(){return i._moveFocusToSelf(),i.close(),false}).prependTo(this._titleBar)}},_updateDocumentTitle:function(){var i=this.getTitle(),t=document.title,e=t?" - "+i:i,s=t.lastIndexOf(e),n=t.lastIndexOf(i);if(this._options.needSetDocumentTitle&&i&&(s!==t.length-e.length||t.length<e.length)&&(n!==t.length-i.length||t.length<i.length))document.title=document.title+e},_clearDocumentTitle:function(){var i=this.getTitle(),t=document.title,e=t?" - "+i:i,s=t.lastIndexOf(e),n=t.lastIndexOf(i),o;if(i&&(s===t.length-e.length||n===t.length-i.length))o=-1!==s?s:n,document.title=t.slice(0,-1!==o?o:t.length)},_setTitle:function(i){x.superclass._setTitle.apply(this,arguments),this._window.find('div[sbisname="windowTitle"] span').text(i),this._setupTitleVisibility()},getZIndex:function(){return this._zIndex},show:function(i){if(!this._isShow){if(W.isIE)this._window.addClass("ws-invisible");this._dRender.addCallback(n.call(this._showRenderCallback.bind(this,i),this._notifyBatchDelayed.bind(this,"onAfterShow")))}},_showRenderCallback:function(i){if(A(function(){if(this._window.css("opacity",""),this._window.removeClass("ws-hidden"),this._notify("onBeforeShow"),this._updateDocumentTitle(),this._isShow=true,this._checkDelayedRecalk(),!i)this.moveToTop(),d(this._container);else r.setVisible(this._zIndex);if(this._isModal)_.adjust();this._notify("onAfterVisibilityChange",true)},this)(),W.isIE)this._window.removeClass("ws-invisible")},_hideWindow:function(){this._window.addClass("ws-hidden"),this._isShow=false,r.popAndShowNext(this)},_restoreLastActiveOnHide:function(){if(W.isMobileIOS)$(document.activeElement).trigger("blur");var i=r.getActiveWindow();if(i)i.onBringToFront()},_notifyMaximizedChange:function(i){u._setWindowMaximized(this,i)},hide:function(){if(!this._isShow)return;if(this._notifyMaximizedChange(false),this._hideWindow(),r.releaseZIndex(this._zIndex),this._clearDocumentTitle(),this._restoreLastActiveOnHide(),this._releaseZIndex(),this._isModal)_.adjust();this._notify("onAfterVisibilityChange",false)},isVisible:function(){return this._isShow},close:function(n){var e=this;function o(i){var t=new w;return t.addCallback(function(){var i=e._saving;return e._saving=void 0,e.finishChildPendingOperations(i)}),e.waitAllPendingOperations(t.addCallback(i))}return this._saving=n,this.getReadyDeferred().addCallback(a(function(){var i=this,t=this._notify("onBeforeClose",n),e=function(){i.hide(),i._notify("onAfterClose",n),i.destroy()},s=this.getActiveChildControl(void 0,true);while(s)s&&s.setActive(false),s=s.getParent();if(false!==t)if(this._animatedWindows&&!this._isAnimating)this._isAnimating=true,this._window.animate({top:"-="+this._window.height()+"px"},k,function(){this._isAnimating=false,o(e.bind(i))});else o(e)},this))},_removeContainer:function(){this._window.empty().remove()},_releaseZIndex:function(){if(0!=this._zIndex)r.releaseZIndex(this._zIndex),this._zIndex=0},destroy:function(){if(this._notifyMaximizedChange(false),this._window.get(0).wsControl=null,this._titleBar)this._titleBar.unbind(),this._window.find('div[sbisname="windowTitle"]').unbind(),this._titleBar.empty().remove(),this._titleBar=$();if(this._resizeUnsub&&this._resizeUnsub(),this._releaseZIndex(),I.compatibility.touch)p.globalChannel().unsubscribe("MobileInputFocus",this._adjustWindowPositionSelf),p.globalChannel().unsubscribe("MobileInputFocusOut",this._adjustWindowPositionSelf);if(this._options.adjustPositionAfterResize)window.removeEventListener("orientationchange",this._orientationChangeHandler);if(x.superclass.destroy.apply(this,arguments),this._windowContent)this._windowContent.empty().remove(),this._windowContent=$();this.hide(),this._window=$()},ok:function(){return this.close(true)},cancel:function(){return this.close(false)},shadowsOff:function(){if(this._window.removeClass("radius"),this._windowContent.removeClass("radius"),this._titleBar)this._titleBar.removeClass("radius")},shadowsOn:function(){if(this._window.addClass("radius"),this._windowContent.addClass("radius"),this._titleBar)this._titleBar.addClass("radius")},_getResizerSize:function(i,t,e){return{width:Math.max(0,t+this._windowWidthStart-this._clientXstart-i.left),height:Math.max(0,e+this._windowHeightStart-this._clientYstart-i.top)}},_updateZIndex:function(){var i=r,t=this._zIndex;if(i.releaseZIndex(this._zIndex),this._zIndex=this._getNewZIndex(i),i.setVisible(this._zIndex),t!==this._zIndex)if(W.isIE10)this._window.css("z-index",0),setTimeout(function(){this._window.css("z-index",this._zIndex),this._adjustModalOverlay()}.bind(this),0);else this._window.css("z-index",this._zIndex),this._adjustModalOverlay()},_getNewZIndex:function(i){return i.acquireZIndex(this._isModal,this._isMaximized)},_adjustModalOverlay:function(){if(this._isModal)_.adjust()},_moveWindow:function(i,t){this._isCenteredV=false,this._isCenteredH=false,this._isMaximized=false,this._left=i,this._top=t,this._updateZIndex()},moveWindow:function(i,t){this._moveWindowWithRecalc(i,t)},setSize:A(function(i){var t=parseInt(this._options.minWidth,10)||0,e=parseInt(this._options.minHeight,10)||0,s=parseInt(this._options.maxWidth,10)||1/0,n=parseInt(this._options.maxHeight,10)||1/0;if(this._width=Math.min(s,Math.max(t,parseInt(i.width,10))),isNaN(this._width))this._width="auto";if(this._height=Math.min(n,Math.max(e,parseInt(i.height,10))),isNaN(this._height))this._height="auto"}),moveWindowToCenter:A(function(){this._isCenteredV=true,this._isCenteredH=true,this._isMaximized=false,this._updateZIndex()}),_maximizeWindow:A(function(){var i=this._options.resizable;if(i)if(this._isMaximized=!this._isMaximized,this.getContainer().toggleClass("ws-window-maximized",this._isMaximized),this._updateZIndex(),this._isMaximized){if(this._maximizeBtn)this._maximizeBtn.addClass("fill");if(this._window.removeClass("ws-window-draggable"),this._resizeBtn)this._resizeBtn.hide()}else{if(this._maximizeBtn)this._maximizeBtn.removeClass("fill");if(this._options.draggable)this._window.addClass("ws-window-draggable");if(this._resizeBtn)this._resizeBtn.show()}return i}),moveToTop:function(i){if(this._isShow){var t;if(!i&&!r.pushUp(this))return-1;if(this._updateZIndex(),$(".ws-window-titlebar.active").removeClass("active"),this._titleBar)this._titleBar.addClass("active");return this._zIndex}else return-1},isMovableToTop:function(){return true},_targetIsHeaderControl:function(i){var t=".ws-window-titlebar-action, .ws-component:not(html), .ws-float-close",e=$(i.target).parents().add(i.target);return e.closest(t).length&&!e.closest('[sbisname="windowTitle"]').length},_mouseDown:function(i){if(this._isMaximized||this._targetIsHeaderControl(i))return true;u._hideUnnecessaryAreas(this),this.moveToTop();var t=this._window.offset(),e=g(i);if(this._clientXstart=e.x-t.left,this._clientYstart=e.y-t.top,this._windowWidthStart=this._window.width(),this._windowHeightStart=this._window.height(),this._mouseStarted=true,this._startCoords={left:this._left,top:this._top},this._isResizing){var s=this._window.offset();this._resizeBar=$("<div></div>").addClass("ws-window-resizebar").fadeTo(0,.8).appendTo(document.body).css({top:s.top-b,left:s.left-b,width:this._window.width(),height:this._window.height(),"z-index":r.getMaxZIndex()+10})}return I.$doc.bind("mousemove touchmove",this._mouseMoveHandler).bind("mouseup touchend",this._mouseUpHandler),i.preventDefault()},_mouseMove:function(i){if(this._mouseStarted)if(this._isResizing){var t=g(i);this._resizeBar.css(this._getResizerSize(this._resizeBar.offset(),t.x,t.y))}else{var t=v(i);this._moveWindow(t.x-this._clientXstart,t.y-this._clientYstart),this._adjustWindowPosition()}if("touchmove"!==i.type)i.stopPropagation(),i.preventDefault()},_mouseUp:function(i){if(!I.browser.isIE)this._window.fadeTo(0,1);if(this._window.removeClass("move"),I.$doc.unbind("mousemove touchmove",this._mouseMoveHandler).unbind("mouseup touchend",this._mouseUpHandler),this._mouseStarted=false,this.onBringToFront(),this._isResizing){var t=this._resizeBar.offset();this._resizeBar.remove(),this._isResizing=false;var e=g(i);this.setSize(this._getResizerSize(t,e.x,e.y))}if(this._startCoords.left!==this._left||this._top!==this._startCoords.top)this._notify("onAfterMove")},canAcceptFocus:function(){return this.isShow()},_restoreSize:function(){},_onResizeHandler:function(){if(this._options.adjustPositionAfterResize)this._adjustWindowPosition();x.superclass._onResizeHandler.apply(this,arguments)},_orientationChangeHandler:function(){this._adjustWindowPosition()},_adjustWindowPosition:function(){if(this.isDestroyed())return;function i(i){var t=["width","height","max-width","max-height","min-width","min-height","margin-left","margin-right","margin-top","margin-bottom"];for(var e in i)if(i.hasOwnProperty(e)){var s=i[e];if(-1!==t.indexOf(e))i[e]="auto"===s||""===s?s:0!==s?s+"px":0}return i}if(this.isVisible())this._notifyMaximizedChange(this._isMaximized);var t=I.browser.isMobileSafari,e=t?window.innerWidth:$(window).width(),s=t?window.innerHeight:$(window).height(),n=this._options.border?100:0,o,a=this._options.minHeight,h={},r=this._left,d=this._top,l=this._haveTitle?this._titleBar.height():0,_=this._haveContentTitleBlock?l:0,u=this._windowContent.outerHeight()-this._windowContent.height(),f={},c=this._window.offset(),w=Math.max(0,e),p=Math.max(0,s),m=Math.max(p-l-u,0),g,v,b,C,x;if(this._isAnimating)return true;if("auto"===this._height){if(this._isMaximized)this._container.css("height","auto"),h.height=this._container.height()<m?m:"auto";else if(this._options.task_1174068748){if(this._container.css("height","auto"),W.firefox)this._container.resize();h.height=this._container.height()<m?"auto":m}else h.height="auto";h.minHeight=a?Math.max(0,a-_):""}else if(this._isMaximized)h.height=Math.max(0,p-l);else h.height=this._height-l;if("auto"===this._width){if(this._container.css({width:"auto","min-width":""}),this._isMaximized)this._container.css("width","auto"),h.width=this._container.width()<w?w:"auto";else if(h.width="auto",!this._options.task_1174068748)h.display="table";o=Math.max(this.isVisible()?this.getMinWidth():this._options.minWidth,n),h.minWidth=o||""}else if(this._isMaximized)h.width=w;else h.width=this._width;if(this._windowContent.css(i({"overflow-x":"hidden","overflow-y":"hidden","margin-top":l,"max-width":w,"max-height":m,width:""})),this._container.css(i({width:h.width,height:h.height,display:h.display,"min-height":h.minHeight,"min-width":h.minWidth,position:"relative",overflow:"visible"})),W.isIE12)this._windowContent.css("width",h.width);if(b={},this._windowContent.prop("scrollHeight")>m+u)b["overflow-y"]="scroll",x=true;if(this._windowContent.css(b),b={},this._windowContent.prop("scrollWidth")>w)b["overflow-x"]="scroll",C=true;if(I.compatibility.touch&&(C||x))b["-webkit-overflow-scrolling"]="touch";if(C&&x||this._isMaximized)b["width"]=w;if(this._windowContent.css(b),g=this._window.outerWidth(true),v=this._window.outerHeight(true),this._isMaximized)f={left:0,top:0};else f={top:this._isCenteredV?(s-v)/2:Math.min(Math.max(0,d),s-v),left:this._isCenteredH?(e-g)/2:Math.min(Math.max(0,r),e-g)};if(this._absolutePosition){var z=$(window).scrollTop(),y=$(window).scrollLeft();f.top+=z>=0?z:0,f.left+=y>=0?y:0}function M(){if(B._options.adjustPositionAfterResize&&B._options.top){var i=B._options.top,t=i+B._container[0].offsetHeight-window.innerHeight;if(t>0)i=Math.max(i-t,0);f.top=i}if(c.left!==f.left||c.top!==f.top)f.left=parseInt(f.left,10),f.top=parseInt(f.top,10),B._window.css(f),B._notify("onMove",f.left,f.top)}var B=this,T;if(this._animatedWindows&&!this._isAnimated&&!this._isAnimating)f.top=-this._window.height(),M(),this._window.animate({top:"+="+this._window.height()+"px"},k,A(function(){B._isAnimating=false,B._isAnimated=true},B)),this._isAnimating=true;else M()},_onSizeChangedBatch:function(){var i;if(x.superclass._onSizeChangedBatch.apply(this,arguments),!(I.browser.isMobilePlatform&&$(document.activeElement).is('input[type="text"], textarea, *[contentEditable=true]'))&&this._options.needRecalcPositionOnSizeChange)this._adjustWindowPosition();return true},_subscribeToWindowResize:function(){var i=A(function(){},this);I.$win.bind("resize",i),this._resizeUnsub=function(){I.$win.unbind("resize",i)}},_templateOptionsFilter:function(){var i;return x.superclass._templateOptionsFilter.apply(this,arguments).concat("border","resizable","resizeable","caption","maximize","windowState","deprecated")},_resizeInner:function(){if(this.isVisible()&&this._options.needRecalcPositionOnSizeChange)A(function(){},this)()}});return x.setDefaultOptions=function(i){C=(i||{})["Lib/Control/Window/Window"]||{}},x});