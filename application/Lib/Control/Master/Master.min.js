define("Lib/Control/Master/Master",["Core/core-instance","Core/Deferred","Core/CommandDispatcher","Lib/Control/CompoundControl/CompoundControl","Lib/Control/TemplatedArea/TemplatedArea"],function(p,a,s,t,h){"use strict";var e=t.extend({$protected:{_options:{steps:[],width:"auto",height:"120px",showTitle:true},_steps:{},_controls:{},_loaded:{},_currStep:void 0,_toStep:{},_history:[]},$constructor:function(){var t=this;for(var e in this._publish("onPrevious","onNext","onStepReady","onComplete","onCancel"),s.declareCommand(this,"next",this.next),s.declareCommand(this,"prev",this.prev),s.declareCommand(this,"complete",this.complete),s.declareCommand(this,"cancel",this.cancel),this._dReady=new a,this._dReady.addCallback(function(){t._notify("onReady")}),this._options.steps)if(this._options.steps.hasOwnProperty(e)){var i=parseInt(e,10);this._toStep[this._options.steps[i].id]=i+1}},init:function(){this._createSteps(),e.superclass.init.apply(this,arguments)},getReadyDeferred:function(){return this._dReady},_getId:function(t){return this._options.steps[t-1].id?this._options.steps[t-1].id:t},_loadContent:function(n,o){return this._runInBatchUpdate("Master._loadContent",function(){var e=this,i=this._getId(n),t;if(!this._loaded[n]){if(this._loaded[n]=true,void 0!==this._options.steps[n-1].template){var s=new a,r;r=new h({autoHeight:true,autoWidth:true,template:this._options.steps[n-1].template,element:this._getBlockId(i),parent:this,keepSize:false,tabindex:1,name:"mysteparea"+i,context:this.getLinkedContext(),handlers:{onReady:function(){if(e._setUpTitle(n),e._steps[e._currStep]&&!o)e._steps[e._currStep].addClass("ws-hidden");if(e._currStep=n,!e._dReady.isReady())e._dReady.callback();else this.setActive(true);s.callback()}}}),e._controls[n]=r,t=s}}else if(e._controls[n]&&!e._controls[n].isReady())return e._controls[n].getReadyDeferred();else this._setUpTitle(n),this._currStep=n,(t=new a).callback();return t.addCallback(function(){var t=e.getChildArea(n);t._notifyOnSizeChanged(t,t),t._checkDelayedRecalk(),e._notify("onStepReady",n,i)}),t})},_createSteps:function(){if(!this._options.steps)return;this._allowEvents();var t=this._notify("onNext",1,this._getId(1));for(var e in t=this._parseStepValue(t)||1,this._options.steps){if(!this._options.steps.hasOwnProperty(e))continue;var i=parseInt(e,10)+1,s=this._options.steps[i-1],r=void 0===s.id||""===s.id?i:s.id,n=t!=i?" ws-hidden":"";if(this._steps[i]=$('<div class="ws-master-div ws-area-height-100-fix'+n+'" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" id="'+this._getBlockId(r)+'"></div>').appendTo(this._container),this._loaded[i]=false,t==i)this._currStep=i,this._loadContent(i,true)}},_setUpTitle:function(t){var e=this._options.showTitle;if(true===e){var i=this.getParent();while(i&&!p.instanceOfModule(i,"Lib/Control/Window/Window"))i=i.getParent();if(p.instanceOfModule(i,"Lib/Control/AreaAbstract/AreaAbstract")&&!i.isPage()){var s=i.getTitle(),r=this._options.steps[this._currStep-1].title,n=this._options.steps[t-1].title,o=new RegExp(" "+r+"$");if(o.test(s))i.setTitle(s.replace(o," "+n));else i.setTitle(s+" "+n)}}else if(e.length){var a=this._getControls(t);if(void 0!==a)for(var h=0;h<a.length;h++){var l=a[h];if(p.instanceOfModule(l,"Deprecated/Controls/FieldLabel/FieldLabel")&&l.getName()===e)l.setValue(this._options.steps[t-1].title)}}},next:function(){var t=1+this._currStep;if(t>this._options.steps.length)return true;if(this.validate(this._currStep)){var e=this._notify("onNext",t,this._getId(t));t=void 0===e?t:e,this.setStep(t)}return true},prev:function(){var t=this._history.pop();if(void 0===t)return true;var e=this._notify("onPrevious",t,this._getId(t));return t=void 0===e?t:e,this.setStep(t),this._history.pop(),true},complete:function(){if(this.validate(this._currStep))this._notify("onComplete",this._currStep,this._getId(this._currStep));return true},cancel:function(){var t=this.getLinkedContext().getRecord();if(t)t.rollback();return this._notify("onCancel"),true},_parseStepValue:function(t){if(void 0!==t)if(!isNaN(parseFloat(t))&&isFinite(t)){if(t>0&&t<=this._options.steps.length)return t}else if(t.length)return this._toStep[t];return},setStep:function(t){var e=this._parseStepValue(t);if(null===e||void 0===this._currStep||this._currStep===e||void 0===this._steps[e])return;if(this._steps[e].removeClass("ws-hidden"),this._steps[this._currStep])this._steps[this._currStep].addClass("ws-hidden");this._history.push(this._currStep),this._loadContent(e)},getStepId:function(){return this._options.steps[this._currStep-1].id},getStep:function(){return this._currStep},_getBlockId:function(t){return"ws-master-"+this.getId()+"-"+t},_getControls:function(t,e){var i=this._controls[t];return i&&p.instanceOfModule(i,"Lib/Control/AreaAbstract/AreaAbstract")?i.getChildControls.apply(i,e):[]},getChildControls:function(){return this._getControls(this._currStep,arguments)},validate:function(t){var e=t?t:this._currStep,i=[this._controls[e]]||[];if(void 0!==i){for(var s=true,r=0;r<i.length;r++){var n=i[r];if(n.validate)s=true===n.validate()&&s}return s}return true},getChildArea:function(t){return this._controls[t]},getSteps:function(){return this._options.steps}});return e});