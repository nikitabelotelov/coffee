define("Lib/Control/Paging/Paging",["Core/Deferred","Lib/Control/Control","tmpl!Lib/Control/Paging/Paging","html!Lib/Control/Paging/Pages_list","css!Lib/Control/Paging/Paging","i18n!Lib/Control/Paging/Paging"],function(e,t,i,s){"use strict";var o=t.Control.extend({_dotTplFn:i,$protected:{_options:{recordsPerPage:void 0,currentPage:1,recordsCount:void 0,pagesLeftRight:3,onlyLeftSide:false,rightArrow:void 0},_listTpl:void 0,_block:[],_maxPage:0,_hasAfterMax:true},$constructor:function(){if(this._options.onlyLeftSide&&void 0===this._options.rightArrow&&(void 0===this._options.recordsCount||void 0===this._options.currentPage||void 0===this._options.recordsPerPage))throw new Error("Не указано количество записей для Control/Paging");this._options.recordsCount=parseInt(this._options.recordsCount,10),this._options.currentPage=parseInt(this._options.currentPage,10),this._options.recordsPerPage=parseInt(this._options.recordsPerPage,10),this._options.pagesLeftRight=parseInt(this._options.pagesLeftRight,10),this._publish("onPageChange"),this._block=this._container.find(".ws-paging"),this._maxPage=this._options.currentPage,this._build()},addContainer:function(t){for(var i=0,e=t.length;i<e;++i)this._container.push(t[i]),(t[i].wsControl=this)._block.push($('<div class="ws-paging"></div>')),t.eq(i).append(this._block[this._block.length-1]);this._build()},_initContainer:function(t){if("element"in t)if("string"==typeof t.element){var i=t.element.split(",");this._container=$();for(var e=0;e<i.length;++e)this._container.push($("#"+i[e].trim()).get(0))}else if("jquery"in t.element)this._container=t.element;else if(t.element.nodeType)this._container=$(t.element)},_isCorrectContainer:function(){return void 0!==this._container&&"jquery"in this._container&&this._container.length>=1},update:function(t,i,e){if(this._options.currentPage==t&&void 0===i&&void 0===e)return;if(void 0!==e){var s=t||this._options.currentPage;if(s>=this._maxPage||!e)this._maxPage=s,this._hasAfterMax=!!e}t=void 0!==t?t:this._options.currentPage,i=void 0!==i?i:this._options.recordsCount,this._options.currentPage=t,this._options.recordsCount=i,this._options.rightArrow=e,this._build()},clearMaxPage:function(){this._maxPage=0,this._hasAfterMax=true,this._build()},_pageLoaded:function(t,i){if(i instanceof Object)this.update(i[0],i[1],i[2]);else this.update(t,void 0,i)},_blockClick:function(t){var i=$(t.currentTarget),e;if(!this._options.enabled||!i.hasClass("ws-paging-active"))return false;if(i.hasClass("ws-paging-first"))e=1;else if(i.hasClass("ws-paging-prev"))e=this._options.currentPage-1;else if(i.hasClass("ws-paging-next"))e=this._options.currentPage+1;else if(i.hasClass("ws-paging-end"))e=this._options.onlyLeftSide?0:Math.ceil(this._options.recordsCount/this._options.recordsPerPage);else e=parseInt(i.text(),10);this.setPage(e)},_build:function(){if(this._listTpl){if(!this.isDestroyed())this._buildCallback()}else if(!this.isDestroyed())this._listTpl=s,this._buildCallback()},_buildCallback:function(){var t,i,e;if(this._block.empty(),this._container.show(),t=this._options.onlyLeftSide?this._maxPage:Math.ceil(this._options.recordsCount/this._options.recordsPerPage),(i=Math.max(this._options.currentPage,t))<=1&&(!this._options.onlyLeftSide||!this._options.rightArrow))this._container.hide();else e=$(this._listTpl({countPages:i,context:this,block:this._block,options:this._options})),$(e).bind("click",this._blockClick.bind(this)),this._block.append(e)},setRecordSet:function(t){var e=this;t.subscribe("onPageChange",function(t,i){e.update(i+1)})},setPageSize:function(t){this._options.recordsPerPage=t,this._build()},setPage:function(t){if("number"===typeof t){var i=new e;if(this._options.onlyLeftSide)i.addCallback(this._pageLoaded.bind(this,t));else this.update(t);return this._notify("onPageChange",t,i),false}},getPage:function(){return this._options.currentPage},setCurrentPage:function(t){this._options.currentPage=t},destroy:function(){if(this._block)this._block.empty().remove(),this._block=null;o.superclass.destroy.apply(this,arguments)}});return o});