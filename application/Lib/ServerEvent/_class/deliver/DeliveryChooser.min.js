define("Lib/ServerEvent/_class/deliver/DeliveryChooser",["require","exports","Core/Deferred","Core/detection","Lib/ServerEvent/_class/Notifier","Lib/ServerEvent/_class/deliver/Browser","Lib/ServerEvent/_class/deliver/Page"],function(n,e,i,o,r,c,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});var d=new r.Notifier,t=function(){function e(e){this.watcher=e,d.setWatcher(e)}return e.prototype.choose=function(e){if("WorkerTransport"===e.getLocalName()||o.isMobileIOS)return i.success(new a.Page(d));var r=a.Page,t;if("LocalPageTransport"!==e.getLocalName())r=c.Browser;if(o.isMobileAndroid&&"undefined"!==typeof Promise&&"undefined"!==typeof indexedDB&&null!==indexedDB)return this.tryLazyIndexedDb().addErrback(function(){return new r(d)});return i.success(new r(d))},e.prototype.tryLazyIndexedDb=function(){var r=new i,t;return n(["Lib/ServerEvent/_class/deliver/IndexedDB"],function(e){if(!e)return r.errback();try{t=setTimeout(function(){r.errback("Timeout crete indexedDB")},3e3),r.dependOn(e.IndexedDB.create(d))}catch(e){r.errback(e)}}),r.addCallback(function(e){return clearTimeout(t),e}),r},e}();e.DeliveryChooser=t});