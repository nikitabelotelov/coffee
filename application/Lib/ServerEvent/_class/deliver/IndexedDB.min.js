define("Lib/ServerEvent/_class/deliver/IndexedDB",["require","exports","Lib/ServerEvent/native/_IndexedDB"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=5e3,r=function(){function r(e,t){this.notifier=e,this.connect=t,this.lastReaded=Date.now()-r.INIT_TIMEOUT,this.tick=this.tick.bind(this),this.timer=setInterval(this.tick,n),this.reader=this.connect.createReader()}return r.prototype.deliver=function(e,t,r){if(!this.writer)this.writer=this.connect.createWriter();this.writer.write(e,t,r)},r.prototype.tick=function(){var s=this,e=this.lastReaded;this.lastReaded=Date.now(),this.reader.query(e).then(function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.channelName,o=i.eventName,c=i.body;s.notifier.fire(n,o,c)}})},r.prototype.destroy=function(){if(this.destroy=function(){},this.connect=null,clearInterval(this.timer),this.writer)this.writer.destructor()},r.create=function(t){return i.Connector.connect(i.Connector.DB_DELIVER,i.Connector.EVENTS_STORE_NAME,new i.AdapterEvent(2)).addCallback(function(e){return new r(t,e)})},r.INIT_TIMEOUT=4e3,r}();t.IndexedDB=r});