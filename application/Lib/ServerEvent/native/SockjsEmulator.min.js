define("Lib/ServerEvent/native/SockjsEmulator",["require","exports","Lib/ServerEvent/_class/Events"],function(e,t,u){"use strict";function i(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=Math.floor(256*Math.random());return t}var a="abcdefghijklmnopqrstuvwxyz012345",s={string:function(e){for(var t=a.length,r=i(e),n=[],o=0;o<e;o++)n.push(a.substr(r[o]%t,1));return n.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length,r;return(new Array(t+1).join("0")+this.number(e)).slice(-t)}},c=8,r=3e3,n;return function(){function a(e,t,r){if(void 0===t)t=[];if(void 0===r)r=true;var n=s.numberString(1e3),o=s.string(c),i="/"===e[e.length-1]?"":"/";if(this.ws=new WebSocket(""+e+i+n+"/"+o+"/websocket",t),this.checkHeartbeat=this.checkHeartbeat.bind(this),this.updateHeartbeat=this.updateHeartbeat.bind(this),this.lastHeartbeat=(new Date).getTime(),this.ws.onmessage=this.updateHeartbeat,r)this.intervalHeartbeatId=setInterval(this.checkHeartbeat,a.HEARTBEAT_TIMEOUT)}return a.prototype.checkHeartbeat=function(){if(this.lastHeartbeat+a.HEARTBEAT_TIMEOUT<(new Date).getTime())clearInterval(this.intervalHeartbeatId),this.close(r)},a.prototype.updateHeartbeat=function(){this.lastHeartbeat=(new Date).getTime()},a.prototype.send=function(e){var t,r='["'+e.replace(/\u0000/gm,"\\u0000").replace(/\n/gm,"\\n").replace(/\f/gm,"\\f").replace(/\r/gm,"\\r").replace(/\t/gm,"\\t")+'"]';this.ws.send(r)},a.prototype.close=function(e,t){this.ws.close()},Object.defineProperty(a.prototype,"binaryType",{get:function(){return this.ws.binaryType},set:function(e){this.ws.binaryType=e},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"bufferedAmount",{get:function(){return this.ws.bufferedAmount},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"extensions",{get:function(){return this.ws.extensions},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"onclose",{get:function(){return this.ws.onclose},set:function(e){this.ws.onclose=e},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"onerror",{get:function(){return this.ws.onerror},set:function(e){this.ws.onerror=e},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"onmessage",{get:function(){return this.ws.onmessage},set:function(o){var i=this;this.ws.onmessage=function(e){if(i.updateHeartbeat(),!e.data)return;if(e.data[0]===a.FRAME_CLOSE){var t=JSON.parse(e.data.substr(1));if(!t[1])return;return o.call(i,u.createME("websocket",{data:t[1],origin:e.origin,source:e.source})),i.close()}if(-1!==a.CONTROL_FRAMES.indexOf(e.data[0]))return;if(a.FRAME_ARRAY!==e.data[0])o.call(i,Object.create(e,{data:{value:e.data}}));for(var r=JSON.parse(e.data.substr(1)),n=0;n<r.length;n++)o.call(i,Object.create(e,{data:{value:r[n]}}))}},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"onopen",{get:function(){return this.ws.onopen},set:function(e){this.ws.onopen=e},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"protocol",{get:function(){return this.ws.protocol},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"readyState",{get:function(){return this.ws.readyState},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"url",{get:function(){return this.ws.url},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"CLOSED",{get:function(){return this.ws.CLOSED},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"CLOSING",{get:function(){return this.ws.CLOSING},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"CONNECTING",{get:function(){return this.ws.CONNECTING},enumerable:true,configurable:true}),Object.defineProperty(a.prototype,"OPEN",{get:function(){return this.ws.OPEN},enumerable:true,configurable:true}),a.prototype.addEventListener=function(e,t,r){if(void 0===r)r=false;this.ws.addEventListener(e,t,r)},a.prototype.dispatchEvent=function(e){return this.ws.dispatchEvent(e)},a.prototype.removeEventListener=function(e,t,r){this.ws.removeEventListener(e,t)},a.FRAME_OPEN="o",a.FRAME_HEARTBEAT="h",a.FRAME_ARRAY="a",a.CONTROL_FRAMES=[a.FRAME_OPEN,a.FRAME_HEARTBEAT,a.FRAME_CLOSE="c"],a.HEARTBEAT_TIMEOUT=3e4,a}()});